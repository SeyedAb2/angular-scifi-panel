import{d as Iv}from"./chunk-KBXHQIL6.js";import{d as hv,l as dv,m as ee,n as Tt,o as gl,p as _l,q as fv,r as pv,s as yl,t as mv,u as Js,v as gv,w as _v,x as yv,y as vv,z as wv}from"./chunk-NQRJCY7Z.js";import{a as uv,b as cv}from"./chunk-J3QV27FA.js";import"./chunk-R73LZQLH.js";import"./chunk-MTAQQOA3.js";import{n as av,o as lv}from"./chunk-33F7243U.js";import{a as ov}from"./chunk-LXAWDZ5C.js";import"./chunk-UYA7X4TY.js";import{d as iv}from"./chunk-HNG6GNP5.js";import{c as sv}from"./chunk-FXPGYO6N.js";import"./chunk-OWSFIWII.js";import"./chunk-EI43ISGQ.js";import"./chunk-FWBM2LHM.js";import"./chunk-UVUT6WPB.js";import"./chunk-4RC4KZ5X.js";import"./chunk-FFZMO4ZQ.js";import{a as de,b as tn,f as zy,g as kh,n as Ii,o as Mh,p as $a}from"./chunk-HX3ESI56.js";import{B as Gy,D as tl,E as nl,F as rl,G as Je,H as il,I as sl,J as ol,K as Uh,L as al,M as ll,N as ul,O as cl,P as hl,Q as dl,R as fl,S as pl,T as ml,U as rv,c as Fy,d as Oy,e as Vy,h as Wa,l as Ly,m as F,o as Qa,p as Uy,q as qy,y as jy,z as Ky}from"./chunk-SWNMHBRX.js";import{P as By}from"./chunk-23EAPCQL.js";import{A as My,d as ky}from"./chunk-2LOGFC5J.js";import{Aa as Sy,Cb as Ry,E as Nh,Fb as Py,G as Dh,Ga as by,Ha as G,Hb as Ny,Jb as wi,La as Ay,Sc as xy,V as ja,ba as za,c as Ua,da as Rr,ea as Iy,gb as Ga,ha as Ey,hb as xh,ia as Ka,j as qa,ja as Ty,jc as Dy,p as Ws,pa as Cy,q as Qs,qa as ge,u as et,ua as Kn,va as K,xa as Gn,za as ae}from"./chunk-DLPH24CR.js";import{A as Z,B as Et,C as Ye,D as Lh,E as nv,F as Ys,G as ce,H as rn,I as Xa,J as Bh,K as Vt,L as Ti,M as Za,N as el,P as Ci,Q as Qn,a as O,b as Ei,c as Wy,d as Qy,e as $y,f as pt,g as Ha,h as $s,i as Fh,j as Hy,k as nn,l as Oh,m as Yy,n as Jy,p as Ya,q as Ge,r as Xy,s as Zy,t as Ot,u as Wn,v as Ja,w as Hs,x as Vh,y as ev,z as tv}from"./chunk-X2P3SVT6.js";import{a as Ph}from"./chunk-2EBTC7QX.js";import{a as en,b as Gs,d as wy,h as Rh,i as x}from"./chunk-FFXK657A.js";var Ev=[{path:"team-tree",loadComponent:()=>import("./chunk-MQWU653I.js").then(n=>n.TeamTreeComponent),title:"SCIFI - Team Tree"},{path:"dashboards",children:[{path:"gaming",loadComponent:()=>import("./chunk-4IEB5OPL.js").then(n=>n.GamingComponent),title:"SCIFI - Gaming"},{path:"sales",loadComponent:()=>import("./chunk-2NTGTV4C.js").then(n=>n.SalesComponent),title:"SCIFI - Sales"},{path:"analytics",loadComponent:()=>import("./chunk-WNBTFOXG.js").then(n=>n.AnalyticsComponent),title:"SCIFI - Analytics"},{path:"ecommerce",loadComponent:()=>import("./chunk-CZMVUJFX.js").then(n=>n.EcommerceComponent),title:"SCIFI - Ecommerce"},{path:"nft",loadComponent:()=>import("./chunk-3M3UQUJL.js").then(n=>n.NftComponent),title:"SCIFI - NFT"},{path:"crm",loadComponent:()=>import("./chunk-5LZMYRVL.js").then(n=>n.CrmComponent),title:"SCIFI - CRM"},{path:"hrm",loadComponent:()=>import("./chunk-RNTMMOP6.js").then(n=>n.HrmComponent),title:"SCIFI - HRM"},{path:"crypto",loadComponent:()=>import("./chunk-EJM7YQCM.js").then(n=>n.CryptoComponent),title:"SCIFI - Crypto"},{path:"jobs",loadComponent:()=>import("./chunk-KUS7ADJ7.js").then(n=>n.JobsComponent),title:"SCIFI - Jobs"},{path:"projects",loadComponent:()=>import("./chunk-ICI5X5QU.js").then(n=>n.ProjectsComponent),title:"SCIFI - Projects"},{path:"courses",loadComponent:()=>import("./chunk-4B3CTRAW.js").then(n=>n.CoursesComponent),title:"SCIFI - Courses"},{path:"stocks",loadComponent:()=>import("./chunk-AVFCFERH.js").then(n=>n.StocksComponent),title:"SCIFI - Stocks"},{path:"personal",loadComponent:()=>import("./chunk-EHDRNOSS.js").then(n=>n.PersonalComponent),title:"SCIFI - Personal"}]}],Tv=(()=>{class n{static{this.routes=Ev}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275mod=G({type:n})}static{this.\u0275inj=K({imports:[F.forChild(Ev),F]})}}return n})();var Cv=[{path:"pages/blog",children:[{path:"blog",loadComponent:()=>import("./chunk-JC7XNFKQ.js").then(n=>n.BlogComponent),title:"SCIFI - Blog"},{path:"blog-details",loadComponent:()=>import("./chunk-FL3DYRU7.js").then(n=>n.BlogDetailsComponent),title:"SCIFI - Blog Details"},{path:"create-blog",loadComponent:()=>import("./chunk-CCJAPXB3.js").then(n=>n.CreateBlogComponent),title:"SCIFI -  Create Blog"}]}],Sv=(()=>{class n{static{this.routes=Cv}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275mod=G({type:n})}static{this.\u0275inj=K({imports:[F.forChild(Cv),F]})}}return n})();var bv=[{path:"advanced-ui",children:[{path:"accordions",loadComponent:()=>import("./chunk-G5AU7RXO.js").then(n=>n.AccordionsComponent),title:"SCIFI - Accordions"},{path:"carousel",loadComponent:()=>import("./chunk-ATA2EQWB.js").then(n=>n.CarouselComponent),title:"SCIFI - Carousel"},{path:"draggable-cards",loadComponent:()=>import("./chunk-MTWAAG4P.js").then(n=>n.DraggableCardsComponent),title:"SCIFI - Draggable Cards"},{path:"modals-closes",loadComponent:()=>import("./chunk-P4LBCBZC.js").then(n=>n.ModalsClosesComponent),title:"SCIFI - Modals Closes"},{path:"placeholders",loadComponent:()=>import("./chunk-HQIK7DMJ.js").then(n=>n.PlaceholdersComponent),title:"SCIFI - Placeholders"},{path:"navbar",loadComponent:()=>import("./chunk-VLMOQWIA.js").then(n=>n.NavbarComponent),title:"SCIFI - Navbar"},{path:"offcanvas",loadComponent:()=>import("./chunk-TZ7A2C4T.js").then(n=>n.OffcanvasComponent),title:"SCIFI - Offcanvas"},{path:"rating",loadComponent:()=>import("./chunk-H27FERIR.js").then(n=>n.RatingsComponent),title:"SCIFI - Courses"},{path:"ribbons",loadComponent:()=>import("./chunk-LUCZED6T.js").then(n=>n.RibbonsComponent),title:"SCIFI - Ribbons"},{path:"scrollspy",loadComponent:()=>import("./chunk-V4JVH4AG.js").then(n=>n.ScrollspyComponent),title:"SCIFI - Scrollspy"},{path:"swiperjs",loadComponent:()=>import("./chunk-YF566UZV.js").then(n=>n.SwiperjsComponent),title:"SCIFI - Swiperjs"},{path:"sortable-js",loadComponent:()=>import("./chunk-D6LHH427.js").then(n=>n.SortableJsComponent),title:"SCIFI - Sortable Js"}]}],Av=(()=>{class n{static{this.routes=bv}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275mod=G({type:n})}static{this.\u0275inj=K({imports:[F.forChild(bv),F]})}}return n})();var Rv=[{path:"pages",children:[{path:"about-us",loadComponent:()=>import("./chunk-YT5MBKCE.js").then(n=>n.AboutusComponent),title:"SCIFI - About us"},{path:"chat",loadComponent:()=>import("./chunk-HAXEXH3P.js").then(n=>n.ChatComponent),title:"SCIFI - Chat"},{path:"contactus",loadComponent:()=>import("./chunk-M3J2PH2Z.js").then(n=>n.ContactusComponent),title:"SCIFI - Contact us"},{path:"contacts",loadComponent:()=>import("./chunk-DXF5CD64.js").then(n=>n.ContactsComponent),title:"SCIFI - Contacts"},{path:"emptypage",loadComponent:()=>import("./chunk-A4OQBX3Z.js").then(n=>n.EmptypageComponent),title:"SCIFI - Empty page"},{path:"faqs",loadComponent:()=>import("./chunk-43YE5YB6.js").then(n=>n.FaqsComponent),title:"SCIFI - Faqs"},{path:"timeline",loadComponent:()=>import("./chunk-LMT2XHA4.js").then(n=>n.TimelineComponent),title:"SCIFI - Timeline"},{path:"notifications",loadComponent:()=>import("./chunk-O5BGW56I.js").then(n=>n.NotificationsComponent),title:"SCIFI - Notifications"},{path:"pricing",loadComponent:()=>import("./chunk-TKJLOKKP.js").then(n=>n.PricingComponent),title:"SCIFI - Pricing"},{path:"team",loadComponent:()=>import("./chunk-FUVPRXQT.js").then(n=>n.TeamComponent),title:"SCIFI - Team"},{path:"terms-conditions",loadComponent:()=>import("./chunk-VIN72PHW.js").then(n=>n.TermsConditionsComponent),title:"SCIFI - Terms Conditions"},{path:"todolist",loadComponent:()=>import("./chunk-IRFQL223.js").then(n=>n.TodolistComponent),title:"SCIFI - Todolist"},{path:"profile",loadComponent:()=>import("./chunk-DZGA5L7T.js").then(n=>n.ProfileComponent),title:"SCIFI - Profile"},{path:"profile-settings",loadComponent:()=>import("./chunk-R4Y75SFE.js").then(n=>n.ProfileSettingsComponent),title:"SCIFI - Profile Settings"},{path:"reviews",loadComponent:()=>import("./chunk-AQB772FY.js").then(n=>n.ReviewsComponent),title:"SCIFI - Reviews"},{path:"search-page",loadComponent:()=>import("./chunk-P4LYH4QF.js").then(n=>ov),title:"SCIFI - Search Page"}]}],Pv=(()=>{class n{static{this.routes=Rv}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275mod=G({type:n})}static{this.\u0275inj=K({imports:[F.forChild(Rv),F]})}}return n})();var Nv=[{path:"apps/ecommerce",children:[{path:"addproduct",loadComponent:()=>import("./chunk-ME533ZTS.js").then(n=>n.AddproductComponent),title:"SCIFI - Add Product"},{path:"cart",loadComponent:()=>import("./chunk-4VWOM52P.js").then(n=>n.CartComponent),title:"SCIFI - Cart"},{path:"checkout",loadComponent:()=>import("./chunk-4INFV7CO.js").then(n=>n.CheckoutComponent),title:"SCIFI - Checkout"},{path:"edit-products",loadComponent:()=>import("./chunk-DG3NQHWN.js").then(n=>n.EditproductsComponent),title:"SCIFI - Edit Products"},{path:"orderdetails",loadComponent:()=>import("./chunk-MSFAW3E2.js").then(n=>n.OrderdetailsComponent),title:"SCIFI - Order Details"},{path:"orders",loadComponent:()=>import("./chunk-Y7YZZRHW.js").then(n=>n.OrdersComponent),title:"SCIFI - Orders"},{path:"product-details",loadComponent:()=>import("./chunk-MDS7DC6D.js").then(n=>n.ProductDetailsComponent),title:"SCIFI - Product Details"},{path:"products",loadComponent:()=>import("./chunk-MAGCAOZE.js").then(n=>n.ProductsComponent),title:"SCIFI - Products"},{path:"products-list",loadComponent:()=>import("./chunk-THXRSVYB.js").then(n=>n.ProductsListComponent),title:"SCIFI - Products List"},{path:"wishlist",loadComponent:()=>import("./chunk-SNEIY2FT.js").then(n=>n.WishlistComponent),title:"SCIFI - Wishlist"}]}],Dv=(()=>{class n{static{this.routes=Nv}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275mod=G({type:n})}static{this.\u0275inj=K({imports:[F.forChild(Nv),F]})}}return n})();var xv=[{path:"apps/filemanager",children:[{path:"filemanager",loadComponent:()=>import("./chunk-BWHP4EUD.js").then(n=>n.FilemanagerComponent),title:"SCIFI - Filemanager"}]}],kv=(()=>{class n{static{this.routes=xv}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275mod=G({type:n})}static{this.\u0275inj=K({imports:[F.forChild(xv),F]})}}return n})();var Mv=[{path:"pages/invoice",children:[{path:"create-invoice",loadComponent:()=>import("./chunk-ZR7B7BY6.js").then(n=>n.CreateInvoiceComponent),title:"SCIFI - Create Invoice"},{path:"invoice-details",loadComponent:()=>import("./chunk-F64ZNPZC.js").then(n=>n.InvoiceDetailsComponent),title:"SCIFI - invoice Details"},{path:"invoice-list",loadComponent:()=>import("./chunk-IX352OKW.js").then(n=>n.InvoiceListComponent),title:"SCIFI - Invoice-list"}]}],Fv=(()=>{class n{static{this.routes=Mv}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275mod=G({type:n})}static{this.\u0275inj=K({imports:[F.forChild(Mv),F]})}}return n})();var Ov=[{path:"charts",children:[{path:"chartjs",loadComponent:()=>import("./chunk-3Y2OQXFS.js").then(n=>n.ChartjsComponent),title:"SCIFI - Chartsjs"},{path:"echart",loadComponent:()=>import("./chunk-CMOIXUT3.js").then(n=>n.EchartsComponent),title:"SCIFI - E-Charts"}]}],Vv=(()=>{class n{static{this.routes=Ov}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275mod=G({type:n})}static{this.\u0275inj=K({imports:[F.forChild(Ov),F]})}}return n})();var Lv=[{path:"charts/apex-charts",children:[{path:"line-charts",loadComponent:()=>import("./chunk-W54HXWR5.js").then(n=>n.LineChartsComponent),title:"SCIFI - Line Charts"},{path:"area-charts",loadComponent:()=>import("./chunk-ABWKAY7D.js").then(n=>n.AreaChartsComponent),title:"SCIFI - Area Charts"},{path:"bar-charts",loadComponent:()=>import("./chunk-QYSWUF6X.js").then(n=>n.BarChartsComponent),title:"SCIFI - Bar Charts"},{path:"column-charts",loadComponent:()=>import("./chunk-WHXRCSGJ.js").then(n=>n.ColumnChartsComponent),title:"SCIFI - Column Charts"},{path:"mixedcharts",loadComponent:()=>import("./chunk-HI5TDFMR.js").then(n=>n.MixedchartsComponent),title:"SCIFI -  MIxed Charts"},{path:"rangeareacharts",loadComponent:()=>import("./chunk-KHG42CSV.js").then(n=>n.RangeareachartsComponent),title:"SCIFI - Range Charts"},{path:"timelinecharts",loadComponent:()=>import("./chunk-M4AYROAE.js").then(n=>n.TimelinechartsComponent),title:"SCIFI - TimeLine Charts"},{path:"funnel-charts",loadComponent:()=>import("./chunk-NWGAHXZC.js").then(n=>n.FunnelChartsComponent),title:"SCIFI - Funnel Charts"},{path:"candlestickcharts",loadComponent:()=>import("./chunk-PWKHIOHH.js").then(n=>n.CandlestickchartsComponent),title:"SCIFI - CandleStick Charts"},{path:"boxplotcharts",loadComponent:()=>import("./chunk-MF3RQ255.js").then(n=>n.BoxplotchartsComponent),title:"SCIFI - Box Plot Charts"},{path:"bubblecharts",loadComponent:()=>import("./chunk-B3AYJONI.js").then(n=>n.BubblechartsComponent),title:"SCIFI - Bubble Charts"},{path:"scattercharts",loadComponent:()=>import("./chunk-GI3RLXO2.js").then(n=>n.ScatterchartsComponent),title:"SCIFI - Scatter Charts"},{path:"heatmapcharts",loadComponent:()=>import("./chunk-TB4Q6MZK.js").then(n=>n.HeatmapchartsComponent),title:"SCIFI - HeatMap Charts"},{path:"treemapcharts",loadComponent:()=>import("./chunk-7WAMWBIY.js").then(n=>n.TreemapchartsComponent),title:"SCIFI - TreeMap Charts"},{path:"piecharts",loadComponent:()=>import("./chunk-6KO4WYLG.js").then(n=>n.PiechartsComponent),title:"SCIFI - Pie Charts"},{path:"radialbarcharts",loadComponent:()=>import("./chunk-LY5H5BYX.js").then(n=>n.RadialbarchartsComponent),title:"SCIFI - Radial Charts"},{path:"radarcharts",loadComponent:()=>import("./chunk-TLRQ77OH.js").then(n=>n.RadarchartsComponent),title:"SCIFI - Radar Charts"},{path:"polarareacharts",loadComponent:()=>import("./chunk-TIYIY5ZS.js").then(n=>n.PolarareachartsComponent),title:"SCIFI - Polar Area Charts"}]}],Bv=(()=>{class n{static{this.routes=Lv}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275mod=G({type:n})}static{this.\u0275inj=K({imports:[F.forChild(Lv),F]})}}return n})();var Uv=[{path:"pages/email",children:[{path:"mailapp",loadComponent:()=>import("./chunk-DUCPIVOO.js").then(n=>n.MailappComponent),title:"SCIFI - Mail App"},{path:"mailsettings",loadComponent:()=>import("./chunk-X5AYD23Z.js").then(n=>n.MailsettingsComponent),title:"SCIFI - Mail Settings"}]}],qv=(()=>{class n{static{this.routes=Uv}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275mod=G({type:n})}static{this.\u0275inj=K({imports:[F.forChild(Uv),F]})}}return n})();var jv=[{path:"ui-elements",children:[{path:"alerts",loadComponent:()=>import("./chunk-Q5MN62G6.js").then(n=>n.AlertsComponent),title:"SCIFI - Alerts"},{path:"breadcrumb",loadComponent:()=>import("./chunk-NAQH2G3O.js").then(n=>n.BreadcrumbComponent),title:"SCIFI - Breadcrumb"},{path:"buttons",loadComponent:()=>import("./chunk-IXB4QV5C.js").then(n=>n.ButtonsComponent),title:"SCIFI - Buttons"},{path:"badge",loadComponent:()=>import("./chunk-YMKBLKEQ.js").then(n=>n.BadgeComponent),title:"SCIFI - Badge"},{path:"button-group",loadComponent:()=>import("./chunk-56EJB76J.js").then(n=>n.ButtongroupComponent),title:"SCIFI - Button Group"},{path:"cards",loadComponent:()=>import("./chunk-WJFKNH7K.js").then(n=>n.CardsComponent),title:"SCIFI - Cards"},{path:"dropdowns",loadComponent:()=>import("./chunk-XUWUBQVT.js").then(n=>n.DropdownsComponent),title:"SCIFI - Dropdowns"},{path:"images&figures",loadComponent:()=>import("./chunk-V7Q2ZF57.js").then(n=>n.ImagesFiguresComponent),title:"SCIFI - Images-Figures"},{path:"links-interactions",loadComponent:()=>import("./chunk-MAJ5EEJW.js").then(n=>n.LinksInteractionsComponent),title:"SCIFI - Links Interactions"},{path:"list-group",loadComponent:()=>import("./chunk-5SEBX5DV.js").then(n=>n.ListgroupComponent),title:"SCIFI - List group"},{path:"nav-tabs",loadComponent:()=>import("./chunk-HB5YLJM5.js").then(n=>n.NavtabsComponent),title:"SCIFI - Navtabs"},{path:"objectfit",loadComponent:()=>import("./chunk-3FRZ6SV5.js").then(n=>n.ObjectfitComponent),title:"SCIFI - Objectfit"},{path:"pagination",loadComponent:()=>import("./chunk-7D3HEN7B.js").then(n=>n.PaginationComponent),title:"SCIFI - Pagination"},{path:"popovers",loadComponent:()=>import("./chunk-WUPWJLC5.js").then(n=>n.PopoversComponent),title:"SCIFI - Popovers"},{path:"toasts",loadComponent:()=>import("./chunk-RZBWZLJ6.js").then(n=>n.ToastsComponent),title:"SCIFI - toasts"},{path:"progress",loadComponent:()=>import("./chunk-BNGRQ553.js").then(n=>n.ProgressComponent),title:"SCIFI - Progress"},{path:"spinners",loadComponent:()=>import("./chunk-QUVUTCAE.js").then(n=>n.SpinnersComponent),title:"SCIFI - Spinners"},{path:"toasts",loadComponent:()=>import("./chunk-RZBWZLJ6.js").then(n=>n.ToastsComponent),title:"SCIFI - Toasts"},{path:"tooltips",loadComponent:()=>import("./chunk-YRPCI5XC.js").then(n=>n.TooltipsComponent),title:"SCIFI - Tooltips"},{path:"typography",loadComponent:()=>import("./chunk-3DD256F2.js").then(n=>n.TypographyComponent),title:"SCIFI - Typography"}]}],zv=(()=>{class n{static{this.routes=jv}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275mod=G({type:n})}static{this.\u0275inj=K({imports:[F.forChild(jv),F]})}}return n})();var Kv=[{path:"utilities",children:[{path:"avatars",loadComponent:()=>import("./chunk-HCQKNLUY.js").then(n=>n.AvatarsComponent),title:"SCIFI - Avatars"},{path:"borders",loadComponent:()=>import("./chunk-YZEHYOPC.js").then(n=>n.BordersComponent),title:"SCIFI - Borders"},{path:"break-point",loadComponent:()=>import("./chunk-R2IIKW5O.js").then(n=>n.BreakPointComponent),title:"SCIFI - Break-point"},{path:"colors",loadComponent:()=>import("./chunk-OUTAKDG3.js").then(n=>n.ColorsComponent),title:"SCIFI - Colors"},{path:"columns",loadComponent:()=>import("./chunk-PAR6AE3O.js").then(n=>n.ColumnsComponent),title:"SCIFI - Columns"},{path:"flex",loadComponent:()=>import("./chunk-4OT45WEN.js").then(n=>n.FlexComponent),title:"SCIFI - Flex"},{path:"gutters",loadComponent:()=>import("./chunk-BLBIFEMM.js").then(n=>n.GutterComponent),title:"SCIFI - Gutters"},{path:"helper",loadComponent:()=>import("./chunk-MIB2B7WG.js").then(n=>n.HelperComponent),title:"SCIFI - Helper"},{path:"position",loadComponent:()=>import("./chunk-UT3PQLDG.js").then(n=>n.PositionComponent),title:"SCIFI - Position"},{path:"additional-content",loadComponent:()=>import("./chunk-BT4QIOOA.js").then(n=>n.AdditionalContentComponent),title:"SCIFI - Additional-content"}]}],Gv=(()=>{class n{static{this.routes=Kv}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275mod=G({type:n})}static{this.\u0275inj=K({imports:[F.forChild(Kv),F]})}}return n})();var Wv=[{path:"apps",children:[{path:"fullcalender",loadComponent:()=>import("./chunk-I2G5ABK4.js").then(n=>n.FullcalendarComponent),title:"SCIFI - full Calender"},{path:"gallery",loadComponent:()=>import("./chunk-D6O643MG.js").then(n=>n.GalleryComponent),title:"SCIFI - Gallery"},{path:"sweetalerts",loadComponent:()=>import("./chunk-MLFKIVJY.js").then(n=>n.SweetalertsComponent),title:"SCIFI - Sweetalerts"}]}],Qv=(()=>{class n{static{this.routes=Wv}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275mod=G({type:n})}static{this.\u0275inj=K({imports:[F.forChild(Wv),F]})}}return n})();var $v=[{path:"apps/task",children:[{path:"kanban-board",loadComponent:()=>import("./chunk-VFDE7IHI.js").then(n=>n.KanbanBoardComponent),title:"SCIFI -Kanban Board "},{path:"list-view",loadComponent:()=>import("./chunk-6P26LRNO.js").then(n=>n.ListViewComponent),title:"SCIFI - List View"},{path:"task-details",loadComponent:()=>import("./chunk-4SWULSRO.js").then(n=>n.TaskDetailsComponent),title:"SCIFI - Task Details"}]}],Hv=(()=>{class n{static{this.routes=$v}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275mod=G({type:n})}static{this.\u0275inj=K({imports:[F.forChild($v),F]})}}return n})();var Yv=[{path:"apps/crm",children:[{path:"companies",loadComponent:()=>import("./chunk-RH2MAYLE.js").then(n=>n.CompaniesComponent),title:"SCIFI - Companies"},{path:"contacts",loadComponent:()=>import("./chunk-YAN44AGP.js").then(n=>n.ContactsComponent),title:"SCIFI - Companies"},{path:"deals",loadComponent:()=>import("./chunk-O55YGMSA.js").then(n=>n.DealsComponent),title:"SCIFI - Deals"},{path:"leads",loadComponent:()=>import("./chunk-WM7YKGIJ.js").then(n=>n.LeadsComponent),title:"SCIFI - Leads"}]}],Jv=(()=>{class n{static{this.routes=Yv}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275mod=G({type:n})}static{this.\u0275inj=K({imports:[F.forChild(Yv),F]})}}return n})();var Xv=[{path:"apps/crypto",children:[{path:"buy-sell",loadComponent:()=>import("./chunk-KMKZXRNX.js").then(n=>n.BuySellComponent),title:"SCIFI - Buy Sell"},{path:"currency-exchange",loadComponent:()=>import("./chunk-OVCKHV7A.js").then(n=>n.CurrencyExchangeComponent),title:"SCIFI - Currency Exchange"},{path:"marketcap",loadComponent:()=>import("./chunk-RB72X6XC.js").then(n=>n.MarketCapComponent),title:"SCIFI - Marketcap"},{path:"transactions",loadComponent:()=>import("./chunk-O5OLIKWG.js").then(n=>n.TransactionsComponent),title:"SCIFI - Transactions"},{path:"wallet",loadComponent:()=>import("./chunk-NPXDZXWB.js").then(n=>n.WalletComponent),title:"SCIFI - Wallet"}]}],Zv=(()=>{class n{static{this.routes=Xv}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275mod=G({type:n})}static{this.\u0275inj=K({imports:[F.forChild(Xv),F]})}}return n})();var ew=[{path:"apps/jobs",children:[{path:"candidate-details",loadComponent:()=>import("./chunk-44F7AOLX.js").then(n=>n.CandidateDetailsComponent),title:"SCIFI - Candidate Details"},{path:"job-details",loadComponent:()=>import("./chunk-X3P43RWN.js").then(n=>n.JobDetailsComponent),title:"SCIFI - Job Details"},{path:"job-post",loadComponent:()=>import("./chunk-TOFXSFAM.js").then(n=>n.JobPostComponent),title:"SCIFI - Job Post"},{path:"jobs-list",loadComponent:()=>import("./chunk-ECJ565AC.js").then(n=>n.JobListComponent),title:"SCIFI - Jobs List"},{path:"search-candidate",loadComponent:()=>import("./chunk-U7V6PRJ5.js").then(n=>n.SearchCandidateComponent),title:"SCIFI - Search Candidate"},{path:"search-jobs",loadComponent:()=>import("./chunk-GI7MPZVG.js").then(n=>n.SearchJobsComponent),title:"SCIFI - Search Jobs"},{path:"search-company",loadComponent:()=>import("./chunk-6APPCLAY.js").then(n=>n.SearchCompanyComponent),title:"SCIFI - Search Company"}]}],tw=(()=>{class n{static{this.routes=ew}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275mod=G({type:n})}static{this.\u0275inj=K({imports:[F.forChild(ew),F]})}}return n})();var nw=[{path:"apps/projects",children:[{path:"create-project",loadComponent:()=>import("./chunk-C7XBTDYI.js").then(n=>n.CreateProjectComponent),title:"SCIFI - Create Project"},{path:"project-overview",loadComponent:()=>import("./chunk-MTP6WSLV.js").then(n=>n.ProjectOverviewComponent),title:"SCIFI - Project Overview"},{path:"project-list",loadComponent:()=>import("./chunk-6NP6VOW4.js").then(n=>n.ProjectListComponent),title:"SCIFI - Project List"}]}],rw=(()=>{class n{static{this.routes=nw}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275mod=G({type:n})}static{this.\u0275inj=K({imports:[F.forChild(nw),F]})}}return n})();var iw=[{path:"apps/nft",children:[{path:"create-nft",loadComponent:()=>import("./chunk-UHZFUEOO.js").then(n=>n.CreateNftComponent),title:"SCIFI - Create Nft"},{path:"live-auction",loadComponent:()=>import("./chunk-J7C74V34.js").then(n=>n.LiveAuctionComponent),title:"SCIFI - Live Auction"},{path:"market-place",loadComponent:()=>import("./chunk-THPE7KOT.js").then(n=>n.MarketPlaceComponent),title:"SCIFI - Market Place"},{path:"nft-details",loadComponent:()=>import("./chunk-DRERKEMU.js").then(n=>n.NftDetailsComponent),title:"SCIFI - Nft Details"},{path:"wallet-integration",loadComponent:()=>import("./chunk-PQRSIL7F.js").then(n=>n.WalletIntegrationComponent),title:"SCIFI - Wallet Integration"}]}],sw=(()=>{class n{static{this.routes=iw}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275mod=G({type:n})}static{this.\u0275inj=K({imports:[F.forChild(iw),F]})}}return n})();var ow=[{path:"forms/form-editor",children:[{path:"angular-editor",loadComponent:()=>import("./chunk-YV6XMTRH.js").then(n=>n.QuillEditorComponent),title:"Scifi - Angular Editor"}]}],aw=(()=>{class n{static{this.routes=ow}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275mod=G({type:n})}static{this.\u0275inj=K({imports:[F.forChild(ow),F]})}}return n})();var lw=[{path:"forms/form-elements",children:[{path:"inputs",loadComponent:()=>import("./chunk-47R5VGYS.js").then(n=>n.InputsComponent),title:"SCIFI - Inputs"},{path:"checks-radios",loadComponent:()=>import("./chunk-QHIUQBDJ.js").then(n=>n.ChecksradiosComponent),title:"SCIFI - Checks-radios"},{path:"inputgroup",loadComponent:()=>import("./chunk-FZVCJOQT.js").then(n=>n.InputgroupComponent),title:"SCIFI - Inputgroup"},{path:"formselect",loadComponent:()=>import("./chunk-X7XS3D7G.js").then(n=>n.FormselectComponent),title:"SCIFI - Formselect"},{path:"file-uploads",loadComponent:()=>import("./chunk-GEWVQK5I.js").then(n=>n.FileuploadsComponent),title:"SCIFI - File uploads"},{path:"datetimepicker",loadComponent:()=>import("./chunk-VLFH5LHM.js").then(n=>n.DatetimepickerComponent),title:"SCIFI - Datetimepicker"},{path:"color-pickers",loadComponent:()=>import("./chunk-J5DDBYLI.js").then(n=>n.ColorpickerComponent),title:"SCIFI - Color Pickers"},{path:"inputs",loadComponent:()=>import("./chunk-47R5VGYS.js").then(n=>n.InputsComponent),title:"SCIFI - Inputs"},{path:"range-slider",loadComponent:()=>import("./chunk-RLLWPVPC.js").then(n=>n.RangesliderComponent),title:"SCIFI - Range Slider"},{path:"inputmask",loadComponent:()=>import("./chunk-REA6YWEL.js").then(n=>n.InputMaskComponent),title:"SCIFI - Range Slider"}]}],uw=(()=>{class n{static{this.routes=lw}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275mod=G({type:n})}static{this.\u0275inj=K({imports:[F.forChild(lw),F]})}}return n})();var cw=[{path:"forms",children:[{path:"form-layouts",loadComponent:()=>import("./chunk-U7TGYKWU.js").then(n=>n.FormLayoutsComponent),title:"SCIFI - Form Layouts"},{path:"floating-labels",loadComponent:()=>import("./chunk-KT6ZWQJE.js").then(n=>n.FloatingLabelsComponent),title:"SCIFI - Floating Labels"},{path:"forms-advanced",loadComponent:()=>import("./chunk-XE4M3UV2.js").then(n=>n.FormAdvancedComponent),title:"SCIFI - Advanced Form"},{path:"form-wizards",loadComponent:()=>import("./chunk-KG5FNUFV.js").then(n=>n.FormWizardsComponent),title:"SCIFI - Validation"},{path:"validation",loadComponent:()=>import("./chunk-42GFWA7Q.js").then(n=>n.ValidationComponent),title:"SCIFI - Validation"},{path:"select2",loadComponent:()=>import("./chunk-D4K5PCSM.js").then(n=>n.Select2Component),title:"SCIFI - Select2"}]}],hw=(()=>{class n{static{this.routes=cw}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275mod=G({type:n})}static{this.\u0275inj=K({imports:[F.forChild(cw),F]})}}return n})();var dw=[{path:"maps",children:[{path:"leafletmaps",loadComponent:()=>import("./chunk-XMSVW6XT.js").then(n=>n.LeafletmapsComponent),title:"SCIFI - Leaflet Map"},{path:"google-map",loadComponent:()=>import("./chunk-RHWE5T3U.js").then(n=>n.GoogleMapComponent),title:"SCIFI - Google Map"}]}],fw=(()=>{class n{static{this.routes=dw}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275mod=G({type:n})}static{this.\u0275inj=K({imports:[F.forChild(dw),F]})}}return n})();var pw=[{path:"",children:[{path:"icons",loadComponent:()=>import("./chunk-MPSJYGBE.js").then(n=>n.IconsComponent),title:"SCIFI - Icons"}]}],mw=(()=>{class n{static{this.routes=pw}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275mod=G({type:n})}static{this.\u0275inj=K({imports:[F.forChild(pw),F]})}}return n})();var gw=[{path:"",children:[{path:"widgets",loadComponent:()=>import("./chunk-66VFQUQD.js").then(n=>n.WidgetsComponent),title:"SCIFI - Widgets"}]}],_w=(()=>{class n{static{this.routes=gw}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275mod=G({type:n})}static{this.\u0275inj=K({imports:[F.forChild(gw),F]})}}return n})();var yw=[{path:"tables",children:[{path:"tables",loadComponent:()=>import("./chunk-22JCZW4C.js").then(n=>n.TablesComponent),title:"SCIFI - Tables"},{path:"angular-material-tables",loadComponent:()=>import("./chunk-J4YGWEVB.js").then(n=>n.AngularMaterialTablesComponent),title:"SCIFI - Angular Material Tables"},{path:"ngx-easy-table",loadComponent:()=>import("./chunk-477IRJQ2.js").then(n=>n.NgxEasyTableComponent),title:"SCIFI - Ngx Easy Table"}]}],vw=(()=>{class n{static{this.routes=yw}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275mod=G({type:n})}static{this.\u0275inj=K({imports:[F.forChild(yw),F]})}}return n})();var ww=[{path:"hr",children:[{path:"",redirectTo:"users",pathMatch:"full"},{path:"users",loadComponent:()=>import("./chunk-NC3FNA2F.js").then(n=>n.UsersComponent),title:"\u0645\u0646\u0627\u0628\u0639 \u0627\u0646\u0633\u0627\u0646\u06CC  - \u0645\u062F\u06CC\u0631\u06CC\u062A \u06A9\u0627\u0631\u0628\u0631\u0627\u0646"},{path:"access",loadComponent:()=>import("./chunk-JM7VMOLF.js").then(n=>n.AccessComponent),title:"\u0645\u0646\u0627\u0628\u0639 \u0627\u0646\u0633\u0627\u0646\u06CC  - \u0645\u062F\u06CC\u0631\u06CC\u062A \u062F\u0633\u062A\u0631\u0633\u0633\u06CC \u0647\u0627"},{path:"level",loadComponent:()=>import("./chunk-7XPHLGJO.js").then(n=>n.LevelComponent),title:"\u0645\u0646\u0627\u0628\u0639 \u0627\u0646\u0633\u0627\u0646\u06CC  - \u0645\u062F\u06CC\u0631\u06CC\u062A \u0633\u0637\u062D \u0647\u0627"},{path:"role",loadComponent:()=>import("./chunk-MN3SPH65.js").then(n=>n.RoleComponent),title:"\u0645\u0646\u0627\u0628\u0639 \u0627\u0646\u0633\u0627\u0646\u06CC  - \u0645\u062F\u06CC\u0631\u06CC\u062A \u0646\u0642\u0634 \u0647\u0627"}]}],Iw=(()=>{class n{static{this.routes=ww}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275mod=G({type:n})}static{this.\u0275inj=K({imports:[F.forChild(ww),F]})}}return n})();var Ew=[{path:"",children:[...Tv.routes,...Iw.routes,...Av.routes,...Pv.routes,...Dv.routes,...kv.routes,...Fv.routes,...Vv.routes,...vw.routes,...Bv.routes,...Sv.routes,...qv.routes,...zv.routes,...Gv.routes,...Qv.routes,...Jv.routes,...Zv.routes,...tw.routes,...rw.routes,...Hv.routes,...sw.routes,...aw.routes,...uw.routes,...hw.routes,...fw.routes,...mw.routes,..._w.routes]}];var Tw=[{path:"authentication",children:[{path:"coming-soon",loadComponent:()=>import("./chunk-3765JFAX.js").then(n=>n.CommingsoonComponent),title:"SCIFI - Coming Soon"},{path:"under-maintainance",loadComponent:()=>import("./chunk-MUUFXTOD.js").then(n=>n.UnderMaintainanceComponent),title:"SCIFI - Under Maintainance"}]},{path:"authentication",children:[{path:"coming-soon",loadComponent:()=>import("./chunk-3765JFAX.js").then(n=>n.CommingsoonComponent),title:"SCIFI - Comming Soon"},{path:"create-password/cover",loadComponent:()=>import("./chunk-GCJRWIE6.js").then(n=>n.CoverComponent),title:"SCIFI -Create Password Cover"},{path:"lock-screen/basic",loadComponent:()=>import("./chunk-4KVQJHVT.js").then(n=>n.BasicComponent),title:"SCIFI - Basic Lock Screen"},{path:"lock-screen/cover",loadComponent:()=>import("./chunk-4LYM4U6V.js").then(n=>n.CoverComponent),title:"SCIFI - Lock Screen Cover"},{path:"sign-in/cover",loadComponent:()=>import("./chunk-72AXGQZL.js").then(n=>n.CoverComponent),title:"\u0631\u0636\u0648\u0627\u0646 - \u0648\u0631\u0648\u062F"},{path:"twostep-verification/basic",loadComponent:()=>import("./chunk-LJ5NSG4C.js").then(n=>n.BasicComponent),title:"Basic Two-Step Verification"},{path:"twostep-verification/cover",loadComponent:()=>import("./chunk-NSCOIU54.js").then(n=>n.CoverComponent),title:"Two-Step Verification Cover"},{path:"under-maintanace",loadComponent:()=>import("./chunk-MUUFXTOD.js").then(n=>n.UnderMaintainanceComponent),title:"Under Maintanace"}]}],Cw=(()=>{class n{static{this.routes=Tw}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275mod=G({type:n})}static{this.\u0275inj=K({imports:[F.forChild(Tw),F]})}}return n})();var Sw=[{path:"error",children:[{path:"error500",loadComponent:()=>import("./chunk-MEFRTO5X.js").then(n=>n.Error500Component),title:"SCIFI - Error 500"},{path:"error401",loadComponent:()=>import("./chunk-TUM4W44F.js").then(n=>n.Error401Component),title:"SCIFI - Error 401"},{path:"error404",loadComponent:()=>import("./chunk-DVSCUUTX.js").then(n=>n.Error404Component),title:"SCIFI - Error 404"}]}],bw=(()=>{class n{static{this.routes=Sw}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275mod=G({type:n})}static{this.\u0275inj=K({imports:[F.forChild(Sw),F]})}}return n})();var Aw=[{path:"",children:[...Cw.routes,...bw.routes]}];var Rw=[{path:"pages",children:[{path:"landing",loadComponent:()=>import("./chunk-6FW73NLY.js").then(n=>n.LandingComponent),title:"SCIFI - Landing"},{path:"jobs-landing",loadComponent:()=>import("./chunk-XLZBUEU4.js").then(n=>n.JobsLandingComponent),title:"SCIFI - Jobs-Landing"}]}],Pw=(()=>{class n{static{this.routes=Rw}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275mod=G({type:n})}static{this.\u0275inj=K({imports:[F.forChild(Rw),F]})}}return n})();var Nw=[{path:"",children:[...Pw.routes]}];var Dw=[{path:"",redirectTo:"login",pathMatch:"full"},{path:"login",loadComponent:()=>import("./chunk-72AXGQZL.js").then(n=>n.CoverComponent),title:"\u0631\u0636\u0648\u0627\u0646 - \u0648\u0631\u0648\u062F"},{path:"",component:jy,children:Ew},{path:"",component:Ky,children:Aw},{path:"",component:Gy,children:Nw},{path:"**",redirectTo:"/error/error404"}];var xw="@firebase/database",kw="1.0.8";var Xd="";function Zd(n){Xd=n}var $h=class{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){t==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),Ge(t))}get(e){let t=this.domStorage_.getItem(this.prefixedName_(e));return t==null?null:Ya(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}};var Hh=class{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){t==null?delete this.cache_[e]:this.cache_[e]=t}get(e){return Ot(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}};var cI=function(n){try{if(typeof window<"u"&&typeof window[n]<"u"){let e=window[n];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new $h(e)}}catch{}return new Hh},Nr=cI("localStorage"),Yh=cI("sessionStorage");var Ri=new Ti("@firebase/database"),hI=function(){let n=1;return function(){return n++}}(),dI=function(n){let e=nv(n),t=new tv;t.update(e);let r=t.digest();return Wy.encodeByteArray(r)},Eo=function(...n){let e="";for(let t=0;t<n.length;t++){let r=n[t];Array.isArray(r)||r&&typeof r=="object"&&typeof r.length=="number"?e+=Eo.apply(null,r):typeof r=="object"?e+=Ge(r):e+=r,e+=" "}return e},Dr=null,Mw=!0,fI=function(n,e){O(!e||n===!0||n===!1,"Can't turn on custom loggers persistently."),n===!0?(Ri.logLevel=Vt.VERBOSE,Dr=Ri.log.bind(Ri),e&&Yh.set("logging_enabled",!0)):typeof n=="function"?Dr=n:(Dr=null,Yh.remove("logging_enabled"))},tt=function(...n){if(Mw===!0&&(Mw=!1,Dr===null&&Yh.get("logging_enabled")===!0&&fI(!0)),Dr){let e=Eo.apply(null,n);Dr(e)}},To=function(n){return function(...e){tt(n,...e)}},Jh=function(...n){let e="FIREBASE INTERNAL ERROR: "+Eo(...n);Ri.error(e)},an=function(...n){let e=`FIREBASE FATAL ERROR: ${Eo(...n)}`;throw Ri.error(e),new Error(e)},ut=function(...n){let e="FIREBASE WARNING: "+Eo(...n);Ri.warn(e)},CA=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&ut("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},Wl=function(n){return typeof n=="number"&&(n!==n||n===Number.POSITIVE_INFINITY||n===Number.NEGATIVE_INFINITY)},SA=function(n){if(nn()||document.readyState==="complete")n();else{let e=!1,t=function(){if(!document.body){setTimeout(t,Math.floor(10));return}e||(e=!0,n())};document.addEventListener?(document.addEventListener("DOMContentLoaded",t,!1),window.addEventListener("load",t,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&t()}),window.attachEvent("onload",t))}},Jn="[MIN_NAME]",Sn="[MAX_NAME]",kr=function(n,e){if(n===e)return 0;if(n===Jn||e===Sn)return-1;if(e===Jn||n===Sn)return 1;{let t=Fw(n),r=Fw(e);return t!==null?r!==null?t-r===0?n.length-e.length:t-r:-1:r!==null?1:n<e?-1:1}},bA=function(n,e){return n===e?0:n<e?-1:1},Xs=function(n,e){if(e&&n in e)return e[n];throw new Error("Missing required key ("+n+") in object: "+Ge(e))},ef=function(n){if(typeof n!="object"||n===null)return Ge(n);let e=[];for(let r in n)e.push(r);e.sort();let t="{";for(let r=0;r<e.length;r++)r!==0&&(t+=","),t+=Ge(e[r]),t+=":",t+=ef(n[e[r]]);return t+="}",t},pI=function(n,e){let t=n.length;if(t<=e)return[n];let r=[];for(let i=0;i<t;i+=e)i+e>t?r.push(n.substring(i,t)):r.push(n.substring(i,i+e));return r};function nt(n,e){for(let t in n)n.hasOwnProperty(t)&&e(t,n[t])}var mI=function(n){O(!Wl(n),"Invalid JSON number");let e=11,t=52,r=(1<<e-1)-1,i,s,o,a,u;n===0?(s=0,o=0,i=1/n===-1/0?1:0):(i=n<0,n=Math.abs(n),n>=Math.pow(2,1-r)?(a=Math.min(Math.floor(Math.log(n)/Math.LN2),r),s=a+r,o=Math.round(n*Math.pow(2,t-a)-Math.pow(2,t))):(s=0,o=Math.round(n/Math.pow(2,1-r-t))));let c=[];for(u=t;u;u-=1)c.push(o%2?1:0),o=Math.floor(o/2);for(u=e;u;u-=1)c.push(s%2?1:0),s=Math.floor(s/2);c.push(i?1:0),c.reverse();let d=c.join(""),f="";for(u=0;u<64;u+=8){let m=parseInt(d.substr(u,8),2).toString(16);m.length===1&&(m="0"+m),f=f+m}return f.toLowerCase()},AA=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},RA=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function PA(n,e){let t="Unknown Error";n==="too_big"?t="The data requested exceeds the maximum size that can be accessed with a single request.":n==="permission_denied"?t="Client doesn't have permission to access the desired data.":n==="unavailable"&&(t="The service is unavailable");let r=new Error(n+" at "+e._path.toString()+": "+t);return r.code=n.toUpperCase(),r}var NA=new RegExp("^-?(0*)\\d{1,10}$"),DA=-2147483648,xA=2147483647,Fw=function(n){if(NA.test(n)){let e=Number(n);if(e>=DA&&e<=xA)return e}return null},Vi=function(n){try{n()}catch(e){setTimeout(()=>{let t=e.stack||"";throw ut("Exception was thrown by user callback.",t),e},Math.floor(0))}},kA=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},no=function(n,e){let t=setTimeout(n,e);return typeof t=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(t):typeof t=="object"&&t.unref&&t.unref(),t};var Xh=class{constructor(e,t){this.appName_=e,this.appCheckProvider=t,this.appCheck=t?.getImmediate({optional:!0}),this.appCheck||t?.get().then(r=>this.appCheck=r)}getToken(e){return this.appCheck?this.appCheck.getToken(e):new Promise((t,r)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,r):t(null)},0)})}addTokenChangeListener(e){var t;(t=this.appCheckProvider)===null||t===void 0||t.get().then(r=>r.addTokenListener(e))}notifyForInvalidToken(){ut(`Provided AppCheck credentials for the app named "${this.appName_}" are invalid. This usually indicates your app was not initialized correctly.`)}};var Zh=class{constructor(e,t,r){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=r,this.auth_=null,this.auth_=r.getImmediate({optional:!0}),this.auth_||r.onInit(i=>this.auth_=i)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(t=>t&&t.code==="auth/token-not-initialized"?(tt("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)):new Promise((t,r)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,r):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',ut(e)}},ro=(()=>{class n{constructor(t){this.accessToken=t}getToken(t){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(t){t(this.accessToken)}removeTokenChangeListener(t){}notifyForInvalidToken(){}}n.OWNER="owner";return n})(),wl="5",gI="v",_I="s",yI="r",vI="f",wI=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,II="ls",EI="p",ed="ac",TI="websocket",CI="long_polling";var Il=class{constructor(e,t,r,i,s=!1,o="",a=!1,u=!1){this.secure=t,this.namespace=r,this.webSocketOnly=i,this.nodeAdmin=s,this.persistenceKey=o,this.includeNamespaceInQueryParams=a,this.isUsingEmulator=u,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=Nr.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&Nr.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){let e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}};function MA(n){return n.host!==n.internalHost||n.isCustomHost()||n.includeNamespaceInQueryParams}function SI(n,e,t){O(typeof e=="string","typeof type must == string"),O(typeof t=="object","typeof params must == object");let r;if(e===TI)r=(n.secure?"wss://":"ws://")+n.internalHost+"/.ws?";else if(e===CI)r=(n.secure?"https://":"http://")+n.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);MA(n)&&(t.ns=n.namespace);let i=[];return nt(t,(s,o)=>{i.push(s+"="+o)}),r+i.join("&")}var td=class{constructor(){this.counters_={}}incrementCounter(e,t=1){Ot(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return $y(this.counters_)}};var qh={},jh={};function tf(n){let e=n.toString();return qh[e]||(qh[e]=new td),qh[e]}function FA(n,e){let t=n.toString();return jh[t]||(jh[t]=e()),jh[t]}var nd=class{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){let r=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let i=0;i<r.length;++i)r[i]&&Vi(()=>{this.onMessage_(r[i])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}};var Ow="start",OA="close",VA="pLPCommand",LA="pRTLPCB",bI="id",AI="pw",RI="ser",BA="cb",UA="seg",qA="ts",jA="d",zA="dframe",PI=1870,NI=30,KA=PI-NI,GA=25e3,WA=3e4,ao=class n{constructor(e,t,r,i,s,o,a){this.connId=e,this.repoInfo=t,this.applicationId=r,this.appCheckToken=i,this.authToken=s,this.transportSessionId=o,this.lastSessionId=a,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=To(e),this.stats_=tf(t),this.urlFn=u=>(this.appCheckToken&&(u[ed]=this.appCheckToken),SI(t,CI,u))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new nd(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(WA)),SA(()=>{if(this.isClosed_)return;this.scriptTagHolder=new rd((...s)=>{let[o,a,u,c,d]=s;if(this.incrementIncomingBytes_(s),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,o===Ow)this.id=a,this.password=u;else if(o===OA)a?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(a,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+o)},(...s)=>{let[o,a]=s;this.incrementIncomingBytes_(s),this.myPacketOrderer.handleResponse(o,a)},()=>{this.onClosed_()},this.urlFn);let r={};r[Ow]="t",r[RI]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(r[BA]=this.scriptTagHolder.uniqueCallbackIdentifier),r[gI]=wl,this.transportSessionId&&(r[_I]=this.transportSessionId),this.lastSessionId&&(r[II]=this.lastSessionId),this.applicationId&&(r[EI]=this.applicationId),this.appCheckToken&&(r[ed]=this.appCheckToken),typeof location<"u"&&location.hostname&&wI.test(location.hostname)&&(r[yI]=vI);let i=this.urlFn(r);this.log_("Connecting via long-poll to "+i),this.scriptTagHolder.addTag(i,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){n.forceAllow_=!0}static forceDisallow(){n.forceDisallow_=!0}static isAvailable(){return nn()?!1:n.forceAllow_?!0:!n.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!AA()&&!RA()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){let t=Ge(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);let r=Qy(t),i=pI(r,KA);for(let s=0;s<i.length;s++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,i.length,i[s]),this.curSegmentNum++}addDisconnectPingFrame(e,t){if(nn())return;this.myDisconnFrame=document.createElement("iframe");let r={};r[zA]="t",r[bI]=e,r[AI]=t,this.myDisconnFrame.src=this.urlFn(r),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){let t=Ge(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}},rd=class n{constructor(e,t,r,i){if(this.onDisconnect=r,this.urlFn=i,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0,nn())this.commandCB=e,this.onMessageCB=t;else{this.uniqueCallbackIdentifier=hI(),window[VA+this.uniqueCallbackIdentifier]=e,window[LA+this.uniqueCallbackIdentifier]=t,this.myIFrame=n.createIFrame_();let s="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(s='<script>document.domain="'+document.domain+'";<\/script>');let o="<html><body>"+s+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(a){tt("frame writing exception"),a.stack&&tt(a.stack),tt(a)}}}static createIFrame_(){let e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||tt("No IE domain setting required")}catch{let r=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+r+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));let e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;let e={};e[bI]=this.myID,e[AI]=this.myPW,e[RI]=this.currentSerial;let t=this.urlFn(e),r="",i=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+NI+r.length<=PI;){let o=this.pendingSegs.shift();r=r+"&"+UA+i+"="+o.seg+"&"+qA+i+"="+o.ts+"&"+jA+i+"="+o.d,i++}return t=t+r,this.addLongPollTag_(t,this.currentSerial),!0}else return!1}enqueueSegment(e,t,r){this.pendingSegs.push({seg:e,ts:t,d:r}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);let r=()=>{this.outstandingRequests.delete(t),this.newRequest_()},i=setTimeout(r,Math.floor(GA)),s=()=>{clearTimeout(i),r()};this.addTag(e,s)}addTag(e,t){nn()?this.doNodeLongPoll(e,t):setTimeout(()=>{try{if(!this.sendNewPolls)return;let r=this.myIFrame.doc.createElement("script");r.type="text/javascript",r.async=!0,r.src=e,r.onload=r.onreadystatechange=function(){let i=r.readyState;(!i||i==="loaded"||i==="complete")&&(r.onload=r.onreadystatechange=null,r.parentNode&&r.parentNode.removeChild(r),t())},r.onerror=()=>{tt("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(r)}catch{}},Math.floor(1))}};var QA=16384,$A=45e3,El=null;typeof MozWebSocket<"u"?El=MozWebSocket:typeof WebSocket<"u"&&(El=WebSocket);var bi=(()=>{class n{constructor(t,r,i,s,o,a,u){this.connId=t,this.applicationId=i,this.appCheckToken=s,this.authToken=o,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=To(this.connId),this.stats_=tf(r),this.connURL=n.connectionURL_(r,a,u,s,i),this.nodeAdmin=r.nodeAdmin}static connectionURL_(t,r,i,s,o){let a={};return a[gI]=wl,!nn()&&typeof location<"u"&&location.hostname&&wI.test(location.hostname)&&(a[yI]=vI),r&&(a[_I]=r),i&&(a[II]=i),s&&(a[ed]=s),o&&(a[EI]=o),SI(t,TI,a)}open(t,r){this.onDisconnect=r,this.onMessage=t,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,Nr.set("previous_websocket_failure",!0);try{let i;if(nn()){let s=this.nodeAdmin?"AdminNode":"Node";i={headers:{"User-Agent":`Firebase/${wl}/${Xd}/${process.platform}/${s}`,"X-Firebase-GMPID":this.applicationId||""}},this.authToken&&(i.headers.Authorization=`Bearer ${this.authToken}`),this.appCheckToken&&(i.headers["X-Firebase-AppCheck"]=this.appCheckToken);let o=process.env,a=this.connURL.indexOf("wss://")===0?o.HTTPS_PROXY||o.https_proxy:o.HTTP_PROXY||o.http_proxy;a&&(i.proxy={origin:a})}this.mySock=new El(this.connURL,[],i)}catch(i){this.log_("Error instantiating WebSocket.");let s=i.message||i.data;s&&this.log_(s),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=i=>{this.handleIncomingFrame(i)},this.mySock.onerror=i=>{this.log_("WebSocket error.  Closing connection.");let s=i.message||i.data;s&&this.log_(s),this.onClosed_()}}start(){}static forceDisallow(){n.forceDisallow_=!0}static isAvailable(){let t=!1;if(typeof navigator<"u"&&navigator.userAgent){let r=/Android ([0-9]{0,}\.[0-9]{0,})/,i=navigator.userAgent.match(r);i&&i.length>1&&parseFloat(i[1])<4.4&&(t=!0)}return!t&&El!==null&&!n.forceDisallow_}static previouslyFailed(){return Nr.isInMemoryStorage||Nr.get("previous_websocket_failure")===!0}markConnectionHealthy(){Nr.remove("previous_websocket_failure")}appendFrame_(t){if(this.frames.push(t),this.frames.length===this.totalFrames){let r=this.frames.join("");this.frames=null;let i=Ya(r);this.onMessage(i)}}handleNewFrameCount_(t){this.totalFrames=t,this.frames=[]}extractFrameCount_(t){if(O(this.frames===null,"We already have a frame buffer"),t.length<=6){let r=Number(t);if(!isNaN(r))return this.handleNewFrameCount_(r),null}return this.handleNewFrameCount_(1),t}handleIncomingFrame(t){if(this.mySock===null)return;let r=t.data;if(this.bytesReceived+=r.length,this.stats_.incrementCounter("bytes_received",r.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(r);else{let i=this.extractFrameCount_(r);i!==null&&this.appendFrame_(i)}}send(t){this.resetKeepAlive();let r=Ge(t);this.bytesSent+=r.length,this.stats_.incrementCounter("bytes_sent",r.length);let i=pI(r,QA);i.length>1&&this.sendString_(String(i.length));for(let s=0;s<i.length;s++)this.sendString_(i[s])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor($A))}sendString_(t){try{this.mySock.send(t)}catch(r){this.log_("Exception thrown from WebSocket.send():",r.message||r.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}n.responsesRequiredToBeHealthy=2,n.healthyTimeout=3e4;return n})(),DI=(()=>{class n{constructor(t){this.initTransports_(t)}static get ALL_TRANSPORTS(){return[ao,bi]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}initTransports_(t){let r=bi&&bi.isAvailable(),i=r&&!bi.previouslyFailed();if(t.webSocketOnly&&(r||ut("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),i=!0),i)this.transports_=[bi];else{let s=this.transports_=[];for(let o of n.ALL_TRANSPORTS)o&&o.isAvailable()&&s.push(o);n.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}n.globalTransportInitialized_=!1;return n})(),HA=6e4,YA=5e3,JA=10*1024,XA=100*1024,zh="t",Vw="d",ZA="s",Lw="r",eR="e",Bw="o",Uw="a",qw="n",jw="p",tR="h",id=class{constructor(e,t,r,i,s,o,a,u,c,d){this.id=e,this.repoInfo_=t,this.applicationId_=r,this.appCheckToken_=i,this.authToken_=s,this.onMessage_=o,this.onReady_=a,this.onDisconnect_=u,this.onKill_=c,this.lastSessionId=d,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=To("c:"+this.id+":"),this.transportManager_=new DI(t),this.log_("Connection created"),this.start_()}start_(){let e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let t=this.connReceiver_(this.conn_),r=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,r)},Math.floor(0));let i=e.healthyTimeout||0;i>0&&(this.healthyTimeout_=no(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>XA?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>JA?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(i)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){let t={t:"d",d:e};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(zh in e){let t=e[zh];t===Uw?this.upgradeIfSecondaryHealthy_():t===Lw?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):t===Bw&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){let t=Xs("t",e),r=Xs("d",e);if(t==="c")this.onSecondaryControl_(r);else if(t==="d")this.pendingDataMessages.push(r);else throw new Error("Unknown protocol layer: "+t)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:jw,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:Uw,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:qw,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){let t=Xs("t",e),r=Xs("d",e);t==="c"?this.onControl_(r):t==="d"&&this.onDataMessage_(r)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){let t=Xs(zh,e);if(Vw in e){let r=e[Vw];if(t===tR){let i=Object.assign({},r);this.repoInfo_.isUsingEmulator&&(i.h=this.repoInfo_.host),this.onHandshake_(i)}else if(t===qw){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let i=0;i<this.pendingDataMessages.length;++i)this.onDataMessage_(this.pendingDataMessages[i]);this.pendingDataMessages=[],this.tryCleanupConnection()}else t===ZA?this.onConnectionShutdown_(r):t===Lw?this.onReset_(r):t===eR?Jh("Server Error: "+r):t===Bw?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):Jh("Unknown control packet command: "+t)}}onHandshake_(e){let t=e.ts,r=e.v,i=e.h;this.sessionId=e.s,this.repoInfo_.host=i,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),wl!==r&&ut("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){let e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let t=this.connReceiver_(this.secondaryConn_),r=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,r),no(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(HA))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):no(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(YA))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:jw,d:{}}}))}onSecondaryConnectionLost_(){let e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(Nr.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}};var Tl=class{put(e,t,r,i){}merge(e,t,r,i){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,r){}onDisconnectMerge(e,t,r){}onDisconnectCancel(e,t){}reportStats(e){}};var Cl=class{constructor(e){this.allowedEvents_=e,this.listeners_={},O(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){let r=[...this.listeners_[e]];for(let i=0;i<r.length;i++)r[i].callback.apply(r[i].context,t)}}on(e,t,r){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:r});let i=this.getInitialEvent(e);i&&t.apply(r,i)}off(e,t,r){this.validateEventType_(e);let i=this.listeners_[e]||[];for(let s=0;s<i.length;s++)if(i[s].callback===t&&(!r||r===i[s].context)){i.splice(s,1);return}}validateEventType_(e){O(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}};var Sl=class n extends Cl{constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!Fh()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}static getInstance(){return new n}getInitialEvent(e){return O(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}};var zw=32,Kw=768,we=class{constructor(e,t){if(t===void 0){this.pieces_=e.split("/");let r=0;for(let i=0;i<this.pieces_.length;i++)this.pieces_[i].length>0&&(this.pieces_[r]=this.pieces_[i],r++);this.pieces_.length=r,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)this.pieces_[t]!==""&&(e+="/"+this.pieces_[t]);return e||"/"}};function ve(){return new we("")}function se(n){return n.pieceNum_>=n.pieces_.length?null:n.pieces_[n.pieceNum_]}function Xn(n){return n.pieces_.length-n.pieceNum_}function Te(n){let e=n.pieceNum_;return e<n.pieces_.length&&e++,new we(n.pieces_,e)}function nf(n){return n.pieceNum_<n.pieces_.length?n.pieces_[n.pieces_.length-1]:null}function nR(n){let e="";for(let t=n.pieceNum_;t<n.pieces_.length;t++)n.pieces_[t]!==""&&(e+="/"+encodeURIComponent(String(n.pieces_[t])));return e||"/"}function lo(n,e=0){return n.pieces_.slice(n.pieceNum_+e)}function xI(n){if(n.pieceNum_>=n.pieces_.length)return null;let e=[];for(let t=n.pieceNum_;t<n.pieces_.length-1;t++)e.push(n.pieces_[t]);return new we(e,0)}function De(n,e){let t=[];for(let r=n.pieceNum_;r<n.pieces_.length;r++)t.push(n.pieces_[r]);if(e instanceof we)for(let r=e.pieceNum_;r<e.pieces_.length;r++)t.push(e.pieces_[r]);else{let r=e.split("/");for(let i=0;i<r.length;i++)r[i].length>0&&t.push(r[i])}return new we(t,0)}function oe(n){return n.pieceNum_>=n.pieces_.length}function mt(n,e){let t=se(n),r=se(e);if(t===null)return e;if(t===r)return mt(Te(n),Te(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+n+")")}function rR(n,e){let t=lo(n,0),r=lo(e,0);for(let i=0;i<t.length&&i<r.length;i++){let s=kr(t[i],r[i]);if(s!==0)return s}return t.length===r.length?0:t.length<r.length?-1:1}function rf(n,e){if(Xn(n)!==Xn(e))return!1;for(let t=n.pieceNum_,r=e.pieceNum_;t<=n.pieces_.length;t++,r++)if(n.pieces_[t]!==e.pieces_[r])return!1;return!0}function Lt(n,e){let t=n.pieceNum_,r=e.pieceNum_;if(Xn(n)>Xn(e))return!1;for(;t<n.pieces_.length;){if(n.pieces_[t]!==e.pieces_[r])return!1;++t,++r}return!0}var sd=class{constructor(e,t){this.errorPrefix_=t,this.parts_=lo(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let r=0;r<this.parts_.length;r++)this.byteLength_+=Ys(this.parts_[r]);kI(this)}};function iR(n,e){n.parts_.length>0&&(n.byteLength_+=1),n.parts_.push(e),n.byteLength_+=Ys(e),kI(n)}function sR(n){let e=n.parts_.pop();n.byteLength_-=Ys(e),n.parts_.length>0&&(n.byteLength_-=1)}function kI(n){if(n.byteLength_>Kw)throw new Error(n.errorPrefix_+"has a key path longer than "+Kw+" bytes ("+n.byteLength_+").");if(n.parts_.length>zw)throw new Error(n.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+zw+") or object contains a cycle "+Pr(n))}function Pr(n){return n.parts_.length===0?"":"in property '"+n.parts_.join(".")+"'"}var od=class n extends Cl{constructor(){super(["visible"]);let e,t;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(t="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(t="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(t="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{let r=!document[e];r!==this.visible_&&(this.visible_=r,this.trigger("visible",r))},!1)}static getInstance(){return new n}getInitialEvent(e){return O(e==="visible","Unknown event type: "+e),[this.visible_]}};var Zs=1e3,oR=60*5*1e3,Gw=30*1e3,aR=1.3,lR=3e4,uR="server_kill",Ww=3,sf=(()=>{class n extends Tl{constructor(t,r,i,s,o,a,u,c){if(super(),this.repoInfo_=t,this.applicationId_=r,this.onDataUpdate_=i,this.onConnectStatus_=s,this.onServerInfoUpdate_=o,this.authTokenProvider_=a,this.appCheckTokenProvider_=u,this.authOverride_=c,this.id=n.nextPersistentConnectionId_++,this.log_=To("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=Zs,this.maxReconnectDelay_=oR,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,c&&!nn())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");od.getInstance().on("visible",this.onVisible_,this),t.host.indexOf("fblocal")===-1&&Sl.getInstance().on("online",this.onOnline_,this)}sendRequest(t,r,i){let s=++this.requestNumber_,o={r:s,a:t,b:r};this.log_(Ge(o)),O(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(o),i&&(this.requestCBHash_[s]=i)}get(t){this.initConnection_();let r=new pt,s={action:"g",request:{p:t._path.toString(),q:t._queryObject},onComplete:a=>{let u=a.d;a.s==="ok"?r.resolve(u):r.reject(u)}};this.outstandingGets_.push(s),this.outstandingGetCount_++;let o=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(o),r.promise}listen(t,r,i,s){this.initConnection_();let o=t._queryIdentifier,a=t._path.toString();this.log_("Listen called for "+a+" "+o),this.listens.has(a)||this.listens.set(a,new Map),O(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"listen() called for non-default but complete query"),O(!this.listens.get(a).has(o),"listen() called twice for same path/queryId.");let u={onComplete:s,hashFn:r,query:t,tag:i};this.listens.get(a).set(o,u),this.connected_&&this.sendListen_(u)}sendGet_(t){let r=this.outstandingGets_[t];this.sendRequest("g",r.request,i=>{delete this.outstandingGets_[t],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),r.onComplete&&r.onComplete(i)})}sendListen_(t){let r=t.query,i=r._path.toString(),s=r._queryIdentifier;this.log_("Listen on "+i+" for "+s);let o={p:i},a="q";t.tag&&(o.q=r._queryObject,o.t=t.tag),o.h=t.hashFn(),this.sendRequest(a,o,u=>{let c=u.d,d=u.s;n.warnOnListenWarnings_(c,r),(this.listens.get(i)&&this.listens.get(i).get(s))===t&&(this.log_("listen response",u),d!=="ok"&&this.removeListen_(i,s),t.onComplete&&t.onComplete(d,c))})}static warnOnListenWarnings_(t,r){if(t&&typeof t=="object"&&Ot(t,"w")){let i=Wn(t,"w");if(Array.isArray(i)&&~i.indexOf("no_index")){let s='".indexOn": "'+r._queryParams.getIndex().toString()+'"',o=r._path.toString();ut(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${s} at ${o} to your security rules for better performance.`)}}}refreshAuthToken(t){this.authToken_=t,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(t)}reduceReconnectDelayIfAdminCredential_(t){(t&&t.length===40||Zy(t))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=Gw)}refreshAppCheckToken(t){this.appCheckToken_=t,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){let t=this.authToken_,r=Xy(t)?"auth":"gauth",i={cred:t};this.authOverride_===null?i.noauth=!0:typeof this.authOverride_=="object"&&(i.authvar=this.authOverride_),this.sendRequest(r,i,s=>{let o=s.s,a=s.d||"error";this.authToken_===t&&(o==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(o,a))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},t=>{let r=t.s,i=t.d||"error";r==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(r,i)})}unlisten(t,r){let i=t._path.toString(),s=t._queryIdentifier;this.log_("Unlisten called for "+i+" "+s),O(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(i,s)&&this.connected_&&this.sendUnlisten_(i,s,t._queryObject,r)}sendUnlisten_(t,r,i,s){this.log_("Unlisten on "+t+" for "+r);let o={p:t},a="n";s&&(o.q=i,o.t=s),this.sendRequest(a,o)}onDisconnectPut(t,r,i){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",t,r,i):this.onDisconnectRequestQueue_.push({pathString:t,action:"o",data:r,onComplete:i})}onDisconnectMerge(t,r,i){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",t,r,i):this.onDisconnectRequestQueue_.push({pathString:t,action:"om",data:r,onComplete:i})}onDisconnectCancel(t,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",t,null,r):this.onDisconnectRequestQueue_.push({pathString:t,action:"oc",data:null,onComplete:r})}sendOnDisconnect_(t,r,i,s){let o={p:r,d:i};this.log_("onDisconnect "+t,o),this.sendRequest(t,o,a=>{s&&setTimeout(()=>{s(a.s,a.d)},Math.floor(0))})}put(t,r,i,s){this.putInternal("p",t,r,i,s)}merge(t,r,i,s){this.putInternal("m",t,r,i,s)}putInternal(t,r,i,s,o){this.initConnection_();let a={p:r,d:i};o!==void 0&&(a.h=o),this.outstandingPuts_.push({action:t,request:a,onComplete:s}),this.outstandingPutCount_++;let u=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(u):this.log_("Buffering put: "+r)}sendPut_(t){let r=this.outstandingPuts_[t].action,i=this.outstandingPuts_[t].request,s=this.outstandingPuts_[t].onComplete;this.outstandingPuts_[t].queued=this.connected_,this.sendRequest(r,i,o=>{this.log_(r+" response",o),delete this.outstandingPuts_[t],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),s&&s(o.s,o.d)})}reportStats(t){if(this.connected_){let r={c:t};this.log_("reportStats",r),this.sendRequest("s",r,i=>{if(i.s!=="ok"){let o=i.d;this.log_("reportStats","Error sending stats: "+o)}})}}onDataMessage_(t){if("r"in t){this.log_("from server: "+Ge(t));let r=t.r,i=this.requestCBHash_[r];i&&(delete this.requestCBHash_[r],i(t.b))}else{if("error"in t)throw"A server-side error has occurred: "+t.error;"a"in t&&this.onDataPush_(t.a,t.b)}}onDataPush_(t,r){this.log_("handleServerMessage",t,r),t==="d"?this.onDataUpdate_(r.p,r.d,!1,r.t):t==="m"?this.onDataUpdate_(r.p,r.d,!0,r.t):t==="c"?this.onListenRevoked_(r.p,r.q):t==="ac"?this.onAuthRevoked_(r.s,r.d):t==="apc"?this.onAppCheckRevoked_(r.s,r.d):t==="sd"?this.onSecurityDebugPacket_(r):Jh("Unrecognized action received from server: "+Ge(t)+`
Are you using the latest client?`)}onReady_(t,r){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(t),this.lastSessionId=r,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(t){O(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(t))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(t){t&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=Zs,this.realtime_||this.scheduleConnect_(0)),this.visible_=t}onOnline_(t){t?(this.log_("Browser went online."),this.reconnectDelay_=Zs,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>lR&&(this.reconnectDelay_=Zs),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());let t=new Date().getTime()-this.lastConnectionAttemptTime_,r=Math.max(0,this.reconnectDelay_-t);r=Math.random()*r,this.log_("Trying to reconnect in "+r+"ms"),this.scheduleConnect_(r),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*aR)}this.onConnectStatus_(!1)}establishConnection_(){return x(this,null,function*(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;let t=this.onDataMessage_.bind(this),r=this.onReady_.bind(this),i=this.onRealtimeDisconnect_.bind(this),s=this.id+":"+n.nextConnectionId_++,o=this.lastSessionId,a=!1,u=null,c=function(){u?u.close():(a=!0,i())},d=function(m){O(u,"sendRequest call when we're not connected not allowed."),u.sendRequest(m)};this.realtime_={close:c,sendRequest:d};let f=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{let[m,_]=yield Promise.all([this.authTokenProvider_.getToken(f),this.appCheckTokenProvider_.getToken(f)]);a?tt("getToken() completed but was canceled"):(tt("getToken() completed. Creating connection."),this.authToken_=m&&m.accessToken,this.appCheckToken_=_&&_.token,u=new id(s,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,t,r,i,I=>{ut(I+" ("+this.repoInfo_.toString()+")"),this.interrupt(uR)},o))}catch(m){this.log_("Failed to get token: "+m),a||(this.repoInfo_.nodeAdmin&&ut(m),c())}}})}interrupt(t){tt("Interrupting connection for reason: "+t),this.interruptReasons_[t]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(t){tt("Resuming connection for reason: "+t),delete this.interruptReasons_[t],Ja(this.interruptReasons_)&&(this.reconnectDelay_=Zs,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(t){let r=t-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:r})}cancelSentTransactions_(){for(let t=0;t<this.outstandingPuts_.length;t++){let r=this.outstandingPuts_[t];r&&"h"in r.request&&r.queued&&(r.onComplete&&r.onComplete("disconnect"),delete this.outstandingPuts_[t],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(t,r){let i;r?i=r.map(o=>ef(o)).join("$"):i="default";let s=this.removeListen_(t,i);s&&s.onComplete&&s.onComplete("permission_denied")}removeListen_(t,r){let i=new we(t).toString(),s;if(this.listens.has(i)){let o=this.listens.get(i);s=o.get(r),o.delete(r),o.size===0&&this.listens.delete(i)}else s=void 0;return s}onAuthRevoked_(t,r){tt("Auth token revoked: "+t+"/"+r),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(t==="invalid_token"||t==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=Ww&&(this.reconnectDelay_=Gw,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(t,r){tt("App check token revoked: "+t+"/"+r),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(t==="invalid_token"||t==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=Ww&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(t){this.securityDebugCallback_?this.securityDebugCallback_(t):"msg"in t&&console.log("FIREBASE: "+t.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(let t of this.listens.values())for(let r of t.values())this.sendListen_(r);for(let t=0;t<this.outstandingPuts_.length;t++)this.outstandingPuts_[t]&&this.sendPut_(t);for(;this.onDisconnectRequestQueue_.length;){let t=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(t.action,t.pathString,t.data,t.onComplete)}for(let t=0;t<this.outstandingGets_.length;t++)this.outstandingGets_[t]&&this.sendGet_(t)}sendConnectStats_(){let t={},r="js";nn()&&(this.repoInfo_.nodeAdmin?r="admin_node":r="node"),t["sdk."+r+"."+Xd.replace(/\./g,"-")]=1,Fh()?t["framework.cordova"]=1:Hy()&&(t["framework.reactnative"]=1),this.reportStats(t)}shouldReconnect_(){let t=Sl.getInstance().currentlyOnline();return Ja(this.interruptReasons_)&&t}}n.nextPersistentConnectionId_=0,n.nextConnectionId_=0;return n})(),le=class n{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new n(e,t)}};var Pi=class{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){let r=new le(Jn,e),i=new le(Jn,t);return this.compare(r,i)!==0}minPost(){return le.MIN}};var vl,bl=class extends Pi{static get __EMPTY_NODE(){return vl}static set __EMPTY_NODE(e){vl=e}compare(e,t){return kr(e.name,t.name)}isDefinedOn(e){throw Ei("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return le.MIN}maxPost(){return new le(Sn,vl)}makePost(e,t){return O(typeof e=="string","KeyIndex indexValue must always be a string."),new le(e,vl)}toString(){return".key"}},on=new bl;var Ai=class{constructor(e,t,r,i,s=null){this.isReverse_=i,this.resultGenerator_=s,this.nodeStack_=[];let o=1;for(;!e.isEmpty();)if(e=e,o=t?r(e.key,t):1,i&&(o*=-1),o<0)this.isReverse_?e=e.left:e=e.right;else if(o===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),t;if(this.resultGenerator_?t=this.resultGenerator_(e.key,e.value):t={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}},Wt=(()=>{class n{constructor(t,r,i,s,o){this.key=t,this.value=r,this.color=i??n.RED,this.left=s??Bt.EMPTY_NODE,this.right=o??Bt.EMPTY_NODE}copy(t,r,i,s,o){return new n(t??this.key,r??this.value,i??this.color,s??this.left,o??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||!!t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,r,i){let s=this,o=i(t,s.key);return o<0?s=s.copy(null,null,null,s.left.insert(t,r,i),null):o===0?s=s.copy(null,r,null,null,null):s=s.copy(null,null,null,null,s.right.insert(t,r,i)),s.fixUp_()}removeMin_(){if(this.left.isEmpty())return Bt.EMPTY_NODE;let t=this;return!t.left.isRed_()&&!t.left.left.isRed_()&&(t=t.moveRedLeft_()),t=t.copy(null,null,null,t.left.removeMin_(),null),t.fixUp_()}remove(t,r){let i,s;if(i=this,r(t,i.key)<0)!i.left.isEmpty()&&!i.left.isRed_()&&!i.left.left.isRed_()&&(i=i.moveRedLeft_()),i=i.copy(null,null,null,i.left.remove(t,r),null);else{if(i.left.isRed_()&&(i=i.rotateRight_()),!i.right.isEmpty()&&!i.right.isRed_()&&!i.right.left.isRed_()&&(i=i.moveRedRight_()),r(t,i.key)===0){if(i.right.isEmpty())return Bt.EMPTY_NODE;s=i.right.min_(),i=i.copy(s.key,s.value,null,null,i.right.removeMin_())}i=i.copy(null,null,null,null,i.right.remove(t,r))}return i.fixUp_()}isRed_(){return this.color}fixUp_(){let t=this;return t.right.isRed_()&&!t.left.isRed_()&&(t=t.rotateLeft_()),t.left.isRed_()&&t.left.left.isRed_()&&(t=t.rotateRight_()),t.left.isRed_()&&t.right.isRed_()&&(t=t.colorFlip_()),t}moveRedLeft_(){let t=this.colorFlip_();return t.right.left.isRed_()&&(t=t.copy(null,null,null,null,t.right.rotateRight_()),t=t.rotateLeft_(),t=t.colorFlip_()),t}moveRedRight_(){let t=this.colorFlip_();return t.left.left.isRed_()&&(t=t.rotateRight_(),t=t.colorFlip_()),t}rotateLeft_(){let t=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight_(){let t=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip_(){let t=this.left.copy(null,null,!this.left.color,null,null),r=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,r)}checkMaxDepth_(){let t=this.check_();return Math.pow(2,t)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");let t=this.left.check_();if(t!==this.right.check_())throw new Error("Black depths differ");return t+(this.isRed_()?0:1)}}return n.RED=!0,n.BLACK=!1,n})(),ad=class{copy(e,t,r,i,s){return this}insert(e,t,r){return new Wt(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}},Bt=class n{constructor(e,t=n.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new n(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,Wt.BLACK,null,null))}remove(e){return new n(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,Wt.BLACK,null,null))}get(e){let t,r=this.root_;for(;!r.isEmpty();){if(t=this.comparator_(e,r.key),t===0)return r.value;t<0?r=r.left:t>0&&(r=r.right)}return null}getPredecessorKey(e){let t,r=this.root_,i=null;for(;!r.isEmpty();)if(t=this.comparator_(e,r.key),t===0){if(r.left.isEmpty())return i?i.key:null;for(r=r.left;!r.right.isEmpty();)r=r.right;return r.key}else t<0?r=r.left:t>0&&(i=r,r=r.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new Ai(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new Ai(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new Ai(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new Ai(this.root_,null,this.comparator_,!0,e)}};Bt.EMPTY_NODE=new ad;function cR(n,e){return kr(n.name,e.name)}function of(n,e){return kr(n,e)}var ld;function hR(n){ld=n}var MI=function(n){return typeof n=="number"?"number:"+mI(n):"string:"+n},FI=function(n){if(n.isLeafNode()){let e=n.val();O(typeof e=="string"||typeof e=="number"||typeof e=="object"&&Ot(e,".sv"),"Priority must be a string or number.")}else O(n===ld||n.isEmpty(),"priority of unexpected type.");O(n===ld||n.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};var Qw,Ni=(()=>{class n{constructor(t,r=n.__childrenNodeConstructor.EMPTY_NODE){this.value_=t,this.priorityNode_=r,this.lazyHash_=null,O(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),FI(this.priorityNode_)}static set __childrenNodeConstructor(t){Qw=t}static get __childrenNodeConstructor(){return Qw}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(t){return new n(this.value_,t)}getImmediateChild(t){return t===".priority"?this.priorityNode_:n.__childrenNodeConstructor.EMPTY_NODE}getChild(t){return oe(t)?this:se(t)===".priority"?this.priorityNode_:n.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(t,r){return null}updateImmediateChild(t,r){return t===".priority"?this.updatePriority(r):r.isEmpty()&&t!==".priority"?this:n.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(t,r).updatePriority(this.priorityNode_)}updateChild(t,r){let i=se(t);return i===null?r:r.isEmpty()&&i!==".priority"?this:(O(i!==".priority"||Xn(t)===1,".priority must be the last token in a path"),this.updateImmediateChild(i,n.__childrenNodeConstructor.EMPTY_NODE.updateChild(Te(t),r)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(t,r){return!1}val(t){return t&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let t="";this.priorityNode_.isEmpty()||(t+="priority:"+MI(this.priorityNode_.val())+":");let r=typeof this.value_;t+=r+":",r==="number"?t+=mI(this.value_):t+=this.value_,this.lazyHash_=dI(t)}return this.lazyHash_}getValue(){return this.value_}compareTo(t){return t===n.__childrenNodeConstructor.EMPTY_NODE?1:t instanceof n.__childrenNodeConstructor?-1:(O(t.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(t))}compareToLeafNode_(t){let r=typeof t.value_,i=typeof this.value_,s=n.VALUE_TYPE_ORDER.indexOf(r),o=n.VALUE_TYPE_ORDER.indexOf(i);return O(s>=0,"Unknown leaf type: "+r),O(o>=0,"Unknown leaf type: "+i),s===o?i==="object"?0:this.value_<t.value_?-1:this.value_===t.value_?0:1:o-s}withIndex(){return this}isIndexed(){return!0}equals(t){if(t===this)return!0;if(t.isLeafNode()){let r=t;return this.value_===r.value_&&this.priorityNode_.equals(r.priorityNode_)}else return!1}}n.VALUE_TYPE_ORDER=["object","boolean","number","string"];return n})(),OI,VI;function dR(n){OI=n}function fR(n){VI=n}var ud=class extends Pi{compare(e,t){let r=e.node.getPriority(),i=t.node.getPriority(),s=r.compareTo(i);return s===0?kr(e.name,t.name):s}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return le.MIN}maxPost(){return new le(Sn,new Ni("[PRIORITY-POST]",VI))}makePost(e,t){let r=OI(e);return new le(t,new Ni("[PRIORITY-POST]",r))}toString(){return".priority"}},Se=new ud;var pR=Math.log(2),cd=class{constructor(e){let t=s=>parseInt(Math.log(s)/pR,10),r=s=>parseInt(Array(s+1).join("1"),2);this.count=t(e+1),this.current_=this.count-1;let i=r(this.count);this.bits_=e+1&i}nextBitIsOne(){let e=!(this.bits_&1<<this.current_);return this.current_--,e}},Al=function(n,e,t,r){n.sort(e);let i=function(u,c){let d=c-u,f,m;if(d===0)return null;if(d===1)return f=n[u],m=t?t(f):f,new Wt(m,f.node,Wt.BLACK,null,null);{let _=parseInt(d/2,10)+u,I=i(u,_),S=i(_+1,c);return f=n[_],m=t?t(f):f,new Wt(m,f.node,Wt.BLACK,I,S)}},s=function(u){let c=null,d=null,f=n.length,m=function(I,S){let P=f-I,V=f;f-=I;let U=i(P+1,V),L=n[P],$=t?t(L):L;_(new Wt($,L.node,S,null,U))},_=function(I){c?(c.left=I,c=I):(d=I,c=I)};for(let I=0;I<u.count;++I){let S=u.nextBitIsOne(),P=Math.pow(2,u.count-(I+1));S?m(P,Wt.BLACK):(m(P,Wt.BLACK),m(P,Wt.RED))}return d},o=new cd(n.length),a=s(o);return new Bt(r||e,a)};var Kh,Si={},Di=class n{constructor(e,t){this.indexes_=e,this.indexSet_=t}static get Default(){return O(Si&&Se,"ChildrenNode.ts has not been loaded"),Kh=Kh||new n({".priority":Si},{".priority":Se}),Kh}get(e){let t=Wn(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof Bt?t:null}hasIndex(e){return Ot(this.indexSet_,e.toString())}addIndex(e,t){O(e!==on,"KeyIndex always exists and isn't meant to be added to the IndexMap.");let r=[],i=!1,s=t.getIterator(le.Wrap),o=s.getNext();for(;o;)i=i||e.isDefinedOn(o.node),r.push(o),o=s.getNext();let a;i?a=Al(r,e.getCompare()):a=Si;let u=e.toString(),c=Object.assign({},this.indexSet_);c[u]=e;let d=Object.assign({},this.indexes_);return d[u]=a,new n(d,c)}addToIndexes(e,t){let r=Hs(this.indexes_,(i,s)=>{let o=Wn(this.indexSet_,s);if(O(o,"Missing index implementation for "+s),i===Si)if(o.isDefinedOn(e.node)){let a=[],u=t.getIterator(le.Wrap),c=u.getNext();for(;c;)c.name!==e.name&&a.push(c),c=u.getNext();return a.push(e),Al(a,o.getCompare())}else return Si;else{let a=t.get(e.name),u=i;return a&&(u=u.remove(new le(e.name,a))),u.insert(e,e.node)}});return new n(r,this.indexSet_)}removeFromIndexes(e,t){let r=Hs(this.indexes_,i=>{if(i===Si)return i;{let s=t.get(e.name);return s?i.remove(new le(e.name,s)):i}});return new n(r,this.indexSet_)}};var eo,ne=(()=>{class n{constructor(t,r,i){this.children_=t,this.priorityNode_=r,this.indexMap_=i,this.lazyHash_=null,this.priorityNode_&&FI(this.priorityNode_),this.children_.isEmpty()&&O(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}static get EMPTY_NODE(){return eo||(eo=new n(new Bt(of),null,Di.Default))}isLeafNode(){return!1}getPriority(){return this.priorityNode_||eo}updatePriority(t){return this.children_.isEmpty()?this:new n(this.children_,t,this.indexMap_)}getImmediateChild(t){if(t===".priority")return this.getPriority();{let r=this.children_.get(t);return r===null?eo:r}}getChild(t){let r=se(t);return r===null?this:this.getImmediateChild(r).getChild(Te(t))}hasChild(t){return this.children_.get(t)!==null}updateImmediateChild(t,r){if(O(r,"We should always be passing snapshot nodes"),t===".priority")return this.updatePriority(r);{let i=new le(t,r),s,o;r.isEmpty()?(s=this.children_.remove(t),o=this.indexMap_.removeFromIndexes(i,this.children_)):(s=this.children_.insert(t,r),o=this.indexMap_.addToIndexes(i,this.children_));let a=s.isEmpty()?eo:this.priorityNode_;return new n(s,a,o)}}updateChild(t,r){let i=se(t);if(i===null)return r;{O(se(t)!==".priority"||Xn(t)===1,".priority must be the last token in a path");let s=this.getImmediateChild(i).updateChild(Te(t),r);return this.updateImmediateChild(i,s)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(t){if(this.isEmpty())return null;let r={},i=0,s=0,o=!0;if(this.forEachChild(Se,(a,u)=>{r[a]=u.val(t),i++,o&&n.INTEGER_REGEXP_.test(a)?s=Math.max(s,Number(a)):o=!1}),!t&&o&&s<2*i){let a=[];for(let u in r)a[u]=r[u];return a}else return t&&!this.getPriority().isEmpty()&&(r[".priority"]=this.getPriority().val()),r}hash(){if(this.lazyHash_===null){let t="";this.getPriority().isEmpty()||(t+="priority:"+MI(this.getPriority().val())+":"),this.forEachChild(Se,(r,i)=>{let s=i.hash();s!==""&&(t+=":"+r+":"+s)}),this.lazyHash_=t===""?"":dI(t)}return this.lazyHash_}getPredecessorChildName(t,r,i){let s=this.resolveIndex_(i);if(s){let o=s.getPredecessorKey(new le(t,r));return o?o.name:null}else return this.children_.getPredecessorKey(t)}getFirstChildName(t){let r=this.resolveIndex_(t);if(r){let i=r.minKey();return i&&i.name}else return this.children_.minKey()}getFirstChild(t){let r=this.getFirstChildName(t);return r?new le(r,this.children_.get(r)):null}getLastChildName(t){let r=this.resolveIndex_(t);if(r){let i=r.maxKey();return i&&i.name}else return this.children_.maxKey()}getLastChild(t){let r=this.getLastChildName(t);return r?new le(r,this.children_.get(r)):null}forEachChild(t,r){let i=this.resolveIndex_(t);return i?i.inorderTraversal(s=>r(s.name,s.node)):this.children_.inorderTraversal(r)}getIterator(t){return this.getIteratorFrom(t.minPost(),t)}getIteratorFrom(t,r){let i=this.resolveIndex_(r);if(i)return i.getIteratorFrom(t,s=>s);{let s=this.children_.getIteratorFrom(t.name,le.Wrap),o=s.peek();for(;o!=null&&r.compare(o,t)<0;)s.getNext(),o=s.peek();return s}}getReverseIterator(t){return this.getReverseIteratorFrom(t.maxPost(),t)}getReverseIteratorFrom(t,r){let i=this.resolveIndex_(r);if(i)return i.getReverseIteratorFrom(t,s=>s);{let s=this.children_.getReverseIteratorFrom(t.name,le.Wrap),o=s.peek();for(;o!=null&&r.compare(o,t)>0;)s.getNext(),o=s.peek();return s}}compareTo(t){return this.isEmpty()?t.isEmpty()?0:-1:t.isLeafNode()||t.isEmpty()?1:t===Co?-1:0}withIndex(t){if(t===on||this.indexMap_.hasIndex(t))return this;{let r=this.indexMap_.addIndex(t,this.children_);return new n(this.children_,this.priorityNode_,r)}}isIndexed(t){return t===on||this.indexMap_.hasIndex(t)}equals(t){if(t===this)return!0;if(t.isLeafNode())return!1;{let r=t;if(this.getPriority().equals(r.getPriority()))if(this.children_.count()===r.children_.count()){let i=this.getIterator(Se),s=r.getIterator(Se),o=i.getNext(),a=s.getNext();for(;o&&a;){if(o.name!==a.name||!o.node.equals(a.node))return!1;o=i.getNext(),a=s.getNext()}return o===null&&a===null}else return!1;else return!1}}resolveIndex_(t){return t===on?null:this.indexMap_.get(t.toString())}}return n.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/,n})(),hd=class extends ne{constructor(){super(new Bt(of),ne.EMPTY_NODE,Di.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return ne.EMPTY_NODE}isEmpty(){return!1}},Co=new hd;Object.defineProperties(le,{MIN:{value:new le(Jn,ne.EMPTY_NODE)},MAX:{value:new le(Sn,Co)}});bl.__EMPTY_NODE=ne.EMPTY_NODE;Ni.__childrenNodeConstructor=ne;hR(Co);fR(Co);var mR=!0;function ke(n,e=null){if(n===null)return ne.EMPTY_NODE;if(typeof n=="object"&&".priority"in n&&(e=n[".priority"]),O(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof n=="object"&&".value"in n&&n[".value"]!==null&&(n=n[".value"]),typeof n!="object"||".sv"in n){let t=n;return new Ni(t,ke(e))}if(!(n instanceof Array)&&mR){let t=[],r=!1;if(nt(n,(o,a)=>{if(o.substring(0,1)!=="."){let u=ke(a);u.isEmpty()||(r=r||!u.getPriority().isEmpty(),t.push(new le(o,u)))}}),t.length===0)return ne.EMPTY_NODE;let s=Al(t,cR,o=>o.name,of);if(r){let o=Al(t,Se.getCompare());return new ne(s,ke(e),new Di({".priority":o},{".priority":Se}))}else return new ne(s,ke(e),Di.Default)}else{let t=ne.EMPTY_NODE;return nt(n,(r,i)=>{if(Ot(n,r)&&r.substring(0,1)!=="."){let s=ke(i);(s.isLeafNode()||!s.isEmpty())&&(t=t.updateImmediateChild(r,s))}}),t.updatePriority(ke(e))}}dR(ke);var uo=class extends Pi{constructor(e){super(),this.indexPath_=e,O(!oe(e)&&se(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){let r=this.extractChild(e.node),i=this.extractChild(t.node),s=r.compareTo(i);return s===0?kr(e.name,t.name):s}makePost(e,t){let r=ke(e),i=ne.EMPTY_NODE.updateChild(this.indexPath_,r);return new le(t,i)}maxPost(){let e=ne.EMPTY_NODE.updateChild(this.indexPath_,Co);return new le(Sn,e)}toString(){return lo(this.indexPath_,0).join("/")}};var dd=class extends Pi{compare(e,t){let r=e.node.compareTo(t.node);return r===0?kr(e.name,t.name):r}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return le.MIN}maxPost(){return le.MAX}makePost(e,t){let r=ke(e);return new le(t,r)}toString(){return".value"}},af=new dd;function LI(n){return{type:"value",snapshotNode:n}}function xi(n,e){return{type:"child_added",snapshotNode:e,childName:n}}function co(n,e){return{type:"child_removed",snapshotNode:e,childName:n}}function ho(n,e,t){return{type:"child_changed",snapshotNode:e,childName:n,oldSnap:t}}function gR(n,e){return{type:"child_moved",snapshotNode:e,childName:n}}var fo=class{constructor(e){this.index_=e}updateChild(e,t,r,i,s,o){O(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");let a=e.getImmediateChild(t);return a.getChild(i).equals(r.getChild(i))&&a.isEmpty()===r.isEmpty()||(o!=null&&(r.isEmpty()?e.hasChild(t)?o.trackChildChange(co(t,a)):O(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?o.trackChildChange(xi(t,r)):o.trackChildChange(ho(t,r,a))),e.isLeafNode()&&r.isEmpty())?e:e.updateImmediateChild(t,r).withIndex(this.index_)}updateFullNode(e,t,r){return r!=null&&(e.isLeafNode()||e.forEachChild(Se,(i,s)=>{t.hasChild(i)||r.trackChildChange(co(i,s))}),t.isLeafNode()||t.forEachChild(Se,(i,s)=>{if(e.hasChild(i)){let o=e.getImmediateChild(i);o.equals(s)||r.trackChildChange(ho(i,s,o))}else r.trackChildChange(xi(i,s))})),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?ne.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}};var Rl=class n{constructor(e){this.indexedFilter_=new fo(e.getIndex()),this.index_=e.getIndex(),this.startPost_=n.getStartPost_(e),this.endPost_=n.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){let t=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,r=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return t&&r}updateChild(e,t,r,i,s,o){return this.matches(new le(t,r))||(r=ne.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,r,i,s,o)}updateFullNode(e,t,r){t.isLeafNode()&&(t=ne.EMPTY_NODE);let i=t.withIndex(this.index_);i=i.updatePriority(ne.EMPTY_NODE);let s=this;return t.forEachChild(Se,(o,a)=>{s.matches(new le(o,a))||(i=i.updateImmediateChild(o,ne.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,i,r)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){let t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}else return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){let t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}else return e.getIndex().maxPost()}};var fd=class{constructor(e){this.withinDirectionalStart=t=>this.reverse_?this.withinEndPost(t):this.withinStartPost(t),this.withinDirectionalEnd=t=>this.reverse_?this.withinStartPost(t):this.withinEndPost(t),this.withinStartPost=t=>{let r=this.index_.compare(this.rangedFilter_.getStartPost(),t);return this.startIsInclusive_?r<=0:r<0},this.withinEndPost=t=>{let r=this.index_.compare(t,this.rangedFilter_.getEndPost());return this.endIsInclusive_?r<=0:r<0},this.rangedFilter_=new Rl(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,r,i,s,o){return this.rangedFilter_.matches(new le(t,r))||(r=ne.EMPTY_NODE),e.getImmediateChild(t).equals(r)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,r,i,s,o):this.fullLimitUpdateChild_(e,t,r,s,o)}updateFullNode(e,t,r){let i;if(t.isLeafNode()||t.isEmpty())i=ne.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<t.numChildren()&&t.isIndexed(this.index_)){i=ne.EMPTY_NODE.withIndex(this.index_);let s;this.reverse_?s=t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):s=t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let o=0;for(;s.hasNext()&&o<this.limit_;){let a=s.getNext();if(this.withinDirectionalStart(a))if(this.withinDirectionalEnd(a))i=i.updateImmediateChild(a.name,a.node),o++;else break;else continue}}else{i=t.withIndex(this.index_),i=i.updatePriority(ne.EMPTY_NODE);let s;this.reverse_?s=i.getReverseIterator(this.index_):s=i.getIterator(this.index_);let o=0;for(;s.hasNext();){let a=s.getNext();o<this.limit_&&this.withinDirectionalStart(a)&&this.withinDirectionalEnd(a)?o++:i=i.updateImmediateChild(a.name,ne.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,i,r)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,r,i,s){let o;if(this.reverse_){let f=this.index_.getCompare();o=(m,_)=>f(_,m)}else o=this.index_.getCompare();let a=e;O(a.numChildren()===this.limit_,"");let u=new le(t,r),c=this.reverse_?a.getFirstChild(this.index_):a.getLastChild(this.index_),d=this.rangedFilter_.matches(u);if(a.hasChild(t)){let f=a.getImmediateChild(t),m=i.getChildAfterChild(this.index_,c,this.reverse_);for(;m!=null&&(m.name===t||a.hasChild(m.name));)m=i.getChildAfterChild(this.index_,m,this.reverse_);let _=m==null?1:o(m,u);if(d&&!r.isEmpty()&&_>=0)return s?.trackChildChange(ho(t,r,f)),a.updateImmediateChild(t,r);{s?.trackChildChange(co(t,f));let S=a.updateImmediateChild(t,ne.EMPTY_NODE);return m!=null&&this.rangedFilter_.matches(m)?(s?.trackChildChange(xi(m.name,m.node)),S.updateImmediateChild(m.name,m.node)):S}}else return r.isEmpty()?e:d&&o(c,u)>=0?(s!=null&&(s.trackChildChange(co(c.name,c.node)),s.trackChildChange(xi(t,r))),a.updateImmediateChild(t,r).updateImmediateChild(c.name,ne.EMPTY_NODE)):e}};var po=class n{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=Se}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return O(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return O(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:Jn}hasEnd(){return this.endSet_}getIndexEndValue(){return O(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return O(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:Sn}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return O(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===Se}copy(){let e=new n;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}};function _R(n){return n.loadsAllData()?new fo(n.getIndex()):n.hasLimit()?new fd(n):new Rl(n)}function yR(n,e){let t=n.copy();return t.limitSet_=!0,t.limit_=e,t.viewFrom_="l",t}function vR(n,e){let t=n.copy();return t.limitSet_=!0,t.limit_=e,t.viewFrom_="r",t}function pd(n,e,t){let r=n.copy();return r.startSet_=!0,e===void 0&&(e=null),r.indexStartValue_=e,t!=null?(r.startNameSet_=!0,r.indexStartName_=t):(r.startNameSet_=!1,r.indexStartName_=""),r}function wR(n,e,t){let r;return n.index_===on||t?r=pd(n,e,t):r=pd(n,e,Sn),r.startAfterSet_=!0,r}function md(n,e,t){let r=n.copy();return r.endSet_=!0,e===void 0&&(e=null),r.indexEndValue_=e,t!==void 0?(r.endNameSet_=!0,r.indexEndName_=t):(r.endNameSet_=!1,r.indexEndName_=""),r}function IR(n,e,t){let r;return n.index_===on||t?r=md(n,e,t):r=md(n,e,Jn),r.endBeforeSet_=!0,r}function Ql(n,e){let t=n.copy();return t.index_=e,t}function $w(n){let e={};if(n.isDefault())return e;let t;if(n.index_===Se?t="$priority":n.index_===af?t="$value":n.index_===on?t="$key":(O(n.index_ instanceof uo,"Unrecognized index type!"),t=n.index_.toString()),e.orderBy=Ge(t),n.startSet_){let r=n.startAfterSet_?"startAfter":"startAt";e[r]=Ge(n.indexStartValue_),n.startNameSet_&&(e[r]+=","+Ge(n.indexStartName_))}if(n.endSet_){let r=n.endBeforeSet_?"endBefore":"endAt";e[r]=Ge(n.indexEndValue_),n.endNameSet_&&(e[r]+=","+Ge(n.indexEndName_))}return n.limitSet_&&(n.isViewFromLeft()?e.limitToFirst=n.limit_:e.limitToLast=n.limit_),e}function Hw(n){let e={};if(n.startSet_&&(e.sp=n.indexStartValue_,n.startNameSet_&&(e.sn=n.indexStartName_),e.sin=!n.startAfterSet_),n.endSet_&&(e.ep=n.indexEndValue_,n.endNameSet_&&(e.en=n.indexEndName_),e.ein=!n.endBeforeSet_),n.limitSet_){e.l=n.limit_;let t=n.viewFrom_;t===""&&(n.isViewFromLeft()?t="l":t="r"),e.vf=t}return n.index_!==Se&&(e.i=n.index_.toString()),e}var gd=class n extends Tl{constructor(e,t,r,i){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=r,this.appCheckTokenProvider_=i,this.log_=To("p:rest:"),this.listens_={}}reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return t!==void 0?"tag$"+t:(O(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}listen(e,t,r,i){let s=e._path.toString();this.log_("Listen called for "+s+" "+e._queryIdentifier);let o=n.getListenId_(e,r),a={};this.listens_[o]=a;let u=$w(e._queryParams);this.restRequest_(s+".json",u,(c,d)=>{let f=d;if(c===404&&(f=null,c=null),c===null&&this.onDataUpdate_(s,f,!1,r),Wn(this.listens_,o)===a){let m;c?c===401?m="permission_denied":m="rest_error:"+c:m="ok",i(m,null)}})}unlisten(e,t){let r=n.getListenId_(e,t);delete this.listens_[r]}get(e){let t=$w(e._queryParams),r=e._path.toString(),i=new pt;return this.restRequest_(r+".json",t,(s,o)=>{let a=o;s===404&&(a=null,s=null),s===null?(this.onDataUpdate_(r,a,!1,null),i.resolve(a)):i.reject(new Error(a))}),i.promise}refreshAuthToken(e){}restRequest_(e,t={},r){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([i,s])=>{i&&i.accessToken&&(t.auth=i.accessToken),s&&s.token&&(t.ac=s.token);let o=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+ev(t);this.log_("Sending REST request for "+o);let a=new XMLHttpRequest;a.onreadystatechange=()=>{if(r&&a.readyState===4){this.log_("REST Response for "+o+" received. status:",a.status,"response:",a.responseText);let u=null;if(a.status>=200&&a.status<300){try{u=Ya(a.responseText)}catch{ut("Failed to parse JSON response for "+o+": "+a.responseText)}r(null,u)}else a.status!==401&&a.status!==404&&ut("Got unsuccessful REST response for "+o+" Status: "+a.status),r(a.status);r=null}},a.open("GET",o,!0),a.send()})}};var _d=class{constructor(){this.rootNode_=ne.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}};function Pl(){return{value:null,children:new Map}}function Li(n,e,t){if(oe(e))n.value=t,n.children.clear();else if(n.value!==null)n.value=n.value.updateChild(e,t);else{let r=se(e);n.children.has(r)||n.children.set(r,Pl());let i=n.children.get(r);e=Te(e),Li(i,e,t)}}function yd(n,e){if(oe(e))return n.value=null,n.children.clear(),!0;if(n.value!==null){if(n.value.isLeafNode())return!1;{let t=n.value;return n.value=null,t.forEachChild(Se,(r,i)=>{Li(n,new we(r),i)}),yd(n,e)}}else if(n.children.size>0){let t=se(e);return e=Te(e),n.children.has(t)&&yd(n.children.get(t),e)&&n.children.delete(t),n.children.size===0}else return!0}function vd(n,e,t){n.value!==null?t(e,n.value):ER(n,(r,i)=>{let s=new we(e.toString()+"/"+r);vd(i,s,t)})}function ER(n,e){n.children.forEach((t,r)=>{e(r,t)})}var wd=class{constructor(e){this.collection_=e,this.last_=null}get(){let e=this.collection_.get(),t=Object.assign({},e);return this.last_&&nt(this.last_,(r,i)=>{t[r]=t[r]-i}),this.last_=e,t}};var Yw=10*1e3,TR=30*1e3,CR=5*60*1e3,Id=class{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new wd(e);let r=Yw+(TR-Yw)*Math.random();no(this.reportStats_.bind(this),Math.floor(r))}reportStats_(){let e=this.statsListener_.get(),t={},r=!1;nt(e,(i,s)=>{s>0&&Ot(this.statsToReport_,i)&&(t[i]=s,r=!0)}),r&&this.server_.reportStats(t),no(this.reportStats_.bind(this),Math.floor(Math.random()*2*CR))}};var sn=function(n){return n[n.OVERWRITE=0]="OVERWRITE",n[n.MERGE=1]="MERGE",n[n.ACK_USER_WRITE=2]="ACK_USER_WRITE",n[n.LISTEN_COMPLETE=3]="LISTEN_COMPLETE",n}(sn||{});function lf(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function uf(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function cf(n){return{fromUser:!1,fromServer:!0,queryId:n,tagged:!0}}var Ed=class n{constructor(e,t,r){this.path=e,this.affectedTree=t,this.revert=r,this.type=sn.ACK_USER_WRITE,this.source=lf()}operationForChild(e){if(oe(this.path)){if(this.affectedTree.value!=null)return O(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{let t=this.affectedTree.subtree(new we(e));return new n(ve(),t,this.revert)}}else return O(se(this.path)===e,"operationForChild called for unrelated child."),new n(Te(this.path),this.affectedTree,this.revert)}};var Nl=class n{constructor(e,t){this.source=e,this.path=t,this.type=sn.LISTEN_COMPLETE}operationForChild(e){return oe(this.path)?new n(this.source,ve()):new n(this.source,Te(this.path))}};var ki=class n{constructor(e,t,r){this.source=e,this.path=t,this.snap=r,this.type=sn.OVERWRITE}operationForChild(e){return oe(this.path)?new n(this.source,ve(),this.snap.getImmediateChild(e)):new n(this.source,Te(this.path),this.snap)}};var mo=class n{constructor(e,t,r){this.source=e,this.path=t,this.children=r,this.type=sn.MERGE}operationForChild(e){if(oe(this.path)){let t=this.children.subtree(new we(e));return t.isEmpty()?null:t.value?new ki(this.source,ve(),t.value):new n(this.source,ve(),t)}else return O(se(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new n(this.source,Te(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}};var ln=class{constructor(e,t,r){this.node_=e,this.fullyInitialized_=t,this.filtered_=r}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(oe(e))return this.isFullyInitialized()&&!this.filtered_;let t=se(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}};var Td=class{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}};function SR(n,e,t,r){let i=[],s=[];return e.forEach(o=>{o.type==="child_changed"&&n.index_.indexedValueChanged(o.oldSnap,o.snapshotNode)&&s.push(gR(o.childName,o.snapshotNode))}),to(n,i,"child_removed",e,r,t),to(n,i,"child_added",e,r,t),to(n,i,"child_moved",s,r,t),to(n,i,"child_changed",e,r,t),to(n,i,"value",e,r,t),i}function to(n,e,t,r,i,s){let o=r.filter(a=>a.type===t);o.sort((a,u)=>AR(n,a,u)),o.forEach(a=>{let u=bR(n,a,s);i.forEach(c=>{c.respondsTo(a.type)&&e.push(c.createEvent(u,n.query_))})})}function bR(n,e,t){return e.type==="value"||e.type==="child_removed"||(e.prevName=t.getPredecessorChildName(e.childName,e.snapshotNode,n.index_)),e}function AR(n,e,t){if(e.childName==null||t.childName==null)throw Ei("Should only compare child_ events.");let r=new le(e.childName,e.snapshotNode),i=new le(t.childName,t.snapshotNode);return n.index_.compare(r,i)}function $l(n,e){return{eventCache:n,serverCache:e}}function io(n,e,t,r){return $l(new ln(e,t,r),n.serverCache)}function BI(n,e,t,r){return $l(n.eventCache,new ln(e,t,r))}function Dl(n){return n.eventCache.isFullyInitialized()?n.eventCache.getNode():null}function xr(n){return n.serverCache.isFullyInitialized()?n.serverCache.getNode():null}var Gh,RR=()=>(Gh||(Gh=new Bt(bA)),Gh),gt=class n{constructor(e,t=RR()){this.value=e,this.children=t}static fromObject(e){let t=new n(null);return nt(e,(r,i)=>{t=t.set(new we(r),i)}),t}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(this.value!=null&&t(this.value))return{path:ve(),value:this.value};if(oe(e))return null;{let r=se(e),i=this.children.get(r);if(i!==null){let s=i.findRootMostMatchingPathAndValue(Te(e),t);return s!=null?{path:De(new we(r),s.path),value:s.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(oe(e))return this;{let t=se(e),r=this.children.get(t);return r!==null?r.subtree(Te(e)):new n(null)}}set(e,t){if(oe(e))return new n(t,this.children);{let r=se(e),s=(this.children.get(r)||new n(null)).set(Te(e),t),o=this.children.insert(r,s);return new n(this.value,o)}}remove(e){if(oe(e))return this.children.isEmpty()?new n(null):new n(null,this.children);{let t=se(e),r=this.children.get(t);if(r){let i=r.remove(Te(e)),s;return i.isEmpty()?s=this.children.remove(t):s=this.children.insert(t,i),this.value===null&&s.isEmpty()?new n(null):new n(this.value,s)}else return this}}get(e){if(oe(e))return this.value;{let t=se(e),r=this.children.get(t);return r?r.get(Te(e)):null}}setTree(e,t){if(oe(e))return t;{let r=se(e),s=(this.children.get(r)||new n(null)).setTree(Te(e),t),o;return s.isEmpty()?o=this.children.remove(r):o=this.children.insert(r,s),new n(this.value,o)}}fold(e){return this.fold_(ve(),e)}fold_(e,t){let r={};return this.children.inorderTraversal((i,s)=>{r[i]=s.fold_(De(e,i),t)}),t(e,this.value,r)}findOnPath(e,t){return this.findOnPath_(e,ve(),t)}findOnPath_(e,t,r){let i=this.value?r(t,this.value):!1;if(i)return i;if(oe(e))return null;{let s=se(e),o=this.children.get(s);return o?o.findOnPath_(Te(e),De(t,s),r):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,ve(),t)}foreachOnPath_(e,t,r){if(oe(e))return this;{this.value&&r(t,this.value);let i=se(e),s=this.children.get(i);return s?s.foreachOnPath_(Te(e),De(t,i),r):new n(null)}}foreach(e){this.foreach_(ve(),e)}foreach_(e,t){this.children.inorderTraversal((r,i)=>{i.foreach_(De(e,r),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,r)=>{r.value&&e(t,r.value)})}};var Qt=class n{constructor(e){this.writeTree_=e}static empty(){return new n(new gt(null))}};function so(n,e,t){if(oe(e))return new Qt(new gt(t));{let r=n.writeTree_.findRootMostValueAndPath(e);if(r!=null){let i=r.path,s=r.value,o=mt(i,e);return s=s.updateChild(o,t),new Qt(n.writeTree_.set(i,s))}else{let i=new gt(t),s=n.writeTree_.setTree(e,i);return new Qt(s)}}}function Cd(n,e,t){let r=n;return nt(t,(i,s)=>{r=so(r,De(e,i),s)}),r}function Jw(n,e){if(oe(e))return Qt.empty();{let t=n.writeTree_.setTree(e,new gt(null));return new Qt(t)}}function Sd(n,e){return Mr(n,e)!=null}function Mr(n,e){let t=n.writeTree_.findRootMostValueAndPath(e);return t!=null?n.writeTree_.get(t.path).getChild(mt(t.path,e)):null}function Xw(n){let e=[],t=n.writeTree_.value;return t!=null?t.isLeafNode()||t.forEachChild(Se,(r,i)=>{e.push(new le(r,i))}):n.writeTree_.children.inorderTraversal((r,i)=>{i.value!=null&&e.push(new le(r,i.value))}),e}function Hn(n,e){if(oe(e))return n;{let t=Mr(n,e);return t!=null?new Qt(new gt(t)):new Qt(n.writeTree_.subtree(e))}}function bd(n){return n.writeTree_.isEmpty()}function Mi(n,e){return UI(ve(),n.writeTree_,e)}function UI(n,e,t){if(e.value!=null)return t.updateChild(n,e.value);{let r=null;return e.children.inorderTraversal((i,s)=>{i===".priority"?(O(s.value!==null,"Priority writes must always be leaf nodes"),r=s.value):t=UI(De(n,i),s,t)}),!t.getChild(n).isEmpty()&&r!==null&&(t=t.updateChild(De(n,".priority"),r)),t}}function Hl(n,e){return KI(e,n)}function PR(n,e,t,r,i){O(r>n.lastWriteId,"Stacking an older write on top of newer ones"),i===void 0&&(i=!0),n.allWrites.push({path:e,snap:t,writeId:r,visible:i}),i&&(n.visibleWrites=so(n.visibleWrites,e,t)),n.lastWriteId=r}function NR(n,e,t,r){O(r>n.lastWriteId,"Stacking an older merge on top of newer ones"),n.allWrites.push({path:e,children:t,writeId:r,visible:!0}),n.visibleWrites=Cd(n.visibleWrites,e,t),n.lastWriteId=r}function DR(n,e){for(let t=0;t<n.allWrites.length;t++){let r=n.allWrites[t];if(r.writeId===e)return r}return null}function xR(n,e){let t=n.allWrites.findIndex(a=>a.writeId===e);O(t>=0,"removeWrite called with nonexistent writeId.");let r=n.allWrites[t];n.allWrites.splice(t,1);let i=r.visible,s=!1,o=n.allWrites.length-1;for(;i&&o>=0;){let a=n.allWrites[o];a.visible&&(o>=t&&kR(a,r.path)?i=!1:Lt(r.path,a.path)&&(s=!0)),o--}if(i){if(s)return MR(n),!0;if(r.snap)n.visibleWrites=Jw(n.visibleWrites,r.path);else{let a=r.children;nt(a,u=>{n.visibleWrites=Jw(n.visibleWrites,De(r.path,u))})}return!0}else return!1}function kR(n,e){if(n.snap)return Lt(n.path,e);for(let t in n.children)if(n.children.hasOwnProperty(t)&&Lt(De(n.path,t),e))return!0;return!1}function MR(n){n.visibleWrites=qI(n.allWrites,FR,ve()),n.allWrites.length>0?n.lastWriteId=n.allWrites[n.allWrites.length-1].writeId:n.lastWriteId=-1}function FR(n){return n.visible}function qI(n,e,t){let r=Qt.empty();for(let i=0;i<n.length;++i){let s=n[i];if(e(s)){let o=s.path,a;if(s.snap)Lt(t,o)?(a=mt(t,o),r=so(r,a,s.snap)):Lt(o,t)&&(a=mt(o,t),r=so(r,ve(),s.snap.getChild(a)));else if(s.children){if(Lt(t,o))a=mt(t,o),r=Cd(r,a,s.children);else if(Lt(o,t))if(a=mt(o,t),oe(a))r=Cd(r,ve(),s.children);else{let u=Wn(s.children,se(a));if(u){let c=u.getChild(Te(a));r=so(r,ve(),c)}}}else throw Ei("WriteRecord should have .snap or .children")}}return r}function jI(n,e,t,r,i){if(!r&&!i){let s=Mr(n.visibleWrites,e);if(s!=null)return s;{let o=Hn(n.visibleWrites,e);if(bd(o))return t;if(t==null&&!Sd(o,ve()))return null;{let a=t||ne.EMPTY_NODE;return Mi(o,a)}}}else{let s=Hn(n.visibleWrites,e);if(!i&&bd(s))return t;if(!i&&t==null&&!Sd(s,ve()))return null;{let o=function(c){return(c.visible||i)&&(!r||!~r.indexOf(c.writeId))&&(Lt(c.path,e)||Lt(e,c.path))},a=qI(n.allWrites,o,e),u=t||ne.EMPTY_NODE;return Mi(a,u)}}}function OR(n,e,t){let r=ne.EMPTY_NODE,i=Mr(n.visibleWrites,e);if(i)return i.isLeafNode()||i.forEachChild(Se,(s,o)=>{r=r.updateImmediateChild(s,o)}),r;if(t){let s=Hn(n.visibleWrites,e);return t.forEachChild(Se,(o,a)=>{let u=Mi(Hn(s,new we(o)),a);r=r.updateImmediateChild(o,u)}),Xw(s).forEach(o=>{r=r.updateImmediateChild(o.name,o.node)}),r}else{let s=Hn(n.visibleWrites,e);return Xw(s).forEach(o=>{r=r.updateImmediateChild(o.name,o.node)}),r}}function VR(n,e,t,r,i){O(r||i,"Either existingEventSnap or existingServerSnap must exist");let s=De(e,t);if(Sd(n.visibleWrites,s))return null;{let o=Hn(n.visibleWrites,s);return bd(o)?i.getChild(t):Mi(o,i.getChild(t))}}function LR(n,e,t,r){let i=De(e,t),s=Mr(n.visibleWrites,i);if(s!=null)return s;if(r.isCompleteForChild(t)){let o=Hn(n.visibleWrites,i);return Mi(o,r.getNode().getImmediateChild(t))}else return null}function BR(n,e){return Mr(n.visibleWrites,e)}function UR(n,e,t,r,i,s,o){let a,u=Hn(n.visibleWrites,e),c=Mr(u,ve());if(c!=null)a=c;else if(t!=null)a=Mi(u,t);else return[];if(a=a.withIndex(o),!a.isEmpty()&&!a.isLeafNode()){let d=[],f=o.getCompare(),m=s?a.getReverseIteratorFrom(r,o):a.getIteratorFrom(r,o),_=m.getNext();for(;_&&d.length<i;)f(_,r)!==0&&d.push(_),_=m.getNext();return d}else return[]}function qR(){return{visibleWrites:Qt.empty(),allWrites:[],lastWriteId:-1}}function xl(n,e,t,r){return jI(n.writeTree,n.treePath,e,t,r)}function hf(n,e){return OR(n.writeTree,n.treePath,e)}function Zw(n,e,t,r){return VR(n.writeTree,n.treePath,e,t,r)}function kl(n,e){return BR(n.writeTree,De(n.treePath,e))}function jR(n,e,t,r,i,s){return UR(n.writeTree,n.treePath,e,t,r,i,s)}function df(n,e,t){return LR(n.writeTree,n.treePath,e,t)}function zI(n,e){return KI(De(n.treePath,e),n.writeTree)}function KI(n,e){return{treePath:n,writeTree:e}}var Ad=class{constructor(){this.changeMap=new Map}trackChildChange(e){let t=e.type,r=e.childName;O(t==="child_added"||t==="child_changed"||t==="child_removed","Only child changes supported for tracking"),O(r!==".priority","Only non-priority child changes can be tracked.");let i=this.changeMap.get(r);if(i){let s=i.type;if(t==="child_added"&&s==="child_removed")this.changeMap.set(r,ho(r,e.snapshotNode,i.snapshotNode));else if(t==="child_removed"&&s==="child_added")this.changeMap.delete(r);else if(t==="child_removed"&&s==="child_changed")this.changeMap.set(r,co(r,i.oldSnap));else if(t==="child_changed"&&s==="child_added")this.changeMap.set(r,xi(r,e.snapshotNode));else if(t==="child_changed"&&s==="child_changed")this.changeMap.set(r,ho(r,e.snapshotNode,i.oldSnap));else throw Ei("Illegal combination of changes: "+e+" occurred after "+i)}else this.changeMap.set(r,e)}getChanges(){return Array.from(this.changeMap.values())}};var Rd=class{getCompleteChild(e){return null}getChildAfterChild(e,t,r){return null}},GI=new Rd,go=class{constructor(e,t,r=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=r}getCompleteChild(e){let t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{let r=this.optCompleteServerCache_!=null?new ln(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return df(this.writes_,e,r)}}getChildAfterChild(e,t,r){let i=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:xr(this.viewCache_),s=jR(this.writes_,i,t,1,r,e);return s.length===0?null:s[0]}};function zR(n){return{filter:n}}function KR(n,e){O(e.eventCache.getNode().isIndexed(n.filter.getIndex()),"Event snap not indexed"),O(e.serverCache.getNode().isIndexed(n.filter.getIndex()),"Server snap not indexed")}function GR(n,e,t,r,i){let s=new Ad,o,a;if(t.type===sn.OVERWRITE){let c=t;c.source.fromUser?o=Pd(n,e,c.path,c.snap,r,i,s):(O(c.source.fromServer,"Unknown source."),a=c.source.tagged||e.serverCache.isFiltered()&&!oe(c.path),o=Ml(n,e,c.path,c.snap,r,i,a,s))}else if(t.type===sn.MERGE){let c=t;c.source.fromUser?o=QR(n,e,c.path,c.children,r,i,s):(O(c.source.fromServer,"Unknown source."),a=c.source.tagged||e.serverCache.isFiltered(),o=Nd(n,e,c.path,c.children,r,i,a,s))}else if(t.type===sn.ACK_USER_WRITE){let c=t;c.revert?o=YR(n,e,c.path,r,i,s):o=$R(n,e,c.path,c.affectedTree,r,i,s)}else if(t.type===sn.LISTEN_COMPLETE)o=HR(n,e,t.path,r,s);else throw Ei("Unknown operation type: "+t.type);let u=s.getChanges();return WR(e,o,u),{viewCache:o,changes:u}}function WR(n,e,t){let r=e.eventCache;if(r.isFullyInitialized()){let i=r.getNode().isLeafNode()||r.getNode().isEmpty(),s=Dl(n);(t.length>0||!n.eventCache.isFullyInitialized()||i&&!r.getNode().equals(s)||!r.getNode().getPriority().equals(s.getPriority()))&&t.push(LI(Dl(e)))}}function WI(n,e,t,r,i,s){let o=e.eventCache;if(kl(r,t)!=null)return e;{let a,u;if(oe(t))if(O(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){let c=xr(e),d=c instanceof ne?c:ne.EMPTY_NODE,f=hf(r,d);a=n.filter.updateFullNode(e.eventCache.getNode(),f,s)}else{let c=xl(r,xr(e));a=n.filter.updateFullNode(e.eventCache.getNode(),c,s)}else{let c=se(t);if(c===".priority"){O(Xn(t)===1,"Can't have a priority with additional path components");let d=o.getNode();u=e.serverCache.getNode();let f=Zw(r,t,d,u);f!=null?a=n.filter.updatePriority(d,f):a=o.getNode()}else{let d=Te(t),f;if(o.isCompleteForChild(c)){u=e.serverCache.getNode();let m=Zw(r,t,o.getNode(),u);m!=null?f=o.getNode().getImmediateChild(c).updateChild(d,m):f=o.getNode().getImmediateChild(c)}else f=df(r,c,e.serverCache);f!=null?a=n.filter.updateChild(o.getNode(),c,f,d,i,s):a=o.getNode()}}return io(e,a,o.isFullyInitialized()||oe(t),n.filter.filtersNodes())}}function Ml(n,e,t,r,i,s,o,a){let u=e.serverCache,c,d=o?n.filter:n.filter.getIndexedFilter();if(oe(t))c=d.updateFullNode(u.getNode(),r,null);else if(d.filtersNodes()&&!u.isFiltered()){let _=u.getNode().updateChild(t,r);c=d.updateFullNode(u.getNode(),_,null)}else{let _=se(t);if(!u.isCompleteForPath(t)&&Xn(t)>1)return e;let I=Te(t),P=u.getNode().getImmediateChild(_).updateChild(I,r);_===".priority"?c=d.updatePriority(u.getNode(),P):c=d.updateChild(u.getNode(),_,P,I,GI,null)}let f=BI(e,c,u.isFullyInitialized()||oe(t),d.filtersNodes()),m=new go(i,f,s);return WI(n,f,t,i,m,a)}function Pd(n,e,t,r,i,s,o){let a=e.eventCache,u,c,d=new go(i,e,s);if(oe(t))c=n.filter.updateFullNode(e.eventCache.getNode(),r,o),u=io(e,c,!0,n.filter.filtersNodes());else{let f=se(t);if(f===".priority")c=n.filter.updatePriority(e.eventCache.getNode(),r),u=io(e,c,a.isFullyInitialized(),a.isFiltered());else{let m=Te(t),_=a.getNode().getImmediateChild(f),I;if(oe(m))I=r;else{let S=d.getCompleteChild(f);S!=null?nf(m)===".priority"&&S.getChild(xI(m)).isEmpty()?I=S:I=S.updateChild(m,r):I=ne.EMPTY_NODE}if(_.equals(I))u=e;else{let S=n.filter.updateChild(a.getNode(),f,I,m,d,o);u=io(e,S,a.isFullyInitialized(),n.filter.filtersNodes())}}}return u}function eI(n,e){return n.eventCache.isCompleteForChild(e)}function QR(n,e,t,r,i,s,o){let a=e;return r.foreach((u,c)=>{let d=De(t,u);eI(e,se(d))&&(a=Pd(n,a,d,c,i,s,o))}),r.foreach((u,c)=>{let d=De(t,u);eI(e,se(d))||(a=Pd(n,a,d,c,i,s,o))}),a}function tI(n,e,t){return t.foreach((r,i)=>{e=e.updateChild(r,i)}),e}function Nd(n,e,t,r,i,s,o,a){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let u=e,c;oe(t)?c=r:c=new gt(null).setTree(t,r);let d=e.serverCache.getNode();return c.children.inorderTraversal((f,m)=>{if(d.hasChild(f)){let _=e.serverCache.getNode().getImmediateChild(f),I=tI(n,_,m);u=Ml(n,u,new we(f),I,i,s,o,a)}}),c.children.inorderTraversal((f,m)=>{let _=!e.serverCache.isCompleteForChild(f)&&m.value===null;if(!d.hasChild(f)&&!_){let I=e.serverCache.getNode().getImmediateChild(f),S=tI(n,I,m);u=Ml(n,u,new we(f),S,i,s,o,a)}}),u}function $R(n,e,t,r,i,s,o){if(kl(i,t)!=null)return e;let a=e.serverCache.isFiltered(),u=e.serverCache;if(r.value!=null){if(oe(t)&&u.isFullyInitialized()||u.isCompleteForPath(t))return Ml(n,e,t,u.getNode().getChild(t),i,s,a,o);if(oe(t)){let c=new gt(null);return u.getNode().forEachChild(on,(d,f)=>{c=c.set(new we(d),f)}),Nd(n,e,t,c,i,s,a,o)}else return e}else{let c=new gt(null);return r.foreach((d,f)=>{let m=De(t,d);u.isCompleteForPath(m)&&(c=c.set(d,u.getNode().getChild(m)))}),Nd(n,e,t,c,i,s,a,o)}}function HR(n,e,t,r,i){let s=e.serverCache,o=BI(e,s.getNode(),s.isFullyInitialized()||oe(t),s.isFiltered());return WI(n,o,t,r,GI,i)}function YR(n,e,t,r,i,s){let o;if(kl(r,t)!=null)return e;{let a=new go(r,e,i),u=e.eventCache.getNode(),c;if(oe(t)||se(t)===".priority"){let d;if(e.serverCache.isFullyInitialized())d=xl(r,xr(e));else{let f=e.serverCache.getNode();O(f instanceof ne,"serverChildren would be complete if leaf node"),d=hf(r,f)}d=d,c=n.filter.updateFullNode(u,d,s)}else{let d=se(t),f=df(r,d,e.serverCache);f==null&&e.serverCache.isCompleteForChild(d)&&(f=u.getImmediateChild(d)),f!=null?c=n.filter.updateChild(u,d,f,Te(t),a,s):e.eventCache.getNode().hasChild(d)?c=n.filter.updateChild(u,d,ne.EMPTY_NODE,Te(t),a,s):c=u,c.isEmpty()&&e.serverCache.isFullyInitialized()&&(o=xl(r,xr(e)),o.isLeafNode()&&(c=n.filter.updateFullNode(c,o,s)))}return o=e.serverCache.isFullyInitialized()||kl(r,ve())!=null,io(e,c,o,n.filter.filtersNodes())}}var Dd=class{constructor(e,t){this.query_=e,this.eventRegistrations_=[];let r=this.query_._queryParams,i=new fo(r.getIndex()),s=_R(r);this.processor_=zR(s);let o=t.serverCache,a=t.eventCache,u=i.updateFullNode(ne.EMPTY_NODE,o.getNode(),null),c=s.updateFullNode(ne.EMPTY_NODE,a.getNode(),null),d=new ln(u,o.isFullyInitialized(),i.filtersNodes()),f=new ln(c,a.isFullyInitialized(),s.filtersNodes());this.viewCache_=$l(f,d),this.eventGenerator_=new Td(this.query_)}get query(){return this.query_}};function JR(n){return n.viewCache_.serverCache.getNode()}function XR(n){return Dl(n.viewCache_)}function ZR(n,e){let t=xr(n.viewCache_);return t&&(n.query._queryParams.loadsAllData()||!oe(e)&&!t.getImmediateChild(se(e)).isEmpty())?t.getChild(e):null}function nI(n){return n.eventRegistrations_.length===0}function eP(n,e){n.eventRegistrations_.push(e)}function rI(n,e,t){let r=[];if(t){O(e==null,"A cancel should cancel all event registrations.");let i=n.query._path;n.eventRegistrations_.forEach(s=>{let o=s.createCancelEvent(t,i);o&&r.push(o)})}if(e){let i=[];for(let s=0;s<n.eventRegistrations_.length;++s){let o=n.eventRegistrations_[s];if(!o.matches(e))i.push(o);else if(e.hasAnyCallback()){i=i.concat(n.eventRegistrations_.slice(s+1));break}}n.eventRegistrations_=i}else n.eventRegistrations_=[];return r}function iI(n,e,t,r){e.type===sn.MERGE&&e.source.queryId!==null&&(O(xr(n.viewCache_),"We should always have a full cache before handling merges"),O(Dl(n.viewCache_),"Missing event cache, even though we have a server cache"));let i=n.viewCache_,s=GR(n.processor_,i,e,t,r);return KR(n.processor_,s.viewCache),O(s.viewCache.serverCache.isFullyInitialized()||!i.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),n.viewCache_=s.viewCache,QI(n,s.changes,s.viewCache.eventCache.getNode(),null)}function tP(n,e){let t=n.viewCache_.eventCache,r=[];return t.getNode().isLeafNode()||t.getNode().forEachChild(Se,(s,o)=>{r.push(xi(s,o))}),t.isFullyInitialized()&&r.push(LI(t.getNode())),QI(n,r,t.getNode(),e)}function QI(n,e,t,r){let i=r?[r]:n.eventRegistrations_;return SR(n.eventGenerator_,e,t,i)}var Fl,Ol=class{constructor(){this.views=new Map}};function nP(n){O(!Fl,"__referenceConstructor has already been defined"),Fl=n}function rP(){return O(Fl,"Reference.ts has not been loaded"),Fl}function iP(n){return n.views.size===0}function ff(n,e,t,r){let i=e.source.queryId;if(i!==null){let s=n.views.get(i);return O(s!=null,"SyncTree gave us an op for an invalid query."),iI(s,e,t,r)}else{let s=[];for(let o of n.views.values())s=s.concat(iI(o,e,t,r));return s}}function $I(n,e,t,r,i){let s=e._queryIdentifier,o=n.views.get(s);if(!o){let a=xl(t,i?r:null),u=!1;a?u=!0:r instanceof ne?(a=hf(t,r),u=!1):(a=ne.EMPTY_NODE,u=!1);let c=$l(new ln(a,u,!1),new ln(r,i,!1));return new Dd(e,c)}return o}function sP(n,e,t,r,i,s){let o=$I(n,e,r,i,s);return n.views.has(e._queryIdentifier)||n.views.set(e._queryIdentifier,o),eP(o,t),tP(o,t)}function oP(n,e,t,r){let i=e._queryIdentifier,s=[],o=[],a=Zn(n);if(i==="default")for(let[u,c]of n.views.entries())o=o.concat(rI(c,t,r)),nI(c)&&(n.views.delete(u),c.query._queryParams.loadsAllData()||s.push(c.query));else{let u=n.views.get(i);u&&(o=o.concat(rI(u,t,r)),nI(u)&&(n.views.delete(i),u.query._queryParams.loadsAllData()||s.push(u.query)))}return a&&!Zn(n)&&s.push(new(rP())(e._repo,e._path)),{removed:s,events:o}}function HI(n){let e=[];for(let t of n.views.values())t.query._queryParams.loadsAllData()||e.push(t);return e}function Yn(n,e){let t=null;for(let r of n.views.values())t=t||ZR(r,e);return t}function YI(n,e){if(e._queryParams.loadsAllData())return Yl(n);{let r=e._queryIdentifier;return n.views.get(r)}}function JI(n,e){return YI(n,e)!=null}function Zn(n){return Yl(n)!=null}function Yl(n){for(let e of n.views.values())if(e.query._queryParams.loadsAllData())return e;return null}var Vl;function aP(n){O(!Vl,"__referenceConstructor has already been defined"),Vl=n}function lP(){return O(Vl,"Reference.ts has not been loaded"),Vl}var uP=1,Ll=class{constructor(e){this.listenProvider_=e,this.syncPointTree_=new gt(null),this.pendingWriteTree_=qR(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}};function pf(n,e,t,r,i){return PR(n.pendingWriteTree_,e,t,r,i),i?Bi(n,new ki(lf(),e,t)):[]}function cP(n,e,t,r){NR(n.pendingWriteTree_,e,t,r);let i=gt.fromObject(t);return Bi(n,new mo(lf(),e,i))}function $n(n,e,t=!1){let r=DR(n.pendingWriteTree_,e);if(xR(n.pendingWriteTree_,e)){let s=new gt(null);return r.snap!=null?s=s.set(ve(),!0):nt(r.children,o=>{s=s.set(new we(o),!0)}),Bi(n,new Ed(r.path,s,t))}else return[]}function So(n,e,t){return Bi(n,new ki(uf(),e,t))}function hP(n,e,t){let r=gt.fromObject(t);return Bi(n,new mo(uf(),e,r))}function dP(n,e){return Bi(n,new Nl(uf(),e))}function fP(n,e,t){let r=mf(n,t);if(r){let i=gf(r),s=i.path,o=i.queryId,a=mt(s,e),u=new Nl(cf(o),a);return _f(n,s,u)}else return[]}function Bl(n,e,t,r,i=!1){let s=e._path,o=n.syncPointTree_.get(s),a=[];if(o&&(e._queryIdentifier==="default"||JI(o,e))){let u=oP(o,e,t,r);iP(o)&&(n.syncPointTree_=n.syncPointTree_.remove(s));let c=u.removed;if(a=u.events,!i){let d=c.findIndex(m=>m._queryParams.loadsAllData())!==-1,f=n.syncPointTree_.findOnPath(s,(m,_)=>Zn(_));if(d&&!f){let m=n.syncPointTree_.subtree(s);if(!m.isEmpty()){let _=gP(m);for(let I=0;I<_.length;++I){let S=_[I],P=S.query,V=tE(n,S);n.listenProvider_.startListening(oo(P),_o(n,P),V.hashFn,V.onComplete)}}}!f&&c.length>0&&!r&&(d?n.listenProvider_.stopListening(oo(e),null):c.forEach(m=>{let _=n.queryToTagMap.get(Xl(m));n.listenProvider_.stopListening(oo(m),_)}))}_P(n,c)}return a}function XI(n,e,t,r){let i=mf(n,r);if(i!=null){let s=gf(i),o=s.path,a=s.queryId,u=mt(o,e),c=new ki(cf(a),u,t);return _f(n,o,c)}else return[]}function pP(n,e,t,r){let i=mf(n,r);if(i){let s=gf(i),o=s.path,a=s.queryId,u=mt(o,e),c=gt.fromObject(t),d=new mo(cf(a),u,c);return _f(n,o,d)}else return[]}function xd(n,e,t,r=!1){let i=e._path,s=null,o=!1;n.syncPointTree_.foreachOnPath(i,(m,_)=>{let I=mt(m,i);s=s||Yn(_,I),o=o||Zn(_)});let a=n.syncPointTree_.get(i);a?(o=o||Zn(a),s=s||Yn(a,ve())):(a=new Ol,n.syncPointTree_=n.syncPointTree_.set(i,a));let u;s!=null?u=!0:(u=!1,s=ne.EMPTY_NODE,n.syncPointTree_.subtree(i).foreachChild((_,I)=>{let S=Yn(I,ve());S&&(s=s.updateImmediateChild(_,S))}));let c=JI(a,e);if(!c&&!e._queryParams.loadsAllData()){let m=Xl(e);O(!n.queryToTagMap.has(m),"View does not exist, but we have a tag");let _=yP();n.queryToTagMap.set(m,_),n.tagToQueryMap.set(_,m)}let d=Hl(n.pendingWriteTree_,i),f=sP(a,e,t,d,s,u);if(!c&&!o&&!r){let m=YI(a,e);f=f.concat(vP(n,e,m))}return f}function Jl(n,e,t){let i=n.pendingWriteTree_,s=n.syncPointTree_.findOnPath(e,(o,a)=>{let u=mt(o,e),c=Yn(a,u);if(c)return c});return jI(i,e,s,t,!0)}function mP(n,e){let t=e._path,r=null;n.syncPointTree_.foreachOnPath(t,(c,d)=>{let f=mt(c,t);r=r||Yn(d,f)});let i=n.syncPointTree_.get(t);i?r=r||Yn(i,ve()):(i=new Ol,n.syncPointTree_=n.syncPointTree_.set(t,i));let s=r!=null,o=s?new ln(r,!0,!1):null,a=Hl(n.pendingWriteTree_,e._path),u=$I(i,e,a,s?o.getNode():ne.EMPTY_NODE,s);return XR(u)}function Bi(n,e){return ZI(e,n.syncPointTree_,null,Hl(n.pendingWriteTree_,ve()))}function ZI(n,e,t,r){if(oe(n.path))return eE(n,e,t,r);{let i=e.get(ve());t==null&&i!=null&&(t=Yn(i,ve()));let s=[],o=se(n.path),a=n.operationForChild(o),u=e.children.get(o);if(u&&a){let c=t?t.getImmediateChild(o):null,d=zI(r,o);s=s.concat(ZI(a,u,c,d))}return i&&(s=s.concat(ff(i,n,r,t))),s}}function eE(n,e,t,r){let i=e.get(ve());t==null&&i!=null&&(t=Yn(i,ve()));let s=[];return e.children.inorderTraversal((o,a)=>{let u=t?t.getImmediateChild(o):null,c=zI(r,o),d=n.operationForChild(o);d&&(s=s.concat(eE(d,a,u,c)))}),i&&(s=s.concat(ff(i,n,r,t))),s}function tE(n,e){let t=e.query,r=_o(n,t);return{hashFn:()=>(JR(e)||ne.EMPTY_NODE).hash(),onComplete:i=>{if(i==="ok")return r?fP(n,t._path,r):dP(n,t._path);{let s=PA(i,t);return Bl(n,t,null,s)}}}}function _o(n,e){let t=Xl(e);return n.queryToTagMap.get(t)}function Xl(n){return n._path.toString()+"$"+n._queryIdentifier}function mf(n,e){return n.tagToQueryMap.get(e)}function gf(n){let e=n.indexOf("$");return O(e!==-1&&e<n.length-1,"Bad queryKey."),{queryId:n.substr(e+1),path:new we(n.substr(0,e))}}function _f(n,e,t){let r=n.syncPointTree_.get(e);O(r,"Missing sync point for query tag that we're tracking");let i=Hl(n.pendingWriteTree_,e);return ff(r,t,i,null)}function gP(n){return n.fold((e,t,r)=>{if(t&&Zn(t))return[Yl(t)];{let i=[];return t&&(i=HI(t)),nt(r,(s,o)=>{i=i.concat(o)}),i}})}function oo(n){return n._queryParams.loadsAllData()&&!n._queryParams.isDefault()?new(lP())(n._repo,n._path):n}function _P(n,e){for(let t=0;t<e.length;++t){let r=e[t];if(!r._queryParams.loadsAllData()){let i=Xl(r),s=n.queryToTagMap.get(i);n.queryToTagMap.delete(i),n.tagToQueryMap.delete(s)}}}function yP(){return uP++}function vP(n,e,t){let r=e._path,i=_o(n,e),s=tE(n,t),o=n.listenProvider_.startListening(oo(e),i,s.hashFn,s.onComplete),a=n.syncPointTree_.subtree(r);if(i)O(!Zn(a.value),"If we're adding a query, it shouldn't be shadowed");else{let u=a.fold((c,d,f)=>{if(!oe(c)&&d&&Zn(d))return[Yl(d).query];{let m=[];return d&&(m=m.concat(HI(d).map(_=>_.query))),nt(f,(_,I)=>{m=m.concat(I)}),m}});for(let c=0;c<u.length;++c){let d=u[c];n.listenProvider_.stopListening(oo(d),_o(n,d))}}return o}var kd=class n{constructor(e){this.node_=e}getImmediateChild(e){let t=this.node_.getImmediateChild(e);return new n(t)}node(){return this.node_}},Md=class n{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){let t=De(this.path_,e);return new n(this.syncTree_,t)}node(){return Jl(this.syncTree_,this.path_)}},wP=function(n){return n=n||{},n.timestamp=n.timestamp||new Date().getTime(),n},sI=function(n,e,t){if(!n||typeof n!="object")return n;if(O(".sv"in n,"Unexpected leaf node or priority contents"),typeof n[".sv"]=="string")return IP(n[".sv"],e,t);if(typeof n[".sv"]=="object")return EP(n[".sv"],e);O(!1,"Unexpected server value: "+JSON.stringify(n,null,2))},IP=function(n,e,t){switch(n){case"timestamp":return t.timestamp;default:O(!1,"Unexpected server value: "+n)}},EP=function(n,e,t){n.hasOwnProperty("increment")||O(!1,"Unexpected server value: "+JSON.stringify(n,null,2));let r=n.increment;typeof r!="number"&&O(!1,"Unexpected increment value: "+r);let i=e.node();if(O(i!==null&&typeof i<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!i.isLeafNode())return r;let o=i.getValue();return typeof o!="number"?r:o+r},nE=function(n,e,t,r){return vf(e,new Md(t,n),r)},yf=function(n,e,t){return vf(n,new kd(e),t)};function vf(n,e,t){let r=n.getPriority().val(),i=sI(r,e.getImmediateChild(".priority"),t),s;if(n.isLeafNode()){let o=n,a=sI(o.getValue(),e,t);return a!==o.getValue()||i!==o.getPriority().val()?new Ni(a,ke(i)):n}else{let o=n;return s=o,i!==o.getPriority().val()&&(s=s.updatePriority(new Ni(i))),o.forEachChild(Se,(a,u)=>{let c=vf(u,e.getImmediateChild(a),t);c!==u&&(s=s.updateImmediateChild(a,c))}),s}}var yo=class{constructor(e="",t=null,r={children:{},childCount:0}){this.name=e,this.parent=t,this.node=r}};function Zl(n,e){let t=e instanceof we?e:new we(e),r=n,i=se(t);for(;i!==null;){let s=Wn(r.node.children,i)||{children:{},childCount:0};r=new yo(i,r,s),t=Te(t),i=se(t)}return r}function Fr(n){return n.node.value}function wf(n,e){n.node.value=e,Fd(n)}function rE(n){return n.node.childCount>0}function TP(n){return Fr(n)===void 0&&!rE(n)}function eu(n,e){nt(n.node.children,(t,r)=>{e(new yo(t,n,r))})}function iE(n,e,t,r){t&&!r&&e(n),eu(n,i=>{iE(i,e,!0,r)}),t&&r&&e(n)}function CP(n,e,t){let r=t?n:n.parent;for(;r!==null;){if(e(r))return!0;r=r.parent}return!1}function bo(n){return new we(n.parent===null?n.name:bo(n.parent)+"/"+n.name)}function Fd(n){n.parent!==null&&SP(n.parent,n.name,n)}function SP(n,e,t){let r=TP(t),i=Ot(n.node.children,e);r&&i?(delete n.node.children[e],n.node.childCount--,Fd(n)):!r&&!i&&(n.node.children[e]=t.node,n.node.childCount++,Fd(n))}var bP=/[\[\].#$\/\u0000-\u001F\u007F]/,AP=/[\[\].#$\u0000-\u001F\u007F]/,Wh=10*1024*1024,tu=function(n){return typeof n=="string"&&n.length!==0&&!bP.test(n)},sE=function(n){return typeof n=="string"&&n.length!==0&&!AP.test(n)},RP=function(n){return n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),sE(n)},vo=function(n){return n===null||typeof n=="string"||typeof n=="number"&&!Wl(n)||n&&typeof n=="object"&&Ot(n,".sv")},un=function(n,e,t,r){r&&e===void 0||Ao(Et(n,"value"),e,t)},Ao=function(n,e,t){let r=t instanceof we?new sd(t,n):t;if(e===void 0)throw new Error(n+"contains undefined "+Pr(r));if(typeof e=="function")throw new Error(n+"contains a function "+Pr(r)+" with contents = "+e.toString());if(Wl(e))throw new Error(n+"contains "+e.toString()+" "+Pr(r));if(typeof e=="string"&&e.length>Wh/3&&Ys(e)>Wh)throw new Error(n+"contains a string greater than "+Wh+" utf8 bytes "+Pr(r)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let i=!1,s=!1;if(nt(e,(o,a)=>{if(o===".value")i=!0;else if(o!==".priority"&&o!==".sv"&&(s=!0,!tu(o)))throw new Error(n+" contains an invalid key ("+o+") "+Pr(r)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);iR(r,o),Ao(n,a,r),sR(r)}),i&&s)throw new Error(n+' contains ".value" child '+Pr(r)+" in addition to actual children.")}},PP=function(n,e){let t,r;for(t=0;t<e.length;t++){r=e[t];let s=lo(r);for(let o=0;o<s.length;o++)if(!(s[o]===".priority"&&o===s.length-1)){if(!tu(s[o]))throw new Error(n+"contains an invalid key ("+s[o]+") in path "+r.toString()+`. Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`)}}e.sort(rR);let i=null;for(t=0;t<e.length;t++){if(r=e[t],i!==null&&Lt(i,r))throw new Error(n+"contains a path "+i.toString()+" that is ancestor of another path "+r.toString());i=r}},oE=function(n,e,t,r){if(r&&e===void 0)return;let i=Et(n,"values");if(!(e&&typeof e=="object")||Array.isArray(e))throw new Error(i+" must be an object containing the children to replace.");let s=[];nt(e,(o,a)=>{let u=new we(o);if(Ao(i,a,De(t,u)),nf(u)===".priority"&&!vo(a))throw new Error(i+"contains an invalid value for '"+u.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");s.push(u)}),PP(i,s)},If=function(n,e,t){if(!(t&&e===void 0)){if(Wl(e))throw new Error(Et(n,"priority")+"is "+e.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!vo(e))throw new Error(Et(n,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")}},Ro=function(n,e,t,r){if(!(r&&t===void 0)&&!tu(t))throw new Error(Et(n,e)+'was an invalid key = "'+t+`".  Firebase keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]").`)},Ui=function(n,e,t,r){if(!(r&&t===void 0)&&!sE(t))throw new Error(Et(n,e)+'was an invalid path = "'+t+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},NP=function(n,e,t,r){t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),Ui(n,e,t,r)},bt=function(n,e){if(se(e)===".info")throw new Error(n+" failed = Can't modify data under /.info/")},aE=function(n,e){let t=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!tu(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||t.length!==0&&!RP(t))throw new Error(Et(n,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};var Od=class{constructor(){this.eventLists_=[],this.recursionDepth_=0}};function nu(n,e){let t=null;for(let r=0;r<e.length;r++){let i=e[r],s=i.getPath();t!==null&&!rf(s,t.path)&&(n.eventLists_.push(t),t=null),t===null&&(t={events:[],path:s}),t.events.push(i)}t&&n.eventLists_.push(t)}function lE(n,e,t){nu(n,t),uE(n,r=>rf(r,e))}function At(n,e,t){nu(n,t),uE(n,r=>Lt(r,e)||Lt(e,r))}function uE(n,e){n.recursionDepth_++;let t=!0;for(let r=0;r<n.eventLists_.length;r++){let i=n.eventLists_[r];if(i){let s=i.path;e(s)?(DP(n.eventLists_[r]),n.eventLists_[r]=null):t=!1}}t&&(n.eventLists_=[]),n.recursionDepth_--}function DP(n){for(let e=0;e<n.events.length;e++){let t=n.events[e];if(t!==null){n.events[e]=null;let r=t.getEventRunner();Dr&&tt("event: "+t.toString()),Vi(r)}}}var cE="repo_interrupt",xP=25,Vd=class{constructor(e,t,r,i){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=r,this.appCheckProvider_=i,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new Od,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=Pl(),this.transactionQueueTree_=new yo,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}};function kP(n,e,t){if(n.stats_=tf(n.repoInfo_),n.forceRestClient_||kA())n.server_=new gd(n.repoInfo_,(r,i,s,o)=>{oI(n,r,i,s,o)},n.authTokenProvider_,n.appCheckProvider_),setTimeout(()=>aI(n,!0),0);else{if(typeof t<"u"&&t!==null){if(typeof t!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{Ge(t)}catch(r){throw new Error("Invalid authOverride provided: "+r)}}n.persistentConnection_=new sf(n.repoInfo_,e,(r,i,s,o)=>{oI(n,r,i,s,o)},r=>{aI(n,r)},r=>{MP(n,r)},n.authTokenProvider_,n.appCheckProvider_,t),n.server_=n.persistentConnection_}n.authTokenProvider_.addTokenChangeListener(r=>{n.server_.refreshAuthToken(r)}),n.appCheckProvider_.addTokenChangeListener(r=>{n.server_.refreshAppCheckToken(r.token)}),n.statsReporter_=FA(n.repoInfo_,()=>new Id(n.stats_,n.server_)),n.infoData_=new _d,n.infoSyncTree_=new Ll({startListening:(r,i,s,o)=>{let a=[],u=n.infoData_.getNode(r._path);return u.isEmpty()||(a=So(n.infoSyncTree_,r._path,u),setTimeout(()=>{o("ok")},0)),a},stopListening:()=>{}}),Ef(n,"connected",!1),n.serverSyncTree_=new Ll({startListening:(r,i,s,o)=>(n.server_.listen(r,s,i,(a,u)=>{let c=o(a,u);At(n.eventQueue_,r._path,c)}),[]),stopListening:(r,i)=>{n.server_.unlisten(r,i)}})}function hE(n){let t=n.infoData_.getNode(new we(".info/serverTimeOffset")).val()||0;return new Date().getTime()+t}function Po(n){return wP({timestamp:hE(n)})}function oI(n,e,t,r,i){n.dataUpdateCount++;let s=new we(e);t=n.interceptServerDataCallback_?n.interceptServerDataCallback_(e,t):t;let o=[];if(i)if(r){let u=Hs(t,c=>ke(c));o=pP(n.serverSyncTree_,s,u,i)}else{let u=ke(t);o=XI(n.serverSyncTree_,s,u,i)}else if(r){let u=Hs(t,c=>ke(c));o=hP(n.serverSyncTree_,s,u)}else{let u=ke(t);o=So(n.serverSyncTree_,s,u)}let a=s;o.length>0&&(a=Fi(n,s)),At(n.eventQueue_,a,o)}function aI(n,e){Ef(n,"connected",e),e===!1&&VP(n)}function MP(n,e){nt(e,(t,r)=>{Ef(n,t,r)})}function Ef(n,e,t){let r=new we("/.info/"+e),i=ke(t);n.infoData_.updateSnapshot(r,i);let s=So(n.infoSyncTree_,r,i);At(n.eventQueue_,r,s)}function ru(n){return n.nextWriteId_++}function FP(n,e,t){let r=mP(n.serverSyncTree_,e);return r!=null?Promise.resolve(r):n.server_.get(e).then(i=>{let s=ke(i).withIndex(e._queryParams.getIndex());xd(n.serverSyncTree_,e,t,!0);let o;if(e._queryParams.loadsAllData())o=So(n.serverSyncTree_,e._path,s);else{let a=_o(n.serverSyncTree_,e);o=XI(n.serverSyncTree_,e._path,s,a)}return At(n.eventQueue_,e._path,o),Bl(n.serverSyncTree_,e,t,null,!0),s},i=>(qi(n,"get for query "+Ge(e)+" failed: "+i),Promise.reject(new Error(i))))}function Tf(n,e,t,r,i){qi(n,"set",{path:e.toString(),value:t,priority:r});let s=Po(n),o=ke(t,r),a=Jl(n.serverSyncTree_,e),u=yf(o,a,s),c=ru(n),d=pf(n.serverSyncTree_,e,u,c,!0);nu(n.eventQueue_,d),n.server_.put(e.toString(),o.val(!0),(m,_)=>{let I=m==="ok";I||ut("set at "+e+" failed: "+m);let S=$n(n.serverSyncTree_,c,!I);At(n.eventQueue_,e,S),er(n,i,m,_)});let f=Sf(n,e);Fi(n,f),At(n.eventQueue_,f,[])}function OP(n,e,t,r){qi(n,"update",{path:e.toString(),value:t});let i=!0,s=Po(n),o={};if(nt(t,(a,u)=>{i=!1,o[a]=nE(De(e,a),ke(u),n.serverSyncTree_,s)}),i)tt("update() called with empty data.  Don't do anything."),er(n,r,"ok",void 0);else{let a=ru(n),u=cP(n.serverSyncTree_,e,o,a);nu(n.eventQueue_,u),n.server_.merge(e.toString(),t,(c,d)=>{let f=c==="ok";f||ut("update at "+e+" failed: "+c);let m=$n(n.serverSyncTree_,a,!f),_=m.length>0?Fi(n,e):e;At(n.eventQueue_,_,m),er(n,r,c,d)}),nt(t,c=>{let d=Sf(n,De(e,c));Fi(n,d)}),At(n.eventQueue_,e,[])}}function VP(n){qi(n,"onDisconnectEvents");let e=Po(n),t=Pl();vd(n.onDisconnect_,ve(),(i,s)=>{let o=nE(i,s,n.serverSyncTree_,e);Li(t,i,o)});let r=[];vd(t,ve(),(i,s)=>{r=r.concat(So(n.serverSyncTree_,i,s));let o=Sf(n,i);Fi(n,o)}),n.onDisconnect_=Pl(),At(n.eventQueue_,ve(),r)}function LP(n,e,t){n.server_.onDisconnectCancel(e.toString(),(r,i)=>{r==="ok"&&yd(n.onDisconnect_,e),er(n,t,r,i)})}function lI(n,e,t,r){let i=ke(t);n.server_.onDisconnectPut(e.toString(),i.val(!0),(s,o)=>{s==="ok"&&Li(n.onDisconnect_,e,i),er(n,r,s,o)})}function BP(n,e,t,r,i){let s=ke(t,r);n.server_.onDisconnectPut(e.toString(),s.val(!0),(o,a)=>{o==="ok"&&Li(n.onDisconnect_,e,s),er(n,i,o,a)})}function UP(n,e,t,r){if(Ja(t)){tt("onDisconnect().update() called with empty data.  Don't do anything."),er(n,r,"ok",void 0);return}n.server_.onDisconnectMerge(e.toString(),t,(i,s)=>{i==="ok"&&nt(t,(o,a)=>{let u=ke(a);Li(n.onDisconnect_,De(e,o),u)}),er(n,r,i,s)})}function qP(n,e,t){let r;se(e._path)===".info"?r=xd(n.infoSyncTree_,e,t):r=xd(n.serverSyncTree_,e,t),lE(n.eventQueue_,e._path,r)}function Ld(n,e,t){let r;se(e._path)===".info"?r=Bl(n.infoSyncTree_,e,t):r=Bl(n.serverSyncTree_,e,t),lE(n.eventQueue_,e._path,r)}function dE(n){n.persistentConnection_&&n.persistentConnection_.interrupt(cE)}function jP(n){n.persistentConnection_&&n.persistentConnection_.resume(cE)}function qi(n,...e){let t="";n.persistentConnection_&&(t=n.persistentConnection_.id+":"),tt(t,...e)}function er(n,e,t,r){e&&Vi(()=>{if(t==="ok")e(null);else{let i=(t||"error").toUpperCase(),s=i;r&&(s+=": "+r);let o=new Error(s);o.code=i,e(o)}})}function zP(n,e,t,r,i,s){qi(n,"transaction on "+e);let o={path:e,update:t,onComplete:r,status:null,order:hI(),applyLocally:s,retryCount:0,unwatcher:i,abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},a=Cf(n,e,void 0);o.currentInputSnapshot=a;let u=o.update(a.val());if(u===void 0)o.unwatcher(),o.currentOutputSnapshotRaw=null,o.currentOutputSnapshotResolved=null,o.onComplete&&o.onComplete(null,!1,o.currentInputSnapshot);else{Ao("transaction failed: Data returned ",u,o.path),o.status=0;let c=Zl(n.transactionQueueTree_,e),d=Fr(c)||[];d.push(o),wf(c,d);let f;typeof u=="object"&&u!==null&&Ot(u,".priority")?(f=Wn(u,".priority"),O(vo(f),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.")):f=(Jl(n.serverSyncTree_,e)||ne.EMPTY_NODE).getPriority().val();let m=Po(n),_=ke(u,f),I=yf(_,a,m);o.currentOutputSnapshotRaw=_,o.currentOutputSnapshotResolved=I,o.currentWriteId=ru(n);let S=pf(n.serverSyncTree_,e,I,o.currentWriteId,o.applyLocally);At(n.eventQueue_,e,S),iu(n,n.transactionQueueTree_)}}function Cf(n,e,t){return Jl(n.serverSyncTree_,e,t)||ne.EMPTY_NODE}function iu(n,e=n.transactionQueueTree_){if(e||su(n,e),Fr(e)){let t=pE(n,e);O(t.length>0,"Sending zero length transaction queue"),t.every(i=>i.status===0)&&KP(n,bo(e),t)}else rE(e)&&eu(e,t=>{iu(n,t)})}function KP(n,e,t){let r=t.map(c=>c.currentWriteId),i=Cf(n,e,r),s=i,o=i.hash();for(let c=0;c<t.length;c++){let d=t[c];O(d.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),d.status=1,d.retryCount++;let f=mt(e,d.path);s=s.updateChild(f,d.currentOutputSnapshotRaw)}let a=s.val(!0),u=e;n.server_.put(u.toString(),a,c=>{qi(n,"transaction put response",{path:u.toString(),status:c});let d=[];if(c==="ok"){let f=[];for(let m=0;m<t.length;m++)t[m].status=2,d=d.concat($n(n.serverSyncTree_,t[m].currentWriteId)),t[m].onComplete&&f.push(()=>t[m].onComplete(null,!0,t[m].currentOutputSnapshotResolved)),t[m].unwatcher();su(n,Zl(n.transactionQueueTree_,e)),iu(n,n.transactionQueueTree_),At(n.eventQueue_,e,d);for(let m=0;m<f.length;m++)Vi(f[m])}else{if(c==="datastale")for(let f=0;f<t.length;f++)t[f].status===3?t[f].status=4:t[f].status=0;else{ut("transaction at "+u.toString()+" failed: "+c);for(let f=0;f<t.length;f++)t[f].status=4,t[f].abortReason=c}Fi(n,e)}},o)}function Fi(n,e){let t=fE(n,e),r=bo(t),i=pE(n,t);return GP(n,i,r),r}function GP(n,e,t){if(e.length===0)return;let r=[],i=[],o=e.filter(a=>a.status===0).map(a=>a.currentWriteId);for(let a=0;a<e.length;a++){let u=e[a],c=mt(t,u.path),d=!1,f;if(O(c!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),u.status===4)d=!0,f=u.abortReason,i=i.concat($n(n.serverSyncTree_,u.currentWriteId,!0));else if(u.status===0)if(u.retryCount>=xP)d=!0,f="maxretry",i=i.concat($n(n.serverSyncTree_,u.currentWriteId,!0));else{let m=Cf(n,u.path,o);u.currentInputSnapshot=m;let _=e[a].update(m.val());if(_!==void 0){Ao("transaction failed: Data returned ",_,u.path);let I=ke(_);typeof _=="object"&&_!=null&&Ot(_,".priority")||(I=I.updatePriority(m.getPriority()));let P=u.currentWriteId,V=Po(n),U=yf(I,m,V);u.currentOutputSnapshotRaw=I,u.currentOutputSnapshotResolved=U,u.currentWriteId=ru(n),o.splice(o.indexOf(P),1),i=i.concat(pf(n.serverSyncTree_,u.path,U,u.currentWriteId,u.applyLocally)),i=i.concat($n(n.serverSyncTree_,P,!0))}else d=!0,f="nodata",i=i.concat($n(n.serverSyncTree_,u.currentWriteId,!0))}At(n.eventQueue_,t,i),i=[],d&&(e[a].status=2,function(m){setTimeout(m,Math.floor(0))}(e[a].unwatcher),e[a].onComplete&&(f==="nodata"?r.push(()=>e[a].onComplete(null,!1,e[a].currentInputSnapshot)):r.push(()=>e[a].onComplete(new Error(f),!1,null))))}su(n,n.transactionQueueTree_);for(let a=0;a<r.length;a++)Vi(r[a]);iu(n,n.transactionQueueTree_)}function fE(n,e){let t,r=n.transactionQueueTree_;for(t=se(e);t!==null&&Fr(r)===void 0;)r=Zl(r,t),e=Te(e),t=se(e);return r}function pE(n,e){let t=[];return mE(n,e,t),t.sort((r,i)=>r.order-i.order),t}function mE(n,e,t){let r=Fr(e);if(r)for(let i=0;i<r.length;i++)t.push(r[i]);eu(e,i=>{mE(n,i,t)})}function su(n,e){let t=Fr(e);if(t){let r=0;for(let i=0;i<t.length;i++)t[i].status!==2&&(t[r]=t[i],r++);t.length=r,wf(e,t.length>0?t:void 0)}eu(e,r=>{su(n,r)})}function Sf(n,e){let t=bo(fE(n,e)),r=Zl(n.transactionQueueTree_,e);return CP(r,i=>{Qh(n,i)}),Qh(n,r),iE(r,i=>{Qh(n,i)}),t}function Qh(n,e){let t=Fr(e);if(t){let r=[],i=[],s=-1;for(let o=0;o<t.length;o++)t[o].status===3||(t[o].status===1?(O(s===o-1,"All SENT items should be at beginning of queue."),s=o,t[o].status=3,t[o].abortReason="set"):(O(t[o].status===0,"Unexpected transaction status in abort"),t[o].unwatcher(),i=i.concat($n(n.serverSyncTree_,t[o].currentWriteId,!0)),t[o].onComplete&&r.push(t[o].onComplete.bind(null,new Error("set"),!1,null))));s===-1?wf(e,void 0):t.length=s+1,At(n.eventQueue_,bo(e),i);for(let o=0;o<r.length;o++)Vi(r[o])}}function WP(n){let e="",t=n.split("/");for(let r=0;r<t.length;r++)if(t[r].length>0){let i=t[r];try{i=decodeURIComponent(i.replace(/\+/g," "))}catch{}e+="/"+i}return e}function QP(n){let e={};n.charAt(0)==="?"&&(n=n.substring(1));for(let t of n.split("&")){if(t.length===0)continue;let r=t.split("=");r.length===2?e[decodeURIComponent(r[0])]=decodeURIComponent(r[1]):ut(`Invalid query segment '${t}' in query '${n}'`)}return e}var Bd=function(n,e){let t=$P(n),r=t.namespace;t.domain==="firebase.com"&&an(t.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!r||r==="undefined")&&t.domain!=="localhost"&&an("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),t.secure||CA();let i=t.scheme==="ws"||t.scheme==="wss";return{repoInfo:new Il(t.host,t.secure,r,i,e,"",r!==t.subdomain),path:new we(t.pathString)}},$P=function(n){let e="",t="",r="",i="",s="",o=!0,a="https",u=443;if(typeof n=="string"){let c=n.indexOf("//");c>=0&&(a=n.substring(0,c-1),n=n.substring(c+2));let d=n.indexOf("/");d===-1&&(d=n.length);let f=n.indexOf("?");f===-1&&(f=n.length),e=n.substring(0,Math.min(d,f)),d<f&&(i=WP(n.substring(d,f)));let m=QP(n.substring(Math.min(n.length,f)));c=e.indexOf(":"),c>=0?(o=a==="https"||a==="wss",u=parseInt(e.substring(c+1),10)):c=e.length;let _=e.slice(0,c);if(_.toLowerCase()==="localhost")t="localhost";else if(_.split(".").length<=2)t=_;else{let I=e.indexOf(".");r=e.substring(0,I).toLowerCase(),t=e.substring(I+1),s=r}"ns"in m&&(s=m.ns)}return{host:e,port:u,domain:t,subdomain:r,secure:o,scheme:a,pathString:i,namespace:s}};var uI="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",HP=function(){let n=0,e=[];return function(t){let r=t===n;n=t;let i,s=new Array(8);for(i=7;i>=0;i--)s[i]=uI.charAt(t%64),t=Math.floor(t/64);O(t===0,"Cannot push at time == 0");let o=s.join("");if(r){for(i=11;i>=0&&e[i]===63;i--)e[i]=0;e[i]++}else for(i=0;i<12;i++)e[i]=Math.floor(Math.random()*64);for(i=0;i<12;i++)o+=uI.charAt(e[i]);return O(o.length===20,"nextPushId: Length should be 20."),o}}();var Ul=class{constructor(e,t,r,i){this.eventType=e,this.eventRegistration=t,this.snapshot=r,this.prevName=i}getPath(){let e=this.snapshot.ref;return this.eventType==="value"?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+Ge(this.snapshot.exportVal())}},ql=class{constructor(e,t,r){this.eventRegistration=e,this.error=t,this.path=r}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}};var wo=class{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return O(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}};var jl=class{constructor(e,t){this._repo=e,this._path=t}cancel(){let e=new pt;return LP(this._repo,this._path,e.wrapCallback(()=>{})),e.promise}remove(){bt("OnDisconnect.remove",this._path);let e=new pt;return lI(this._repo,this._path,null,e.wrapCallback(()=>{})),e.promise}set(e){bt("OnDisconnect.set",this._path),un("OnDisconnect.set",e,this._path,!1);let t=new pt;return lI(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}setWithPriority(e,t){bt("OnDisconnect.setWithPriority",this._path),un("OnDisconnect.setWithPriority",e,this._path,!1),If("OnDisconnect.setWithPriority",t,!1);let r=new pt;return BP(this._repo,this._path,e,t,r.wrapCallback(()=>{})),r.promise}update(e){bt("OnDisconnect.update",this._path),oE("OnDisconnect.update",e,this._path,!1);let t=new pt;return UP(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}};var _t=class n{constructor(e,t,r,i){this._repo=e,this._path=t,this._queryParams=r,this._orderByCalled=i}get key(){return oe(this._path)?null:nf(this._path)}get ref(){return new Rt(this._repo,this._path)}get _queryIdentifier(){let e=Hw(this._queryParams),t=ef(e);return t==="{}"?"default":t}get _queryObject(){return Hw(this._queryParams)}isEqual(e){if(e=ce(e),!(e instanceof n))return!1;let t=this._repo===e._repo,r=rf(this._path,e._path),i=this._queryIdentifier===e._queryIdentifier;return t&&r&&i}toJSON(){return this.toString()}toString(){return this._repo.toString()+nR(this._path)}};function ou(n,e){if(n._orderByCalled===!0)throw new Error(e+": You can't combine multiple orderBy calls.")}function nr(n){let e=null,t=null;if(n.hasStart()&&(e=n.getIndexStartValue()),n.hasEnd()&&(t=n.getIndexEndValue()),n.getIndex()===on){let r="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",i="Query: When ordering by key, the argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() must be a string.";if(n.hasStart()){if(n.getIndexStartName()!==Jn)throw new Error(r);if(typeof e!="string")throw new Error(i)}if(n.hasEnd()){if(n.getIndexEndName()!==Sn)throw new Error(r);if(typeof t!="string")throw new Error(i)}}else if(n.getIndex()===Se){if(e!=null&&!vo(e)||t!=null&&!vo(t))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), startAfter() endAt(), endBefore(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(O(n.getIndex()instanceof uo||n.getIndex()===af,"unknown index type."),e!=null&&typeof e=="object"||t!=null&&typeof t=="object")throw new Error("Query: First argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() cannot be an object.")}function au(n){if(n.hasStart()&&n.hasEnd()&&n.hasLimit()&&!n.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), startAfter(), endAt(), endBefore(), and limit(). Use limitToFirst() or limitToLast() instead.")}var Rt=class n extends _t{constructor(e,t){super(e,t,new po,!1)}get parent(){let e=xI(this._path);return e===null?null:new n(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}},Oi=class n{constructor(e,t,r){this._node=e,this.ref=t,this._index=r}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){let t=new we(e),r=tr(this.ref,e);return new n(this._node.getChild(t),r,Se)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(r,i)=>e(new n(i,tr(this.ref,r),Se)))}hasChild(e){let t=new we(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}};function bf(n,e){return n=ce(n),n._checkNotDeleted("ref"),e!==void 0?tr(n._root,e):n._root}function Af(n,e){n=ce(n),n._checkNotDeleted("refFromURL");let t=Bd(e,n._repo.repoInfo_.nodeAdmin);aE("refFromURL",t);let r=t.repoInfo;return!n._repo.repoInfo_.isCustomHost()&&r.host!==n._repo.repoInfo_.host&&an("refFromURL: Host name does not match the current database: (found "+r.host+" but expected "+n._repo.repoInfo_.host+")"),bf(n,t.path.toString())}function tr(n,e){return n=ce(n),se(n._path)===null?NP("child","path",e,!1):Ui("child","path",e,!1),new Rt(n._repo,De(n._path,e))}function gE(n,e){n=ce(n),bt("push",n._path),un("push",e,n._path,!0);let t=hE(n._repo),r=HP(t),i=tr(n,r),s=tr(n,r),o;return e!=null?o=lu(s,e).then(()=>s):o=Promise.resolve(s),i.then=o.then.bind(o),i.catch=o.then.bind(o,void 0),i}function _E(n){return bt("remove",n._path),lu(n,null)}function lu(n,e){n=ce(n),bt("set",n._path),un("set",e,n._path,!1);let t=new pt;return Tf(n._repo,n._path,e,null,t.wrapCallback(()=>{})),t.promise}function yE(n,e){n=ce(n),bt("setPriority",n._path),If("setPriority",e,!1);let t=new pt;return Tf(n._repo,De(n._path,".priority"),e,null,t.wrapCallback(()=>{})),t.promise}function vE(n,e,t){if(bt("setWithPriority",n._path),un("setWithPriority",e,n._path,!1),If("setWithPriority",t,!1),n.key===".length"||n.key===".keys")throw"setWithPriority failed: "+n.key+" is a read-only object.";let r=new pt;return Tf(n._repo,n._path,e,t,r.wrapCallback(()=>{})),r.promise}function wE(n,e){oE("update",e,n._path,!1);let t=new pt;return OP(n._repo,n._path,e,t.wrapCallback(()=>{})),t.promise}function IE(n){n=ce(n);let e=new wo(()=>{}),t=new Io(e);return FP(n._repo,n,t).then(r=>new Oi(r,new Rt(n._repo,n._path),n._queryParams.getIndex()))}var Io=class n{constructor(e){this.callbackContext=e}respondsTo(e){return e==="value"}createEvent(e,t){let r=t._queryParams.getIndex();return new Ul("value",this,new Oi(e.snapshotNode,new Rt(t._repo,t._path),r))}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new ql(this,e,t):null}matches(e){return e instanceof n?!e.callbackContext||!this.callbackContext?!0:e.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}},zl=class n{constructor(e,t){this.eventType=e,this.callbackContext=t}respondsTo(e){let t=e==="children_added"?"child_added":e;return t=t==="children_removed"?"child_removed":t,this.eventType===t}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new ql(this,e,t):null}createEvent(e,t){O(e.childName!=null,"Child events should have a childName.");let r=tr(new Rt(t._repo,t._path),e.childName),i=t._queryParams.getIndex();return new Ul(e.type,this,new Oi(e.snapshotNode,r,i),e.prevName)}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,e.prevName)}matches(e){return e instanceof n?this.eventType===e.eventType&&(!this.callbackContext||!e.callbackContext||this.callbackContext.matches(e.callbackContext)):!1}hasAnyCallback(){return!!this.callbackContext}};function No(n,e,t,r,i){let s;if(typeof r=="object"&&(s=void 0,i=r),typeof r=="function"&&(s=r),i&&i.onlyOnce){let u=t,c=(d,f)=>{Ld(n._repo,n,a),u(d,f)};c.userCallback=t.userCallback,c.context=t.context,t=c}let o=new wo(t,s||void 0),a=e==="value"?new Io(o):new zl(e,o);return qP(n._repo,n,a),()=>Ld(n._repo,n,a)}function uu(n,e,t,r){return No(n,"value",e,t,r)}function Rf(n,e,t,r){return No(n,"child_added",e,t,r)}function Pf(n,e,t,r){return No(n,"child_changed",e,t,r)}function Nf(n,e,t,r){return No(n,"child_moved",e,t,r)}function Df(n,e,t,r){return No(n,"child_removed",e,t,r)}function xf(n,e,t){let r=null,i=t?new wo(t):null;e==="value"?r=new Io(i):e&&(r=new zl(e,i)),Ld(n._repo,n,r)}var Pt=class{},Kl=class extends Pt{constructor(e,t){super(),this._value=e,this._key=t,this.type="endAt"}_apply(e){un("endAt",this._value,e._path,!0);let t=md(e._queryParams,this._value,this._key);if(au(t),nr(t),e._queryParams.hasEnd())throw new Error("endAt: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new _t(e._repo,e._path,t,e._orderByCalled)}};function EE(n,e){return Ro("endAt","key",e,!0),new Kl(n,e)}var Ud=class extends Pt{constructor(e,t){super(),this._value=e,this._key=t,this.type="endBefore"}_apply(e){un("endBefore",this._value,e._path,!1);let t=IR(e._queryParams,this._value,this._key);if(au(t),nr(t),e._queryParams.hasEnd())throw new Error("endBefore: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new _t(e._repo,e._path,t,e._orderByCalled)}};function TE(n,e){return Ro("endBefore","key",e,!0),new Ud(n,e)}var Gl=class extends Pt{constructor(e,t){super(),this._value=e,this._key=t,this.type="startAt"}_apply(e){un("startAt",this._value,e._path,!0);let t=pd(e._queryParams,this._value,this._key);if(au(t),nr(t),e._queryParams.hasStart())throw new Error("startAt: Starting point was already set (by another call to startAt, startBefore or equalTo).");return new _t(e._repo,e._path,t,e._orderByCalled)}};function CE(n=null,e){return Ro("startAt","key",e,!0),new Gl(n,e)}var qd=class extends Pt{constructor(e,t){super(),this._value=e,this._key=t,this.type="startAfter"}_apply(e){un("startAfter",this._value,e._path,!1);let t=wR(e._queryParams,this._value,this._key);if(au(t),nr(t),e._queryParams.hasStart())throw new Error("startAfter: Starting point was already set (by another call to startAt, startAfter, or equalTo).");return new _t(e._repo,e._path,t,e._orderByCalled)}};function SE(n,e){return Ro("startAfter","key",e,!0),new qd(n,e)}var jd=class extends Pt{constructor(e){super(),this._limit=e,this.type="limitToFirst"}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToFirst: Limit was already set (by another call to limitToFirst or limitToLast).");return new _t(e._repo,e._path,yR(e._queryParams,this._limit),e._orderByCalled)}};function bE(n){if(typeof n!="number"||Math.floor(n)!==n||n<=0)throw new Error("limitToFirst: First argument must be a positive integer.");return new jd(n)}var zd=class extends Pt{constructor(e){super(),this._limit=e,this.type="limitToLast"}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToLast: Limit was already set (by another call to limitToFirst or limitToLast).");return new _t(e._repo,e._path,vR(e._queryParams,this._limit),e._orderByCalled)}};function AE(n){if(typeof n!="number"||Math.floor(n)!==n||n<=0)throw new Error("limitToLast: First argument must be a positive integer.");return new zd(n)}var Kd=class extends Pt{constructor(e){super(),this._path=e,this.type="orderByChild"}_apply(e){ou(e,"orderByChild");let t=new we(this._path);if(oe(t))throw new Error("orderByChild: cannot pass in empty path. Use orderByValue() instead.");let r=new uo(t),i=Ql(e._queryParams,r);return nr(i),new _t(e._repo,e._path,i,!0)}};function RE(n){if(n==="$key")throw new Error('orderByChild: "$key" is invalid.  Use orderByKey() instead.');if(n==="$priority")throw new Error('orderByChild: "$priority" is invalid.  Use orderByPriority() instead.');if(n==="$value")throw new Error('orderByChild: "$value" is invalid.  Use orderByValue() instead.');return Ui("orderByChild","path",n,!1),new Kd(n)}var Gd=class extends Pt{constructor(){super(...arguments),this.type="orderByKey"}_apply(e){ou(e,"orderByKey");let t=Ql(e._queryParams,on);return nr(t),new _t(e._repo,e._path,t,!0)}};function PE(){return new Gd}var Wd=class extends Pt{constructor(){super(...arguments),this.type="orderByPriority"}_apply(e){ou(e,"orderByPriority");let t=Ql(e._queryParams,Se);return nr(t),new _t(e._repo,e._path,t,!0)}};function NE(){return new Wd}var Qd=class extends Pt{constructor(){super(...arguments),this.type="orderByValue"}_apply(e){ou(e,"orderByValue");let t=Ql(e._queryParams,af);return nr(t),new _t(e._repo,e._path,t,!0)}};function DE(){return new Qd}var $d=class extends Pt{constructor(e,t){super(),this._value=e,this._key=t,this.type="equalTo"}_apply(e){if(un("equalTo",this._value,e._path,!1),e._queryParams.hasStart())throw new Error("equalTo: Starting point was already set (by another call to startAt/startAfter or equalTo).");if(e._queryParams.hasEnd())throw new Error("equalTo: Ending point was already set (by another call to endAt/endBefore or equalTo).");return new Kl(this._value,this._key)._apply(new Gl(this._value,this._key)._apply(e))}};function xE(n,e){return Ro("equalTo","key",e,!0),new $d(n,e)}function Ut(n,...e){let t=ce(n);for(let r of e)t=r._apply(t);return t}nP(Rt);aP(Rt);var YP="FIREBASE_DATABASE_EMULATOR_HOST",Hd={},JP=!1;function XP(n,e,t,r){n.repoInfo_=new Il(`${e}:${t}`,!1,n.repoInfo_.namespace,n.repoInfo_.webSocketOnly,n.repoInfo_.nodeAdmin,n.repoInfo_.persistenceKey,n.repoInfo_.includeNamespaceInQueryParams,!0),r&&(n.authTokenProvider_=r)}function kf(n,e,t,r,i){let s=r||n.options.databaseURL;s===void 0&&(n.options.projectId||an("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),tt("Using default host for project ",n.options.projectId),s=`${n.options.projectId}-default-rtdb.firebaseio.com`);let o=Bd(s,i),a=o.repoInfo,u,c;typeof process<"u"&&process.env&&(c=process.env[YP]),c?(u=!0,s=`http://${c}?ns=${a.namespace}`,o=Bd(s,i),a=o.repoInfo):u=!o.repoInfo.secure;let d=i&&u?new ro(ro.OWNER):new Zh(n.name,n.options,e);aE("Invalid Firebase Database URL",o),oe(o.path)||an("Database URL must point to the root of a Firebase Database (not including a child path).");let f=eN(a,n,d,new Xh(n.name,t));return new Yd(f,n)}function ZP(n,e){let t=Hd[e];(!t||t[n.key]!==n)&&an(`Database ${e}(${n.repoInfo_}) has already been deleted.`),dE(n),delete t[n.key]}function eN(n,e,t,r){let i=Hd[e.name];i||(i={},Hd[e.name]=i);let s=i[n.toURLString()];return s&&an("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),s=new Vd(n,JP,t,r),i[n.toURLString()]=s,s}var Yd=class{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(kP(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new Rt(this._repo,ve())),this._rootInternal}_delete(){return this._rootInternal!==null&&(ZP(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&an("Cannot call "+e+" on a deleted database.")}};function kE(){DI.IS_TRANSPORT_INITIALIZED&&ut("Transport has already been initialized. Please call this function before calling ref or setting up a listener")}function ME(){kE(),ao.forceDisallow()}function FE(){kE(),bi.forceDisallow(),ao.forceAllow()}function OE(n,e,t,r={}){n=ce(n),n._checkNotDeleted("useEmulator"),n._instanceStarted&&an("Cannot call useEmulator() after instance has already been initialized.");let i=n._repoInternal,s;if(i.repoInfo_.nodeAdmin)r.mockUserToken&&an('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),s=new ro(ro.OWNER);else if(r.mockUserToken){let o=typeof r.mockUserToken=="string"?r.mockUserToken:Ha(r.mockUserToken,n.app.options.projectId);s=new ro(o)}XP(i,e,t,s)}function VE(n){n=ce(n),n._checkNotDeleted("goOffline"),dE(n._repo)}function LE(n){n=ce(n),n._checkNotDeleted("goOnline"),jP(n._repo)}function BE(n,e){fI(n,e)}function tN(n){Zd(el),Za(new rn("database",(e,{instanceIdentifier:t})=>{let r=e.getProvider("app").getImmediate(),i=e.getProvider("auth-internal"),s=e.getProvider("app-check-internal");return kf(r,i,s,t)},"PUBLIC").setMultipleInstances(!0)),Ci(xw,kw,n),Ci(xw,kw,"esm2017")}var nN={".sv":"timestamp"};function UE(){return nN}function qE(n){return{".sv":{increment:n}}}var Jd=class{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return{committed:this.committed,snapshot:this.snapshot.toJSON()}}};function jE(n,e,t){var r;if(n=ce(n),bt("Reference.transaction",n._path),n.key===".length"||n.key===".keys")throw"Reference.transaction failed: "+n.key+" is a read-only object.";let i=(r=t?.applyLocally)!==null&&r!==void 0?r:!0,s=new pt,o=(u,c,d)=>{let f=null;u?s.reject(u):(f=new Oi(d,new Rt(n._repo,n._path),Se),s.resolve(new Jd(c,f)))},a=uu(n,()=>{});return zP(n._repo,n._path,e,o,a,i),s.promise}sf.prototype.simpleListen=function(n,e){this.sendRequest("q",{p:n},e)};sf.prototype.echo=function(n,e){this.sendRequest("echo",{d:n},e)};tN();var rN="@firebase/database-compat",iN="1.0.8";var sN=new Ti("@firebase/database-compat"),zE=function(n){let e="FIREBASE WARNING: "+n;sN.warn(e)};var oN=function(n,e,t,r){if(!(r&&t===void 0)&&typeof t!="boolean")throw new Error(Et(n,e)+"must be a boolean.")},aN=function(n,e,t){if(!(t&&e===void 0))switch(e){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw new Error(Et(n,"eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}};var Mf=class{constructor(e){this._delegate=e}cancel(e){Z("OnDisconnect.cancel",0,1,arguments.length),Ye("OnDisconnect.cancel","onComplete",e,!0);let t=this._delegate.cancel();return e&&t.then(()=>e(null),r=>e(r)),t}remove(e){Z("OnDisconnect.remove",0,1,arguments.length),Ye("OnDisconnect.remove","onComplete",e,!0);let t=this._delegate.remove();return e&&t.then(()=>e(null),r=>e(r)),t}set(e,t){Z("OnDisconnect.set",1,2,arguments.length),Ye("OnDisconnect.set","onComplete",t,!0);let r=this._delegate.set(e);return t&&r.then(()=>t(null),i=>t(i)),r}setWithPriority(e,t,r){Z("OnDisconnect.setWithPriority",2,3,arguments.length),Ye("OnDisconnect.setWithPriority","onComplete",r,!0);let i=this._delegate.setWithPriority(e,t);return r&&i.then(()=>r(null),s=>r(s)),i}update(e,t){if(Z("OnDisconnect.update",1,2,arguments.length),Array.isArray(e)){let i={};for(let s=0;s<e.length;++s)i[""+s]=e[s];e=i,zE("Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}Ye("OnDisconnect.update","onComplete",t,!0);let r=this._delegate.update(e);return t&&r.then(()=>t(null),i=>t(i)),r}};var Ff=class{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return Z("TransactionResult.toJSON",0,1,arguments.length),{committed:this.committed,snapshot:this.snapshot.toJSON()}}};var Or=class n{constructor(e,t){this._database=e,this._delegate=t}val(){return Z("DataSnapshot.val",0,0,arguments.length),this._delegate.val()}exportVal(){return Z("DataSnapshot.exportVal",0,0,arguments.length),this._delegate.exportVal()}toJSON(){return Z("DataSnapshot.toJSON",0,1,arguments.length),this._delegate.toJSON()}exists(){return Z("DataSnapshot.exists",0,0,arguments.length),this._delegate.exists()}child(e){return Z("DataSnapshot.child",0,1,arguments.length),e=String(e),Ui("DataSnapshot.child","path",e,!1),new n(this._database,this._delegate.child(e))}hasChild(e){return Z("DataSnapshot.hasChild",1,1,arguments.length),Ui("DataSnapshot.hasChild","path",e,!1),this._delegate.hasChild(e)}getPriority(){return Z("DataSnapshot.getPriority",0,0,arguments.length),this._delegate.priority}forEach(e){return Z("DataSnapshot.forEach",1,1,arguments.length),Ye("DataSnapshot.forEach","action",e,!1),this._delegate.forEach(t=>e(new n(this._database,t)))}hasChildren(){return Z("DataSnapshot.hasChildren",0,0,arguments.length),this._delegate.hasChildren()}get key(){return this._delegate.key}numChildren(){return Z("DataSnapshot.numChildren",0,0,arguments.length),this._delegate.size}getRef(){return Z("DataSnapshot.ref",0,0,arguments.length),new bn(this._database,this._delegate.ref)}get ref(){return this.getRef()}},cu=class n{constructor(e,t){this.database=e,this._delegate=t}on(e,t,r,i){var s;Z("Query.on",2,4,arguments.length),Ye("Query.on","callback",t,!1);let o=n.getCancelAndContextArgs_("Query.on",r,i),a=(c,d)=>{t.call(o.context,new Or(this.database,c),d)};a.userCallback=t,a.context=o.context;let u=(s=o.cancel)===null||s===void 0?void 0:s.bind(o.context);switch(e){case"value":return uu(this._delegate,a,u),t;case"child_added":return Rf(this._delegate,a,u),t;case"child_removed":return Df(this._delegate,a,u),t;case"child_changed":return Pf(this._delegate,a,u),t;case"child_moved":return Nf(this._delegate,a,u),t;default:throw new Error(Et("Query.on","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}}off(e,t,r){if(Z("Query.off",0,3,arguments.length),aN("Query.off",e,!0),Ye("Query.off","callback",t,!0),Lh("Query.off","context",r,!0),t){let i=()=>{};i.userCallback=t,i.context=r,xf(this._delegate,e,i)}else xf(this._delegate,e)}get(){return IE(this._delegate).then(e=>new Or(this.database,e))}once(e,t,r,i){Z("Query.once",1,4,arguments.length),Ye("Query.once","callback",t,!0);let s=n.getCancelAndContextArgs_("Query.once",r,i),o=new pt,a=(c,d)=>{let f=new Or(this.database,c);t&&t.call(s.context,f,d),o.resolve(f)};a.userCallback=t,a.context=s.context;let u=c=>{s.cancel&&s.cancel.call(s.context,c),o.reject(c)};switch(e){case"value":uu(this._delegate,a,u,{onlyOnce:!0});break;case"child_added":Rf(this._delegate,a,u,{onlyOnce:!0});break;case"child_removed":Df(this._delegate,a,u,{onlyOnce:!0});break;case"child_changed":Pf(this._delegate,a,u,{onlyOnce:!0});break;case"child_moved":Nf(this._delegate,a,u,{onlyOnce:!0});break;default:throw new Error(Et("Query.once","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}return o.promise}limitToFirst(e){return Z("Query.limitToFirst",1,1,arguments.length),new n(this.database,Ut(this._delegate,bE(e)))}limitToLast(e){return Z("Query.limitToLast",1,1,arguments.length),new n(this.database,Ut(this._delegate,AE(e)))}orderByChild(e){return Z("Query.orderByChild",1,1,arguments.length),new n(this.database,Ut(this._delegate,RE(e)))}orderByKey(){return Z("Query.orderByKey",0,0,arguments.length),new n(this.database,Ut(this._delegate,PE()))}orderByPriority(){return Z("Query.orderByPriority",0,0,arguments.length),new n(this.database,Ut(this._delegate,NE()))}orderByValue(){return Z("Query.orderByValue",0,0,arguments.length),new n(this.database,Ut(this._delegate,DE()))}startAt(e=null,t){return Z("Query.startAt",0,2,arguments.length),new n(this.database,Ut(this._delegate,CE(e,t)))}startAfter(e=null,t){return Z("Query.startAfter",0,2,arguments.length),new n(this.database,Ut(this._delegate,SE(e,t)))}endAt(e=null,t){return Z("Query.endAt",0,2,arguments.length),new n(this.database,Ut(this._delegate,EE(e,t)))}endBefore(e=null,t){return Z("Query.endBefore",0,2,arguments.length),new n(this.database,Ut(this._delegate,TE(e,t)))}equalTo(e,t){return Z("Query.equalTo",1,2,arguments.length),new n(this.database,Ut(this._delegate,xE(e,t)))}toString(){return Z("Query.toString",0,0,arguments.length),this._delegate.toString()}toJSON(){return Z("Query.toJSON",0,1,arguments.length),this._delegate.toJSON()}isEqual(e){if(Z("Query.isEqual",1,1,arguments.length),!(e instanceof n)){let t="Query.isEqual failed: First argument must be an instance of firebase.database.Query.";throw new Error(t)}return this._delegate.isEqual(e._delegate)}static getCancelAndContextArgs_(e,t,r){let i={cancel:void 0,context:void 0};if(t&&r)i.cancel=t,Ye(e,"cancel",i.cancel,!0),i.context=r,Lh(e,"context",i.context,!0);else if(t)if(typeof t=="object"&&t!==null)i.context=t;else if(typeof t=="function")i.cancel=t;else throw new Error(Et(e,"cancelOrContext")+" must either be a cancel callback or a context object.");return i}get ref(){return new bn(this.database,new Rt(this._delegate._repo,this._delegate._path))}},bn=class n extends cu{constructor(e,t){super(e,new _t(t._repo,t._path,new po,!1)),this.database=e,this._delegate=t}getKey(){return Z("Reference.key",0,0,arguments.length),this._delegate.key}child(e){return Z("Reference.child",1,1,arguments.length),typeof e=="number"&&(e=String(e)),new n(this.database,tr(this._delegate,e))}getParent(){Z("Reference.parent",0,0,arguments.length);let e=this._delegate.parent;return e?new n(this.database,e):null}getRoot(){return Z("Reference.root",0,0,arguments.length),new n(this.database,this._delegate.root)}set(e,t){Z("Reference.set",1,2,arguments.length),Ye("Reference.set","onComplete",t,!0);let r=lu(this._delegate,e);return t&&r.then(()=>t(null),i=>t(i)),r}update(e,t){if(Z("Reference.update",1,2,arguments.length),Array.isArray(e)){let i={};for(let s=0;s<e.length;++s)i[""+s]=e[s];e=i,zE("Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}bt("Reference.update",this._delegate._path),Ye("Reference.update","onComplete",t,!0);let r=wE(this._delegate,e);return t&&r.then(()=>t(null),i=>t(i)),r}setWithPriority(e,t,r){Z("Reference.setWithPriority",2,3,arguments.length),Ye("Reference.setWithPriority","onComplete",r,!0);let i=vE(this._delegate,e,t);return r&&i.then(()=>r(null),s=>r(s)),i}remove(e){Z("Reference.remove",0,1,arguments.length),Ye("Reference.remove","onComplete",e,!0);let t=_E(this._delegate);return e&&t.then(()=>e(null),r=>e(r)),t}transaction(e,t,r){Z("Reference.transaction",1,3,arguments.length),Ye("Reference.transaction","transactionUpdate",e,!1),Ye("Reference.transaction","onComplete",t,!0),oN("Reference.transaction","applyLocally",r,!0);let i=jE(this._delegate,e,{applyLocally:r}).then(s=>new Ff(s.committed,new Or(this.database,s.snapshot)));return t&&i.then(s=>t(null,s.committed,s.snapshot),s=>t(s,!1,null)),i}setPriority(e,t){Z("Reference.setPriority",1,2,arguments.length),Ye("Reference.setPriority","onComplete",t,!0);let r=yE(this._delegate,e);return t&&r.then(()=>t(null),i=>t(i)),r}push(e,t){Z("Reference.push",0,2,arguments.length),Ye("Reference.push","onComplete",t,!0);let r=gE(this._delegate,e),i=r.then(o=>new n(this.database,o));t&&i.then(()=>t(null),o=>t(o));let s=new n(this.database,r);return s.then=i.then.bind(i),s.catch=i.catch.bind(i,void 0),s}onDisconnect(){return bt("Reference.onDisconnect",this._delegate._path),new Mf(new jl(this._delegate._repo,this._delegate._path))}get key(){return this.getKey()}get parent(){return this.getParent()}get root(){return this.getRoot()}};var Vr=class{constructor(e,t){this._delegate=e,this.app=t,this.INTERNAL={delete:()=>this._delegate._delete(),forceWebSockets:ME,forceLongPolling:FE}}useEmulator(e,t,r={}){OE(this._delegate,e,t,r)}ref(e){if(Z("database.ref",0,1,arguments.length),e instanceof bn){let t=Af(this._delegate,e.toString());return new bn(this,t)}else{let t=bf(this._delegate,e);return new bn(this,t)}}refFromURL(e){Z("database.refFromURL",1,1,arguments.length);let r=Af(this._delegate,e);return new bn(this,r)}goOffline(){return Z("database.goOffline",0,0,arguments.length),VE(this._delegate)}goOnline(){return Z("database.goOnline",0,0,arguments.length),LE(this._delegate)}};Vr.ServerValue={TIMESTAMP:UE(),increment:n=>qE(n)};function lN({app:n,url:e,version:t,customAuthImpl:r,customAppCheckImpl:i,namespace:s,nodeAdmin:o=!1}){Zd(t);let a=new Bh("database-standalone"),u=new Xa("auth-internal",a);u.setComponent(new rn("auth-internal",()=>r,"PRIVATE"));let c;return i&&(c=new Xa("app-check-internal",a),c.setComponent(new rn("app-check-internal",()=>i,"PRIVATE"))),{instance:new Vr(kf(n,u,c,e,o),n),namespace:s}}var uN=Object.freeze({__proto__:null,initStandalone:lN});var cN=Vr.ServerValue;function hN(n){n.INTERNAL.registerComponent(new rn("database-compat",(e,{instanceIdentifier:t})=>{let r=e.getProvider("app-compat").getImmediate(),i=e.getProvider("database").getImmediate({identifier:t});return new Vr(i,r)},"PUBLIC").setServiceProps({Reference:bn,Query:cu,Database:Vr,DataSnapshot:Or,enableLogging:BE,INTERNAL:uN,ServerValue:cN}).setMultipleInstances(!0)),n.registerVersion(rN,iN)}hN(Qn);function Do(n,e,t="on",r=qa){return new Ua(i=>{let s=null;return s=n[t](e,(o,a)=>{r.schedule(()=>{i.next({snapshot:o,prevKey:a})}),t==="once"&&r.schedule(()=>i.complete())},o=>{r.schedule(()=>i.error(o))}),t==="on"?{unsubscribe(){s!=null&&n.off(e,s)}}:{unsubscribe(){}}}).pipe(et(i=>{let{snapshot:s,prevKey:o}=i,a=null;return s.exists()&&(a=s.key),{type:e,payload:s,prevKey:o,key:a}}),Iy())}function mN(n){return typeof n=="string"}function gN(n){return typeof n.exportVal=="function"}function $E(n){return n==null}function HE(n){return typeof n.set=="function"}function KE(n,e){return HE(e)?e:n.ref(e)}function YE(n,e){if(mN(n))return e.stringCase();if(HE(n))return e.firebaseCase();if(gN(n))return e.snapshotCase();throw new Error(`Expects a string, snapshot, or reference. Got: ${typeof n}`)}function JE(n){return($E(n)||n.length===0)&&(n=["child_added","child_removed","child_changed","child_moved"]),n}function XE(n,e,t){e=JE(e);let r=e.map(i=>Do(n,i,"on",t));return Nh(...r)}function _N(n,e,t){let r=XE(n,e).pipe(Rr((i,s)=>[...i,s],[]));return vN(n,r,t)}function yN(n,e){return Do(n,"value","on",e).pipe(et(t=>{let r;return t.payload.forEach(i=>(r=i.key,!1)),{data:t,lastKeyToLoad:r}}))}function vN(n,e,t){return yN(n,t).pipe(Cy(e),et(([i,s])=>{let o=i.lastKeyToLoad,a=s.map(u=>u.key);return{actions:s,lastKeyToLoad:o,loadedKeys:a}}),Ey(i=>i.loadedKeys.indexOf(i.lastKeyToLoad)===-1),et(i=>i.actions))}function GE(n,e){return function(r,i){return YE(r,{stringCase:()=>n.child(r)[e](i),firebaseCase:()=>r[e](i),snapshotCase:()=>r.ref[e](i)})}}function wN(n){return function(t){return t?YE(t,{stringCase:()=>n.child(t).remove(),firebaseCase:()=>t.remove(),snapshotCase:()=>t.ref.remove()}):n.remove()}}function IN(n,e,t){return Do(n,"value","once",t).pipe(Ty(r=>{let i=[Qs(r)];return e.forEach(s=>i.push(Do(n,s,"on",t))),Nh(...i).pipe(Rr(TN,[]))}),ja())}function ZE(n,e){let t=n.length;for(let r=0;r<t;r++)if(n[r].payload.key===e)return r;return-1}function EN(n,e){if($E(e))return 0;{let t=ZE(n,e);return t===-1?n.length:t+1}}function TN(n,e){let{payload:t,prevKey:r,key:i}=e,s=ZE(n,i),o=EN(n,r);switch(e.type){case"value":if(e.payload?.exists()){let a=null;e.payload.forEach(u=>{let c={payload:u,type:"value",prevKey:a,key:u.key};return a=u.key,n=[...n,c],!1})}return n;case"child_added":if(s>-1)(n[s-1]?.key||null)!==r&&(n=n.filter(u=>u.payload.key!==t.key),n.splice(o,0,e));else{if(r==null)return[e,...n];n=n.slice(),n.splice(o,0,e)}return n;case"child_removed":return n.filter(a=>a.payload.key!==t.key);case"child_changed":return n.map(a=>a.payload.key===i?e:a);case"child_moved":if(s>-1){let a=n.splice(s,1)[0];return n=n.slice(),n.splice(o,0,a),n}return n;default:return n}}function WE(n,e,t){return e=JE(e),IN(n,e,t)}function CN(n,e){let t=e.schedulers.outsideAngular,r=e.schedulers.ngZone.run(()=>n.ref);return{query:n,update:GE(r,"update"),set:GE(r,"set"),push:i=>r.push(i),remove:wN(r),snapshotChanges(i){return WE(n,i,t).pipe(Je)},stateChanges(i){return XE(n,i,t).pipe(Je)},auditTrail(i){return _N(n,i,t).pipe(Je)},valueChanges(i,s){return WE(n,i,t).pipe(et(a=>a.map(u=>s&&s.idField?Gs(en({},u.payload.val()),{[s.idField]:u.key}):u.payload.val())),Je)}}}function QE(n,e){return function(){return Do(n,"value","on",e)}}function SN(n,e){return{query:n,snapshotChanges(){return QE(n,e.schedulers.outsideAngular)().pipe(Je)},update(t){return n.ref.update(t)},set(t){return n.ref.set(t)},remove(){return n.ref.remove()},valueChanges(){return QE(n,e.schedulers.outsideAngular)().pipe(Je,et(r=>r.payload.exists()?r.payload.val():null))}}}var bN=new Gn("angularfire2.realtimeDatabaseURL"),AN=new Gn("angularfire2.database.use-emulator"),RN=(()=>{class n{schedulers;database;constructor(t,r,i,s,o,a,u,c,d,f,m,_,I,S,P){this.schedulers=a;let V=u,U=ol(t,o,r);c&&pl(U,o,d,m,_,I,f,S),this.database=al(`${U.name}.database.${i}`,"AngularFireDatabase",U.name,()=>{let L=o.runOutsideAngular(()=>U.database(i||void 0));return V&&L.useEmulator(...V),L},[V])}list(t,r){let i=this.schedulers.ngZone.runOutsideAngular(()=>KE(this.database,t)),s=i;return r&&(s=r(i)),CN(s,this)}object(t){let r=this.schedulers.ngZone.runOutsideAngular(()=>KE(this.database,t));return SN(r,this)}createPushId(){return this.schedulers.ngZone.runOutsideAngular(()=>this.database.ref()).push().key}static \u0275fac=function(r){return new(r||n)(ae(il),ae(sl,8),ae(bN,8),ae(Ga),ae(wi),ae(rl),ae(AN,8),ae(ml,8),ae(ll,8),ae(ul,8),ae(cl,8),ae(hl,8),ae(dl,8),ae(fl,8),ae(nl,8))};static \u0275prov=Kn({token:n,factory:n.\u0275fac,providedIn:"any"})}return n})(),eT=(()=>{class n{constructor(){Qn.registerVersion("angularfire",tl.full,"rtdb-compat")}static \u0275fac=function(r){return new(r||n)};static \u0275mod=G({type:n});static \u0275inj=K({providers:[RN]})}return n})();var tT=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},nT={};var rr,Of;(function(){var n;function e(E,y){function w(){}w.prototype=y.prototype,E.D=y.prototype,E.prototype=new w,E.prototype.constructor=E,E.C=function(T,C,A){for(var v=Array(arguments.length-2),Mt=2;Mt<arguments.length;Mt++)v[Mt-2]=arguments[Mt];return y.prototype[C].apply(T,v)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(r,t),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(E,y,w){w||(w=0);var T=Array(16);if(typeof y=="string")for(var C=0;16>C;++C)T[C]=y.charCodeAt(w++)|y.charCodeAt(w++)<<8|y.charCodeAt(w++)<<16|y.charCodeAt(w++)<<24;else for(C=0;16>C;++C)T[C]=y[w++]|y[w++]<<8|y[w++]<<16|y[w++]<<24;y=E.g[0],w=E.g[1],C=E.g[2];var A=E.g[3],v=y+(A^w&(C^A))+T[0]+3614090360&4294967295;y=w+(v<<7&4294967295|v>>>25),v=A+(C^y&(w^C))+T[1]+3905402710&4294967295,A=y+(v<<12&4294967295|v>>>20),v=C+(w^A&(y^w))+T[2]+606105819&4294967295,C=A+(v<<17&4294967295|v>>>15),v=w+(y^C&(A^y))+T[3]+3250441966&4294967295,w=C+(v<<22&4294967295|v>>>10),v=y+(A^w&(C^A))+T[4]+4118548399&4294967295,y=w+(v<<7&4294967295|v>>>25),v=A+(C^y&(w^C))+T[5]+1200080426&4294967295,A=y+(v<<12&4294967295|v>>>20),v=C+(w^A&(y^w))+T[6]+2821735955&4294967295,C=A+(v<<17&4294967295|v>>>15),v=w+(y^C&(A^y))+T[7]+4249261313&4294967295,w=C+(v<<22&4294967295|v>>>10),v=y+(A^w&(C^A))+T[8]+1770035416&4294967295,y=w+(v<<7&4294967295|v>>>25),v=A+(C^y&(w^C))+T[9]+2336552879&4294967295,A=y+(v<<12&4294967295|v>>>20),v=C+(w^A&(y^w))+T[10]+4294925233&4294967295,C=A+(v<<17&4294967295|v>>>15),v=w+(y^C&(A^y))+T[11]+2304563134&4294967295,w=C+(v<<22&4294967295|v>>>10),v=y+(A^w&(C^A))+T[12]+1804603682&4294967295,y=w+(v<<7&4294967295|v>>>25),v=A+(C^y&(w^C))+T[13]+4254626195&4294967295,A=y+(v<<12&4294967295|v>>>20),v=C+(w^A&(y^w))+T[14]+2792965006&4294967295,C=A+(v<<17&4294967295|v>>>15),v=w+(y^C&(A^y))+T[15]+1236535329&4294967295,w=C+(v<<22&4294967295|v>>>10),v=y+(C^A&(w^C))+T[1]+4129170786&4294967295,y=w+(v<<5&4294967295|v>>>27),v=A+(w^C&(y^w))+T[6]+3225465664&4294967295,A=y+(v<<9&4294967295|v>>>23),v=C+(y^w&(A^y))+T[11]+643717713&4294967295,C=A+(v<<14&4294967295|v>>>18),v=w+(A^y&(C^A))+T[0]+3921069994&4294967295,w=C+(v<<20&4294967295|v>>>12),v=y+(C^A&(w^C))+T[5]+3593408605&4294967295,y=w+(v<<5&4294967295|v>>>27),v=A+(w^C&(y^w))+T[10]+38016083&4294967295,A=y+(v<<9&4294967295|v>>>23),v=C+(y^w&(A^y))+T[15]+3634488961&4294967295,C=A+(v<<14&4294967295|v>>>18),v=w+(A^y&(C^A))+T[4]+3889429448&4294967295,w=C+(v<<20&4294967295|v>>>12),v=y+(C^A&(w^C))+T[9]+568446438&4294967295,y=w+(v<<5&4294967295|v>>>27),v=A+(w^C&(y^w))+T[14]+3275163606&4294967295,A=y+(v<<9&4294967295|v>>>23),v=C+(y^w&(A^y))+T[3]+4107603335&4294967295,C=A+(v<<14&4294967295|v>>>18),v=w+(A^y&(C^A))+T[8]+1163531501&4294967295,w=C+(v<<20&4294967295|v>>>12),v=y+(C^A&(w^C))+T[13]+2850285829&4294967295,y=w+(v<<5&4294967295|v>>>27),v=A+(w^C&(y^w))+T[2]+4243563512&4294967295,A=y+(v<<9&4294967295|v>>>23),v=C+(y^w&(A^y))+T[7]+1735328473&4294967295,C=A+(v<<14&4294967295|v>>>18),v=w+(A^y&(C^A))+T[12]+2368359562&4294967295,w=C+(v<<20&4294967295|v>>>12),v=y+(w^C^A)+T[5]+4294588738&4294967295,y=w+(v<<4&4294967295|v>>>28),v=A+(y^w^C)+T[8]+2272392833&4294967295,A=y+(v<<11&4294967295|v>>>21),v=C+(A^y^w)+T[11]+1839030562&4294967295,C=A+(v<<16&4294967295|v>>>16),v=w+(C^A^y)+T[14]+4259657740&4294967295,w=C+(v<<23&4294967295|v>>>9),v=y+(w^C^A)+T[1]+2763975236&4294967295,y=w+(v<<4&4294967295|v>>>28),v=A+(y^w^C)+T[4]+1272893353&4294967295,A=y+(v<<11&4294967295|v>>>21),v=C+(A^y^w)+T[7]+4139469664&4294967295,C=A+(v<<16&4294967295|v>>>16),v=w+(C^A^y)+T[10]+3200236656&4294967295,w=C+(v<<23&4294967295|v>>>9),v=y+(w^C^A)+T[13]+681279174&4294967295,y=w+(v<<4&4294967295|v>>>28),v=A+(y^w^C)+T[0]+3936430074&4294967295,A=y+(v<<11&4294967295|v>>>21),v=C+(A^y^w)+T[3]+3572445317&4294967295,C=A+(v<<16&4294967295|v>>>16),v=w+(C^A^y)+T[6]+76029189&4294967295,w=C+(v<<23&4294967295|v>>>9),v=y+(w^C^A)+T[9]+3654602809&4294967295,y=w+(v<<4&4294967295|v>>>28),v=A+(y^w^C)+T[12]+3873151461&4294967295,A=y+(v<<11&4294967295|v>>>21),v=C+(A^y^w)+T[15]+530742520&4294967295,C=A+(v<<16&4294967295|v>>>16),v=w+(C^A^y)+T[2]+3299628645&4294967295,w=C+(v<<23&4294967295|v>>>9),v=y+(C^(w|~A))+T[0]+4096336452&4294967295,y=w+(v<<6&4294967295|v>>>26),v=A+(w^(y|~C))+T[7]+1126891415&4294967295,A=y+(v<<10&4294967295|v>>>22),v=C+(y^(A|~w))+T[14]+2878612391&4294967295,C=A+(v<<15&4294967295|v>>>17),v=w+(A^(C|~y))+T[5]+4237533241&4294967295,w=C+(v<<21&4294967295|v>>>11),v=y+(C^(w|~A))+T[12]+1700485571&4294967295,y=w+(v<<6&4294967295|v>>>26),v=A+(w^(y|~C))+T[3]+2399980690&4294967295,A=y+(v<<10&4294967295|v>>>22),v=C+(y^(A|~w))+T[10]+4293915773&4294967295,C=A+(v<<15&4294967295|v>>>17),v=w+(A^(C|~y))+T[1]+2240044497&4294967295,w=C+(v<<21&4294967295|v>>>11),v=y+(C^(w|~A))+T[8]+1873313359&4294967295,y=w+(v<<6&4294967295|v>>>26),v=A+(w^(y|~C))+T[15]+4264355552&4294967295,A=y+(v<<10&4294967295|v>>>22),v=C+(y^(A|~w))+T[6]+2734768916&4294967295,C=A+(v<<15&4294967295|v>>>17),v=w+(A^(C|~y))+T[13]+1309151649&4294967295,w=C+(v<<21&4294967295|v>>>11),v=y+(C^(w|~A))+T[4]+4149444226&4294967295,y=w+(v<<6&4294967295|v>>>26),v=A+(w^(y|~C))+T[11]+3174756917&4294967295,A=y+(v<<10&4294967295|v>>>22),v=C+(y^(A|~w))+T[2]+718787259&4294967295,C=A+(v<<15&4294967295|v>>>17),v=w+(A^(C|~y))+T[9]+3951481745&4294967295,E.g[0]=E.g[0]+y&4294967295,E.g[1]=E.g[1]+(C+(v<<21&4294967295|v>>>11))&4294967295,E.g[2]=E.g[2]+C&4294967295,E.g[3]=E.g[3]+A&4294967295}r.prototype.u=function(E,y){y===void 0&&(y=E.length);for(var w=y-this.blockSize,T=this.B,C=this.h,A=0;A<y;){if(C==0)for(;A<=w;)i(this,E,A),A+=this.blockSize;if(typeof E=="string"){for(;A<y;)if(T[C++]=E.charCodeAt(A++),C==this.blockSize){i(this,T),C=0;break}}else for(;A<y;)if(T[C++]=E[A++],C==this.blockSize){i(this,T),C=0;break}}this.h=C,this.o+=y},r.prototype.v=function(){var E=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);E[0]=128;for(var y=1;y<E.length-8;++y)E[y]=0;var w=8*this.o;for(y=E.length-8;y<E.length;++y)E[y]=w&255,w/=256;for(this.u(E),E=Array(16),y=w=0;4>y;++y)for(var T=0;32>T;T+=8)E[w++]=this.g[y]>>>T&255;return E};function s(E,y){var w=a;return Object.prototype.hasOwnProperty.call(w,E)?w[E]:w[E]=y(E)}function o(E,y){this.h=y;for(var w=[],T=!0,C=E.length-1;0<=C;C--){var A=E[C]|0;T&&A==y||(w[C]=A,T=!1)}this.g=w}var a={};function u(E){return-128<=E&&128>E?s(E,function(y){return new o([y|0],0>y?-1:0)}):new o([E|0],0>E?-1:0)}function c(E){if(isNaN(E)||!isFinite(E))return f;if(0>E)return P(c(-E));for(var y=[],w=1,T=0;E>=w;T++)y[T]=E/w|0,w*=4294967296;return new o(y,0)}function d(E,y){if(E.length==0)throw Error("number format error: empty string");if(y=y||10,2>y||36<y)throw Error("radix out of range: "+y);if(E.charAt(0)=="-")return P(d(E.substring(1),y));if(0<=E.indexOf("-"))throw Error('number format error: interior "-" character');for(var w=c(Math.pow(y,8)),T=f,C=0;C<E.length;C+=8){var A=Math.min(8,E.length-C),v=parseInt(E.substring(C,C+A),y);8>A?(A=c(Math.pow(y,A)),T=T.j(A).add(c(v))):(T=T.j(w),T=T.add(c(v)))}return T}var f=u(0),m=u(1),_=u(16777216);n=o.prototype,n.m=function(){if(S(this))return-P(this).m();for(var E=0,y=1,w=0;w<this.g.length;w++){var T=this.i(w);E+=(0<=T?T:4294967296+T)*y,y*=4294967296}return E},n.toString=function(E){if(E=E||10,2>E||36<E)throw Error("radix out of range: "+E);if(I(this))return"0";if(S(this))return"-"+P(this).toString(E);for(var y=c(Math.pow(E,6)),w=this,T="";;){var C=$(w,y).g;w=V(w,C.j(y));var A=((0<w.g.length?w.g[0]:w.h)>>>0).toString(E);if(w=C,I(w))return A+T;for(;6>A.length;)A="0"+A;T=A+T}},n.i=function(E){return 0>E?0:E<this.g.length?this.g[E]:this.h};function I(E){if(E.h!=0)return!1;for(var y=0;y<E.g.length;y++)if(E.g[y]!=0)return!1;return!0}function S(E){return E.h==-1}n.l=function(E){return E=V(this,E),S(E)?-1:I(E)?0:1};function P(E){for(var y=E.g.length,w=[],T=0;T<y;T++)w[T]=~E.g[T];return new o(w,~E.h).add(m)}n.abs=function(){return S(this)?P(this):this},n.add=function(E){for(var y=Math.max(this.g.length,E.g.length),w=[],T=0,C=0;C<=y;C++){var A=T+(this.i(C)&65535)+(E.i(C)&65535),v=(A>>>16)+(this.i(C)>>>16)+(E.i(C)>>>16);T=v>>>16,A&=65535,v&=65535,w[C]=v<<16|A}return new o(w,w[w.length-1]&-2147483648?-1:0)};function V(E,y){return E.add(P(y))}n.j=function(E){if(I(this)||I(E))return f;if(S(this))return S(E)?P(this).j(P(E)):P(P(this).j(E));if(S(E))return P(this.j(P(E)));if(0>this.l(_)&&0>E.l(_))return c(this.m()*E.m());for(var y=this.g.length+E.g.length,w=[],T=0;T<2*y;T++)w[T]=0;for(T=0;T<this.g.length;T++)for(var C=0;C<E.g.length;C++){var A=this.i(T)>>>16,v=this.i(T)&65535,Mt=E.i(C)>>>16,Ln=E.i(C)&65535;w[2*T+2*C]+=v*Ln,U(w,2*T+2*C),w[2*T+2*C+1]+=A*Ln,U(w,2*T+2*C+1),w[2*T+2*C+1]+=v*Mt,U(w,2*T+2*C+1),w[2*T+2*C+2]+=A*Mt,U(w,2*T+2*C+2)}for(T=0;T<y;T++)w[T]=w[2*T+1]<<16|w[2*T];for(T=y;T<2*y;T++)w[T]=0;return new o(w,0)};function U(E,y){for(;(E[y]&65535)!=E[y];)E[y+1]+=E[y]>>>16,E[y]&=65535,y++}function L(E,y){this.g=E,this.h=y}function $(E,y){if(I(y))throw Error("division by zero");if(I(E))return new L(f,f);if(S(E))return y=$(P(E),y),new L(P(y.g),P(y.h));if(S(y))return y=$(E,P(y)),new L(P(y.g),y.h);if(30<E.g.length){if(S(E)||S(y))throw Error("slowDivide_ only works with positive integers.");for(var w=m,T=y;0>=T.l(E);)w=re(w),T=re(T);var C=X(w,1),A=X(T,1);for(T=X(T,2),w=X(w,2);!I(T);){var v=A.add(T);0>=v.l(E)&&(C=C.add(w),A=v),T=X(T,1),w=X(w,1)}return y=V(E,C.j(y)),new L(C,y)}for(C=f;0<=E.l(y);){for(w=Math.max(1,Math.floor(E.m()/y.m())),T=Math.ceil(Math.log(w)/Math.LN2),T=48>=T?1:Math.pow(2,T-48),A=c(w),v=A.j(y);S(v)||0<v.l(E);)w-=T,A=c(w),v=A.j(y);I(A)&&(A=m),C=C.add(A),E=V(E,v)}return new L(C,E)}n.A=function(E){return $(this,E).h},n.and=function(E){for(var y=Math.max(this.g.length,E.g.length),w=[],T=0;T<y;T++)w[T]=this.i(T)&E.i(T);return new o(w,this.h&E.h)},n.or=function(E){for(var y=Math.max(this.g.length,E.g.length),w=[],T=0;T<y;T++)w[T]=this.i(T)|E.i(T);return new o(w,this.h|E.h)},n.xor=function(E){for(var y=Math.max(this.g.length,E.g.length),w=[],T=0;T<y;T++)w[T]=this.i(T)^E.i(T);return new o(w,this.h^E.h)};function re(E){for(var y=E.g.length+1,w=[],T=0;T<y;T++)w[T]=E.i(T)<<1|E.i(T-1)>>>31;return new o(w,E.h)}function X(E,y){var w=y>>5;y%=32;for(var T=E.g.length-w,C=[],A=0;A<T;A++)C[A]=0<y?E.i(A+w)>>>y|E.i(A+w+1)<<32-y:E.i(A+w);return new o(C,E.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,Of=nT.Md5=r,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=c,o.fromString=d,rr=nT.Integer=o}).apply(typeof tT<"u"?tT:typeof self<"u"?self:typeof window<"u"?window:{});var hu=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},An={};var Vf,PN,ji,Lf,xo,du,Bf,Uf,qf;(function(){var n,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(l,h,p){return l==Array.prototype||l==Object.prototype||(l[h]=p.value),l};function t(l){l=[typeof globalThis=="object"&&globalThis,l,typeof window=="object"&&window,typeof self=="object"&&self,typeof hu=="object"&&hu];for(var h=0;h<l.length;++h){var p=l[h];if(p&&p.Math==Math)return p}throw Error("Cannot find global object")}var r=t(this);function i(l,h){if(h)e:{var p=r;l=l.split(".");for(var g=0;g<l.length-1;g++){var b=l[g];if(!(b in p))break e;p=p[b]}l=l[l.length-1],g=p[l],h=h(g),h!=g&&h!=null&&e(p,l,{configurable:!0,writable:!0,value:h})}}function s(l,h){l instanceof String&&(l+="");var p=0,g=!1,b={next:function(){if(!g&&p<l.length){var N=p++;return{value:h(N,l[N]),done:!1}}return g=!0,{done:!0,value:void 0}}};return b[Symbol.iterator]=function(){return b},b}i("Array.prototype.values",function(l){return l||function(){return s(this,function(h,p){return p})}});var o=o||{},a=this||self;function u(l){var h=typeof l;return h=h!="object"?h:l?Array.isArray(l)?"array":h:"null",h=="array"||h=="object"&&typeof l.length=="number"}function c(l){var h=typeof l;return h=="object"&&l!=null||h=="function"}function d(l,h,p){return l.call.apply(l.bind,arguments)}function f(l,h,p){if(!l)throw Error();if(2<arguments.length){var g=Array.prototype.slice.call(arguments,2);return function(){var b=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(b,g),l.apply(h,b)}}return function(){return l.apply(h,arguments)}}function m(l,h,p){return m=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?d:f,m.apply(null,arguments)}function _(l,h){var p=Array.prototype.slice.call(arguments,1);return function(){var g=p.slice();return g.push.apply(g,arguments),l.apply(this,g)}}function I(l,h){function p(){}p.prototype=h.prototype,l.aa=h.prototype,l.prototype=new p,l.prototype.constructor=l,l.Qb=function(g,b,N){for(var B=Array(arguments.length-2),Ee=2;Ee<arguments.length;Ee++)B[Ee-2]=arguments[Ee];return h.prototype[b].apply(g,B)}}function S(l){let h=l.length;if(0<h){let p=Array(h);for(let g=0;g<h;g++)p[g]=l[g];return p}return[]}function P(l,h){for(let p=1;p<arguments.length;p++){let g=arguments[p];if(u(g)){let b=l.length||0,N=g.length||0;l.length=b+N;for(let B=0;B<N;B++)l[b+B]=g[B]}else l.push(g)}}class V{constructor(h,p){this.i=h,this.j=p,this.h=0,this.g=null}get(){let h;return 0<this.h?(this.h--,h=this.g,this.g=h.next,h.next=null):h=this.i(),h}}function U(l){return/^[\s\xa0]*$/.test(l)}function L(){var l=a.navigator;return l&&(l=l.userAgent)?l:""}function $(l){return $[" "](l),l}$[" "]=function(){};var re=L().indexOf("Gecko")!=-1&&!(L().toLowerCase().indexOf("webkit")!=-1&&L().indexOf("Edge")==-1)&&!(L().indexOf("Trident")!=-1||L().indexOf("MSIE")!=-1)&&L().indexOf("Edge")==-1;function X(l,h,p){for(let g in l)h.call(p,l[g],g,l)}function E(l,h){for(let p in l)h.call(void 0,l[p],p,l)}function y(l){let h={};for(let p in l)h[p]=l[p];return h}let w="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function T(l,h){let p,g;for(let b=1;b<arguments.length;b++){g=arguments[b];for(p in g)l[p]=g[p];for(let N=0;N<w.length;N++)p=w[N],Object.prototype.hasOwnProperty.call(g,p)&&(l[p]=g[p])}}function C(l){var h=1;l=l.split(":");let p=[];for(;0<h&&l.length;)p.push(l.shift()),h--;return l.length&&p.push(l.join(":")),p}function A(l){a.setTimeout(()=>{throw l},0)}function v(){var l=ue;let h=null;return l.g&&(h=l.g,l.g=l.g.next,l.g||(l.h=null),h.next=null),h}class Mt{constructor(){this.h=this.g=null}add(h,p){let g=Ln.get();g.set(h,p),this.h?this.h.next=g:this.g=g,this.h=g}}var Ln=new V(()=>new W,l=>l.reset());class W{constructor(){this.next=this.g=this.h=null}set(h,p){this.h=h,this.g=p,this.next=null}reset(){this.next=this.g=this.h=null}}let H,J=!1,ue=new Mt,Ue=()=>{let l=a.Promise.resolve(void 0);H=()=>{l.then(Ft)}};var Ft=()=>{for(var l;l=v();){try{l.h.call(l.g)}catch(p){A(p)}var h=Ln;h.j(l),100>h.h&&(h.h++,l.next=h.g,h.g=l)}J=!1};function Oe(){this.s=this.s,this.C=this.C}Oe.prototype.s=!1,Oe.prototype.ma=function(){this.s||(this.s=!0,this.N())},Oe.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function Ae(l,h){this.type=l,this.g=this.target=h,this.defaultPrevented=!1}Ae.prototype.h=function(){this.defaultPrevented=!0};var Re=function(){if(!a.addEventListener||!Object.defineProperty)return!1;var l=!1,h=Object.defineProperty({},"passive",{get:function(){l=!0}});try{let p=()=>{};a.addEventListener("test",p,h),a.removeEventListener("test",p,h)}catch{}return l}();function Bn(l,h){if(Ae.call(this,l?l.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,l){var p=this.type=l.type,g=l.changedTouches&&l.changedTouches.length?l.changedTouches[0]:null;if(this.target=l.target||l.srcElement,this.g=h,h=l.relatedTarget){if(re){e:{try{$(h.nodeName);var b=!0;break e}catch{}b=!1}b||(h=null)}}else p=="mouseover"?h=l.fromElement:p=="mouseout"&&(h=l.toElement);this.relatedTarget=h,g?(this.clientX=g.clientX!==void 0?g.clientX:g.pageX,this.clientY=g.clientY!==void 0?g.clientY:g.pageY,this.screenX=g.screenX||0,this.screenY=g.screenY||0):(this.clientX=l.clientX!==void 0?l.clientX:l.pageX,this.clientY=l.clientY!==void 0?l.clientY:l.pageY,this.screenX=l.screenX||0,this.screenY=l.screenY||0),this.button=l.button,this.key=l.key||"",this.ctrlKey=l.ctrlKey,this.altKey=l.altKey,this.shiftKey=l.shiftKey,this.metaKey=l.metaKey,this.pointerId=l.pointerId||0,this.pointerType=typeof l.pointerType=="string"?l.pointerType:rh[l.pointerType]||"",this.state=l.state,this.i=l,l.defaultPrevented&&Bn.aa.h.call(this)}}I(Bn,Ae);var rh={2:"touch",3:"pen",4:"mouse"};Bn.prototype.h=function(){Bn.aa.h.call(this);var l=this.i;l.preventDefault?l.preventDefault():l.returnValue=!1};var Ve="closure_listenable_"+(1e6*Math.random()|0),In=0;function It(l,h,p,g,b){this.listener=l,this.proxy=null,this.src=h,this.type=p,this.capture=!!g,this.ha=b,this.key=++In,this.da=this.fa=!1}function En(l){l.da=!0,l.listener=null,l.proxy=null,l.src=null,l.ha=null}function Un(l){this.src=l,this.g={},this.h=0}Un.prototype.add=function(l,h,p,g,b){var N=l.toString();l=this.g[N],l||(l=this.g[N]=[],this.h++);var B=sh(l,h,g,b);return-1<B?(h=l[B],p||(h.fa=!1)):(h=new It(h,this.src,N,!!g,b),h.fa=p,l.push(h)),h};function ih(l,h){var p=h.type;if(p in l.g){var g=l.g[p],b=Array.prototype.indexOf.call(g,h,void 0),N;(N=0<=b)&&Array.prototype.splice.call(g,b,1),N&&(En(h),l.g[p].length==0&&(delete l.g[p],l.h--))}}function sh(l,h,p,g){for(var b=0;b<l.length;++b){var N=l[b];if(!N.da&&N.listener==h&&N.capture==!!p&&N.ha==g)return b}return-1}var oh="closure_lm_"+(1e6*Math.random()|0),ah={};function w_(l,h,p,g,b){if(g&&g.once)return E_(l,h,p,g,b);if(Array.isArray(h)){for(var N=0;N<h.length;N++)w_(l,h[N],p,g,b);return null}return p=hh(p),l&&l[Ve]?l.K(h,p,c(g)?!!g.capture:!!g,b):I_(l,h,p,!1,g,b)}function I_(l,h,p,g,b,N){if(!h)throw Error("Invalid event type");var B=c(b)?!!b.capture:!!b,Ee=uh(l);if(Ee||(l[oh]=Ee=new Un(l)),p=Ee.add(h,p,g,B,N),p.proxy)return p;if(g=Qb(),p.proxy=g,g.src=l,g.listener=p,l.addEventListener)Re||(b=B),b===void 0&&(b=!1),l.addEventListener(h.toString(),g,b);else if(l.attachEvent)l.attachEvent(C_(h.toString()),g);else if(l.addListener&&l.removeListener)l.addListener(g);else throw Error("addEventListener and attachEvent are unavailable.");return p}function Qb(){function l(p){return h.call(l.src,l.listener,p)}let h=$b;return l}function E_(l,h,p,g,b){if(Array.isArray(h)){for(var N=0;N<h.length;N++)E_(l,h[N],p,g,b);return null}return p=hh(p),l&&l[Ve]?l.L(h,p,c(g)?!!g.capture:!!g,b):I_(l,h,p,!0,g,b)}function T_(l,h,p,g,b){if(Array.isArray(h))for(var N=0;N<h.length;N++)T_(l,h[N],p,g,b);else g=c(g)?!!g.capture:!!g,p=hh(p),l&&l[Ve]?(l=l.i,h=String(h).toString(),h in l.g&&(N=l.g[h],p=sh(N,p,g,b),-1<p&&(En(N[p]),Array.prototype.splice.call(N,p,1),N.length==0&&(delete l.g[h],l.h--)))):l&&(l=uh(l))&&(h=l.g[h.toString()],l=-1,h&&(l=sh(h,p,g,b)),(p=-1<l?h[l]:null)&&lh(p))}function lh(l){if(typeof l!="number"&&l&&!l.da){var h=l.src;if(h&&h[Ve])ih(h.i,l);else{var p=l.type,g=l.proxy;h.removeEventListener?h.removeEventListener(p,g,l.capture):h.detachEvent?h.detachEvent(C_(p),g):h.addListener&&h.removeListener&&h.removeListener(g),(p=uh(h))?(ih(p,l),p.h==0&&(p.src=null,h[oh]=null)):En(l)}}}function C_(l){return l in ah?ah[l]:ah[l]="on"+l}function $b(l,h){if(l.da)l=!0;else{h=new Bn(h,this);var p=l.listener,g=l.ha||l.src;l.fa&&lh(l),l=p.call(g,h)}return l}function uh(l){return l=l[oh],l instanceof Un?l:null}var ch="__closure_events_fn_"+(1e9*Math.random()>>>0);function hh(l){return typeof l=="function"?l:(l[ch]||(l[ch]=function(h){return l.handleEvent(h)}),l[ch])}function ot(){Oe.call(this),this.i=new Un(this),this.M=this,this.F=null}I(ot,Oe),ot.prototype[Ve]=!0,ot.prototype.removeEventListener=function(l,h,p,g){T_(this,l,h,p,g)};function dt(l,h){var p,g=l.F;if(g)for(p=[];g;g=g.F)p.push(g);if(l=l.M,g=h.type||h,typeof h=="string")h=new Ae(h,l);else if(h instanceof Ae)h.target=h.target||l;else{var b=h;h=new Ae(g,l),T(h,b)}if(b=!0,p)for(var N=p.length-1;0<=N;N--){var B=h.g=p[N];b=Sa(B,g,!0,h)&&b}if(B=h.g=l,b=Sa(B,g,!0,h)&&b,b=Sa(B,g,!1,h)&&b,p)for(N=0;N<p.length;N++)B=h.g=p[N],b=Sa(B,g,!1,h)&&b}ot.prototype.N=function(){if(ot.aa.N.call(this),this.i){var l=this.i,h;for(h in l.g){for(var p=l.g[h],g=0;g<p.length;g++)En(p[g]);delete l.g[h],l.h--}}this.F=null},ot.prototype.K=function(l,h,p,g){return this.i.add(String(l),h,!1,p,g)},ot.prototype.L=function(l,h,p,g){return this.i.add(String(l),h,!0,p,g)};function Sa(l,h,p,g){if(h=l.i.g[String(h)],!h)return!0;h=h.concat();for(var b=!0,N=0;N<h.length;++N){var B=h[N];if(B&&!B.da&&B.capture==p){var Ee=B.listener,rt=B.ha||B.src;B.fa&&ih(l.i,B),b=Ee.call(rt,g)!==!1&&b}}return b&&!g.defaultPrevented}function S_(l,h,p){if(typeof l=="function")p&&(l=m(l,p));else if(l&&typeof l.handleEvent=="function")l=m(l.handleEvent,l);else throw Error("Invalid listener argument");return 2147483647<Number(h)?-1:a.setTimeout(l,h||0)}function b_(l){l.g=S_(()=>{l.g=null,l.i&&(l.i=!1,b_(l))},l.l);let h=l.h;l.h=null,l.m.apply(null,h)}class Hb extends Oe{constructor(h,p){super(),this.m=h,this.l=p,this.h=null,this.i=!1,this.g=null}j(h){this.h=arguments,this.g?this.i=!0:b_(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Ds(l){Oe.call(this),this.h=l,this.g={}}I(Ds,Oe);var A_=[];function R_(l){X(l.g,function(h,p){this.g.hasOwnProperty(p)&&lh(h)},l),l.g={}}Ds.prototype.N=function(){Ds.aa.N.call(this),R_(this)},Ds.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var dh=a.JSON.stringify,Yb=a.JSON.parse,Jb=class{stringify(l){return a.JSON.stringify(l,void 0)}parse(l){return a.JSON.parse(l,void 0)}};function fh(){}fh.prototype.h=null;function P_(l){return l.h||(l.h=l.i())}function N_(){}var xs={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function ph(){Ae.call(this,"d")}I(ph,Ae);function mh(){Ae.call(this,"c")}I(mh,Ae);var Cr={},D_=null;function ba(){return D_=D_||new ot}Cr.La="serverreachability";function x_(l){Ae.call(this,Cr.La,l)}I(x_,Ae);function ks(l){let h=ba();dt(h,new x_(h))}Cr.STAT_EVENT="statevent";function k_(l,h){Ae.call(this,Cr.STAT_EVENT,l),this.stat=h}I(k_,Ae);function ft(l){let h=ba();dt(h,new k_(h,l))}Cr.Ma="timingevent";function M_(l,h){Ae.call(this,Cr.Ma,l),this.size=h}I(M_,Ae);function Ms(l,h){if(typeof l!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){l()},h)}function Fs(){this.g=!0}Fs.prototype.xa=function(){this.g=!1};function Xb(l,h,p,g,b,N){l.info(function(){if(l.g)if(N)for(var B="",Ee=N.split("&"),rt=0;rt<Ee.length;rt++){var ye=Ee[rt].split("=");if(1<ye.length){var at=ye[0];ye=ye[1];var lt=at.split("_");B=2<=lt.length&&lt[1]=="type"?B+(at+"="+ye+"&"):B+(at+"=redacted&")}}else B=null;else B=N;return"XMLHTTP REQ ("+g+") [attempt "+b+"]: "+h+`
`+p+`
`+B})}function Zb(l,h,p,g,b,N,B){l.info(function(){return"XMLHTTP RESP ("+g+") [ attempt "+b+"]: "+h+`
`+p+`
`+N+" "+B})}function gi(l,h,p,g){l.info(function(){return"XMLHTTP TEXT ("+h+"): "+tA(l,p)+(g?" "+g:"")})}function eA(l,h){l.info(function(){return"TIMEOUT: "+h})}Fs.prototype.info=function(){};function tA(l,h){if(!l.g)return h;if(!h)return null;try{var p=JSON.parse(h);if(p){for(l=0;l<p.length;l++)if(Array.isArray(p[l])){var g=p[l];if(!(2>g.length)){var b=g[1];if(Array.isArray(b)&&!(1>b.length)){var N=b[0];if(N!="noop"&&N!="stop"&&N!="close")for(var B=1;B<b.length;B++)b[B]=""}}}}return dh(p)}catch{return h}}var Aa={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},F_={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},gh;function Ra(){}I(Ra,fh),Ra.prototype.g=function(){return new XMLHttpRequest},Ra.prototype.i=function(){return{}},gh=new Ra;function qn(l,h,p,g){this.j=l,this.i=h,this.l=p,this.R=g||1,this.U=new Ds(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new O_}function O_(){this.i=null,this.g="",this.h=!1}var V_={},_h={};function yh(l,h,p){l.L=1,l.v=xa(Tn(h)),l.m=p,l.P=!0,L_(l,null)}function L_(l,h){l.F=Date.now(),Pa(l),l.A=Tn(l.v);var p=l.A,g=l.R;Array.isArray(g)||(g=[String(g)]),X_(p.i,"t",g),l.C=0,p=l.j.J,l.h=new O_,l.g=gy(l.j,p?h:null,!l.m),0<l.O&&(l.M=new Hb(m(l.Y,l,l.g),l.O)),h=l.U,p=l.g,g=l.ca;var b="readystatechange";Array.isArray(b)||(b&&(A_[0]=b.toString()),b=A_);for(var N=0;N<b.length;N++){var B=w_(p,b[N],g||h.handleEvent,!1,h.h||h);if(!B)break;h.g[B.key]=B}h=l.H?y(l.H):{},l.m?(l.u||(l.u="POST"),h["Content-Type"]="application/x-www-form-urlencoded",l.g.ea(l.A,l.u,l.m,h)):(l.u="GET",l.g.ea(l.A,l.u,null,h)),ks(),Xb(l.i,l.u,l.A,l.l,l.R,l.m)}qn.prototype.ca=function(l){l=l.target;let h=this.M;h&&Cn(l)==3?h.j():this.Y(l)},qn.prototype.Y=function(l){try{if(l==this.g)e:{let lt=Cn(this.g);var h=this.g.Ba();let vi=this.g.Z();if(!(3>lt)&&(lt!=3||this.g&&(this.h.h||this.g.oa()||sy(this.g)))){this.J||lt!=4||h==7||(h==8||0>=vi?ks(3):ks(2)),vh(this);var p=this.g.Z();this.X=p;t:if(B_(this)){var g=sy(this.g);l="";var b=g.length,N=Cn(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Sr(this),Os(this);var B="";break t}this.h.i=new a.TextDecoder}for(h=0;h<b;h++)this.h.h=!0,l+=this.h.i.decode(g[h],{stream:!(N&&h==b-1)});g.length=0,this.h.g+=l,this.C=0,B=this.h.g}else B=this.g.oa();if(this.o=p==200,Zb(this.i,this.u,this.A,this.l,this.R,lt,p),this.o){if(this.T&&!this.K){t:{if(this.g){var Ee,rt=this.g;if((Ee=rt.g?rt.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!U(Ee)){var ye=Ee;break t}}ye=null}if(p=ye)gi(this.i,this.l,p,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,wh(this,p);else{this.o=!1,this.s=3,ft(12),Sr(this),Os(this);break e}}if(this.P){p=!0;let Gt;for(;!this.J&&this.C<B.length;)if(Gt=nA(this,B),Gt==_h){lt==4&&(this.s=4,ft(14),p=!1),gi(this.i,this.l,null,"[Incomplete Response]");break}else if(Gt==V_){this.s=4,ft(15),gi(this.i,this.l,B,"[Invalid Chunk]"),p=!1;break}else gi(this.i,this.l,Gt,null),wh(this,Gt);if(B_(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),lt!=4||B.length!=0||this.h.h||(this.s=1,ft(16),p=!1),this.o=this.o&&p,!p)gi(this.i,this.l,B,"[Invalid Chunked Response]"),Sr(this),Os(this);else if(0<B.length&&!this.W){this.W=!0;var at=this.j;at.g==this&&at.ba&&!at.M&&(at.j.info("Great, no buffering proxy detected. Bytes received: "+B.length),bh(at),at.M=!0,ft(11))}}else gi(this.i,this.l,B,null),wh(this,B);lt==4&&Sr(this),this.o&&!this.J&&(lt==4?dy(this.j,this):(this.o=!1,Pa(this)))}else vA(this.g),p==400&&0<B.indexOf("Unknown SID")?(this.s=3,ft(12)):(this.s=0,ft(13)),Sr(this),Os(this)}}}catch{}finally{}};function B_(l){return l.g?l.u=="GET"&&l.L!=2&&l.j.Ca:!1}function nA(l,h){var p=l.C,g=h.indexOf(`
`,p);return g==-1?_h:(p=Number(h.substring(p,g)),isNaN(p)?V_:(g+=1,g+p>h.length?_h:(h=h.slice(g,g+p),l.C=g+p,h)))}qn.prototype.cancel=function(){this.J=!0,Sr(this)};function Pa(l){l.S=Date.now()+l.I,U_(l,l.I)}function U_(l,h){if(l.B!=null)throw Error("WatchDog timer not null");l.B=Ms(m(l.ba,l),h)}function vh(l){l.B&&(a.clearTimeout(l.B),l.B=null)}qn.prototype.ba=function(){this.B=null;let l=Date.now();0<=l-this.S?(eA(this.i,this.A),this.L!=2&&(ks(),ft(17)),Sr(this),this.s=2,Os(this)):U_(this,this.S-l)};function Os(l){l.j.G==0||l.J||dy(l.j,l)}function Sr(l){vh(l);var h=l.M;h&&typeof h.ma=="function"&&h.ma(),l.M=null,R_(l.U),l.g&&(h=l.g,l.g=null,h.abort(),h.ma())}function wh(l,h){try{var p=l.j;if(p.G!=0&&(p.g==l||Ih(p.h,l))){if(!l.K&&Ih(p.h,l)&&p.G==3){try{var g=p.Da.g.parse(h)}catch{g=null}if(Array.isArray(g)&&g.length==3){var b=g;if(b[0]==0){e:if(!p.u){if(p.g)if(p.g.F+3e3<l.F)Va(p),Fa(p);else break e;Sh(p),ft(18)}}else p.za=b[1],0<p.za-p.T&&37500>b[2]&&p.F&&p.v==0&&!p.C&&(p.C=Ms(m(p.Za,p),6e3));if(1>=z_(p.h)&&p.ca){try{p.ca()}catch{}p.ca=void 0}}else Ar(p,11)}else if((l.K||p.g==l)&&Va(p),!U(h))for(b=p.Da.g.parse(h),h=0;h<b.length;h++){let ye=b[h];if(p.T=ye[0],ye=ye[1],p.G==2)if(ye[0]=="c"){p.K=ye[1],p.ia=ye[2];let at=ye[3];at!=null&&(p.la=at,p.j.info("VER="+p.la));let lt=ye[4];lt!=null&&(p.Aa=lt,p.j.info("SVER="+p.Aa));let vi=ye[5];vi!=null&&typeof vi=="number"&&0<vi&&(g=1.5*vi,p.L=g,p.j.info("backChannelRequestTimeoutMs_="+g)),g=p;let Gt=l.g;if(Gt){let Ba=Gt.g?Gt.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Ba){var N=g.h;N.g||Ba.indexOf("spdy")==-1&&Ba.indexOf("quic")==-1&&Ba.indexOf("h2")==-1||(N.j=N.l,N.g=new Set,N.h&&(Eh(N,N.h),N.h=null))}if(g.D){let Ah=Gt.g?Gt.g.getResponseHeader("X-HTTP-Session-Id"):null;Ah&&(g.ya=Ah,Pe(g.I,g.D,Ah))}}p.G=3,p.l&&p.l.ua(),p.ba&&(p.R=Date.now()-l.F,p.j.info("Handshake RTT: "+p.R+"ms")),g=p;var B=l;if(g.qa=my(g,g.J?g.ia:null,g.W),B.K){K_(g.h,B);var Ee=B,rt=g.L;rt&&(Ee.I=rt),Ee.B&&(vh(Ee),Pa(Ee)),g.g=B}else cy(g);0<p.i.length&&Oa(p)}else ye[0]!="stop"&&ye[0]!="close"||Ar(p,7);else p.G==3&&(ye[0]=="stop"||ye[0]=="close"?ye[0]=="stop"?Ar(p,7):Ch(p):ye[0]!="noop"&&p.l&&p.l.ta(ye),p.v=0)}}ks(4)}catch{}}var rA=class{constructor(l,h){this.g=l,this.map=h}};function q_(l){this.l=l||10,a.PerformanceNavigationTiming?(l=a.performance.getEntriesByType("navigation"),l=0<l.length&&(l[0].nextHopProtocol=="hq"||l[0].nextHopProtocol=="h2")):l=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=l?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function j_(l){return l.h?!0:l.g?l.g.size>=l.j:!1}function z_(l){return l.h?1:l.g?l.g.size:0}function Ih(l,h){return l.h?l.h==h:l.g?l.g.has(h):!1}function Eh(l,h){l.g?l.g.add(h):l.h=h}function K_(l,h){l.h&&l.h==h?l.h=null:l.g&&l.g.has(h)&&l.g.delete(h)}q_.prototype.cancel=function(){if(this.i=G_(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let l of this.g.values())l.cancel();this.g.clear()}};function G_(l){if(l.h!=null)return l.i.concat(l.h.D);if(l.g!=null&&l.g.size!==0){let h=l.i;for(let p of l.g.values())h=h.concat(p.D);return h}return S(l.i)}function iA(l){if(l.V&&typeof l.V=="function")return l.V();if(typeof Map<"u"&&l instanceof Map||typeof Set<"u"&&l instanceof Set)return Array.from(l.values());if(typeof l=="string")return l.split("");if(u(l)){for(var h=[],p=l.length,g=0;g<p;g++)h.push(l[g]);return h}h=[],p=0;for(g in l)h[p++]=l[g];return h}function sA(l){if(l.na&&typeof l.na=="function")return l.na();if(!l.V||typeof l.V!="function"){if(typeof Map<"u"&&l instanceof Map)return Array.from(l.keys());if(!(typeof Set<"u"&&l instanceof Set)){if(u(l)||typeof l=="string"){var h=[];l=l.length;for(var p=0;p<l;p++)h.push(p);return h}h=[],p=0;for(let g in l)h[p++]=g;return h}}}function W_(l,h){if(l.forEach&&typeof l.forEach=="function")l.forEach(h,void 0);else if(u(l)||typeof l=="string")Array.prototype.forEach.call(l,h,void 0);else for(var p=sA(l),g=iA(l),b=g.length,N=0;N<b;N++)h.call(void 0,g[N],p&&p[N],l)}var Q_=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function oA(l,h){if(l){l=l.split("&");for(var p=0;p<l.length;p++){var g=l[p].indexOf("="),b=null;if(0<=g){var N=l[p].substring(0,g);b=l[p].substring(g+1)}else N=l[p];h(N,b?decodeURIComponent(b.replace(/\+/g," ")):"")}}}function br(l){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,l instanceof br){this.h=l.h,Na(this,l.j),this.o=l.o,this.g=l.g,Da(this,l.s),this.l=l.l;var h=l.i,p=new Bs;p.i=h.i,h.g&&(p.g=new Map(h.g),p.h=h.h),$_(this,p),this.m=l.m}else l&&(h=String(l).match(Q_))?(this.h=!1,Na(this,h[1]||"",!0),this.o=Vs(h[2]||""),this.g=Vs(h[3]||"",!0),Da(this,h[4]),this.l=Vs(h[5]||"",!0),$_(this,h[6]||"",!0),this.m=Vs(h[7]||"")):(this.h=!1,this.i=new Bs(null,this.h))}br.prototype.toString=function(){var l=[],h=this.j;h&&l.push(Ls(h,H_,!0),":");var p=this.g;return(p||h=="file")&&(l.push("//"),(h=this.o)&&l.push(Ls(h,H_,!0),"@"),l.push(encodeURIComponent(String(p)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),p=this.s,p!=null&&l.push(":",String(p))),(p=this.l)&&(this.g&&p.charAt(0)!="/"&&l.push("/"),l.push(Ls(p,p.charAt(0)=="/"?uA:lA,!0))),(p=this.i.toString())&&l.push("?",p),(p=this.m)&&l.push("#",Ls(p,hA)),l.join("")};function Tn(l){return new br(l)}function Na(l,h,p){l.j=p?Vs(h,!0):h,l.j&&(l.j=l.j.replace(/:$/,""))}function Da(l,h){if(h){if(h=Number(h),isNaN(h)||0>h)throw Error("Bad port number "+h);l.s=h}else l.s=null}function $_(l,h,p){h instanceof Bs?(l.i=h,dA(l.i,l.h)):(p||(h=Ls(h,cA)),l.i=new Bs(h,l.h))}function Pe(l,h,p){l.i.set(h,p)}function xa(l){return Pe(l,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),l}function Vs(l,h){return l?h?decodeURI(l.replace(/%25/g,"%2525")):decodeURIComponent(l):""}function Ls(l,h,p){return typeof l=="string"?(l=encodeURI(l).replace(h,aA),p&&(l=l.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),l):null}function aA(l){return l=l.charCodeAt(0),"%"+(l>>4&15).toString(16)+(l&15).toString(16)}var H_=/[#\/\?@]/g,lA=/[#\?:]/g,uA=/[#\?]/g,cA=/[#\?@]/g,hA=/#/g;function Bs(l,h){this.h=this.g=null,this.i=l||null,this.j=!!h}function jn(l){l.g||(l.g=new Map,l.h=0,l.i&&oA(l.i,function(h,p){l.add(decodeURIComponent(h.replace(/\+/g," ")),p)}))}n=Bs.prototype,n.add=function(l,h){jn(this),this.i=null,l=_i(this,l);var p=this.g.get(l);return p||this.g.set(l,p=[]),p.push(h),this.h+=1,this};function Y_(l,h){jn(l),h=_i(l,h),l.g.has(h)&&(l.i=null,l.h-=l.g.get(h).length,l.g.delete(h))}function J_(l,h){return jn(l),h=_i(l,h),l.g.has(h)}n.forEach=function(l,h){jn(this),this.g.forEach(function(p,g){p.forEach(function(b){l.call(h,b,g,this)},this)},this)},n.na=function(){jn(this);let l=Array.from(this.g.values()),h=Array.from(this.g.keys()),p=[];for(let g=0;g<h.length;g++){let b=l[g];for(let N=0;N<b.length;N++)p.push(h[g])}return p},n.V=function(l){jn(this);let h=[];if(typeof l=="string")J_(this,l)&&(h=h.concat(this.g.get(_i(this,l))));else{l=Array.from(this.g.values());for(let p=0;p<l.length;p++)h=h.concat(l[p])}return h},n.set=function(l,h){return jn(this),this.i=null,l=_i(this,l),J_(this,l)&&(this.h-=this.g.get(l).length),this.g.set(l,[h]),this.h+=1,this},n.get=function(l,h){return l?(l=this.V(l),0<l.length?String(l[0]):h):h};function X_(l,h,p){Y_(l,h),0<p.length&&(l.i=null,l.g.set(_i(l,h),S(p)),l.h+=p.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";let l=[],h=Array.from(this.g.keys());for(var p=0;p<h.length;p++){var g=h[p];let N=encodeURIComponent(String(g)),B=this.V(g);for(g=0;g<B.length;g++){var b=N;B[g]!==""&&(b+="="+encodeURIComponent(String(B[g]))),l.push(b)}}return this.i=l.join("&")};function _i(l,h){return h=String(h),l.j&&(h=h.toLowerCase()),h}function dA(l,h){h&&!l.j&&(jn(l),l.i=null,l.g.forEach(function(p,g){var b=g.toLowerCase();g!=b&&(Y_(this,g),X_(this,b,p))},l)),l.j=h}function fA(l,h){let p=new Fs;if(a.Image){let g=new Image;g.onload=_(zn,p,"TestLoadImage: loaded",!0,h,g),g.onerror=_(zn,p,"TestLoadImage: error",!1,h,g),g.onabort=_(zn,p,"TestLoadImage: abort",!1,h,g),g.ontimeout=_(zn,p,"TestLoadImage: timeout",!1,h,g),a.setTimeout(function(){g.ontimeout&&g.ontimeout()},1e4),g.src=l}else h(!1)}function pA(l,h){let p=new Fs,g=new AbortController,b=setTimeout(()=>{g.abort(),zn(p,"TestPingServer: timeout",!1,h)},1e4);fetch(l,{signal:g.signal}).then(N=>{clearTimeout(b),N.ok?zn(p,"TestPingServer: ok",!0,h):zn(p,"TestPingServer: server error",!1,h)}).catch(()=>{clearTimeout(b),zn(p,"TestPingServer: error",!1,h)})}function zn(l,h,p,g,b){try{b&&(b.onload=null,b.onerror=null,b.onabort=null,b.ontimeout=null),g(p)}catch{}}function mA(){this.g=new Jb}function gA(l,h,p){let g=p||"";try{W_(l,function(b,N){let B=b;c(b)&&(B=dh(b)),h.push(g+N+"="+encodeURIComponent(B))})}catch(b){throw h.push(g+"type="+encodeURIComponent("_badmap")),b}}function Us(l){this.l=l.Ub||null,this.j=l.eb||!1}I(Us,fh),Us.prototype.g=function(){return new ka(this.l,this.j)},Us.prototype.i=function(l){return function(){return l}}({});function ka(l,h){ot.call(this),this.D=l,this.o=h,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}I(ka,ot),n=ka.prototype,n.open=function(l,h){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=l,this.A=h,this.readyState=1,js(this)},n.send=function(l){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;let h={headers:this.u,method:this.B,credentials:this.m,cache:void 0};l&&(h.body=l),(this.D||a).fetch(new Request(this.A,h)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,qs(this)),this.readyState=0},n.Sa=function(l){if(this.g&&(this.l=l,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=l.headers,this.readyState=2,js(this)),this.g&&(this.readyState=3,js(this),this.g)))if(this.responseType==="arraybuffer")l.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in l){if(this.j=l.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Z_(this)}else l.text().then(this.Ra.bind(this),this.ga.bind(this))};function Z_(l){l.j.read().then(l.Pa.bind(l)).catch(l.ga.bind(l))}n.Pa=function(l){if(this.g){if(this.o&&l.value)this.response.push(l.value);else if(!this.o){var h=l.value?l.value:new Uint8Array(0);(h=this.v.decode(h,{stream:!l.done}))&&(this.response=this.responseText+=h)}l.done?qs(this):js(this),this.readyState==3&&Z_(this)}},n.Ra=function(l){this.g&&(this.response=this.responseText=l,qs(this))},n.Qa=function(l){this.g&&(this.response=l,qs(this))},n.ga=function(){this.g&&qs(this)};function qs(l){l.readyState=4,l.l=null,l.j=null,l.v=null,js(l)}n.setRequestHeader=function(l,h){this.u.append(l,h)},n.getResponseHeader=function(l){return this.h&&this.h.get(l.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";let l=[],h=this.h.entries();for(var p=h.next();!p.done;)p=p.value,l.push(p[0]+": "+p[1]),p=h.next();return l.join(`\r
`)};function js(l){l.onreadystatechange&&l.onreadystatechange.call(l)}Object.defineProperty(ka.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(l){this.m=l?"include":"same-origin"}});function ey(l){let h="";return X(l,function(p,g){h+=g,h+=":",h+=p,h+=`\r
`}),h}function Th(l,h,p){e:{for(g in p){var g=!1;break e}g=!0}g||(p=ey(p),typeof l=="string"?p!=null&&encodeURIComponent(String(p)):Pe(l,h,p))}function Le(l){ot.call(this),this.headers=new Map,this.o=l||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}I(Le,ot);var _A=/^https?$/i,yA=["POST","PUT"];n=Le.prototype,n.Ha=function(l){this.J=l},n.ea=function(l,h,p,g){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+l);h=h?h.toUpperCase():"GET",this.D=l,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():gh.g(),this.v=this.o?P_(this.o):P_(gh),this.g.onreadystatechange=m(this.Ea,this);try{this.B=!0,this.g.open(h,String(l),!0),this.B=!1}catch(N){ty(this,N);return}if(l=p||"",p=new Map(this.headers),g)if(Object.getPrototypeOf(g)===Object.prototype)for(var b in g)p.set(b,g[b]);else if(typeof g.keys=="function"&&typeof g.get=="function")for(let N of g.keys())p.set(N,g.get(N));else throw Error("Unknown input type for opt_headers: "+String(g));g=Array.from(p.keys()).find(N=>N.toLowerCase()=="content-type"),b=a.FormData&&l instanceof a.FormData,!(0<=Array.prototype.indexOf.call(yA,h,void 0))||g||b||p.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(let[N,B]of p)this.g.setRequestHeader(N,B);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{iy(this),this.u=!0,this.g.send(l),this.u=!1}catch(N){ty(this,N)}};function ty(l,h){l.h=!1,l.g&&(l.j=!0,l.g.abort(),l.j=!1),l.l=h,l.m=5,ny(l),Ma(l)}function ny(l){l.A||(l.A=!0,dt(l,"complete"),dt(l,"error"))}n.abort=function(l){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=l||7,dt(this,"complete"),dt(this,"abort"),Ma(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Ma(this,!0)),Le.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?ry(this):this.bb())},n.bb=function(){ry(this)};function ry(l){if(l.h&&typeof o<"u"&&(!l.v[1]||Cn(l)!=4||l.Z()!=2)){if(l.u&&Cn(l)==4)S_(l.Ea,0,l);else if(dt(l,"readystatechange"),Cn(l)==4){l.h=!1;try{let B=l.Z();e:switch(B){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var h=!0;break e;default:h=!1}var p;if(!(p=h)){var g;if(g=B===0){var b=String(l.D).match(Q_)[1]||null;!b&&a.self&&a.self.location&&(b=a.self.location.protocol.slice(0,-1)),g=!_A.test(b?b.toLowerCase():"")}p=g}if(p)dt(l,"complete"),dt(l,"success");else{l.m=6;try{var N=2<Cn(l)?l.g.statusText:""}catch{N=""}l.l=N+" ["+l.Z()+"]",ny(l)}}finally{Ma(l)}}}}function Ma(l,h){if(l.g){iy(l);let p=l.g,g=l.v[0]?()=>{}:null;l.g=null,l.v=null,h||dt(l,"ready");try{p.onreadystatechange=g}catch{}}}function iy(l){l.I&&(a.clearTimeout(l.I),l.I=null)}n.isActive=function(){return!!this.g};function Cn(l){return l.g?l.g.readyState:0}n.Z=function(){try{return 2<Cn(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(l){if(this.g){var h=this.g.responseText;return l&&h.indexOf(l)==0&&(h=h.substring(l.length)),Yb(h)}};function sy(l){try{if(!l.g)return null;if("response"in l.g)return l.g.response;switch(l.H){case"":case"text":return l.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in l.g)return l.g.mozResponseArrayBuffer}return null}catch{return null}}function vA(l){let h={};l=(l.g&&2<=Cn(l)&&l.g.getAllResponseHeaders()||"").split(`\r
`);for(let g=0;g<l.length;g++){if(U(l[g]))continue;var p=C(l[g]);let b=p[0];if(p=p[1],typeof p!="string")continue;p=p.trim();let N=h[b]||[];h[b]=N,N.push(p)}E(h,function(g){return g.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function zs(l,h,p){return p&&p.internalChannelParams&&p.internalChannelParams[l]||h}function oy(l){this.Aa=0,this.i=[],this.j=new Fs,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=zs("failFast",!1,l),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=zs("baseRetryDelayMs",5e3,l),this.cb=zs("retryDelaySeedMs",1e4,l),this.Wa=zs("forwardChannelMaxRetries",2,l),this.wa=zs("forwardChannelRequestTimeoutMs",2e4,l),this.pa=l&&l.xmlHttpFactory||void 0,this.Xa=l&&l.Tb||void 0,this.Ca=l&&l.useFetchStreams||!1,this.L=void 0,this.J=l&&l.supportsCrossDomainXhr||!1,this.K="",this.h=new q_(l&&l.concurrentRequestLimit),this.Da=new mA,this.P=l&&l.fastHandshake||!1,this.O=l&&l.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=l&&l.Rb||!1,l&&l.xa&&this.j.xa(),l&&l.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&l&&l.detectBufferingProxy||!1,this.ja=void 0,l&&l.longPollingTimeout&&0<l.longPollingTimeout&&(this.ja=l.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=oy.prototype,n.la=8,n.G=1,n.connect=function(l,h,p,g){ft(0),this.W=l,this.H=h||{},p&&g!==void 0&&(this.H.OSID=p,this.H.OAID=g),this.F=this.X,this.I=my(this,null,this.W),Oa(this)};function Ch(l){if(ay(l),l.G==3){var h=l.U++,p=Tn(l.I);if(Pe(p,"SID",l.K),Pe(p,"RID",h),Pe(p,"TYPE","terminate"),Ks(l,p),h=new qn(l,l.j,h),h.L=2,h.v=xa(Tn(p)),p=!1,a.navigator&&a.navigator.sendBeacon)try{p=a.navigator.sendBeacon(h.v.toString(),"")}catch{}!p&&a.Image&&(new Image().src=h.v,p=!0),p||(h.g=gy(h.j,null),h.g.ea(h.v)),h.F=Date.now(),Pa(h)}py(l)}function Fa(l){l.g&&(bh(l),l.g.cancel(),l.g=null)}function ay(l){Fa(l),l.u&&(a.clearTimeout(l.u),l.u=null),Va(l),l.h.cancel(),l.s&&(typeof l.s=="number"&&a.clearTimeout(l.s),l.s=null)}function Oa(l){if(!j_(l.h)&&!l.s){l.s=!0;var h=l.Ga;H||Ue(),J||(H(),J=!0),ue.add(h,l),l.B=0}}function wA(l,h){return z_(l.h)>=l.h.j-(l.s?1:0)?!1:l.s?(l.i=h.D.concat(l.i),!0):l.G==1||l.G==2||l.B>=(l.Va?0:l.Wa)?!1:(l.s=Ms(m(l.Ga,l,h),fy(l,l.B)),l.B++,!0)}n.Ga=function(l){if(this.s)if(this.s=null,this.G==1){if(!l){this.U=Math.floor(1e5*Math.random()),l=this.U++;let b=new qn(this,this.j,l),N=this.o;if(this.S&&(N?(N=y(N),T(N,this.S)):N=this.S),this.m!==null||this.O||(b.H=N,N=null),this.P)e:{for(var h=0,p=0;p<this.i.length;p++){t:{var g=this.i[p];if("__data__"in g.map&&(g=g.map.__data__,typeof g=="string")){g=g.length;break t}g=void 0}if(g===void 0)break;if(h+=g,4096<h){h=p;break e}if(h===4096||p===this.i.length-1){h=p+1;break e}}h=1e3}else h=1e3;h=uy(this,b,h),p=Tn(this.I),Pe(p,"RID",l),Pe(p,"CVER",22),this.D&&Pe(p,"X-HTTP-Session-Id",this.D),Ks(this,p),N&&(this.O?h="headers="+encodeURIComponent(String(ey(N)))+"&"+h:this.m&&Th(p,this.m,N)),Eh(this.h,b),this.Ua&&Pe(p,"TYPE","init"),this.P?(Pe(p,"$req",h),Pe(p,"SID","null"),b.T=!0,yh(b,p,null)):yh(b,p,h),this.G=2}}else this.G==3&&(l?ly(this,l):this.i.length==0||j_(this.h)||ly(this))};function ly(l,h){var p;h?p=h.l:p=l.U++;let g=Tn(l.I);Pe(g,"SID",l.K),Pe(g,"RID",p),Pe(g,"AID",l.T),Ks(l,g),l.m&&l.o&&Th(g,l.m,l.o),p=new qn(l,l.j,p,l.B+1),l.m===null&&(p.H=l.o),h&&(l.i=h.D.concat(l.i)),h=uy(l,p,1e3),p.I=Math.round(.5*l.wa)+Math.round(.5*l.wa*Math.random()),Eh(l.h,p),yh(p,g,h)}function Ks(l,h){l.H&&X(l.H,function(p,g){Pe(h,g,p)}),l.l&&W_({},function(p,g){Pe(h,g,p)})}function uy(l,h,p){p=Math.min(l.i.length,p);var g=l.l?m(l.l.Na,l.l,l):null;e:{var b=l.i;let N=-1;for(;;){let B=["count="+p];N==-1?0<p?(N=b[0].g,B.push("ofs="+N)):N=0:B.push("ofs="+N);let Ee=!0;for(let rt=0;rt<p;rt++){let ye=b[rt].g,at=b[rt].map;if(ye-=N,0>ye)N=Math.max(0,b[rt].g-100),Ee=!1;else try{gA(at,B,"req"+ye+"_")}catch{g&&g(at)}}if(Ee){g=B.join("&");break e}}}return l=l.i.splice(0,p),h.D=l,g}function cy(l){if(!l.g&&!l.u){l.Y=1;var h=l.Fa;H||Ue(),J||(H(),J=!0),ue.add(h,l),l.v=0}}function Sh(l){return l.g||l.u||3<=l.v?!1:(l.Y++,l.u=Ms(m(l.Fa,l),fy(l,l.v)),l.v++,!0)}n.Fa=function(){if(this.u=null,hy(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var l=2*this.R;this.j.info("BP detection timer enabled: "+l),this.A=Ms(m(this.ab,this),l)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,ft(10),Fa(this),hy(this))};function bh(l){l.A!=null&&(a.clearTimeout(l.A),l.A=null)}function hy(l){l.g=new qn(l,l.j,"rpc",l.Y),l.m===null&&(l.g.H=l.o),l.g.O=0;var h=Tn(l.qa);Pe(h,"RID","rpc"),Pe(h,"SID",l.K),Pe(h,"AID",l.T),Pe(h,"CI",l.F?"0":"1"),!l.F&&l.ja&&Pe(h,"TO",l.ja),Pe(h,"TYPE","xmlhttp"),Ks(l,h),l.m&&l.o&&Th(h,l.m,l.o),l.L&&(l.g.I=l.L);var p=l.g;l=l.ia,p.L=1,p.v=xa(Tn(h)),p.m=null,p.P=!0,L_(p,l)}n.Za=function(){this.C!=null&&(this.C=null,Fa(this),Sh(this),ft(19))};function Va(l){l.C!=null&&(a.clearTimeout(l.C),l.C=null)}function dy(l,h){var p=null;if(l.g==h){Va(l),bh(l),l.g=null;var g=2}else if(Ih(l.h,h))p=h.D,K_(l.h,h),g=1;else return;if(l.G!=0){if(h.o)if(g==1){p=h.m?h.m.length:0,h=Date.now()-h.F;var b=l.B;g=ba(),dt(g,new M_(g,p)),Oa(l)}else cy(l);else if(b=h.s,b==3||b==0&&0<h.X||!(g==1&&wA(l,h)||g==2&&Sh(l)))switch(p&&0<p.length&&(h=l.h,h.i=h.i.concat(p)),b){case 1:Ar(l,5);break;case 4:Ar(l,10);break;case 3:Ar(l,6);break;default:Ar(l,2)}}}function fy(l,h){let p=l.Ta+Math.floor(Math.random()*l.cb);return l.isActive()||(p*=2),p*h}function Ar(l,h){if(l.j.info("Error code "+h),h==2){var p=m(l.fb,l),g=l.Xa;let b=!g;g=new br(g||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||Na(g,"https"),xa(g),b?fA(g.toString(),p):pA(g.toString(),p)}else ft(2);l.G=0,l.l&&l.l.sa(h),py(l),ay(l)}n.fb=function(l){l?(this.j.info("Successfully pinged google.com"),ft(2)):(this.j.info("Failed to ping google.com"),ft(1))};function py(l){if(l.G=0,l.ka=[],l.l){let h=G_(l.h);(h.length!=0||l.i.length!=0)&&(P(l.ka,h),P(l.ka,l.i),l.h.i.length=0,S(l.i),l.i.length=0),l.l.ra()}}function my(l,h,p){var g=p instanceof br?Tn(p):new br(p);if(g.g!="")h&&(g.g=h+"."+g.g),Da(g,g.s);else{var b=a.location;g=b.protocol,h=h?h+"."+b.hostname:b.hostname,b=+b.port;var N=new br(null);g&&Na(N,g),h&&(N.g=h),b&&Da(N,b),p&&(N.l=p),g=N}return p=l.D,h=l.ya,p&&h&&Pe(g,p,h),Pe(g,"VER",l.la),Ks(l,g),g}function gy(l,h,p){if(h&&!l.J)throw Error("Can't create secondary domain capable XhrIo object.");return h=l.Ca&&!l.pa?new Le(new Us({eb:p})):new Le(l.pa),h.Ha(l.J),h}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function _y(){}n=_y.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function La(){}La.prototype.g=function(l,h){return new St(l,h)};function St(l,h){ot.call(this),this.g=new oy(h),this.l=l,this.h=h&&h.messageUrlParams||null,l=h&&h.messageHeaders||null,h&&h.clientProtocolHeaderRequired&&(l?l["X-Client-Protocol"]="webchannel":l={"X-Client-Protocol":"webchannel"}),this.g.o=l,l=h&&h.initMessageHeaders||null,h&&h.messageContentType&&(l?l["X-WebChannel-Content-Type"]=h.messageContentType:l={"X-WebChannel-Content-Type":h.messageContentType}),h&&h.va&&(l?l["X-WebChannel-Client-Profile"]=h.va:l={"X-WebChannel-Client-Profile":h.va}),this.g.S=l,(l=h&&h.Sb)&&!U(l)&&(this.g.m=l),this.v=h&&h.supportsCrossDomainXhr||!1,this.u=h&&h.sendRawJson||!1,(h=h&&h.httpSessionIdParam)&&!U(h)&&(this.g.D=h,l=this.h,l!==null&&h in l&&(l=this.h,h in l&&delete l[h])),this.j=new yi(this)}I(St,ot),St.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},St.prototype.close=function(){Ch(this.g)},St.prototype.o=function(l){var h=this.g;if(typeof l=="string"){var p={};p.__data__=l,l=p}else this.u&&(p={},p.__data__=dh(l),l=p);h.i.push(new rA(h.Ya++,l)),h.G==3&&Oa(h)},St.prototype.N=function(){this.g.l=null,delete this.j,Ch(this.g),delete this.g,St.aa.N.call(this)};function yy(l){ph.call(this),l.__headers__&&(this.headers=l.__headers__,this.statusCode=l.__status__,delete l.__headers__,delete l.__status__);var h=l.__sm__;if(h){e:{for(let p in h){l=p;break e}l=void 0}(this.i=l)&&(l=this.i,h=h!==null&&l in h?h[l]:void 0),this.data=h}else this.data=l}I(yy,ph);function vy(){mh.call(this),this.status=1}I(vy,mh);function yi(l){this.g=l}I(yi,_y),yi.prototype.ua=function(){dt(this.g,"a")},yi.prototype.ta=function(l){dt(this.g,new yy(l))},yi.prototype.sa=function(l){dt(this.g,new vy)},yi.prototype.ra=function(){dt(this.g,"b")},La.prototype.createWebChannel=La.prototype.g,St.prototype.send=St.prototype.o,St.prototype.open=St.prototype.m,St.prototype.close=St.prototype.close,qf=An.createWebChannelTransport=function(){return new La},Uf=An.getStatEventTarget=function(){return ba()},Bf=An.Event=Cr,du=An.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Aa.NO_ERROR=0,Aa.TIMEOUT=8,Aa.HTTP_ERROR=6,xo=An.ErrorCode=Aa,F_.COMPLETE="complete",Lf=An.EventType=F_,N_.EventType=xs,xs.OPEN="a",xs.CLOSE="b",xs.ERROR="c",xs.MESSAGE="d",ot.prototype.listen=ot.prototype.K,ji=An.WebChannel=N_,PN=An.FetchXmlHttpFactory=Us,Le.prototype.listenOnce=Le.prototype.L,Le.prototype.getLastError=Le.prototype.Ka,Le.prototype.getLastErrorCode=Le.prototype.Ba,Le.prototype.getStatus=Le.prototype.Z,Le.prototype.getResponseJson=Le.prototype.Oa,Le.prototype.getResponseText=Le.prototype.oa,Le.prototype.send=Le.prototype.ea,Le.prototype.setWithCredentials=Le.prototype.Ha,Vf=An.XhrIo=Le}).apply(typeof hu<"u"?hu:typeof self<"u"?self:typeof window<"u"?window:{});var rT="@firebase/firestore";var $e=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};$e.UNAUTHENTICATED=new $e(null),$e.GOOGLE_CREDENTIALS=new $e("google-credentials-uid"),$e.FIRST_PARTY=new $e("first-party-uid"),$e.MOCK_USER=new $e("mock-user");var vs="10.14.0";var cr=new Ti("@firebase/firestore");function Qi(){return cr.logLevel}function oC(n){cr.setLogLevel(n)}function M(n,...e){if(cr.logLevel<=Vt.DEBUG){let t=e.map(Wm);cr.debug(`Firestore (${vs}): ${n}`,...t)}}function qe(n,...e){if(cr.logLevel<=Vt.ERROR){let t=e.map(Wm);cr.error(`Firestore (${vs}): ${n}`,...t)}}function $t(n,...e){if(cr.logLevel<=Vt.WARN){let t=e.map(Wm);cr.warn(`Firestore (${vs}): ${n}`,...t)}}function Wm(n){if(typeof n=="string")return n;try{return function(t){return JSON.stringify(t)}(n)}catch{return n}}function z(n="Unexpected state"){let e=`FIRESTORE (${vs}) INTERNAL ASSERTION FAILED: `+n;throw qe(e),new Error(e)}function Q(n,e){n||z()}function aC(n,e){n||z()}function q(n,e){return n}var D={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},k=class extends Jy{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var Xe=class{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}};var Eu=class{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}},Qf=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t($e.UNAUTHENTICATED))}shutdown(){}},$f=class{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}},Hf=class{constructor(e){this.t=e,this.currentUser=$e.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){Q(this.o===void 0);let r=this.i,i=u=>this.i!==r?(r=this.i,t(u)):Promise.resolve(),s=new Xe;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new Xe,e.enqueueRetryable(()=>i(this.currentUser))};let o=()=>{let u=s;e.enqueueRetryable(()=>x(this,null,function*(){yield u.promise,yield i(this.currentUser)}))},a=u=>{M("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=u,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit(u=>a(u)),setTimeout(()=>{if(!this.auth){let u=this.t.getImmediate({optional:!0});u?a(u):(M("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new Xe)}},0),o()}getToken(){let e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(M("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(Q(typeof r.accessToken=="string"),new Eu(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){let e=this.auth&&this.auth.getUid();return Q(e===null||typeof e=="string"),new $e(e)}},Yf=class{constructor(e,t,r){this.l=e,this.h=t,this.P=r,this.type="FirstParty",this.user=$e.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);let e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}},Jf=class{constructor(e,t,r){this.l=e,this.h=t,this.P=r}getToken(){return Promise.resolve(new Yf(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t($e.FIRST_PARTY))}shutdown(){}invalidateToken(){}},Xf=class{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},Zf=class{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){Q(this.o===void 0);let r=s=>{s.error!=null&&M("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);let o=s.token!==this.R;return this.R=s.token,M("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable(()=>r(s))};let i=s=>{M("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){let s=this.A.getImmediate({optional:!0});s?i(s):M("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(Q(typeof t.token=="string"),this.R=t.token,new Xf(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}};function NN(n){let e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}var Tu=class{static newId(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length,r="";for(;r.length<20;){let i=NN(40);for(let s=0;s<i.length;++s)r.length<20&&i[s]<t&&(r+=e.charAt(i[s]%e.length))}return r}};function te(n,e){return n<e?-1:n>e?1:0}function ns(n,e,t){return n.length===e.length&&n.every((r,i)=>t(r,e[i]))}function lC(n){return n+"\0"}var Me=class n{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new k(D.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new k(D.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new k(D.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new k(D.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return n.fromMillis(Date.now())}static fromDate(e){return n.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*t));return new n(t,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?te(this.nanoseconds,e.nanoseconds):te(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){let e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}};var Y=class n{constructor(e){this.timestamp=e}static fromTimestamp(e){return new n(e)}static min(){return new n(new Me(0,0))}static max(){return new n(new Me(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var Cu=class n{constructor(e,t,r){t===void 0?t=0:t>e.length&&z(),r===void 0?r=e.length-t:r>e.length-t&&z(),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return n.comparator(this,e)===0}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof n?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let r=Math.min(e.length,t.length);for(let i=0;i<r;i++){let s=e.get(i),o=t.get(i);if(s<o)return-1;if(s>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}},me=class n extends Cu{construct(e,t,r){return new n(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let r of e){if(r.indexOf("//")>=0)throw new k(D.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(i=>i.length>0))}return new n(t)}static emptyPath(){return new n([])}},DN=/^[_a-zA-Z][_a-zA-Z0-9]*$/,je=class n extends Cu{construct(e,t,r){return new n(e,t,r)}static isValidIdentifier(e){return DN.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),n.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new n(["__name__"])}static fromServerFormat(e){let t=[],r="",i=0,s=()=>{if(r.length===0)throw new k(D.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""},o=!1;for(;i<e.length;){let a=e[i];if(a==="\\"){if(i+1===e.length)throw new k(D.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let u=e[i+1];if(u!=="\\"&&u!=="."&&u!=="`")throw new k(D.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=u,i+=2}else a==="`"?(o=!o,i++):a!=="."||o?(r+=a,i++):(s(),i++)}if(s(),o)throw new k(D.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new n(t)}static emptyPath(){return new n([])}};var j=class n{constructor(e){this.path=e}static fromPath(e){return new n(me.fromString(e))}static fromName(e){return new n(me.fromString(e).popFirst(5))}static empty(){return new n(me.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&me.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return me.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new n(new me(e.slice()))}};var rs=class{constructor(e,t,r,i){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=i}};function ep(n){return n.fields.find(e=>e.kind===2)}function Br(n){return n.fields.filter(e=>e.kind!==2)}rs.UNKNOWN_ID=-1;var Zi=class{constructor(e,t){this.fieldPath=e,this.kind=t}};var Ko=class n{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new n(0,jt.min())}};function uC(n,e){let t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,i=Y.fromTimestamp(r===1e9?new Me(t+1,0):new Me(t,r));return new jt(i,j.empty(),e)}function cC(n){return new jt(n.readTime,n.key,-1)}var jt=class n{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new n(Y.min(),j.empty(),-1)}static max(){return new n(Y.max(),j.empty(),-1)}};function Qm(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=j.comparator(n.documentKey,e.documentKey),t!==0?t:te(n.largestBatchId,e.largestBatchId))}var hC="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Su=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}};function wr(n){return x(this,null,function*(){if(n.code!==D.FAILED_PRECONDITION||n.message!==hC)throw n;M("LocalStore","Unexpectedly lost primary lease")})}var R=class n{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&z(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new n((r,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(r,i)},this.catchCallback=s=>{this.wrapFailure(t,s).next(r,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof n?t:n.resolve(t)}catch(t){return n.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):n.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):n.reject(t)}static resolve(e){return new n((t,r)=>{t(e)})}static reject(e){return new n((t,r)=>{r(e)})}static waitFor(e){return new n((t,r)=>{let i=0,s=0,o=!1;e.forEach(a=>{++i,a.next(()=>{++s,o&&s===i&&t()},u=>r(u))}),o=!0,s===i&&t()})}static or(e){let t=n.resolve(!1);for(let r of e)t=t.next(i=>i?n.resolve(i):r());return t}static forEach(e,t){let r=[];return e.forEach((i,s)=>{r.push(t.call(this,i,s))}),this.waitFor(r)}static mapArray(e,t){return new n((r,i)=>{let s=e.length,o=new Array(s),a=0;for(let u=0;u<s;u++){let c=u;t(e[c]).next(d=>{o[c]=d,++a,a===s&&r(o)},d=>i(d))}})}static doWhile(e,t){return new n((r,i)=>{let s=()=>{e()===!0?t().next(()=>{s()},i):r()};s()})}};var bu=class n{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.V=new Xe,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{t.error?this.V.reject(new Gr(e,t.error)):this.V.resolve()},this.transaction.onerror=r=>{let i=$m(r.target.error);this.V.reject(new Gr(e,i))}}static open(e,t,r,i){try{return new n(t,e.transaction(i,r))}catch(s){throw new Gr(t,s)}}get m(){return this.V.promise}abort(e){e&&this.V.reject(e),this.aborted||(M("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){let e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){let t=this.transaction.objectStore(e);return new np(t)}},hr=class n{constructor(e,t,r){this.name=e,this.version=t,this.p=r,n.S($s())===12.2&&qe("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return M("SimpleDb","Removing database:",e),Ur(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!Yy())return!1;if(n.v())return!0;let e=$s(),t=n.S(e),r=0<t&&t<10,i=dC(e),s=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||s)}static v(){var e;return typeof process<"u"&&((e=process.__PRIVATE_env)===null||e===void 0?void 0:e.C)==="YES"}static F(e,t){return e.store(t)}static S(e){let t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(r)}M(e){return x(this,null,function*(){return this.db||(M("SimpleDb","Opening database:",this.name),this.db=yield new Promise((t,r)=>{let i=indexedDB.open(this.name,this.version);i.onsuccess=s=>{let o=s.target.result;t(o)},i.onblocked=()=>{r(new Gr(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=s=>{let o=s.target.error;o.name==="VersionError"?r(new k(D.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?r(new k(D.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):r(new Gr(e,o))},i.onupgradeneeded=s=>{M("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',s.oldVersion);let o=s.target.result;this.p.O(o,i.transaction,s.oldVersion,this.version).next(()=>{M("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.N&&(this.db.onversionchange=t=>this.N(t)),this.db})}L(e){this.N=e,this.db&&(this.db.onversionchange=t=>e(t))}runTransaction(e,t,r,i){return x(this,null,function*(){let s=t==="readonly",o=0;for(;;){++o;try{this.db=yield this.M(e);let a=bu.open(this.db,e,s?"readonly":"readwrite",r),u=i(a).next(c=>(a.g(),c)).catch(c=>(a.abort(c),R.reject(c))).toPromise();return u.catch(()=>{}),yield a.m,u}catch(a){let u=a,c=u.name!=="FirebaseError"&&o<3;if(M("SimpleDb","Transaction failed with error:",u.message,"Retrying:",c),this.close(),!c)return Promise.reject(u)}}})}close(){this.db&&this.db.close(),this.db=void 0}};function dC(n){let e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}var tp=class{constructor(e){this.B=e,this.k=!1,this.q=null}get isDone(){return this.k}get K(){return this.q}set cursor(e){this.B=e}done(){this.k=!0}$(e){this.q=e}delete(){return Ur(this.B.delete())}},Gr=class extends k{constructor(e,t){super(D.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}};function Ir(n){return n.name==="IndexedDbTransactionError"}var np=class{constructor(e){this.store=e}put(e,t){let r;return t!==void 0?(M("SimpleDb","PUT",this.store.name,e,t),r=this.store.put(t,e)):(M("SimpleDb","PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),Ur(r)}add(e){return M("SimpleDb","ADD",this.store.name,e,e),Ur(this.store.add(e))}get(e){return Ur(this.store.get(e)).next(t=>(t===void 0&&(t=null),M("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return M("SimpleDb","DELETE",this.store.name,e),Ur(this.store.delete(e))}count(){return M("SimpleDb","COUNT",this.store.name),Ur(this.store.count())}U(e,t){let r=this.options(e,t),i=r.index?this.store.index(r.index):this.store;if(typeof i.getAll=="function"){let s=i.getAll(r.range);return new R((o,a)=>{s.onerror=u=>{a(u.target.error)},s.onsuccess=u=>{o(u.target.result)}})}{let s=this.cursor(r),o=[];return this.W(s,(a,u)=>{o.push(u)}).next(()=>o)}}G(e,t){let r=this.store.getAll(e,t===null?void 0:t);return new R((i,s)=>{r.onerror=o=>{s(o.target.error)},r.onsuccess=o=>{i(o.target.result)}})}j(e,t){M("SimpleDb","DELETE ALL",this.store.name);let r=this.options(e,t);r.H=!1;let i=this.cursor(r);return this.W(i,(s,o,a)=>a.delete())}J(e,t){let r;t?r=e:(r={},t=e);let i=this.cursor(r);return this.W(i,t)}Y(e){let t=this.cursor({});return new R((r,i)=>{t.onerror=s=>{let o=$m(s.target.error);i(o)},t.onsuccess=s=>{let o=s.target.result;o?e(o.primaryKey,o.value).next(a=>{a?o.continue():r()}):r()}})}W(e,t){let r=[];return new R((i,s)=>{e.onerror=o=>{s(o.target.error)},e.onsuccess=o=>{let a=o.target.result;if(!a)return void i();let u=new tp(a),c=t(a.primaryKey,a.value,u);if(c instanceof R){let d=c.catch(f=>(u.done(),R.reject(f)));r.push(d)}u.isDone?i():u.K===null?a.continue():a.continue(u.K)}}).next(()=>R.waitFor(r))}options(e,t){let r;return e!==void 0&&(typeof e=="string"?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){let r=this.store.index(e.index);return e.H?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}};function Ur(n){return new R((e,t)=>{n.onsuccess=r=>{let i=r.target.result;e(i)},n.onerror=r=>{let i=$m(r.target.error);t(i)}})}var iT=!1;function $m(n){let e=hr.S($s());if(e>=12.2&&e<13){let t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){let r=new k("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return iT||(iT=!0,setTimeout(()=>{throw r},0)),r}}return n}var rp=class{constructor(e,t){this.asyncQueue=e,this.Z=t,this.task=null}start(){this.X(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}X(e){M("IndexBackfiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,()=>x(this,null,function*(){this.task=null;try{M("IndexBackfiller",`Documents written: ${yield this.Z.ee()}`)}catch(t){Ir(t)?M("IndexBackfiller","Ignoring IndexedDB error during index backfill: ",t):yield wr(t)}yield this.X(6e4)}))}},ip=class{constructor(e,t){this.localStore=e,this.persistence=t}ee(e=50){return x(this,null,function*(){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.te(t,e))})}te(e,t){let r=new Set,i=t,s=!0;return R.doWhile(()=>s===!0&&i>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(o!==null&&!r.has(o))return M("IndexBackfiller",`Processing collection: ${o}`),this.ne(e,o,i).next(a=>{i-=a,r.add(o)});s=!1})).next(()=>t-i)}ne(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(i=>this.localStore.localDocuments.getNextDocuments(e,t,i,r).next(s=>{let o=s.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this.re(i,s)).next(a=>(M("IndexBackfiller",`Updating offset: ${a}`),this.localStore.indexManager.updateCollectionGroup(e,t,a))).next(()=>o.size)}))}re(e,t){let r=e;return t.changes.forEach((i,s)=>{let o=cC(s);Qm(o,r)>0&&(r=o)}),new jt(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}};var Nt=(()=>{class n{constructor(t,r){this.previousValue=t,r&&(r.sequenceNumberHandler=i=>this.ie(i),this.se=i=>r.writeSequenceNumber(i))}ie(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){let t=++this.previousValue;return this.se&&this.se(t),t}}return n.oe=-1,n})();function ha(n){return n==null}function Go(n){return n===0&&1/n==-1/0}function fC(n){return typeof n=="number"&&Number.isInteger(n)&&!Go(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}function yt(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=sT(e)),e=xN(n.get(t),e);return sT(e)}function xN(n,e){let t=e,r=n.length;for(let i=0;i<r;i++){let s=n.charAt(i);switch(s){case"\0":t+="";break;case"":t+="";break;default:t+=s}}return t}function sT(n){return n+""}function cn(n){let e=n.length;if(Q(e>=2),e===2)return Q(n.charAt(0)===""&&n.charAt(1)===""),me.emptyPath();let t=e-2,r=[],i="";for(let s=0;s<e;){let o=n.indexOf("",s);switch((o<0||o>t)&&z(),n.charAt(o+1)){case"":let a=n.substring(s,o),u;i.length===0?u=a:(i+=a,u=i,i=""),r.push(u);break;case"":i+=n.substring(s,o),i+="\0";break;case"":i+=n.substring(s,o+1);break;default:z()}s=o+2}return new me(r)}var oT=["userId","batchId"];function _u(n,e){return[n,yt(e)]}function pC(n,e,t){return[n,yt(e),t]}var kN={},MN=["prefixPath","collectionGroup","readTime","documentId"],FN=["prefixPath","collectionGroup","documentId"],ON=["collectionGroup","readTime","prefixPath","documentId"],VN=["canonicalId","targetId"],LN=["targetId","path"],BN=["path","targetId"],UN=["collectionId","parent"],qN=["indexId","uid"],jN=["uid","sequenceNumber"],zN=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],KN=["indexId","uid","orderedDocumentKey"],GN=["userId","collectionPath","documentId"],WN=["userId","collectionPath","largestBatchId"],QN=["userId","collectionGroup","largestBatchId"],mC=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],$N=[...mC,"documentOverlays"],gC=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],_C=gC,Hm=[..._C,"indexConfiguration","indexState","indexEntries"],HN=Hm,YN=[...Hm,"globals"];var Wo=class extends Su{constructor(e,t){super(),this._e=e,this.currentSequenceNumber=t}};function Ze(n,e){let t=q(n);return hr.F(t._e,e)}function aT(n){let e=0;for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function ri(n,e){for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function yC(n){for(let e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}var Ne=class n{constructor(e,t){this.comparator=e,this.root=t||dn.EMPTY}insert(e,t){return new n(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,dn.BLACK,null,null))}remove(e){return new n(this.comparator,this.root.remove(e,this.comparator).copy(null,null,dn.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){let i=this.comparator(e,r.key);if(i===0)return t+r.left.size;i<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){let e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Xi(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Xi(this.root,e,this.comparator,!1)}getReverseIterator(){return new Xi(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Xi(this.root,e,this.comparator,!0)}},Xi=class{constructor(e,t,r,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?r(e.key,t):1,t&&i&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(s===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}},dn=class n{constructor(e,t,r,i,s){this.key=e,this.value=t,this.color=r??n.RED,this.left=i??n.EMPTY,this.right=s??n.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,i,s){return new n(e??this.key,t??this.value,r??this.color,i??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let i=this,s=r(e,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(e,t,r),null):s===0?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return n.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),t(e,i.key)===0){if(i.right.isEmpty())return n.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){let e=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){let e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw z();let e=this.left.check();if(e!==this.right.check())throw z();return e+(this.isRed()?0:1)}};dn.EMPTY=null,dn.RED=!0,dn.BLACK=!1;dn.EMPTY=new class{constructor(){this.size=0}get key(){throw z()}get value(){throw z()}get color(){throw z()}get left(){throw z()}get right(){throw z()}copy(e,t,r,i,s){return this}insert(e,t,r){return new dn(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};var Ce=class n{constructor(e){this.comparator=e,this.data=new Ne(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){let r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){let i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Au(this.data.getIterator())}getIteratorFrom(e){return new Au(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=r.getNext().key;if(this.comparator(i,s)!==0)return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new n(this.comparator);return t.data=e,t}},Au=class{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};function zi(n){return n.hasNext()?n.getNext():void 0}var Dt=class n{constructor(e){this.fields=e,e.sort(je.comparator)}static empty(){return new n([])}unionWith(e){let t=new Ce(je.comparator);for(let r of this.fields)t=t.add(r);for(let r of e)t=t.add(r);return new n(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return ns(this.fields,e.fields,(t,r)=>t.isEqual(r))}};var Ru=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};function vC(){return typeof atob<"u"}var Ke=class n{constructor(e){this.binaryString=e}static fromBase64String(e){let t=function(i){try{return atob(i)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new Ru("Invalid base64 string: "+s):s}}(e);return new n(t)}static fromUint8Array(e){let t=function(i){let s="";for(let o=0;o<i.length;++o)s+=String.fromCharCode(i[o]);return s}(e);return new n(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){let r=new Uint8Array(t.length);for(let i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return te(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}};Ke.EMPTY_BYTE_STRING=new Ke("");var JN=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Nn(n){if(Q(!!n),typeof n=="string"){let e=0,t=JN.exec(n);if(Q(!!t),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}let r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:xe(n.seconds),nanos:xe(n.nanos)}}function xe(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function dr(n){return typeof n=="string"?Ke.fromBase64String(n):Ke.fromUint8Array(n)}function vc(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="server_timestamp"}function Ym(n){let e=n.mapValue.fields.__previous_value__;return vc(e)?Ym(e):e}function Qo(n){let e=Nn(n.mapValue.fields.__local_write_time__.timestampValue);return new Me(e.seconds,e.nanos)}var sp=class{constructor(e,t,r,i,s,o,a,u,c){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=i,this.ssl=s,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=u,this.useFetchStreams=c}},fr=class n{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new n("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof n&&e.projectId===this.projectId&&e.database===this.database}};var lr={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},yu={nullValue:"NULL_VALUE"};function Wr(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?vc(n)?4:wC(n)?9007199254740991:wc(n)?10:11:z()}function mn(n,e){if(n===e)return!0;let t=Wr(n);if(t!==Wr(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return Qo(n).isEqual(Qo(e));case 3:return function(i,s){if(typeof i.timestampValue=="string"&&typeof s.timestampValue=="string"&&i.timestampValue.length===s.timestampValue.length)return i.timestampValue===s.timestampValue;let o=Nn(i.timestampValue),a=Nn(s.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(i,s){return dr(i.bytesValue).isEqual(dr(s.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(i,s){return xe(i.geoPointValue.latitude)===xe(s.geoPointValue.latitude)&&xe(i.geoPointValue.longitude)===xe(s.geoPointValue.longitude)}(n,e);case 2:return function(i,s){if("integerValue"in i&&"integerValue"in s)return xe(i.integerValue)===xe(s.integerValue);if("doubleValue"in i&&"doubleValue"in s){let o=xe(i.doubleValue),a=xe(s.doubleValue);return o===a?Go(o)===Go(a):isNaN(o)&&isNaN(a)}return!1}(n,e);case 9:return ns(n.arrayValue.values||[],e.arrayValue.values||[],mn);case 10:case 11:return function(i,s){let o=i.mapValue.fields||{},a=s.mapValue.fields||{};if(aT(o)!==aT(a))return!1;for(let u in o)if(o.hasOwnProperty(u)&&(a[u]===void 0||!mn(o[u],a[u])))return!1;return!0}(n,e);default:return z()}}function $o(n,e){return(n.values||[]).find(t=>mn(t,e))!==void 0}function pr(n,e){if(n===e)return 0;let t=Wr(n),r=Wr(e);if(t!==r)return te(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return te(n.booleanValue,e.booleanValue);case 2:return function(s,o){let a=xe(s.integerValue||s.doubleValue),u=xe(o.integerValue||o.doubleValue);return a<u?-1:a>u?1:a===u?0:isNaN(a)?isNaN(u)?0:-1:1}(n,e);case 3:return lT(n.timestampValue,e.timestampValue);case 4:return lT(Qo(n),Qo(e));case 5:return te(n.stringValue,e.stringValue);case 6:return function(s,o){let a=dr(s),u=dr(o);return a.compareTo(u)}(n.bytesValue,e.bytesValue);case 7:return function(s,o){let a=s.split("/"),u=o.split("/");for(let c=0;c<a.length&&c<u.length;c++){let d=te(a[c],u[c]);if(d!==0)return d}return te(a.length,u.length)}(n.referenceValue,e.referenceValue);case 8:return function(s,o){let a=te(xe(s.latitude),xe(o.latitude));return a!==0?a:te(xe(s.longitude),xe(o.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return uT(n.arrayValue,e.arrayValue);case 10:return function(s,o){var a,u,c,d;let f=s.fields||{},m=o.fields||{},_=(a=f.value)===null||a===void 0?void 0:a.arrayValue,I=(u=m.value)===null||u===void 0?void 0:u.arrayValue,S=te(((c=_?.values)===null||c===void 0?void 0:c.length)||0,((d=I?.values)===null||d===void 0?void 0:d.length)||0);return S!==0?S:uT(_,I)}(n.mapValue,e.mapValue);case 11:return function(s,o){if(s===lr.mapValue&&o===lr.mapValue)return 0;if(s===lr.mapValue)return 1;if(o===lr.mapValue)return-1;let a=s.fields||{},u=Object.keys(a),c=o.fields||{},d=Object.keys(c);u.sort(),d.sort();for(let f=0;f<u.length&&f<d.length;++f){let m=te(u[f],d[f]);if(m!==0)return m;let _=pr(a[u[f]],c[d[f]]);if(_!==0)return _}return te(u.length,d.length)}(n.mapValue,e.mapValue);default:throw z()}}function lT(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return te(n,e);let t=Nn(n),r=Nn(e),i=te(t.seconds,r.seconds);return i!==0?i:te(t.nanos,r.nanos)}function uT(n,e){let t=n.values||[],r=e.values||[];for(let i=0;i<t.length&&i<r.length;++i){let s=pr(t[i],r[i]);if(s)return s}return te(t.length,r.length)}function is(n){return op(n)}function op(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){let r=Nn(t);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(t){return dr(t).toBase64()}(n.bytesValue):"referenceValue"in n?function(t){return j.fromName(t).toString()}(n.referenceValue):"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let r="[",i=!0;for(let s of t.values||[])i?i=!1:r+=",",r+=op(s);return r+"]"}(n.arrayValue):"mapValue"in n?function(t){let r=Object.keys(t.fields||{}).sort(),i="{",s=!0;for(let o of r)s?s=!1:i+=",",i+=`${o}:${op(t.fields[o])}`;return i+"}"}(n.mapValue):z()}function Qr(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function ap(n){return!!n&&"integerValue"in n}function Ho(n){return!!n&&"arrayValue"in n}function cT(n){return!!n&&"nullValue"in n}function hT(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function vu(n){return!!n&&"mapValue"in n}function wc(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="__vector__"}function Bo(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){let e={mapValue:{fields:{}}};return ri(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=Bo(r)),e}if(n.arrayValue){let e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Bo(n.arrayValue.values[t]);return e}return Object.assign({},n)}function wC(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}var IC={mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{}}}}};function XN(n){return"nullValue"in n?yu:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?Qr(fr.empty(),j.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?wc(n)?IC:{mapValue:{}}:z()}function ZN(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?Qr(fr.empty(),j.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?IC:"mapValue"in n?wc(n)?{mapValue:{}}:lr:z()}function dT(n,e){let t=pr(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function fT(n,e){let t=pr(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}var ht=class n{constructor(e){this.value=e}static empty(){return new n({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!vu(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Bo(t)}setAll(e){let t=je.emptyPath(),r={},i=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){let u=this.getFieldsMap(t);this.applyChanges(u,r,i),r={},i=[],t=a.popLast()}o?r[a.lastSegment()]=Bo(o):i.push(a.lastSegment())});let s=this.getFieldsMap(t);this.applyChanges(s,r,i)}delete(e){let t=this.field(e.popLast());vu(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return mn(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=t.mapValue.fields[e.get(r)];vu(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,r){ri(t,(i,s)=>e[i]=s);for(let i of r)delete e[i]}clone(){return new n(Bo(this.value))}};function EC(n){let e=[];return ri(n.fields,(t,r)=>{let i=new je([t]);if(vu(r)){let s=EC(r.mapValue).fields;if(s.length===0)e.push(i);else for(let o of s)e.push(i.child(o))}else e.push(i)}),new Dt(e)}var He=class n{constructor(e,t,r,i,s,o,a){this.key=e,this.documentType=t,this.version=r,this.readTime=i,this.createTime=s,this.data=o,this.documentState=a}static newInvalidDocument(e){return new n(e,0,Y.min(),Y.min(),Y.min(),ht.empty(),0)}static newFoundDocument(e,t,r,i){return new n(e,1,t,Y.min(),r,i,0)}static newNoDocument(e,t){return new n(e,2,t,Y.min(),Y.min(),ht.empty(),0)}static newUnknownDocument(e,t){return new n(e,3,t,Y.min(),Y.min(),ht.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(Y.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=ht.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=ht.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Y.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof n&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new n(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};var gn=class{constructor(e,t){this.position=e,this.inclusive=t}};function pT(n,e,t){let r=0;for(let i=0;i<n.position.length;i++){let s=e[i],o=n.position[i];if(s.field.isKeyField()?r=j.comparator(j.fromName(o.referenceValue),t.key):r=pr(o,t.data.field(s.field)),s.dir==="desc"&&(r*=-1),r!==0)break}return r}function mT(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!mn(n.position[t],e.position[t]))return!1;return!0}var $r=class{constructor(e,t="asc"){this.field=e,this.dir=t}};function eD(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}var Pu=class{},he=class n extends Pu{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new cp(e,t,r):t==="array-contains"?new fp(e,r):t==="in"?new Nu(e,r):t==="not-in"?new pp(e,r):t==="array-contains-any"?new mp(e,r):new n(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new hp(e,r):new dp(e,r)}matches(e){let t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(pr(t,this.value)):t!==null&&Wr(this.value)===Wr(t)&&this.matchesComparison(pr(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return z()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},Ie=class n extends Pu{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new n(e,t)}matches(e){return ss(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}};function ss(n){return n.op==="and"}function lp(n){return n.op==="or"}function Jm(n){return TC(n)&&ss(n)}function TC(n){for(let e of n.filters)if(e instanceof Ie)return!1;return!0}function up(n){if(n instanceof he)return n.field.canonicalString()+n.op.toString()+is(n.value);if(Jm(n))return n.filters.map(e=>up(e)).join(",");{let e=n.filters.map(t=>up(t)).join(",");return`${n.op}(${e})`}}function CC(n,e){return n instanceof he?function(r,i){return i instanceof he&&r.op===i.op&&r.field.isEqual(i.field)&&mn(r.value,i.value)}(n,e):n instanceof Ie?function(r,i){return i instanceof Ie&&r.op===i.op&&r.filters.length===i.filters.length?r.filters.reduce((s,o,a)=>s&&CC(o,i.filters[a]),!0):!1}(n,e):void z()}function SC(n,e){let t=n.filters.concat(e);return Ie.create(t,n.op)}function bC(n){return n instanceof he?function(t){return`${t.field.canonicalString()} ${t.op} ${is(t.value)}`}(n):n instanceof Ie?function(t){return t.op.toString()+" {"+t.getFilters().map(bC).join(" ,")+"}"}(n):"Filter"}var cp=class extends he{constructor(e,t,r){super(e,t,r),this.key=j.fromName(r.referenceValue)}matches(e){let t=j.comparator(e.key,this.key);return this.matchesComparison(t)}},hp=class extends he{constructor(e,t){super(e,"in",t),this.keys=AC("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}},dp=class extends he{constructor(e,t){super(e,"not-in",t),this.keys=AC("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}};function AC(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(r=>j.fromName(r.referenceValue))}var fp=class extends he{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return Ho(t)&&$o(t.arrayValue,this.value)}},Nu=class extends he{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return t!==null&&$o(this.value.arrayValue,t)}},pp=class extends he{constructor(e,t){super(e,"not-in",t)}matches(e){if($o(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return t!==null&&!$o(this.value.arrayValue,t)}},mp=class extends he{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!(!Ho(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>$o(this.value.arrayValue,r))}};var gp=class{constructor(e,t=null,r=[],i=[],s=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=i,this.limit=s,this.startAt=o,this.endAt=a,this.ue=null}};function _p(n,e=null,t=[],r=[],i=null,s=null,o=null){return new gp(n,e,t,r,i,s,o)}function Hr(n){let e=q(n);if(e.ue===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>up(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>function(s){return s.field.canonicalString()+s.dir}(r)).join(","),ha(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>is(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>is(r)).join(",")),e.ue=t}return e.ue}function da(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!eD(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!CC(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!mT(n.startAt,e.startAt)&&mT(n.endAt,e.endAt)}function Du(n){return j.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function xu(n,e){return n.filters.filter(t=>t instanceof he&&t.field.isEqual(e))}function gT(n,e,t){let r=yu,i=!0;for(let s of xu(n,e)){let o=yu,a=!0;switch(s.op){case"<":case"<=":o=XN(s.value);break;case"==":case"in":case">=":o=s.value;break;case">":o=s.value,a=!1;break;case"!=":case"not-in":o=yu}dT({value:r,inclusive:i},{value:o,inclusive:a})<0&&(r=o,i=a)}if(t!==null){for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){let o=t.position[s];dT({value:r,inclusive:i},{value:o,inclusive:t.inclusive})<0&&(r=o,i=t.inclusive);break}}return{value:r,inclusive:i}}function _T(n,e,t){let r=lr,i=!0;for(let s of xu(n,e)){let o=lr,a=!0;switch(s.op){case">=":case">":o=ZN(s.value),a=!1;break;case"==":case"in":case"<=":o=s.value;break;case"<":o=s.value,a=!1;break;case"!=":case"not-in":o=lr}fT({value:r,inclusive:i},{value:o,inclusive:a})>0&&(r=o,i=a)}if(t!==null){for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){let o=t.position[s];fT({value:r,inclusive:i},{value:o,inclusive:t.inclusive})>0&&(r=o,i=t.inclusive);break}}return{value:r,inclusive:i}}var Ht=class{constructor(e,t=null,r=[],i=[],s=null,o="F",a=null,u=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=i,this.limit=s,this.limitType=o,this.startAt=a,this.endAt=u,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}};function RC(n,e,t,r,i,s,o,a){return new Ht(n,e,t,r,i,s,o,a)}function ws(n){return new Ht(n)}function yT(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function Xm(n){return n.collectionGroup!==null}function es(n){let e=q(n);if(e.ce===null){e.ce=[];let t=new Set;for(let s of e.explicitOrderBy)e.ce.push(s),t.add(s.field.canonicalString());let r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new Ce(je.comparator);return o.filters.forEach(u=>{u.getFlattenedFilters().forEach(c=>{c.isInequality()&&(a=a.add(c.field))})}),a})(e).forEach(s=>{t.has(s.canonicalString())||s.isKeyField()||e.ce.push(new $r(s,r))}),t.has(je.keyField().canonicalString())||e.ce.push(new $r(je.keyField(),r))}return e.ce}function vt(n){let e=q(n);return e.le||(e.le=tD(e,es(n))),e.le}function tD(n,e){if(n.limitType==="F")return _p(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(i=>{let s=i.dir==="desc"?"asc":"desc";return new $r(i.field,s)});let t=n.endAt?new gn(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new gn(n.startAt.position,n.startAt.inclusive):null;return _p(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function yp(n,e){let t=n.filters.concat([e]);return new Ht(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function ku(n,e,t){return new Ht(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function fa(n,e){return da(vt(n),vt(e))&&n.limitType===e.limitType}function PC(n){return`${Hr(vt(n))}|lt:${n.limitType}`}function $i(n){return`Query(target=${function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(i=>bC(i)).join(", ")}]`),ha(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(i=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(i)).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(i=>is(i)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(i=>is(i)).join(",")),`Target(${r})`}(vt(n))}; limitType=${n.limitType})`}function pa(n,e){return e.isFoundDocument()&&function(r,i){let s=i.key.path;return r.collectionGroup!==null?i.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(s):j.isDocumentKey(r.path)?r.path.isEqual(s):r.path.isImmediateParentOf(s)}(n,e)&&function(r,i){for(let s of es(r))if(!s.field.isKeyField()&&i.data.field(s.field)===null)return!1;return!0}(n,e)&&function(r,i){for(let s of r.filters)if(!s.matches(i))return!1;return!0}(n,e)&&function(r,i){return!(r.startAt&&!function(o,a,u){let c=pT(o,a,u);return o.inclusive?c<=0:c<0}(r.startAt,es(r),i)||r.endAt&&!function(o,a,u){let c=pT(o,a,u);return o.inclusive?c>=0:c>0}(r.endAt,es(r),i))}(n,e)}function NC(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function DC(n){return(e,t)=>{let r=!1;for(let i of es(n)){let s=nD(i,e,t);if(s!==0)return s;r=r||i.field.isKeyField()}return 0}}function nD(n,e,t){let r=n.field.isKeyField()?j.comparator(e.key,t.key):function(s,o,a){let u=o.data.field(s),c=a.data.field(s);return u!==null&&c!==null?pr(u,c):z()}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return z()}}var _n=class{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(let[i,s]of r)if(this.equalsFn(i,e))return s}}has(e){return this.get(e)!==void 0}set(e,t){let r=this.mapKeyFn(e),i=this.inner[r];if(i===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e))return void(i[s]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return r.length===1?delete this.inner[t]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){ri(this.inner,(t,r)=>{for(let[i,s]of r)e(i,s)})}isEmpty(){return yC(this.inner)}size(){return this.innerSize}};var rD=new Ne(j.comparator);function Ct(){return rD}var xC=new Ne(j.comparator);function Vo(...n){let e=xC;for(let t of n)e=e.insert(t.key,t);return e}function kC(n){let e=xC;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function hn(){return Uo()}function MC(){return Uo()}function Uo(){return new _n(n=>n.toString(),(n,e)=>n.isEqual(e))}var iD=new Ne(j.comparator),sD=new Ce(j.comparator);function ie(...n){let e=sD;for(let t of n)e=e.add(t);return e}var oD=new Ce(te);function Zm(){return oD}function eg(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Go(e)?"-0":e}}function FC(n){return{integerValue:""+n}}function OC(n,e){return fC(e)?FC(e):eg(n,e)}var os=class{constructor(){this._=void 0}};function aD(n,e,t){return n instanceof mr?function(i,s){let o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return s&&vc(s)&&(s=Ym(s)),s&&(o.fields.__previous_value__=s),{mapValue:o}}(t,e):n instanceof Dn?LC(n,e):n instanceof xn?BC(n,e):function(i,s){let o=VC(i,s),a=vT(o)+vT(i.Pe);return ap(o)&&ap(i.Pe)?FC(a):eg(i.serializer,a)}(n,e)}function lD(n,e,t){return n instanceof Dn?LC(n,e):n instanceof xn?BC(n,e):t}function VC(n,e){return n instanceof gr?function(r){return ap(r)||function(s){return!!s&&"doubleValue"in s}(r)}(e)?e:{integerValue:0}:null}var mr=class extends os{},Dn=class extends os{constructor(e){super(),this.elements=e}};function LC(n,e){let t=UC(e);for(let r of n.elements)t.some(i=>mn(i,r))||t.push(r);return{arrayValue:{values:t}}}var xn=class extends os{constructor(e){super(),this.elements=e}};function BC(n,e){let t=UC(e);for(let r of n.elements)t=t.filter(i=>!mn(i,r));return{arrayValue:{values:t}}}var gr=class extends os{constructor(e,t){super(),this.serializer=e,this.Pe=t}};function vT(n){return xe(n.integerValue||n.doubleValue)}function UC(n){return Ho(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}var Yr=class{constructor(e,t){this.field=e,this.transform=t}};function uD(n,e){return n.field.isEqual(e.field)&&function(r,i){return r instanceof Dn&&i instanceof Dn||r instanceof xn&&i instanceof xn?ns(r.elements,i.elements,mn):r instanceof gr&&i instanceof gr?mn(r.Pe,i.Pe):r instanceof mr&&i instanceof mr}(n.transform,e.transform)}var vp=class{constructor(e,t){this.version=e,this.transformResults=t}},Be=class n{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new n}static exists(e){return new n(void 0,e)}static updateTime(e){return new n(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}};function wu(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}var as=class{};function qC(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new yr(n.key,Be.none()):new _r(n.key,n.data,Be.none());{let t=n.data,r=ht.empty(),i=new Ce(je.comparator);for(let s of e.fields)if(!i.has(s)){let o=t.field(s);o===null&&s.length>1&&(s=s.popLast(),o=t.field(s)),o===null?r.delete(s):r.set(s,o),i=i.add(s)}return new Yt(n.key,r,new Dt(i.toArray()),Be.none())}}function cD(n,e,t){n instanceof _r?function(i,s,o){let a=i.value.clone(),u=IT(i.fieldTransforms,s,o.transformResults);a.setAll(u),s.convertToFoundDocument(o.version,a).setHasCommittedMutations()}(n,e,t):n instanceof Yt?function(i,s,o){if(!wu(i.precondition,s))return void s.convertToUnknownDocument(o.version);let a=IT(i.fieldTransforms,s,o.transformResults),u=s.data;u.setAll(jC(i)),u.setAll(a),s.convertToFoundDocument(o.version,u).setHasCommittedMutations()}(n,e,t):function(i,s,o){s.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,t)}function qo(n,e,t,r){return n instanceof _r?function(s,o,a,u){if(!wu(s.precondition,o))return a;let c=s.value.clone(),d=ET(s.fieldTransforms,u,o);return c.setAll(d),o.convertToFoundDocument(o.version,c).setHasLocalMutations(),null}(n,e,t,r):n instanceof Yt?function(s,o,a,u){if(!wu(s.precondition,o))return a;let c=ET(s.fieldTransforms,u,o),d=o.data;return d.setAll(jC(s)),d.setAll(c),o.convertToFoundDocument(o.version,d).setHasLocalMutations(),a===null?null:a.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(f=>f.field))}(n,e,t,r):function(s,o,a){return wu(s.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a}(n,e,t)}function hD(n,e){let t=null;for(let r of n.fieldTransforms){let i=e.data.field(r.field),s=VC(r.transform,i||null);s!=null&&(t===null&&(t=ht.empty()),t.set(r.field,s))}return t||null}function wT(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(r,i){return r===void 0&&i===void 0||!(!r||!i)&&ns(r,i,(s,o)=>uD(s,o))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}var _r=class extends as{constructor(e,t,r,i=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}},Yt=class extends as{constructor(e,t,r,i,s=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}};function jC(n){let e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){let r=n.data.field(t);e.set(t,r)}}),e}function IT(n,e,t){let r=new Map;Q(n.length===t.length);for(let i=0;i<t.length;i++){let s=n[i],o=s.transform,a=e.data.field(s.field);r.set(s.field,lD(o,a,t[i]))}return r}function ET(n,e,t){let r=new Map;for(let i of n){let s=i.transform,o=t.data.field(i.field);r.set(i.field,aD(s,o,e))}return r}var yr=class extends as{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}},Yo=class extends as{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};var Jo=class{constructor(e,t,r,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,t){let r=t.mutationResults;for(let i=0;i<this.mutations.length;i++){let s=this.mutations[i];s.key.isEqual(e.key)&&cD(s,e,r[i])}}applyToLocalView(e,t){for(let r of this.baseMutations)r.key.isEqual(e.key)&&(t=qo(r,e,t,this.localWriteTime));for(let r of this.mutations)r.key.isEqual(e.key)&&(t=qo(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let r=MC();return this.mutations.forEach(i=>{let s=e.get(i.key),o=s.overlayedDocument,a=this.applyToLocalView(o,s.mutatedFields);a=t.has(i.key)?null:a;let u=qC(o,a);u!==null&&r.set(i.key,u),o.isValidDocument()||o.convertToNoDocument(Y.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),ie())}isEqual(e){return this.batchId===e.batchId&&ns(this.mutations,e.mutations,(t,r)=>wT(t,r))&&ns(this.baseMutations,e.baseMutations,(t,r)=>wT(t,r))}},wp=class n{constructor(e,t,r,i){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=i}static from(e,t,r){Q(e.mutations.length===r.length);let i=function(){return iD}(),s=e.mutations;for(let o=0;o<s.length;o++)i=i.insert(s[o].key,r[o].version);return new n(e,t,r,i)}};var Xo=class{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var Ip=class{constructor(e,t){this.count=e,this.unchangedNames=t}};var We,pe;function zC(n){switch(n){default:return z();case D.CANCELLED:case D.UNKNOWN:case D.DEADLINE_EXCEEDED:case D.RESOURCE_EXHAUSTED:case D.INTERNAL:case D.UNAVAILABLE:case D.UNAUTHENTICATED:return!1;case D.INVALID_ARGUMENT:case D.NOT_FOUND:case D.ALREADY_EXISTS:case D.PERMISSION_DENIED:case D.FAILED_PRECONDITION:case D.ABORTED:case D.OUT_OF_RANGE:case D.UNIMPLEMENTED:case D.DATA_LOSS:return!0}}function KC(n){if(n===void 0)return qe("GRPC error has no .code"),D.UNKNOWN;switch(n){case We.OK:return D.OK;case We.CANCELLED:return D.CANCELLED;case We.UNKNOWN:return D.UNKNOWN;case We.DEADLINE_EXCEEDED:return D.DEADLINE_EXCEEDED;case We.RESOURCE_EXHAUSTED:return D.RESOURCE_EXHAUSTED;case We.INTERNAL:return D.INTERNAL;case We.UNAVAILABLE:return D.UNAVAILABLE;case We.UNAUTHENTICATED:return D.UNAUTHENTICATED;case We.INVALID_ARGUMENT:return D.INVALID_ARGUMENT;case We.NOT_FOUND:return D.NOT_FOUND;case We.ALREADY_EXISTS:return D.ALREADY_EXISTS;case We.PERMISSION_DENIED:return D.PERMISSION_DENIED;case We.FAILED_PRECONDITION:return D.FAILED_PRECONDITION;case We.ABORTED:return D.ABORTED;case We.OUT_OF_RANGE:return D.OUT_OF_RANGE;case We.UNIMPLEMENTED:return D.UNIMPLEMENTED;case We.DATA_LOSS:return D.DATA_LOSS;default:return z()}}(pe=We||(We={}))[pe.OK=0]="OK",pe[pe.CANCELLED=1]="CANCELLED",pe[pe.UNKNOWN=2]="UNKNOWN",pe[pe.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",pe[pe.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",pe[pe.NOT_FOUND=5]="NOT_FOUND",pe[pe.ALREADY_EXISTS=6]="ALREADY_EXISTS",pe[pe.PERMISSION_DENIED=7]="PERMISSION_DENIED",pe[pe.UNAUTHENTICATED=16]="UNAUTHENTICATED",pe[pe.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",pe[pe.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",pe[pe.ABORTED=10]="ABORTED",pe[pe.OUT_OF_RANGE=11]="OUT_OF_RANGE",pe[pe.UNIMPLEMENTED=12]="UNIMPLEMENTED",pe[pe.INTERNAL=13]="INTERNAL",pe[pe.UNAVAILABLE=14]="UNAVAILABLE",pe[pe.DATA_LOSS=15]="DATA_LOSS";var TT=null;function GC(){return new TextEncoder}var dD=new rr([4294967295,4294967295],0);function CT(n){let e=GC().encode(n),t=new Of;return t.update(e),new Uint8Array(t.digest())}function ST(n){let e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new rr([t,r],0),new rr([i,s],0)]}var Ep=class n{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new Kr(`Invalid padding: ${t}`);if(r<0)throw new Kr(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new Kr(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new Kr(`Invalid padding when bitmap length is 0: ${t}`);this.Ie=8*e.length-t,this.Te=rr.fromNumber(this.Ie)}Ee(e,t,r){let i=e.add(t.multiply(rr.fromNumber(r)));return i.compare(dD)===1&&(i=new rr([i.getBits(0),i.getBits(1)],0)),i.modulo(this.Te).toNumber()}de(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Ie===0)return!1;let t=CT(e),[r,i]=ST(t);for(let s=0;s<this.hashCount;s++){let o=this.Ee(r,i,s);if(!this.de(o))return!1}return!0}static create(e,t,r){let i=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),o=new n(s,i,t);return r.forEach(a=>o.insert(a)),o}insert(e){if(this.Ie===0)return;let t=CT(e),[r,i]=ST(t);for(let s=0;s<this.hashCount;s++){let o=this.Ee(r,i,s);this.Ae(o)}}Ae(e){let t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}},Kr=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var Zo=class n{constructor(e,t,r,i,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,r){let i=new Map;return i.set(e,ea.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new n(Y.min(),i,new Ne(te),Ct(),ie())}},ea=class n{constructor(e,t,r,i,s){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new n(r,t,ie(),ie(),ie())}};var ts=class{constructor(e,t,r,i){this.Re=e,this.removedTargetIds=t,this.key=r,this.Ve=i}},Mu=class{constructor(e,t){this.targetId=e,this.me=t}},Fu=class{constructor(e,t,r=Ke.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=i}},Ou=class{constructor(){this.fe=0,this.ge=AT(),this.pe=Ke.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=ie(),t=ie(),r=ie();return this.ge.forEach((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:r=r.add(i);break;default:z()}}),new ea(this.pe,this.ye,e,t,r)}Ce(){this.we=!1,this.ge=AT()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,Q(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}},Tp=class{constructor(e){this.Le=e,this.Be=new Map,this.ke=Ct(),this.qe=bT(),this.Qe=new Ne(te)}Ke(e){for(let t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(t,e.Ve):this.Ue(t,e.key,e.Ve);for(let t of e.removedTargetIds)this.Ue(t,e.key,e.Ve)}We(e){this.forEachTarget(e,t=>{let r=this.Ge(t);switch(e.state){case 0:this.ze(t)&&r.De(e.resumeToken);break;case 1:r.Oe(),r.Se||r.Ce(),r.De(e.resumeToken);break;case 2:r.Oe(),r.Se||this.removeTarget(t);break;case 3:this.ze(t)&&(r.Ne(),r.De(e.resumeToken));break;case 4:this.ze(t)&&(this.je(t),r.De(e.resumeToken));break;default:z()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Be.forEach((r,i)=>{this.ze(i)&&t(i)})}He(e){let t=e.targetId,r=e.me.count,i=this.Je(t);if(i){let s=i.target;if(Du(s))if(r===0){let o=new j(s.path);this.Ue(t,o,He.newNoDocument(o,Y.min()))}else Q(r===1);else{let o=this.Ye(t);if(o!==r){let a=this.Ze(e),u=a?this.Xe(a,e,o):1;if(u!==0){this.je(t);let c=u===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(t,c)}TT?.et(function(d,f,m,_,I){var S,P,V,U,L,$;let re={localCacheCount:d,existenceFilterCount:f.count,databaseId:m.database,projectId:m.projectId},X=f.unchangedNames;return X&&(re.bloomFilter={applied:I===0,hashCount:(S=X?.hashCount)!==null&&S!==void 0?S:0,bitmapLength:(U=(V=(P=X?.bits)===null||P===void 0?void 0:P.bitmap)===null||V===void 0?void 0:V.length)!==null&&U!==void 0?U:0,padding:($=(L=X?.bits)===null||L===void 0?void 0:L.padding)!==null&&$!==void 0?$:0,mightContain:E=>{var y;return(y=_?.mightContain(E))!==null&&y!==void 0&&y}}),re}(o,e.me,this.Le.tt(),a,u))}}}}Ze(e){let t=e.me.unchangedNames;if(!t||!t.bits)return null;let{bits:{bitmap:r="",padding:i=0},hashCount:s=0}=t,o,a;try{o=dr(r).toUint8Array()}catch(u){if(u instanceof Ru)return $t("Decoding the base64 bloom filter in existence filter failed ("+u.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw u}try{a=new Ep(o,i,s)}catch(u){return $t(u instanceof Kr?"BloomFilter error: ":"Applying bloom filter failed: ",u),null}return a.Ie===0?null:a}Xe(e,t,r){return t.me.count===r-this.nt(e,t.targetId)?0:2}nt(e,t){let r=this.Le.getRemoteKeysForTarget(t),i=0;return r.forEach(s=>{let o=this.Le.tt(),a=`projects/${o.projectId}/databases/${o.database}/documents/${s.path.canonicalString()}`;e.mightContain(a)||(this.Ue(t,s,null),i++)}),i}rt(e){let t=new Map;this.Be.forEach((s,o)=>{let a=this.Je(o);if(a){if(s.current&&Du(a.target)){let u=new j(a.target.path);this.ke.get(u)!==null||this.it(o,u)||this.Ue(o,u,He.newNoDocument(u,e))}s.be&&(t.set(o,s.ve()),s.Ce())}});let r=ie();this.qe.forEach((s,o)=>{let a=!0;o.forEachWhile(u=>{let c=this.Je(u);return!c||c.purpose==="TargetPurposeLimboResolution"||(a=!1,!1)}),a&&(r=r.add(s))}),this.ke.forEach((s,o)=>o.setReadTime(e));let i=new Zo(e,t,this.Qe,this.ke,r);return this.ke=Ct(),this.qe=bT(),this.Qe=new Ne(te),i}$e(e,t){if(!this.ze(e))return;let r=this.it(e,t.key)?2:0;this.Ge(e).Fe(t.key,r),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e))}Ue(e,t,r){if(!this.ze(e))return;let i=this.Ge(e);this.it(e,t)?i.Fe(t,1):i.Me(t),this.qe=this.qe.insert(t,this.st(t).delete(e)),r&&(this.ke=this.ke.insert(t,r))}removeTarget(e){this.Be.delete(e)}Ye(e){let t=this.Ge(e).ve();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let t=this.Be.get(e);return t||(t=new Ou,this.Be.set(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new Ce(te),this.qe=this.qe.insert(e,t)),t}ze(e){let t=this.Je(e)!==null;return t||M("WatchChangeAggregator","Detected inactive target",e),t}Je(e){let t=this.Be.get(e);return t&&t.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new Ou),this.Le.getRemoteKeysForTarget(e).forEach(t=>{this.Ue(e,t,null)})}it(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}};function bT(){return new Ne(j.comparator)}function AT(){return new Ne(j.comparator)}var fD={asc:"ASCENDING",desc:"DESCENDING"},pD={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},mD={and:"AND",or:"OR"},Cp=class{constructor(e,t){this.databaseId=e,this.useProto3Json=t}};function Sp(n,e){return n.useProto3Json||ha(e)?e:{value:e}}function ls(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function WC(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function gD(n,e){return ls(n,e.toTimestamp())}function ze(n){return Q(!!n),Y.fromTimestamp(function(t){let r=Nn(t);return new Me(r.seconds,r.nanos)}(n))}function tg(n,e){return bp(n,e).canonicalString()}function bp(n,e){let t=function(i){return new me(["projects",i.projectId,"databases",i.database])}(n).child("documents");return e===void 0?t:t.child(e)}function QC(n){let e=me.fromString(n);return Q(rS(e)),e}function ta(n,e){return tg(n.databaseId,e.path)}function fn(n,e){let t=QC(e);if(t.get(1)!==n.databaseId.projectId)throw new k(D.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new k(D.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new j(YC(t))}function $C(n,e){return tg(n.databaseId,e)}function HC(n){let e=QC(n);return e.length===4?me.emptyPath():YC(e)}function Ap(n){return new me(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function YC(n){return Q(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function RT(n,e,t){return{name:ta(n,e),fields:t.value.mapValue.fields}}function JC(n,e,t){let r=fn(n,e.name),i=ze(e.updateTime),s=e.createTime?ze(e.createTime):Y.min(),o=new ht({mapValue:{fields:e.fields}}),a=He.newFoundDocument(r,i,s,o);return t&&a.setHasCommittedMutations(),t?a.setHasCommittedMutations():a}function _D(n,e){return"found"in e?function(r,i){Q(!!i.found),i.found.name,i.found.updateTime;let s=fn(r,i.found.name),o=ze(i.found.updateTime),a=i.found.createTime?ze(i.found.createTime):Y.min(),u=new ht({mapValue:{fields:i.found.fields}});return He.newFoundDocument(s,o,a,u)}(n,e):"missing"in e?function(r,i){Q(!!i.missing),Q(!!i.readTime);let s=fn(r,i.missing),o=ze(i.readTime);return He.newNoDocument(s,o)}(n,e):z()}function yD(n,e){let t;if("targetChange"in e){e.targetChange;let r=function(c){return c==="NO_CHANGE"?0:c==="ADD"?1:c==="REMOVE"?2:c==="CURRENT"?3:c==="RESET"?4:z()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],s=function(c,d){return c.useProto3Json?(Q(d===void 0||typeof d=="string"),Ke.fromBase64String(d||"")):(Q(d===void 0||d instanceof Buffer||d instanceof Uint8Array),Ke.fromUint8Array(d||new Uint8Array))}(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(c){let d=c.code===void 0?D.UNKNOWN:KC(c.code);return new k(d,c.message||"")}(o);t=new Fu(r,i,s,a||null)}else if("documentChange"in e){e.documentChange;let r=e.documentChange;r.document,r.document.name,r.document.updateTime;let i=fn(n,r.document.name),s=ze(r.document.updateTime),o=r.document.createTime?ze(r.document.createTime):Y.min(),a=new ht({mapValue:{fields:r.document.fields}}),u=He.newFoundDocument(i,s,o,a),c=r.targetIds||[],d=r.removedTargetIds||[];t=new ts(c,d,u.key,u)}else if("documentDelete"in e){e.documentDelete;let r=e.documentDelete;r.document;let i=fn(n,r.document),s=r.readTime?ze(r.readTime):Y.min(),o=He.newNoDocument(i,s),a=r.removedTargetIds||[];t=new ts([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;let r=e.documentRemove;r.document;let i=fn(n,r.document),s=r.removedTargetIds||[];t=new ts([],s,i,null)}else{if(!("filter"in e))return z();{e.filter;let r=e.filter;r.targetId;let{count:i=0,unchangedNames:s}=r,o=new Ip(i,s),a=r.targetId;t=new Mu(a,o)}}return t}function na(n,e){let t;if(e instanceof _r)t={update:RT(n,e.key,e.value)};else if(e instanceof yr)t={delete:ta(n,e.key)};else if(e instanceof Yt)t={update:RT(n,e.key,e.data),updateMask:CD(e.fieldMask)};else{if(!(e instanceof Yo))return z();t={verify:ta(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(s,o){let a=o.transform;if(a instanceof mr)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof Dn)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof xn)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof gr)return{fieldPath:o.field.canonicalString(),increment:a.Pe};throw z()}(0,r))),e.precondition.isNone||(t.currentDocument=function(i,s){return s.updateTime!==void 0?{updateTime:gD(i,s.updateTime)}:s.exists!==void 0?{exists:s.exists}:z()}(n,e.precondition)),t}function Rp(n,e){let t=e.currentDocument?function(s){return s.updateTime!==void 0?Be.updateTime(ze(s.updateTime)):s.exists!==void 0?Be.exists(s.exists):Be.none()}(e.currentDocument):Be.none(),r=e.updateTransforms?e.updateTransforms.map(i=>function(o,a){let u=null;if("setToServerValue"in a)Q(a.setToServerValue==="REQUEST_TIME"),u=new mr;else if("appendMissingElements"in a){let d=a.appendMissingElements.values||[];u=new Dn(d)}else if("removeAllFromArray"in a){let d=a.removeAllFromArray.values||[];u=new xn(d)}else"increment"in a?u=new gr(o,a.increment):z();let c=je.fromServerFormat(a.fieldPath);return new Yr(c,u)}(n,i)):[];if(e.update){e.update.name;let i=fn(n,e.update.name),s=new ht({mapValue:{fields:e.update.fields}});if(e.updateMask){let o=function(u){let c=u.fieldPaths||[];return new Dt(c.map(d=>je.fromServerFormat(d)))}(e.updateMask);return new Yt(i,s,o,t,r)}return new _r(i,s,t,r)}if(e.delete){let i=fn(n,e.delete);return new yr(i,t)}if(e.verify){let i=fn(n,e.verify);return new Yo(i,t)}return z()}function vD(n,e){return n&&n.length>0?(Q(e!==void 0),n.map(t=>function(i,s){let o=i.updateTime?ze(i.updateTime):ze(s);return o.isEqual(Y.min())&&(o=ze(s)),new vp(o,i.transformResults||[])}(t,e))):[]}function XC(n,e){return{documents:[$C(n,e.path)]}}function ZC(n,e){let t={structuredQuery:{}},r=e.path,i;e.collectionGroup!==null?(i=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=$C(n,i);let s=function(c){if(c.length!==0)return nS(Ie.create(c,"and"))}(e.filters);s&&(t.structuredQuery.where=s);let o=function(c){if(c.length!==0)return c.map(d=>function(m){return{field:Hi(m.field),direction:ID(m.dir)}}(d))}(e.orderBy);o&&(t.structuredQuery.orderBy=o);let a=Sp(n,e.limit);return a!==null&&(t.structuredQuery.limit=a),e.startAt&&(t.structuredQuery.startAt=function(c){return{before:c.inclusive,values:c.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(c){return{before:!c.inclusive,values:c.position}}(e.endAt)),{_t:t,parent:i}}function eS(n){let e=HC(n.parent),t=n.structuredQuery,r=t.from?t.from.length:0,i=null;if(r>0){Q(r===1);let d=t.from[0];d.allDescendants?i=d.collectionId:e=e.child(d.collectionId)}let s=[];t.where&&(s=function(f){let m=tS(f);return m instanceof Ie&&Jm(m)?m.getFilters():[m]}(t.where));let o=[];t.orderBy&&(o=function(f){return f.map(m=>function(I){return new $r(Yi(I.field),function(P){switch(P){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(I.direction))}(m))}(t.orderBy));let a=null;t.limit&&(a=function(f){let m;return m=typeof f=="object"?f.value:f,ha(m)?null:m}(t.limit));let u=null;t.startAt&&(u=function(f){let m=!!f.before,_=f.values||[];return new gn(_,m)}(t.startAt));let c=null;return t.endAt&&(c=function(f){let m=!f.before,_=f.values||[];return new gn(_,m)}(t.endAt)),RC(e,i,o,s,a,"F",u,c)}function wD(n,e){let t=function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return z()}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function tS(n){return n.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":let r=Yi(t.unaryFilter.field);return he.create(r,"==",{doubleValue:NaN});case"IS_NULL":let i=Yi(t.unaryFilter.field);return he.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let s=Yi(t.unaryFilter.field);return he.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let o=Yi(t.unaryFilter.field);return he.create(o,"!=",{nullValue:"NULL_VALUE"});default:return z()}}(n):n.fieldFilter!==void 0?function(t){return he.create(Yi(t.fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return z()}}(t.fieldFilter.op),t.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(t){return Ie.create(t.compositeFilter.filters.map(r=>tS(r)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return z()}}(t.compositeFilter.op))}(n):z()}function ID(n){return fD[n]}function ED(n){return pD[n]}function TD(n){return mD[n]}function Hi(n){return{fieldPath:n.canonicalString()}}function Yi(n){return je.fromServerFormat(n.fieldPath)}function nS(n){return n instanceof he?function(t){if(t.op==="=="){if(hT(t.value))return{unaryFilter:{field:Hi(t.field),op:"IS_NAN"}};if(cT(t.value))return{unaryFilter:{field:Hi(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(hT(t.value))return{unaryFilter:{field:Hi(t.field),op:"IS_NOT_NAN"}};if(cT(t.value))return{unaryFilter:{field:Hi(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Hi(t.field),op:ED(t.op),value:t.value}}}(n):n instanceof Ie?function(t){let r=t.getFilters().map(i=>nS(i));return r.length===1?r[0]:{compositeFilter:{op:TD(t.op),filters:r}}}(n):z()}function CD(n){let e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function rS(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}var us=class n{constructor(e,t,r,i,s=Y.min(),o=Y.min(),a=Ke.EMPTY_BYTE_STRING,u=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=u}withSequenceNumber(e){return new n(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}};var Vu=class{constructor(e){this.ct=e}};function SD(n,e){let t;if(e.document)t=JC(n.ct,e.document,!!e.hasCommittedMutations);else if(e.noDocument){let r=j.fromSegments(e.noDocument.path),i=Xr(e.noDocument.readTime);t=He.newNoDocument(r,i),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return z();{let r=j.fromSegments(e.unknownDocument.path),i=Xr(e.unknownDocument.version);t=He.newUnknownDocument(r,i)}}return e.readTime&&t.setReadTime(function(i){let s=new Me(i[0],i[1]);return Y.fromTimestamp(s)}(e.readTime)),t}function PT(n,e){let t=e.key,r={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:Lu(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document=function(s,o){return{name:ta(s,o.key),fields:o.data.value.mapValue.fields,updateTime:ls(s,o.version.toTimestamp()),createTime:ls(s,o.createTime.toTimestamp())}}(n.ct,e);else if(e.isNoDocument())r.noDocument={path:t.path.toArray(),readTime:Jr(e.version)};else{if(!e.isUnknownDocument())return z();r.unknownDocument={path:t.path.toArray(),version:Jr(e.version)}}return r}function Lu(n){let e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function Jr(n){let e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function Xr(n){let e=new Me(n.seconds,n.nanoseconds);return Y.fromTimestamp(e)}function qr(n,e){let t=(e.baseMutations||[]).map(s=>Rp(n.ct,s));for(let s=0;s<e.mutations.length-1;++s){let o=e.mutations[s];if(s+1<e.mutations.length&&e.mutations[s+1].transform!==void 0){let a=e.mutations[s+1];o.updateTransforms=a.transform.fieldTransforms,e.mutations.splice(s+1,1),++s}}let r=e.mutations.map(s=>Rp(n.ct,s)),i=Me.fromMillis(e.localWriteTimeMs);return new Jo(e.batchId,i,t,r)}function Lo(n){let e=Xr(n.readTime),t=n.lastLimboFreeSnapshotVersion!==void 0?Xr(n.lastLimboFreeSnapshotVersion):Y.min(),r;return r=function(s){return s.documents!==void 0}(n.query)?function(s){return Q(s.documents.length===1),vt(ws(HC(s.documents[0])))}(n.query):function(s){return vt(eS(s))}(n.query),new us(r,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,e,t,Ke.fromBase64String(n.resumeToken))}function iS(n,e){let t=Jr(e.snapshotVersion),r=Jr(e.lastLimboFreeSnapshotVersion),i;i=Du(e.target)?XC(n.ct,e.target):ZC(n.ct,e.target)._t;let s=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:Hr(e.target),readTime:t,resumeToken:s,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:i}}function ng(n){let e=eS({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?ku(e,e.limit,"L"):e}function jf(n,e){return new Xo(e.largestBatchId,Rp(n.ct,e.overlayMutation))}function NT(n,e){let t=e.path.lastSegment();return[n,yt(e.path.popLast()),t]}function DT(n,e,t,r){return{indexId:n,uid:e,sequenceNumber:t,readTime:Jr(r.readTime),documentKey:yt(r.documentKey.path),largestBatchId:r.largestBatchId}}var Pp=class{getBundleMetadata(e,t){return xT(e).get(t).next(r=>{if(r)return function(s){return{id:s.bundleId,createTime:Xr(s.createTime),version:s.version}}(r)})}saveBundleMetadata(e,t){return xT(e).put(function(i){return{bundleId:i.id,createTime:Jr(ze(i.createTime)),version:i.version}}(t))}getNamedQuery(e,t){return kT(e).get(t).next(r=>{if(r)return function(s){return{name:s.name,query:ng(s.bundledQuery),readTime:Xr(s.readTime)}}(r)})}saveNamedQuery(e,t){return kT(e).put(function(i){return{name:i.name,readTime:Jr(ze(i.readTime)),bundledQuery:i.bundledQuery}}(t))}};function xT(n){return Ze(n,"bundles")}function kT(n){return Ze(n,"namedQueries")}var Bu=class n{constructor(e,t){this.serializer=e,this.userId=t}static lt(e,t){let r=t.uid||"";return new n(e,r)}getOverlay(e,t){return ko(e).get(NT(this.userId,t)).next(r=>r?jf(this.serializer,r):null)}getOverlays(e,t){let r=hn();return R.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){let i=[];return r.forEach((s,o)=>{let a=new Xo(t,o);i.push(this.ht(e,a))}),R.waitFor(i)}removeOverlaysForBatchId(e,t,r){let i=new Set;t.forEach(o=>i.add(yt(o.getCollectionPath())));let s=[];return i.forEach(o=>{let a=IDBKeyRange.bound([this.userId,o,r],[this.userId,o,r+1],!1,!0);s.push(ko(e).j("collectionPathOverlayIndex",a))}),R.waitFor(s)}getOverlaysForCollection(e,t,r){let i=hn(),s=yt(t),o=IDBKeyRange.bound([this.userId,s,r],[this.userId,s,Number.POSITIVE_INFINITY],!0);return ko(e).U("collectionPathOverlayIndex",o).next(a=>{for(let u of a){let c=jf(this.serializer,u);i.set(c.getKey(),c)}return i})}getOverlaysForCollectionGroup(e,t,r,i){let s=hn(),o,a=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,Number.POSITIVE_INFINITY],!0);return ko(e).J({index:"collectionGroupOverlayIndex",range:a},(u,c,d)=>{let f=jf(this.serializer,c);s.size()<i||f.largestBatchId===o?(s.set(f.getKey(),f),o=f.largestBatchId):d.done()}).next(()=>s)}ht(e,t){return ko(e).put(function(i,s,o){let[a,u,c]=NT(s,o.mutation.key);return{userId:s,collectionPath:u,documentId:c,collectionGroup:o.mutation.key.getCollectionGroup(),largestBatchId:o.largestBatchId,overlayMutation:na(i.ct,o.mutation)}}(this.serializer,this.userId,t))}};function ko(n){return Ze(n,"documentOverlays")}var Np=class{Pt(e){return Ze(e,"globals")}getSessionToken(e){return this.Pt(e).get("sessionToken").next(t=>{let r=t?.value;return r?Ke.fromUint8Array(r):Ke.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.Pt(e).put({name:"sessionToken",value:t.toUint8Array()})}};var Rn=class{constructor(){}It(e,t){this.Tt(e,t),t.Et()}Tt(e,t){if("nullValue"in e)this.dt(t,5);else if("booleanValue"in e)this.dt(t,10),t.At(e.booleanValue?1:0);else if("integerValue"in e)this.dt(t,15),t.At(xe(e.integerValue));else if("doubleValue"in e){let r=xe(e.doubleValue);isNaN(r)?this.dt(t,13):(this.dt(t,15),Go(r)?t.At(0):t.At(r))}else if("timestampValue"in e){let r=e.timestampValue;this.dt(t,20),typeof r=="string"&&(r=Nn(r)),t.Rt(`${r.seconds||""}`),t.At(r.nanos||0)}else if("stringValue"in e)this.Vt(e.stringValue,t),this.ft(t);else if("bytesValue"in e)this.dt(t,30),t.gt(dr(e.bytesValue)),this.ft(t);else if("referenceValue"in e)this.yt(e.referenceValue,t);else if("geoPointValue"in e){let r=e.geoPointValue;this.dt(t,45),t.At(r.latitude||0),t.At(r.longitude||0)}else"mapValue"in e?wC(e)?this.dt(t,Number.MAX_SAFE_INTEGER):wc(e)?this.wt(e.mapValue,t):(this.St(e.mapValue,t),this.ft(t)):"arrayValue"in e?(this.bt(e.arrayValue,t),this.ft(t)):z()}Vt(e,t){this.dt(t,25),this.Dt(e,t)}Dt(e,t){t.Rt(e)}St(e,t){let r=e.fields||{};this.dt(t,55);for(let i of Object.keys(r))this.Vt(i,t),this.Tt(r[i],t)}wt(e,t){var r,i;let s=e.fields||{};this.dt(t,53);let o="value",a=((i=(r=s[o].arrayValue)===null||r===void 0?void 0:r.values)===null||i===void 0?void 0:i.length)||0;this.dt(t,15),t.At(xe(a)),this.Vt(o,t),this.Tt(s[o],t)}bt(e,t){let r=e.values||[];this.dt(t,50);for(let i of r)this.Tt(i,t)}yt(e,t){this.dt(t,37),j.fromName(e).path.forEach(r=>{this.dt(t,60),this.Dt(r,t)})}dt(e,t){e.At(t)}ft(e){e.At(2)}};Rn.vt=new Rn;function bD(n){if(n===0)return 8;let e=0;return!(n>>4)&&(e+=4,n<<=4),!(n>>6)&&(e+=2,n<<=2),!(n>>7)&&(e+=1),e}function MT(n){let e=64-function(r){let i=0;for(let s=0;s<8;++s){let o=bD(255&r[s]);if(i+=o,o!==8)break}return i}(n);return Math.ceil(e/8)}var Dp=class{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Ct(e){let t=e[Symbol.iterator](),r=t.next();for(;!r.done;)this.Ft(r.value),r=t.next();this.Mt()}xt(e){let t=e[Symbol.iterator](),r=t.next();for(;!r.done;)this.Ot(r.value),r=t.next();this.Nt()}Lt(e){for(let t of e){let r=t.charCodeAt(0);if(r<128)this.Ft(r);else if(r<2048)this.Ft(960|r>>>6),this.Ft(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Ft(480|r>>>12),this.Ft(128|63&r>>>6),this.Ft(128|63&r);else{let i=t.codePointAt(0);this.Ft(240|i>>>18),this.Ft(128|63&i>>>12),this.Ft(128|63&i>>>6),this.Ft(128|63&i)}}this.Mt()}Bt(e){for(let t of e){let r=t.charCodeAt(0);if(r<128)this.Ot(r);else if(r<2048)this.Ot(960|r>>>6),this.Ot(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Ot(480|r>>>12),this.Ot(128|63&r>>>6),this.Ot(128|63&r);else{let i=t.codePointAt(0);this.Ot(240|i>>>18),this.Ot(128|63&i>>>12),this.Ot(128|63&i>>>6),this.Ot(128|63&i)}}this.Nt()}kt(e){let t=this.qt(e),r=MT(t);this.Qt(1+r),this.buffer[this.position++]=255&r;for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=255&t[i]}Kt(e){let t=this.qt(e),r=MT(t);this.Qt(1+r),this.buffer[this.position++]=~(255&r);for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=~(255&t[i])}$t(){this.Ut(255),this.Ut(255)}Wt(){this.Gt(255),this.Gt(255)}reset(){this.position=0}seed(e){this.Qt(e.length),this.buffer.set(e,this.position),this.position+=e.length}zt(){return this.buffer.slice(0,this.position)}qt(e){let t=function(s){let o=new DataView(new ArrayBuffer(8));return o.setFloat64(0,s,!1),new Uint8Array(o.buffer)}(e),r=(128&t[0])!=0;t[0]^=r?255:128;for(let i=1;i<t.length;++i)t[i]^=r?255:0;return t}Ft(e){let t=255&e;t===0?(this.Ut(0),this.Ut(255)):t===255?(this.Ut(255),this.Ut(0)):this.Ut(t)}Ot(e){let t=255&e;t===0?(this.Gt(0),this.Gt(255)):t===255?(this.Gt(255),this.Gt(0)):this.Gt(e)}Mt(){this.Ut(0),this.Ut(1)}Nt(){this.Gt(0),this.Gt(1)}Ut(e){this.Qt(1),this.buffer[this.position++]=e}Gt(e){this.Qt(1),this.buffer[this.position++]=~e}Qt(e){let t=e+this.position;if(t<=this.buffer.length)return;let r=2*this.buffer.length;r<t&&(r=t);let i=new Uint8Array(r);i.set(this.buffer),this.buffer=i}},xp=class{constructor(e){this.jt=e}gt(e){this.jt.Ct(e)}Rt(e){this.jt.Lt(e)}At(e){this.jt.kt(e)}Et(){this.jt.$t()}},kp=class{constructor(e){this.jt=e}gt(e){this.jt.xt(e)}Rt(e){this.jt.Bt(e)}At(e){this.jt.Kt(e)}Et(){this.jt.Wt()}},jr=class{constructor(){this.jt=new Dp,this.Ht=new xp(this.jt),this.Jt=new kp(this.jt)}seed(e){this.jt.seed(e)}Yt(e){return e===0?this.Ht:this.Jt}zt(){return this.jt.zt()}reset(){this.jt.reset()}};var zr=class n{constructor(e,t,r,i){this.indexId=e,this.documentKey=t,this.arrayValue=r,this.directionalValue=i}Zt(){let e=this.directionalValue.length,t=e===0||this.directionalValue[e-1]===255?e+1:e,r=new Uint8Array(t);return r.set(this.directionalValue,0),t!==e?r.set([0],this.directionalValue.length):++r[r.length-1],new n(this.indexId,this.documentKey,this.arrayValue,r)}};function ir(n,e){let t=n.indexId-e.indexId;return t!==0?t:(t=FT(n.arrayValue,e.arrayValue),t!==0?t:(t=FT(n.directionalValue,e.directionalValue),t!==0?t:j.comparator(n.documentKey,e.documentKey)))}function FT(n,e){for(let t=0;t<n.length&&t<e.length;++t){let r=n[t]-e[t];if(r!==0)return r}return n.length-e.length}var Uu=class{constructor(e){this.Xt=new Ce((t,r)=>je.comparator(t.field,r.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.en=e.orderBy,this.tn=[];for(let t of e.filters){let r=t;r.isInequality()?this.Xt=this.Xt.add(r):this.tn.push(r)}}get nn(){return this.Xt.size>1}rn(e){if(Q(e.collectionGroup===this.collectionId),this.nn)return!1;let t=ep(e);if(t!==void 0&&!this.sn(t))return!1;let r=Br(e),i=new Set,s=0,o=0;for(;s<r.length&&this.sn(r[s]);++s)i=i.add(r[s].fieldPath.canonicalString());if(s===r.length)return!0;if(this.Xt.size>0){let a=this.Xt.getIterator().getNext();if(!i.has(a.field.canonicalString())){let u=r[s];if(!this.on(a,u)||!this._n(this.en[o++],u))return!1}++s}for(;s<r.length;++s){let a=r[s];if(o>=this.en.length||!this._n(this.en[o++],a))return!1}return!0}an(){if(this.nn)return null;let e=new Ce(je.comparator),t=[];for(let r of this.tn)if(!r.field.isKeyField())if(r.op==="array-contains"||r.op==="array-contains-any")t.push(new Zi(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),t.push(new Zi(r.field,0))}for(let r of this.en)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),t.push(new Zi(r.field,r.dir==="asc"?0:1)));return new rs(rs.UNKNOWN_ID,this.collectionId,t,Ko.empty())}sn(e){for(let t of this.tn)if(this.on(t,e))return!0;return!1}on(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;let r=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===r}_n(e,t){return!!e.field.isEqual(t.fieldPath)&&(t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc")}};function sS(n){var e,t;if(Q(n instanceof he||n instanceof Ie),n instanceof he){if(n instanceof Nu){let i=((t=(e=n.value.arrayValue)===null||e===void 0?void 0:e.values)===null||t===void 0?void 0:t.map(s=>he.create(n.field,"==",s)))||[];return Ie.create(i,"or")}return n}let r=n.filters.map(i=>sS(i));return Ie.create(r,n.op)}function AD(n){if(n.getFilters().length===0)return[];let e=Op(sS(n));return Q(oS(e)),Mp(e)||Fp(e)?[e]:e.getFilters()}function Mp(n){return n instanceof he}function Fp(n){return n instanceof Ie&&Jm(n)}function oS(n){return Mp(n)||Fp(n)||function(t){if(t instanceof Ie&&lp(t)){for(let r of t.getFilters())if(!Mp(r)&&!Fp(r))return!1;return!0}return!1}(n)}function Op(n){if(Q(n instanceof he||n instanceof Ie),n instanceof he)return n;if(n.filters.length===1)return Op(n.filters[0]);let e=n.filters.map(r=>Op(r)),t=Ie.create(e,n.op);return t=qu(t),oS(t)?t:(Q(t instanceof Ie),Q(ss(t)),Q(t.filters.length>1),t.filters.reduce((r,i)=>rg(r,i)))}function rg(n,e){let t;return Q(n instanceof he||n instanceof Ie),Q(e instanceof he||e instanceof Ie),t=n instanceof he?e instanceof he?function(i,s){return Ie.create([i,s],"and")}(n,e):OT(n,e):e instanceof he?OT(e,n):function(i,s){if(Q(i.filters.length>0&&s.filters.length>0),ss(i)&&ss(s))return SC(i,s.getFilters());let o=lp(i)?i:s,a=lp(i)?s:i,u=o.filters.map(c=>rg(c,a));return Ie.create(u,"or")}(n,e),qu(t)}function OT(n,e){if(ss(e))return SC(e,n.getFilters());{let t=e.filters.map(r=>rg(n,r));return Ie.create(t,"or")}}function qu(n){if(Q(n instanceof he||n instanceof Ie),n instanceof he)return n;let e=n.getFilters();if(e.length===1)return qu(e[0]);if(TC(n))return n;let t=e.map(i=>qu(i)),r=[];return t.forEach(i=>{i instanceof he?r.push(i):i instanceof Ie&&(i.op===n.op?r.push(...i.filters):r.push(i))}),r.length===1?r[0]:Ie.create(r,n.op)}var Vp=class{constructor(){this.un=new ra}addToCollectionParentIndex(e,t){return this.un.add(t),R.resolve()}getCollectionParents(e,t){return R.resolve(this.un.getEntries(t))}addFieldIndex(e,t){return R.resolve()}deleteFieldIndex(e,t){return R.resolve()}deleteAllFieldIndexes(e){return R.resolve()}createTargetIndexes(e,t){return R.resolve()}getDocumentsMatchingTarget(e,t){return R.resolve(null)}getIndexType(e,t){return R.resolve(0)}getFieldIndexes(e,t){return R.resolve([])}getNextCollectionGroupToUpdate(e){return R.resolve(null)}getMinOffset(e,t){return R.resolve(jt.min())}getMinOffsetFromCollectionGroup(e,t){return R.resolve(jt.min())}updateCollectionGroup(e,t,r){return R.resolve()}updateIndexEntries(e,t){return R.resolve()}},ra=class{constructor(){this.index={}}add(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t]||new Ce(me.comparator),s=!i.has(r);return this.index[t]=i.add(r),s}has(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t];return i&&i.has(r)}getEntries(e){return(this.index[e]||new Ce(me.comparator)).toArray()}};var fu=new Uint8Array(0),Lp=class{constructor(e,t){this.databaseId=t,this.cn=new ra,this.ln=new _n(r=>Hr(r),(r,i)=>da(r,i)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.cn.has(t)){let r=t.lastSegment(),i=t.popLast();e.addOnCommittedListener(()=>{this.cn.add(t)});let s={collectionId:r,parent:yt(i)};return VT(e).put(s)}return R.resolve()}getCollectionParents(e,t){let r=[],i=IDBKeyRange.bound([t,""],[lC(t),""],!1,!0);return VT(e).U(i).next(s=>{for(let o of s){if(o.collectionId!==t)break;r.push(cn(o.parent))}return r})}addFieldIndex(e,t){let r=Mo(e),i=function(a){return{indexId:a.indexId,collectionGroup:a.collectionGroup,fields:a.fields.map(u=>[u.fieldPath.canonicalString(),u.kind])}}(t);delete i.indexId;let s=r.add(i);if(t.indexState){let o=Gi(e);return s.next(a=>{o.put(DT(a,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return s.next()}deleteFieldIndex(e,t){let r=Mo(e),i=Gi(e),s=Ki(e);return r.delete(t.indexId).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){let t=Mo(e),r=Ki(e),i=Gi(e);return t.j().next(()=>r.j()).next(()=>i.j())}createTargetIndexes(e,t){return R.forEach(this.hn(t),r=>this.getIndexType(e,r).next(i=>{if(i===0||i===1){let s=new Uu(r).an();if(s!=null)return this.addFieldIndex(e,s)}}))}getDocumentsMatchingTarget(e,t){let r=Ki(e),i=!0,s=new Map;return R.forEach(this.hn(t),o=>this.Pn(e,o).next(a=>{i&&(i=!!a),s.set(o,a)})).next(()=>{if(i){let o=ie(),a=[];return R.forEach(s,(u,c)=>{M("IndexedDbIndexManager",`Using index ${function(L){return`id=${L.indexId}|cg=${L.collectionGroup}|f=${L.fields.map($=>`${$.fieldPath}:${$.kind}`).join(",")}`}(u)} to execute ${Hr(t)}`);let d=function(L,$){let re=ep($);if(re===void 0)return null;for(let X of xu(L,re.fieldPath))switch(X.op){case"array-contains-any":return X.value.arrayValue.values||[];case"array-contains":return[X.value]}return null}(c,u),f=function(L,$){let re=new Map;for(let X of Br($))for(let E of xu(L,X.fieldPath))switch(E.op){case"==":case"in":re.set(X.fieldPath.canonicalString(),E.value);break;case"not-in":case"!=":return re.set(X.fieldPath.canonicalString(),E.value),Array.from(re.values())}return null}(c,u),m=function(L,$){let re=[],X=!0;for(let E of Br($)){let y=E.kind===0?gT(L,E.fieldPath,L.startAt):_T(L,E.fieldPath,L.startAt);re.push(y.value),X&&(X=y.inclusive)}return new gn(re,X)}(c,u),_=function(L,$){let re=[],X=!0;for(let E of Br($)){let y=E.kind===0?_T(L,E.fieldPath,L.endAt):gT(L,E.fieldPath,L.endAt);re.push(y.value),X&&(X=y.inclusive)}return new gn(re,X)}(c,u),I=this.In(u,c,m),S=this.In(u,c,_),P=this.Tn(u,c,f),V=this.En(u.indexId,d,I,m.inclusive,S,_.inclusive,P);return R.forEach(V,U=>r.G(U,t.limit).next(L=>{L.forEach($=>{let re=j.fromSegments($.documentKey);o.has(re)||(o=o.add(re),a.push(re))})}))}).next(()=>a)}return R.resolve(null)})}hn(e){let t=this.ln.get(e);return t||(e.filters.length===0?t=[e]:t=AD(Ie.create(e.filters,"and")).map(r=>_p(e.path,e.collectionGroup,e.orderBy,r.getFilters(),e.limit,e.startAt,e.endAt)),this.ln.set(e,t),t)}En(e,t,r,i,s,o,a){let u=(t!=null?t.length:1)*Math.max(r.length,s.length),c=u/(t!=null?t.length:1),d=[];for(let f=0;f<u;++f){let m=t?this.dn(t[f/c]):fu,_=this.An(e,m,r[f%c],i),I=this.Rn(e,m,s[f%c],o),S=a.map(P=>this.An(e,m,P,!0));d.push(...this.createRange(_,I,S))}return d}An(e,t,r,i){let s=new zr(e,j.empty(),t,r);return i?s:s.Zt()}Rn(e,t,r,i){let s=new zr(e,j.empty(),t,r);return i?s.Zt():s}Pn(e,t){let r=new Uu(t),i=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,i).next(s=>{let o=null;for(let a of s)r.rn(a)&&(!o||a.fields.length>o.fields.length)&&(o=a);return o})}getIndexType(e,t){let r=2,i=this.hn(t);return R.forEach(i,s=>this.Pn(e,s).next(o=>{o?r!==0&&o.fields.length<function(u){let c=new Ce(je.comparator),d=!1;for(let f of u.filters)for(let m of f.getFlattenedFilters())m.field.isKeyField()||(m.op==="array-contains"||m.op==="array-contains-any"?d=!0:c=c.add(m.field));for(let f of u.orderBy)f.field.isKeyField()||(c=c.add(f.field));return c.size+(d?1:0)}(s)&&(r=1):r=0})).next(()=>function(o){return o.limit!==null}(t)&&i.length>1&&r===2?1:r)}Vn(e,t){let r=new jr;for(let i of Br(e)){let s=t.data.field(i.fieldPath);if(s==null)return null;let o=r.Yt(i.kind);Rn.vt.It(s,o)}return r.zt()}dn(e){let t=new jr;return Rn.vt.It(e,t.Yt(0)),t.zt()}mn(e,t){let r=new jr;return Rn.vt.It(Qr(this.databaseId,t),r.Yt(function(s){let o=Br(s);return o.length===0?0:o[o.length-1].kind}(e))),r.zt()}Tn(e,t,r){if(r===null)return[];let i=[];i.push(new jr);let s=0;for(let o of Br(e)){let a=r[s++];for(let u of i)if(this.fn(t,o.fieldPath)&&Ho(a))i=this.gn(i,o,a);else{let c=u.Yt(o.kind);Rn.vt.It(a,c)}}return this.pn(i)}In(e,t,r){return this.Tn(e,t,r.position)}pn(e){let t=[];for(let r=0;r<e.length;++r)t[r]=e[r].zt();return t}gn(e,t,r){let i=[...e],s=[];for(let o of r.arrayValue.values||[])for(let a of i){let u=new jr;u.seed(a.zt()),Rn.vt.It(o,u.Yt(t.kind)),s.push(u)}return s}fn(e,t){return!!e.filters.find(r=>r instanceof he&&r.field.isEqual(t)&&(r.op==="in"||r.op==="not-in"))}getFieldIndexes(e,t){let r=Mo(e),i=Gi(e);return(t?r.U("collectionGroupIndex",IDBKeyRange.bound(t,t)):r.U()).next(s=>{let o=[];return R.forEach(s,a=>i.get([a.indexId,this.uid]).next(u=>{o.push(function(d,f){let m=f?new Ko(f.sequenceNumber,new jt(Xr(f.readTime),new j(cn(f.documentKey)),f.largestBatchId)):Ko.empty(),_=d.fields.map(([I,S])=>new Zi(je.fromServerFormat(I),S));return new rs(d.indexId,d.collectionGroup,_,m)}(a,u))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>t.length===0?null:(t.sort((r,i)=>{let s=r.indexState.sequenceNumber-i.indexState.sequenceNumber;return s!==0?s:te(r.collectionGroup,i.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,r){let i=Mo(e),s=Gi(e);return this.yn(e).next(o=>i.U("collectionGroupIndex",IDBKeyRange.bound(t,t)).next(a=>R.forEach(a,u=>s.put(DT(u.indexId,this.uid,o,r)))))}updateIndexEntries(e,t){let r=new Map;return R.forEach(t,(i,s)=>{let o=r.get(i.collectionGroup);return(o?R.resolve(o):this.getFieldIndexes(e,i.collectionGroup)).next(a=>(r.set(i.collectionGroup,a),R.forEach(a,u=>this.wn(e,i,u).next(c=>{let d=this.Sn(s,u);return c.isEqual(d)?R.resolve():this.bn(e,s,u,c,d)}))))})}Dn(e,t,r,i){return Ki(e).put({indexId:i.indexId,uid:this.uid,arrayValue:i.arrayValue,directionalValue:i.directionalValue,orderedDocumentKey:this.mn(r,t.key),documentKey:t.key.path.toArray()})}vn(e,t,r,i){return Ki(e).delete([i.indexId,this.uid,i.arrayValue,i.directionalValue,this.mn(r,t.key),t.key.path.toArray()])}wn(e,t,r){let i=Ki(e),s=new Ce(ir);return i.J({index:"documentKeyIndex",range:IDBKeyRange.only([r.indexId,this.uid,this.mn(r,t)])},(o,a)=>{s=s.add(new zr(r.indexId,t,a.arrayValue,a.directionalValue))}).next(()=>s)}Sn(e,t){let r=new Ce(ir),i=this.Vn(t,e);if(i==null)return r;let s=ep(t);if(s!=null){let o=e.data.field(s.fieldPath);if(Ho(o))for(let a of o.arrayValue.values||[])r=r.add(new zr(t.indexId,e.key,this.dn(a),i))}else r=r.add(new zr(t.indexId,e.key,fu,i));return r}bn(e,t,r,i,s){M("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);let o=[];return function(u,c,d,f,m){let _=u.getIterator(),I=c.getIterator(),S=zi(_),P=zi(I);for(;S||P;){let V=!1,U=!1;if(S&&P){let L=d(S,P);L<0?U=!0:L>0&&(V=!0)}else S!=null?U=!0:V=!0;V?(f(P),P=zi(I)):U?(m(S),S=zi(_)):(S=zi(_),P=zi(I))}}(i,s,ir,a=>{o.push(this.Dn(e,t,r,a))},a=>{o.push(this.vn(e,t,r,a))}),R.waitFor(o)}yn(e){let t=1;return Gi(e).J({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(r,i,s)=>{s.done(),t=i.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((o,a)=>ir(o,a)).filter((o,a,u)=>!a||ir(o,u[a-1])!==0);let i=[];i.push(e);for(let o of r){let a=ir(o,e),u=ir(o,t);if(a===0)i[0]=e.Zt();else if(a>0&&u<0)i.push(o),i.push(o.Zt());else if(u>0)break}i.push(t);let s=[];for(let o=0;o<i.length;o+=2){if(this.Cn(i[o],i[o+1]))return[];let a=[i[o].indexId,this.uid,i[o].arrayValue,i[o].directionalValue,fu,[]],u=[i[o+1].indexId,this.uid,i[o+1].arrayValue,i[o+1].directionalValue,fu,[]];s.push(IDBKeyRange.bound(a,u))}return s}Cn(e,t){return ir(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(LT)}getMinOffset(e,t){return R.mapArray(this.hn(t),r=>this.Pn(e,r).next(i=>i||z())).next(LT)}};function VT(n){return Ze(n,"collectionParents")}function Ki(n){return Ze(n,"indexEntries")}function Mo(n){return Ze(n,"indexConfiguration")}function Gi(n){return Ze(n,"indexState")}function LT(n){Q(n.length!==0);let e=n[0].indexState.offset,t=e.largestBatchId;for(let r=1;r<n.length;r++){let i=n[r].indexState.offset;Qm(i,e)<0&&(e=i),t<i.largestBatchId&&(t=i.largestBatchId)}return new jt(e.readTime,e.documentKey,t)}var BT={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},qt=class n{constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}static withCacheSize(e){return new n(e,n.DEFAULT_COLLECTION_PERCENTILE,n.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}};function aS(n,e,t){let r=n.store("mutations"),i=n.store("documentMutations"),s=[],o=IDBKeyRange.only(t.batchId),a=0,u=r.J({range:o},(d,f,m)=>(a++,m.delete()));s.push(u.next(()=>{Q(a===1)}));let c=[];for(let d of t.mutations){let f=pC(e,d.key.path,t.batchId);s.push(i.delete(f)),c.push(d.key)}return R.waitFor(s).next(()=>c)}function ju(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw z();e=n.noDocument}return JSON.stringify(e).length}qt.DEFAULT_COLLECTION_PERCENTILE=10,qt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,qt.DEFAULT=new qt(41943040,qt.DEFAULT_COLLECTION_PERCENTILE,qt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),qt.DISABLED=new qt(-1,0,0);var zu=class n{constructor(e,t,r,i){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=i,this.Fn={}}static lt(e,t,r,i){Q(e.uid!=="");let s=e.isAuthenticated()?e.uid:"";return new n(s,t,r,i)}checkEmpty(e){let t=!0,r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return sr(e).J({index:"userMutationsIndex",range:r},(i,s,o)=>{t=!1,o.done()}).next(()=>t)}addMutationBatch(e,t,r,i){let s=Ji(e),o=sr(e);return o.add({}).next(a=>{Q(typeof a=="number");let u=new Jo(a,t,r,i),c=function(_,I,S){let P=S.baseMutations.map(U=>na(_.ct,U)),V=S.mutations.map(U=>na(_.ct,U));return{userId:I,batchId:S.batchId,localWriteTimeMs:S.localWriteTime.toMillis(),baseMutations:P,mutations:V}}(this.serializer,this.userId,u),d=[],f=new Ce((m,_)=>te(m.canonicalString(),_.canonicalString()));for(let m of i){let _=pC(this.userId,m.key.path,a);f=f.add(m.key.path.popLast()),d.push(o.put(c)),d.push(s.put(_,kN))}return f.forEach(m=>{d.push(this.indexManager.addToCollectionParentIndex(e,m))}),e.addOnCommittedListener(()=>{this.Fn[a]=u.keys()}),R.waitFor(d).next(()=>u)})}lookupMutationBatch(e,t){return sr(e).get(t).next(r=>r?(Q(r.userId===this.userId),qr(this.serializer,r)):null)}Mn(e,t){return this.Fn[t]?R.resolve(this.Fn[t]):this.lookupMutationBatch(e,t).next(r=>{if(r){let i=r.keys();return this.Fn[t]=i,i}return null})}getNextMutationBatchAfterBatchId(e,t){let r=t+1,i=IDBKeyRange.lowerBound([this.userId,r]),s=null;return sr(e).J({index:"userMutationsIndex",range:i},(o,a,u)=>{a.userId===this.userId&&(Q(a.batchId>=r),s=qr(this.serializer,a)),u.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(e){let t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),r=-1;return sr(e).J({index:"userMutationsIndex",range:t,reverse:!0},(i,s,o)=>{r=s.batchId,o.done()}).next(()=>r)}getAllMutationBatches(e){let t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return sr(e).U("userMutationsIndex",t).next(r=>r.map(i=>qr(this.serializer,i)))}getAllMutationBatchesAffectingDocumentKey(e,t){let r=_u(this.userId,t.path),i=IDBKeyRange.lowerBound(r),s=[];return Ji(e).J({range:i},(o,a,u)=>{let[c,d,f]=o,m=cn(d);if(c===this.userId&&t.path.isEqual(m))return sr(e).get(f).next(_=>{if(!_)throw z();Q(_.userId===this.userId),s.push(qr(this.serializer,_))});u.done()}).next(()=>s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new Ce(te),i=[];return t.forEach(s=>{let o=_u(this.userId,s.path),a=IDBKeyRange.lowerBound(o),u=Ji(e).J({range:a},(c,d,f)=>{let[m,_,I]=c,S=cn(_);m===this.userId&&s.path.isEqual(S)?r=r.add(I):f.done()});i.push(u)}),R.waitFor(i).next(()=>this.xn(e,r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,i=r.length+1,s=_u(this.userId,r),o=IDBKeyRange.lowerBound(s),a=new Ce(te);return Ji(e).J({range:o},(u,c,d)=>{let[f,m,_]=u,I=cn(m);f===this.userId&&r.isPrefixOf(I)?I.length===i&&(a=a.add(_)):d.done()}).next(()=>this.xn(e,a))}xn(e,t){let r=[],i=[];return t.forEach(s=>{i.push(sr(e).get(s).next(o=>{if(o===null)throw z();Q(o.userId===this.userId),r.push(qr(this.serializer,o))}))}),R.waitFor(i).next(()=>r)}removeMutationBatch(e,t){return aS(e._e,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.On(t.batchId)}),R.forEach(r,i=>this.referenceDelegate.markPotentiallyOrphaned(e,i))))}On(e){delete this.Fn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return R.resolve();let r=IDBKeyRange.lowerBound(function(o){return[o]}(this.userId)),i=[];return Ji(e).J({range:r},(s,o,a)=>{if(s[0]===this.userId){let u=cn(s[1]);i.push(u)}else a.done()}).next(()=>{Q(i.length===0)})})}containsKey(e,t){return lS(e,this.userId,t)}Nn(e){return uS(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}};function lS(n,e,t){let r=_u(e,t.path),i=r[1],s=IDBKeyRange.lowerBound(r),o=!1;return Ji(n).J({range:s,H:!0},(a,u,c)=>{let[d,f,m]=a;d===e&&f===i&&(o=!0),c.done()}).next(()=>o)}function sr(n){return Ze(n,"mutations")}function Ji(n){return Ze(n,"documentMutations")}function uS(n){return Ze(n,"mutationQueues")}var cs=class n{constructor(e){this.Ln=e}next(){return this.Ln+=2,this.Ln}static Bn(){return new n(0)}static kn(){return new n(-1)}};var Bp=class{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.qn(e).next(t=>{let r=new cs(t.highestTargetId);return t.highestTargetId=r.next(),this.Qn(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.qn(e).next(t=>Y.fromTimestamp(new Me(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.qn(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.qn(e).next(i=>(i.highestListenSequenceNumber=t,r&&(i.lastRemoteSnapshotVersion=r.toTimestamp()),t>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=t),this.Qn(e,i)))}addTargetData(e,t){return this.Kn(e,t).next(()=>this.qn(e).next(r=>(r.targetCount+=1,this.$n(t,r),this.Qn(e,r))))}updateTargetData(e,t){return this.Kn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>Wi(e).delete(t.targetId)).next(()=>this.qn(e)).next(r=>(Q(r.targetCount>0),r.targetCount-=1,this.Qn(e,r)))}removeTargets(e,t,r){let i=0,s=[];return Wi(e).J((o,a)=>{let u=Lo(a);u.sequenceNumber<=t&&r.get(u.targetId)===null&&(i++,s.push(this.removeTargetData(e,u)))}).next(()=>R.waitFor(s)).next(()=>i)}forEachTarget(e,t){return Wi(e).J((r,i)=>{let s=Lo(i);t(s)})}qn(e){return UT(e).get("targetGlobalKey").next(t=>(Q(t!==null),t))}Qn(e,t){return UT(e).put("targetGlobalKey",t)}Kn(e,t){return Wi(e).put(iS(this.serializer,t))}$n(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.qn(e).next(t=>t.targetCount)}getTargetData(e,t){let r=Hr(t),i=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]),s=null;return Wi(e).J({range:i,index:"queryTargetsIndex"},(o,a,u)=>{let c=Lo(a);da(t,c.target)&&(s=c,u.done())}).next(()=>s)}addMatchingKeys(e,t,r){let i=[],s=or(e);return t.forEach(o=>{let a=yt(o.path);i.push(s.put({targetId:r,path:a})),i.push(this.referenceDelegate.addReference(e,r,o))}),R.waitFor(i)}removeMatchingKeys(e,t,r){let i=or(e);return R.forEach(t,s=>{let o=yt(s.path);return R.waitFor([i.delete([r,o]),this.referenceDelegate.removeReference(e,r,s)])})}removeMatchingKeysForTargetId(e,t){let r=or(e),i=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(i)}getMatchingKeysForTargetId(e,t){let r=IDBKeyRange.bound([t],[t+1],!1,!0),i=or(e),s=ie();return i.J({range:r,H:!0},(o,a,u)=>{let c=cn(o[1]),d=new j(c);s=s.add(d)}).next(()=>s)}containsKey(e,t){let r=yt(t.path),i=IDBKeyRange.bound([r],[lC(r)],!1,!0),s=0;return or(e).J({index:"documentTargetsIndex",H:!0,range:i},([o,a],u,c)=>{o!==0&&(s++,c.done())}).next(()=>s>0)}ot(e,t){return Wi(e).get(t).next(r=>r?Lo(r):null)}};function Wi(n){return Ze(n,"targets")}function UT(n){return Ze(n,"targetGlobal")}function or(n){return Ze(n,"targetDocuments")}function qT([n,e],[t,r]){let i=te(n,t);return i===0?te(e,r):i}var Up=class{constructor(e){this.Un=e,this.buffer=new Ce(qT),this.Wn=0}Gn(){return++this.Wn}zn(e){let t=[e,this.Gn()];if(this.buffer.size<this.Un)this.buffer=this.buffer.add(t);else{let r=this.buffer.last();qT(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}},qp=class{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.jn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Hn(6e4)}stop(){this.jn&&(this.jn.cancel(),this.jn=null)}get started(){return this.jn!==null}Hn(e){M("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.jn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,()=>x(this,null,function*(){this.jn=null;try{yield this.localStore.collectGarbage(this.garbageCollector)}catch(t){Ir(t)?M("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",t):yield wr(t)}yield this.Hn(3e5)}))}},jp=class{constructor(e,t){this.Jn=e,this.params=t}calculateTargetCount(e,t){return this.Jn.Yn(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(t===0)return R.resolve(Nt.oe);let r=new Up(t);return this.Jn.forEachTarget(e,i=>r.zn(i.sequenceNumber)).next(()=>this.Jn.Zn(e,i=>r.zn(i))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.Jn.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.Jn.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(M("LruGarbageCollector","Garbage collection skipped; disabled"),R.resolve(BT)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(M("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),BT):this.Xn(e,t))}getCacheSize(e){return this.Jn.getCacheSize(e)}Xn(e,t){let r,i,s,o,a,u,c,d=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(f=>(f>this.params.maximumSequenceNumbersToCollect?(M("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${f}`),i=this.params.maximumSequenceNumbersToCollect):i=f,o=Date.now(),this.nthSequenceNumber(e,i))).next(f=>(r=f,a=Date.now(),this.removeTargets(e,r,t))).next(f=>(s=f,u=Date.now(),this.removeOrphanedDocuments(e,r))).next(f=>(c=Date.now(),Qi()<=Vt.DEBUG&&M("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-d}ms
	Determined least recently used ${i} in `+(a-o)+`ms
	Removed ${s} targets in `+(u-a)+`ms
	Removed ${f} documents in `+(c-u)+`ms
Total Duration: ${c-d}ms`),R.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:f})))}};function RD(n,e){return new jp(n,e)}var zp=class{constructor(e,t){this.db=e,this.garbageCollector=RD(this,t)}Yn(e){let t=this.er(e);return this.db.getTargetCache().getTargetCount(e).next(r=>t.next(i=>r+i))}er(e){let t=0;return this.Zn(e,r=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Zn(e,t){return this.tr(e,(r,i)=>t(i))}addReference(e,t,r){return pu(e,r)}removeReference(e,t,r){return pu(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return pu(e,t)}nr(e,t){return function(i,s){let o=!1;return uS(i).Y(a=>lS(i,a,s).next(u=>(u&&(o=!0),R.resolve(!u)))).next(()=>o)}(e,t)}removeOrphanedDocuments(e,t){let r=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[],s=0;return this.tr(e,(o,a)=>{if(a<=t){let u=this.nr(e,o).next(c=>{if(!c)return s++,r.getEntry(e,o).next(()=>(r.removeEntry(o,Y.min()),or(e).delete(function(f){return[0,yt(f.path)]}(o))))});i.push(u)}}).next(()=>R.waitFor(i)).next(()=>r.apply(e)).next(()=>s)}removeTarget(e,t){let r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return pu(e,t)}tr(e,t){let r=or(e),i,s=Nt.oe;return r.J({index:"documentTargetsIndex"},([o,a],{path:u,sequenceNumber:c})=>{o===0?(s!==Nt.oe&&t(new j(cn(i)),s),s=c,i=u):s=Nt.oe}).next(()=>{s!==Nt.oe&&t(new j(cn(i)),s)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}};function pu(n,e){return or(n).put(function(r,i){return{targetId:0,path:yt(r.path),sequenceNumber:i}}(e,n.currentSequenceNumber))}var Ku=class{constructor(){this.changes=new _n(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,He.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let r=this.changes.get(t);return r!==void 0?R.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}};var Kp=class{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return Lr(e).put(r)}removeEntry(e,t,r){return Lr(e).delete(function(s,o){let a=s.path.toArray();return[a.slice(0,a.length-2),a[a.length-2],Lu(o),a[a.length-1]]}(t,r))}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.rr(e,r)))}getEntry(e,t){let r=He.newInvalidDocument(t);return Lr(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(Fo(t))},(i,s)=>{r=this.ir(t,s)}).next(()=>r)}sr(e,t){let r={size:0,document:He.newInvalidDocument(t)};return Lr(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(Fo(t))},(i,s)=>{r={document:this.ir(t,s),size:ju(s)}}).next(()=>r)}getEntries(e,t){let r=Ct();return this._r(e,t,(i,s)=>{let o=this.ir(i,s);r=r.insert(i,o)}).next(()=>r)}ar(e,t){let r=Ct(),i=new Ne(j.comparator);return this._r(e,t,(s,o)=>{let a=this.ir(s,o);r=r.insert(s,a),i=i.insert(s,ju(o))}).next(()=>({documents:r,ur:i}))}_r(e,t,r){if(t.isEmpty())return R.resolve();let i=new Ce(KT);t.forEach(u=>i=i.add(u));let s=IDBKeyRange.bound(Fo(i.first()),Fo(i.last())),o=i.getIterator(),a=o.getNext();return Lr(e).J({index:"documentKeyIndex",range:s},(u,c,d)=>{let f=j.fromSegments([...c.prefixPath,c.collectionGroup,c.documentId]);for(;a&&KT(a,f)<0;)r(a,null),a=o.getNext();a&&a.isEqual(f)&&(r(a,c),a=o.hasNext()?o.getNext():null),a?d.$(Fo(a)):d.done()}).next(()=>{for(;a;)r(a,null),a=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(e,t,r,i,s){let o=t.path,a=[o.popLast().toArray(),o.lastSegment(),Lu(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],u=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return Lr(e).U(IDBKeyRange.bound(a,u,!0)).next(c=>{s?.incrementDocumentReadCount(c.length);let d=Ct();for(let f of c){let m=this.ir(j.fromSegments(f.prefixPath.concat(f.collectionGroup,f.documentId)),f);m.isFoundDocument()&&(pa(t,m)||i.has(m.key))&&(d=d.insert(m.key,m))}return d})}getAllFromCollectionGroup(e,t,r,i){let s=Ct(),o=zT(t,r),a=zT(t,jt.max());return Lr(e).J({index:"collectionGroupIndex",range:IDBKeyRange.bound(o,a,!0)},(u,c,d)=>{let f=this.ir(j.fromSegments(c.prefixPath.concat(c.collectionGroup,c.documentId)),c);s=s.insert(f.key,f),s.size===i&&d.done()}).next(()=>s)}newChangeBuffer(e){return new Gp(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return jT(e).get("remoteDocumentGlobalKey").next(t=>(Q(!!t),t))}rr(e,t){return jT(e).put("remoteDocumentGlobalKey",t)}ir(e,t){if(t){let r=SD(this.serializer,t);if(!(r.isNoDocument()&&r.version.isEqual(Y.min())))return r}return He.newInvalidDocument(e)}};function cS(n){return new Kp(n)}var Gp=class extends Ku{constructor(e,t){super(),this.cr=e,this.trackRemovals=t,this.lr=new _n(r=>r.toString(),(r,i)=>r.isEqual(i))}applyChanges(e){let t=[],r=0,i=new Ce((s,o)=>te(s.canonicalString(),o.canonicalString()));return this.changes.forEach((s,o)=>{let a=this.lr.get(s);if(t.push(this.cr.removeEntry(e,s,a.readTime)),o.isValidDocument()){let u=PT(this.cr.serializer,o);i=i.add(s.path.popLast());let c=ju(u);r+=c-a.size,t.push(this.cr.addEntry(e,s,u))}else if(r-=a.size,this.trackRemovals){let u=PT(this.cr.serializer,o.convertToNoDocument(Y.min()));t.push(this.cr.addEntry(e,s,u))}}),i.forEach(s=>{t.push(this.cr.indexManager.addToCollectionParentIndex(e,s))}),t.push(this.cr.updateMetadata(e,r)),R.waitFor(t)}getFromCache(e,t){return this.cr.sr(e,t).next(r=>(this.lr.set(t,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(e,t){return this.cr.ar(e,t).next(({documents:r,ur:i})=>(i.forEach((s,o)=>{this.lr.set(s,{size:o,readTime:r.get(s).readTime})}),r))}};function jT(n){return Ze(n,"remoteDocumentGlobal")}function Lr(n){return Ze(n,"remoteDocumentsV14")}function Fo(n){let e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function zT(n,e){let t=e.documentKey.path.toArray();return[n,Lu(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function KT(n,e){let t=n.path.toArray(),r=e.path.toArray(),i=0;for(let s=0;s<t.length-2&&s<r.length-2;++s)if(i=te(t[s],r[s]),i)return i;return i=te(t.length,r.length),i||(i=te(t[t.length-2],r[r.length-2]),i||te(t[t.length-1],r[r.length-1]))}var Wp=class{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}};var Gu=class{constructor(e,t,r,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(r=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(r!==null&&qo(r.mutation,i,Dt.empty(),Me.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,ie()).next(()=>r))}getLocalViewOfDocuments(e,t,r=ie()){let i=hn();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,r).next(s=>{let o=Vo();return s.forEach((a,u)=>{o=o.insert(a,u.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){let r=hn();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,ie()))}populateOverlays(e,t,r){let i=[];return r.forEach(s=>{t.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(e,i).next(s=>{s.forEach((o,a)=>{t.set(o,a)})})}computeViews(e,t,r,i){let s=Ct(),o=Uo(),a=function(){return Uo()}();return t.forEach((u,c)=>{let d=r.get(c.key);i.has(c.key)&&(d===void 0||d.mutation instanceof Yt)?s=s.insert(c.key,c):d!==void 0?(o.set(c.key,d.mutation.getFieldMask()),qo(d.mutation,c,d.mutation.getFieldMask(),Me.now())):o.set(c.key,Dt.empty())}),this.recalculateAndSaveOverlays(e,s).next(u=>(u.forEach((c,d)=>o.set(c,d)),t.forEach((c,d)=>{var f;return a.set(c,new Wp(d,(f=o.get(c))!==null&&f!==void 0?f:null))}),a))}recalculateAndSaveOverlays(e,t){let r=Uo(),i=new Ne((o,a)=>o-a),s=ie();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(let a of o)a.keys().forEach(u=>{let c=t.get(u);if(c===null)return;let d=r.get(u)||Dt.empty();d=a.applyToLocalView(c,d),r.set(u,d);let f=(i.get(a.batchId)||ie()).add(u);i=i.insert(a.batchId,f)})}).next(()=>{let o=[],a=i.getReverseIterator();for(;a.hasNext();){let u=a.getNext(),c=u.key,d=u.value,f=MC();d.forEach(m=>{if(!s.has(m)){let _=qC(t.get(m),r.get(m));_!==null&&f.set(m,_),s=s.add(m)}}),o.push(this.documentOverlayCache.saveOverlays(e,c,f))}return R.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,i){return function(o){return j.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):Xm(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,i):this.getDocumentsMatchingCollectionQuery(e,t,r,i)}getNextDocuments(e,t,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,i).next(s=>{let o=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,i-s.size):R.resolve(hn()),a=-1,u=s;return o.next(c=>R.forEach(c,(d,f)=>(a<f.largestBatchId&&(a=f.largestBatchId),s.get(d)?R.resolve():this.remoteDocumentCache.getEntry(e,d).next(m=>{u=u.insert(d,m)}))).next(()=>this.populateOverlays(e,c,s)).next(()=>this.computeViews(e,u,c,ie())).next(d=>({batchId:a,changes:kC(d)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new j(t)).next(r=>{let i=Vo();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,r,i){let s=t.collectionGroup,o=Vo();return this.indexManager.getCollectionParents(e,s).next(a=>R.forEach(a,u=>{let c=function(f,m){return new Ht(m,null,f.explicitOrderBy.slice(),f.filters.slice(),f.limit,f.limitType,f.startAt,f.endAt)}(t,u.child(s));return this.getDocumentsMatchingCollectionQuery(e,c,r,i).next(d=>{d.forEach((f,m)=>{o=o.insert(f,m)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,r,i){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(o=>(s=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,s,i))).next(o=>{s.forEach((u,c)=>{let d=c.getKey();o.get(d)===null&&(o=o.insert(d,He.newInvalidDocument(d)))});let a=Vo();return o.forEach((u,c)=>{let d=s.get(u);d!==void 0&&qo(d.mutation,c,Dt.empty(),Me.now()),pa(t,c)&&(a=a.insert(u,c))}),a})}};var Qp=class{constructor(e){this.serializer=e,this.hr=new Map,this.Pr=new Map}getBundleMetadata(e,t){return R.resolve(this.hr.get(t))}saveBundleMetadata(e,t){return this.hr.set(t.id,function(i){return{id:i.id,version:i.version,createTime:ze(i.createTime)}}(t)),R.resolve()}getNamedQuery(e,t){return R.resolve(this.Pr.get(t))}saveNamedQuery(e,t){return this.Pr.set(t.name,function(i){return{name:i.name,query:ng(i.bundledQuery),readTime:ze(i.readTime)}}(t)),R.resolve()}};var $p=class{constructor(){this.overlays=new Ne(j.comparator),this.Ir=new Map}getOverlay(e,t){return R.resolve(this.overlays.get(t))}getOverlays(e,t){let r=hn();return R.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((i,s)=>{this.ht(e,t,s)}),R.resolve()}removeOverlaysForBatchId(e,t,r){let i=this.Ir.get(r);return i!==void 0&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.Ir.delete(r)),R.resolve()}getOverlaysForCollection(e,t,r){let i=hn(),s=t.length+1,o=new j(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){let u=a.getNext().value,c=u.getKey();if(!t.isPrefixOf(c.path))break;c.path.length===s&&u.largestBatchId>r&&i.set(u.getKey(),u)}return R.resolve(i)}getOverlaysForCollectionGroup(e,t,r,i){let s=new Ne((c,d)=>c-d),o=this.overlays.getIterator();for(;o.hasNext();){let c=o.getNext().value;if(c.getKey().getCollectionGroup()===t&&c.largestBatchId>r){let d=s.get(c.largestBatchId);d===null&&(d=hn(),s=s.insert(c.largestBatchId,d)),d.set(c.getKey(),c)}}let a=hn(),u=s.getIterator();for(;u.hasNext()&&(u.getNext().value.forEach((c,d)=>a.set(c,d)),!(a.size()>=i)););return R.resolve(a)}ht(e,t,r){let i=this.overlays.get(r.key);if(i!==null){let o=this.Ir.get(i.largestBatchId).delete(r.key);this.Ir.set(i.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new Xo(t,r));let s=this.Ir.get(t);s===void 0&&(s=ie(),this.Ir.set(t,s)),this.Ir.set(t,s.add(r.key))}};var Hp=class{constructor(){this.sessionToken=Ke.EMPTY_BYTE_STRING}getSessionToken(e){return R.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,R.resolve()}};var ia=class{constructor(){this.Tr=new Ce(Qe.Er),this.dr=new Ce(Qe.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(e,t){let r=new Qe(e,t);this.Tr=this.Tr.add(r),this.dr=this.dr.add(r)}Rr(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.Vr(new Qe(e,t))}mr(e,t){e.forEach(r=>this.removeReference(r,t))}gr(e){let t=new j(new me([])),r=new Qe(t,e),i=new Qe(t,e+1),s=[];return this.dr.forEachInRange([r,i],o=>{this.Vr(o),s.push(o.key)}),s}pr(){this.Tr.forEach(e=>this.Vr(e))}Vr(e){this.Tr=this.Tr.delete(e),this.dr=this.dr.delete(e)}yr(e){let t=new j(new me([])),r=new Qe(t,e),i=new Qe(t,e+1),s=ie();return this.dr.forEachInRange([r,i],o=>{s=s.add(o.key)}),s}containsKey(e){let t=new Qe(e,0),r=this.Tr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}},Qe=class{constructor(e,t){this.key=e,this.wr=t}static Er(e,t){return j.comparator(e.key,t.key)||te(e.wr,t.wr)}static Ar(e,t){return te(e.wr,t.wr)||j.comparator(e.key,t.key)}};var Yp=class{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Sr=1,this.br=new Ce(Qe.Er)}checkEmpty(e){return R.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,i){let s=this.Sr;this.Sr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let o=new Jo(s,t,r,i);this.mutationQueue.push(o);for(let a of i)this.br=this.br.add(new Qe(a.key,s)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return R.resolve(o)}lookupMutationBatch(e,t){return R.resolve(this.Dr(t))}getNextMutationBatchAfterBatchId(e,t){let r=t+1,i=this.vr(r),s=i<0?0:i;return R.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return R.resolve(this.mutationQueue.length===0?-1:this.Sr-1)}getAllMutationBatches(e){return R.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let r=new Qe(t,0),i=new Qe(t,Number.POSITIVE_INFINITY),s=[];return this.br.forEachInRange([r,i],o=>{let a=this.Dr(o.wr);s.push(a)}),R.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new Ce(te);return t.forEach(i=>{let s=new Qe(i,0),o=new Qe(i,Number.POSITIVE_INFINITY);this.br.forEachInRange([s,o],a=>{r=r.add(a.wr)})}),R.resolve(this.Cr(r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,i=r.length+1,s=r;j.isDocumentKey(s)||(s=s.child(""));let o=new Qe(new j(s),0),a=new Ce(te);return this.br.forEachWhile(u=>{let c=u.key.path;return!!r.isPrefixOf(c)&&(c.length===i&&(a=a.add(u.wr)),!0)},o),R.resolve(this.Cr(a))}Cr(e){let t=[];return e.forEach(r=>{let i=this.Dr(r);i!==null&&t.push(i)}),t}removeMutationBatch(e,t){Q(this.Fr(t.batchId,"removed")===0),this.mutationQueue.shift();let r=this.br;return R.forEach(t.mutations,i=>{let s=new Qe(i.key,t.batchId);return r=r.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.br=r})}On(e){}containsKey(e,t){let r=new Qe(t,0),i=this.br.firstAfterOrEqual(r);return R.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,R.resolve()}Fr(e,t){return this.vr(e)}vr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Dr(e){let t=this.vr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}};var Jp=class{constructor(e){this.Mr=e,this.docs=function(){return new Ne(j.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let r=t.key,i=this.docs.get(r),s=i?i.size:0,o=this.Mr(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:o}),this.size+=o-s,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let r=this.docs.get(t);return R.resolve(r?r.document.mutableCopy():He.newInvalidDocument(t))}getEntries(e,t){let r=Ct();return t.forEach(i=>{let s=this.docs.get(i);r=r.insert(i,s?s.document.mutableCopy():He.newInvalidDocument(i))}),R.resolve(r)}getDocumentsMatchingQuery(e,t,r,i){let s=Ct(),o=t.path,a=new j(o.child("")),u=this.docs.getIteratorFrom(a);for(;u.hasNext();){let{key:c,value:{document:d}}=u.getNext();if(!o.isPrefixOf(c.path))break;c.path.length>o.length+1||Qm(cC(d),r)<=0||(i.has(d.key)||pa(t,d))&&(s=s.insert(d.key,d.mutableCopy()))}return R.resolve(s)}getAllFromCollectionGroup(e,t,r,i){z()}Or(e,t){return R.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new Xp(this)}getSize(e){return R.resolve(this.size)}},Xp=class extends Ku{constructor(e){super(),this.cr=e}applyChanges(e){let t=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?t.push(this.cr.addEntry(e,i)):this.cr.removeEntry(r)}),R.waitFor(t)}getFromCache(e,t){return this.cr.getEntry(e,t)}getAllFromCache(e,t){return this.cr.getEntries(e,t)}};var Zp=class{constructor(e){this.persistence=e,this.Nr=new _n(t=>Hr(t),da),this.lastRemoteSnapshotVersion=Y.min(),this.highestTargetId=0,this.Lr=0,this.Br=new ia,this.targetCount=0,this.kr=cs.Bn()}forEachTarget(e,t){return this.Nr.forEach((r,i)=>t(i)),R.resolve()}getLastRemoteSnapshotVersion(e){return R.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return R.resolve(this.Lr)}allocateTargetId(e){return this.highestTargetId=this.kr.next(),R.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.Lr&&(this.Lr=t),R.resolve()}Kn(e){this.Nr.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.kr=new cs(t),this.highestTargetId=t),e.sequenceNumber>this.Lr&&(this.Lr=e.sequenceNumber)}addTargetData(e,t){return this.Kn(t),this.targetCount+=1,R.resolve()}updateTargetData(e,t){return this.Kn(t),R.resolve()}removeTargetData(e,t){return this.Nr.delete(t.target),this.Br.gr(t.targetId),this.targetCount-=1,R.resolve()}removeTargets(e,t,r){let i=0,s=[];return this.Nr.forEach((o,a)=>{a.sequenceNumber<=t&&r.get(a.targetId)===null&&(this.Nr.delete(o),s.push(this.removeMatchingKeysForTargetId(e,a.targetId)),i++)}),R.waitFor(s).next(()=>i)}getTargetCount(e){return R.resolve(this.targetCount)}getTargetData(e,t){let r=this.Nr.get(t)||null;return R.resolve(r)}addMatchingKeys(e,t,r){return this.Br.Rr(t,r),R.resolve()}removeMatchingKeys(e,t,r){this.Br.mr(t,r);let i=this.persistence.referenceDelegate,s=[];return i&&t.forEach(o=>{s.push(i.markPotentiallyOrphaned(e,o))}),R.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.Br.gr(t),R.resolve()}getMatchingKeysForTargetId(e,t){let r=this.Br.yr(t);return R.resolve(r)}containsKey(e,t){return R.resolve(this.Br.containsKey(t))}};var Wu=class{constructor(e,t){this.qr={},this.overlays={},this.Qr=new Nt(0),this.Kr=!1,this.Kr=!0,this.$r=new Hp,this.referenceDelegate=e(this),this.Ur=new Zp(this),this.indexManager=new Vp,this.remoteDocumentCache=function(i){return new Jp(i)}(r=>this.referenceDelegate.Wr(r)),this.serializer=new Vu(t),this.Gr=new Qp(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new $p,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.qr[e.toKey()];return r||(r=new Yp(t,this.referenceDelegate),this.qr[e.toKey()]=r),r}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(e,t,r){M("MemoryPersistence","Starting transaction:",e);let i=new em(this.Qr.next());return this.referenceDelegate.zr(),r(i).next(s=>this.referenceDelegate.jr(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}Hr(e,t){return R.or(Object.values(this.qr).map(r=>()=>r.containsKey(e,t)))}},em=class extends Su{constructor(e){super(),this.currentSequenceNumber=e}},Qu=class n{constructor(e){this.persistence=e,this.Jr=new ia,this.Yr=null}static Zr(e){return new n(e)}get Xr(){if(this.Yr)return this.Yr;throw z()}addReference(e,t,r){return this.Jr.addReference(r,t),this.Xr.delete(r.toString()),R.resolve()}removeReference(e,t,r){return this.Jr.removeReference(r,t),this.Xr.add(r.toString()),R.resolve()}markPotentiallyOrphaned(e,t){return this.Xr.add(t.toString()),R.resolve()}removeTarget(e,t){this.Jr.gr(t.targetId).forEach(i=>this.Xr.add(i.toString()));let r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(i=>{i.forEach(s=>this.Xr.add(s.toString()))}).next(()=>r.removeTargetData(e,t))}zr(){this.Yr=new Set}jr(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return R.forEach(this.Xr,r=>{let i=j.fromPath(r);return this.ei(e,i).next(s=>{s||t.removeEntry(i,Y.min())})}).next(()=>(this.Yr=null,t.apply(e)))}updateLimboDocument(e,t){return this.ei(e,t).next(r=>{r?this.Xr.delete(t.toString()):this.Xr.add(t.toString())})}Wr(e){return 0}ei(e,t){return R.or([()=>R.resolve(this.Jr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Hr(e,t)])}};var tm=class{constructor(e){this.serializer=e}O(e,t,r,i){let s=new bu("createOrUpgrade",t);r<1&&i>=1&&(function(u){u.createObjectStore("owner")}(e),function(u){u.createObjectStore("mutationQueues",{keyPath:"userId"}),u.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",oT,{unique:!0}),u.createObjectStore("documentMutations")}(e),GT(e),function(u){u.createObjectStore("remoteDocuments")}(e));let o=R.resolve();return r<3&&i>=3&&(r!==0&&(function(u){u.deleteObjectStore("targetDocuments"),u.deleteObjectStore("targets"),u.deleteObjectStore("targetGlobal")}(e),GT(e)),o=o.next(()=>function(u){let c=u.store("targetGlobal"),d={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:Y.min().toTimestamp(),targetCount:0};return c.put("targetGlobalKey",d)}(s))),r<4&&i>=4&&(r!==0&&(o=o.next(()=>function(u,c){return c.store("mutations").U().next(d=>{u.deleteObjectStore("mutations"),u.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",oT,{unique:!0});let f=c.store("mutations"),m=d.map(_=>f.put(_));return R.waitFor(m)})}(e,s))),o=o.next(()=>{(function(u){u.createObjectStore("clientMetadata",{keyPath:"clientId"})})(e)})),r<5&&i>=5&&(o=o.next(()=>this.ni(s))),r<6&&i>=6&&(o=o.next(()=>(function(u){u.createObjectStore("remoteDocumentGlobal")}(e),this.ri(s)))),r<7&&i>=7&&(o=o.next(()=>this.ii(s))),r<8&&i>=8&&(o=o.next(()=>this.si(e,s))),r<9&&i>=9&&(o=o.next(()=>{(function(u){u.objectStoreNames.contains("remoteDocumentChanges")&&u.deleteObjectStore("remoteDocumentChanges")})(e)})),r<10&&i>=10&&(o=o.next(()=>this.oi(s))),r<11&&i>=11&&(o=o.next(()=>{(function(u){u.createObjectStore("bundles",{keyPath:"bundleId"})})(e),function(u){u.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),r<12&&i>=12&&(o=o.next(()=>{(function(u){let c=u.createObjectStore("documentOverlays",{keyPath:GN});c.createIndex("collectionPathOverlayIndex",WN,{unique:!1}),c.createIndex("collectionGroupOverlayIndex",QN,{unique:!1})})(e)})),r<13&&i>=13&&(o=o.next(()=>function(u){let c=u.createObjectStore("remoteDocumentsV14",{keyPath:MN});c.createIndex("documentKeyIndex",FN),c.createIndex("collectionGroupIndex",ON)}(e)).next(()=>this._i(e,s)).next(()=>e.deleteObjectStore("remoteDocuments"))),r<14&&i>=14&&(o=o.next(()=>this.ai(e,s))),r<15&&i>=15&&(o=o.next(()=>function(u){u.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),u.createObjectStore("indexState",{keyPath:qN}).createIndex("sequenceNumberIndex",jN,{unique:!1}),u.createObjectStore("indexEntries",{keyPath:zN}).createIndex("documentKeyIndex",KN,{unique:!1})}(e))),r<16&&i>=16&&(o=o.next(()=>{t.objectStore("indexState").clear()}).next(()=>{t.objectStore("indexEntries").clear()})),r<17&&i>=17&&(o=o.next(()=>{(function(u){u.createObjectStore("globals",{keyPath:"name"})})(e)})),o}ri(e){let t=0;return e.store("remoteDocuments").J((r,i)=>{t+=ju(i)}).next(()=>{let r={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",r)})}ni(e){let t=e.store("mutationQueues"),r=e.store("mutations");return t.U().next(i=>R.forEach(i,s=>{let o=IDBKeyRange.bound([s.userId,-1],[s.userId,s.lastAcknowledgedBatchId]);return r.U("userMutationsIndex",o).next(a=>R.forEach(a,u=>{Q(u.userId===s.userId);let c=qr(this.serializer,u);return aS(e,s.userId,c).next(()=>{})}))}))}ii(e){let t=e.store("targetDocuments"),r=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(i=>{let s=[];return r.J((o,a)=>{let u=new me(o),c=function(f){return[0,yt(f)]}(u);s.push(t.get(c).next(d=>d?R.resolve():(f=>t.put({targetId:0,path:yt(f),sequenceNumber:i.highestListenSequenceNumber}))(u)))}).next(()=>R.waitFor(s))})}si(e,t){e.createObjectStore("collectionParents",{keyPath:UN});let r=t.store("collectionParents"),i=new ra,s=o=>{if(i.add(o)){let a=o.lastSegment(),u=o.popLast();return r.put({collectionId:a,parent:yt(u)})}};return t.store("remoteDocuments").J({H:!0},(o,a)=>{let u=new me(o);return s(u.popLast())}).next(()=>t.store("documentMutations").J({H:!0},([o,a,u],c)=>{let d=cn(a);return s(d.popLast())}))}oi(e){let t=e.store("targets");return t.J((r,i)=>{let s=Lo(i),o=iS(this.serializer,s);return t.put(o)})}_i(e,t){let r=t.store("remoteDocuments"),i=[];return r.J((s,o)=>{let a=t.store("remoteDocumentsV14"),u=function(f){return f.document?new j(me.fromString(f.document.name).popFirst(5)):f.noDocument?j.fromSegments(f.noDocument.path):f.unknownDocument?j.fromSegments(f.unknownDocument.path):z()}(o).path.toArray(),c={prefixPath:u.slice(0,u.length-2),collectionGroup:u[u.length-2],documentId:u[u.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};i.push(a.put(c))}).next(()=>R.waitFor(i))}ai(e,t){let r=t.store("mutations"),i=cS(this.serializer),s=new Wu(Qu.Zr,this.serializer.ct);return r.U().next(o=>{let a=new Map;return o.forEach(u=>{var c;let d=(c=a.get(u.userId))!==null&&c!==void 0?c:ie();qr(this.serializer,u).keys().forEach(f=>d=d.add(f)),a.set(u.userId,d)}),R.forEach(a,(u,c)=>{let d=new $e(c),f=Bu.lt(this.serializer,d),m=s.getIndexManager(d),_=zu.lt(d,this.serializer,m,s.referenceDelegate);return new Gu(i,_,f,m).recalculateAndSaveOverlaysForDocumentKeys(new Wo(t,Nt.oe),u).next()})})}};function GT(n){n.createObjectStore("targetDocuments",{keyPath:LN}).createIndex("documentTargetsIndex",BN,{unique:!0}),n.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",VN,{unique:!0}),n.createObjectStore("targetGlobal")}var zf="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",nm=class n{constructor(e,t,r,i,s,o,a,u,c,d,f=17){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.ui=s,this.window=o,this.document=a,this.ci=c,this.li=d,this.hi=f,this.Qr=null,this.Kr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Pi=null,this.inForeground=!1,this.Ii=null,this.Ti=null,this.Ei=Number.NEGATIVE_INFINITY,this.di=m=>Promise.resolve(),!n.D())throw new k(D.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new zp(this,i),this.Ai=t+"main",this.serializer=new Vu(u),this.Ri=new hr(this.Ai,this.hi,new tm(this.serializer)),this.$r=new Np,this.Ur=new Bp(this.referenceDelegate,this.serializer),this.remoteDocumentCache=cS(this.serializer),this.Gr=new Pp,this.window&&this.window.localStorage?this.Vi=this.window.localStorage:(this.Vi=null,d===!1&&qe("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.mi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new k(D.FAILED_PRECONDITION,zf);return this.fi(),this.gi(),this.pi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Ur.getHighestSequenceNumber(e))}).then(e=>{this.Qr=new Nt(e,this.ci)}).then(()=>{this.Kr=!0}).catch(e=>(this.Ri&&this.Ri.close(),Promise.reject(e)))}yi(e){return this.di=t=>x(this,null,function*(){if(this.started)return e(t)}),e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ri.L(t=>x(this,null,function*(){t.newVersion===null&&(yield e())}))}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.ui.enqueueAndForget(()=>x(this,null,function*(){this.started&&(yield this.mi())})))}mi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>mu(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.wi(e).next(t=>{t||(this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)))})}).next(()=>this.Si(e)).next(t=>this.isPrimary&&!t?this.bi(e).next(()=>!1):!!t&&this.Di(e).next(()=>!0))).catch(e=>{if(Ir(e))return M("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return M("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.ui.enqueueRetryable(()=>this.di(e)),this.isPrimary=e})}wi(e){return Oo(e).get("owner").next(t=>R.resolve(this.vi(t)))}Ci(e){return mu(e).delete(this.clientId)}Fi(){return x(this,null,function*(){if(this.isPrimary&&!this.Mi(this.Ei,18e5)){this.Ei=Date.now();let e=yield this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{let r=Ze(t,"clientMetadata");return r.U().next(i=>{let s=this.xi(i,18e5),o=i.filter(a=>s.indexOf(a)===-1);return R.forEach(o,a=>r.delete(a.clientId)).next(()=>o)})}).catch(()=>[]);if(this.Vi)for(let t of e)this.Vi.removeItem(this.Oi(t.clientId))}})}pi(){this.Ti=this.ui.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.mi().then(()=>this.Fi()).then(()=>this.pi()))}vi(e){return!!e&&e.ownerId===this.clientId}Si(e){return this.li?R.resolve(!0):Oo(e).get("owner").next(t=>{if(t!==null&&this.Mi(t.leaseTimestampMs,5e3)&&!this.Ni(t.ownerId)){if(this.vi(t)&&this.networkEnabled)return!0;if(!this.vi(t)){if(!t.allowTabSynchronization)throw new k(D.FAILED_PRECONDITION,zf);return!1}}return!(!this.networkEnabled||!this.inForeground)||mu(e).U().next(r=>this.xi(r,5e3).find(i=>{if(this.clientId!==i.clientId){let s=!this.networkEnabled&&i.networkEnabled,o=!this.inForeground&&i.inForeground,a=this.networkEnabled===i.networkEnabled;if(s||o&&a)return!0}return!1})===void 0)}).next(t=>(this.isPrimary!==t&&M("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}shutdown(){return x(this,null,function*(){this.Kr=!1,this.Li(),this.Ti&&(this.Ti.cancel(),this.Ti=null),this.Bi(),this.ki(),yield this.Ri.runTransaction("shutdown","readwrite",["owner","clientMetadata"],e=>{let t=new Wo(e,Nt.oe);return this.bi(t).next(()=>this.Ci(t))}),this.Ri.close(),this.qi()})}xi(e,t){return e.filter(r=>this.Mi(r.updateTimeMs,t)&&!this.Ni(r.clientId))}Qi(){return this.runTransaction("getActiveClients","readonly",e=>mu(e).U().next(t=>this.xi(t,18e5).map(r=>r.clientId)))}get started(){return this.Kr}getGlobalsCache(){return this.$r}getMutationQueue(e,t){return zu.lt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new Lp(e,this.serializer.ct.databaseId)}getDocumentOverlayCache(e){return Bu.lt(this.serializer,e)}getBundleCache(){return this.Gr}runTransaction(e,t,r){M("IndexedDbPersistence","Starting transaction:",e);let i=t==="readonly"?"readonly":"readwrite",s=function(u){return u===17?YN:u===16?HN:u===15?Hm:u===14?_C:u===13?gC:u===12?$N:u===11?mC:void z()}(this.hi),o;return this.Ri.runTransaction(e,i,s,a=>(o=new Wo(a,this.Qr?this.Qr.next():Nt.oe),t==="readwrite-primary"?this.wi(o).next(u=>!!u||this.Si(o)).next(u=>{if(!u)throw qe(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)),new k(D.FAILED_PRECONDITION,hC);return r(o)}).next(u=>this.Di(o).next(()=>u)):this.Ki(o).next(()=>r(o)))).then(a=>(o.raiseOnCommittedEvent(),a))}Ki(e){return Oo(e).get("owner").next(t=>{if(t!==null&&this.Mi(t.leaseTimestampMs,5e3)&&!this.Ni(t.ownerId)&&!this.vi(t)&&!(this.li||this.allowTabSynchronization&&t.allowTabSynchronization))throw new k(D.FAILED_PRECONDITION,zf)})}Di(e){let t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Oo(e).put("owner",t)}static D(){return hr.D()}bi(e){let t=Oo(e);return t.get("owner").next(r=>this.vi(r)?(M("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):R.resolve())}Mi(e,t){let r=Date.now();return!(e<r-t)&&(!(e>r)||(qe(`Detected an update time that is in the future: ${e} > ${r}`),!1))}fi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Ii=()=>{this.ui.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.mi()))},this.document.addEventListener("visibilitychange",this.Ii),this.inForeground=this.document.visibilityState==="visible")}Bi(){this.Ii&&(this.document.removeEventListener("visibilitychange",this.Ii),this.Ii=null)}gi(){var e;typeof((e=this.window)===null||e===void 0?void 0:e.addEventListener)=="function"&&(this.Pi=()=>{this.Li();let t=/(?:Version|Mobile)\/1[456]/;Oh()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.ui.enterRestrictedMode(!0),this.ui.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Pi))}ki(){this.Pi&&(this.window.removeEventListener("pagehide",this.Pi),this.Pi=null)}Ni(e){var t;try{let r=((t=this.Vi)===null||t===void 0?void 0:t.getItem(this.Oi(e)))!==null;return M("IndexedDbPersistence",`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return qe("IndexedDbPersistence","Failed to get zombied client id.",r),!1}}Li(){if(this.Vi)try{this.Vi.setItem(this.Oi(this.clientId),String(Date.now()))}catch(e){qe("Failed to set zombie client id.",e)}}qi(){if(this.Vi)try{this.Vi.removeItem(this.Oi(this.clientId))}catch{}}Oi(e){return`firestore_zombie_${this.persistenceKey}_${e}`}};function Oo(n){return Ze(n,"owner")}function mu(n){return Ze(n,"clientMetadata")}function ig(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}var rm=class n{constructor(e,t,r,i){this.targetId=e,this.fromCache=t,this.$i=r,this.Ui=i}static Wi(e,t){let r=ie(),i=ie();for(let s of t.docChanges)switch(s.type){case 0:r=r.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new n(e,t.fromCache,r,i)}};var im=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}};var $u=class{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=function(){return Oh()?8:dC($s())>0?6:4}()}initialize(e,t){this.Ji=e,this.indexManager=t,this.Gi=!0}getDocumentsMatchingQuery(e,t,r,i){let s={result:null};return this.Yi(e,t).next(o=>{s.result=o}).next(()=>{if(!s.result)return this.Zi(e,t,i,r).next(o=>{s.result=o})}).next(()=>{if(s.result)return;let o=new im;return this.Xi(e,t,o).next(a=>{if(s.result=a,this.zi)return this.es(e,t,o,a.size)})}).next(()=>s.result)}es(e,t,r,i){return r.documentReadCount<this.ji?(Qi()<=Vt.DEBUG&&M("QueryEngine","SDK will not create cache indexes for query:",$i(t),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),R.resolve()):(Qi()<=Vt.DEBUG&&M("QueryEngine","Query:",$i(t),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.Hi*i?(Qi()<=Vt.DEBUG&&M("QueryEngine","The SDK decides to create cache indexes for query:",$i(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,vt(t))):R.resolve())}Yi(e,t){if(yT(t))return R.resolve(null);let r=vt(t);return this.indexManager.getIndexType(e,r).next(i=>i===0?null:(t.limit!==null&&i===1&&(t=ku(t,null,"F"),r=vt(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(s=>{let o=ie(...s);return this.Ji.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,r).next(u=>{let c=this.ts(t,a);return this.ns(t,c,o,u.readTime)?this.Yi(e,ku(t,null,"F")):this.rs(e,c,t,u)}))})))}Zi(e,t,r,i){return yT(t)||i.isEqual(Y.min())?R.resolve(null):this.Ji.getDocuments(e,r).next(s=>{let o=this.ts(t,s);return this.ns(t,o,r,i)?R.resolve(null):(Qi()<=Vt.DEBUG&&M("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),$i(t)),this.rs(e,o,t,uC(i,-1)).next(a=>a))})}ts(e,t){let r=new Ce(DC(e));return t.forEach((i,s)=>{pa(e,s)&&(r=r.add(s))}),r}ns(e,t,r,i){if(e.limit===null)return!1;if(r.size!==t.size)return!0;let s=e.limitType==="F"?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}Xi(e,t,r){return Qi()<=Vt.DEBUG&&M("QueryEngine","Using full collection scan to execute query:",$i(t)),this.Ji.getDocumentsMatchingQuery(e,t,jt.min(),r)}rs(e,t,r,i){return this.Ji.getDocumentsMatchingQuery(e,r,i).next(s=>(t.forEach(o=>{s=s.insert(o.key,o)}),s))}};var sm=class{constructor(e,t,r,i){this.persistence=e,this.ss=t,this.serializer=i,this.os=new Ne(te),this._s=new _n(s=>Hr(s),da),this.us=new Map,this.cs=e.getRemoteDocumentCache(),this.Ur=e.getTargetCache(),this.Gr=e.getBundleCache(),this.ls(r)}ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Gu(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.os))}};function hS(n,e,t,r){return new sm(n,e,t,r)}function dS(n,e){return x(this,null,function*(){let t=q(n);return yield t.persistence.runTransaction("Handle user change","readonly",r=>{let i;return t.mutationQueue.getAllMutationBatches(r).next(s=>(i=s,t.ls(e),t.mutationQueue.getAllMutationBatches(r))).next(s=>{let o=[],a=[],u=ie();for(let c of i){o.push(c.batchId);for(let d of c.mutations)u=u.add(d.key)}for(let c of s){a.push(c.batchId);for(let d of c.mutations)u=u.add(d.key)}return t.localDocuments.getDocuments(r,u).next(c=>({hs:c,removedBatchIds:o,addedBatchIds:a}))})})})}function PD(n,e){let t=q(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{let i=e.batch.keys(),s=t.cs.newChangeBuffer({trackRemovals:!0});return function(a,u,c,d){let f=c.batch,m=f.keys(),_=R.resolve();return m.forEach(I=>{_=_.next(()=>d.getEntry(u,I)).next(S=>{let P=c.docVersions.get(I);Q(P!==null),S.version.compareTo(P)<0&&(f.applyToRemoteDocument(S,c),S.isValidDocument()&&(S.setReadTime(c.commitVersion),d.addEntry(S)))})}),_.next(()=>a.mutationQueue.removeMutationBatch(u,f))}(t,r,e,s).next(()=>s.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(a){let u=ie();for(let c=0;c<a.mutationResults.length;++c)a.mutationResults[c].transformResults.length>0&&(u=u.add(a.batch.mutations[c].key));return u}(e))).next(()=>t.localDocuments.getDocuments(r,i))})}function fS(n){let e=q(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Ur.getLastRemoteSnapshotVersion(t))}function ND(n,e){let t=q(n),r=e.snapshotVersion,i=t.os;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{let o=t.cs.newChangeBuffer({trackRemovals:!0});i=t.os;let a=[];e.targetChanges.forEach((d,f)=>{let m=i.get(f);if(!m)return;a.push(t.Ur.removeMatchingKeys(s,d.removedDocuments,f).next(()=>t.Ur.addMatchingKeys(s,d.addedDocuments,f)));let _=m.withSequenceNumber(s.currentSequenceNumber);e.targetMismatches.get(f)!==null?_=_.withResumeToken(Ke.EMPTY_BYTE_STRING,Y.min()).withLastLimboFreeSnapshotVersion(Y.min()):d.resumeToken.approximateByteSize()>0&&(_=_.withResumeToken(d.resumeToken,r)),i=i.insert(f,_),function(S,P,V){return S.resumeToken.approximateByteSize()===0||P.snapshotVersion.toMicroseconds()-S.snapshotVersion.toMicroseconds()>=3e8?!0:V.addedDocuments.size+V.modifiedDocuments.size+V.removedDocuments.size>0}(m,_,d)&&a.push(t.Ur.updateTargetData(s,_))});let u=Ct(),c=ie();if(e.documentUpdates.forEach(d=>{e.resolvedLimboDocuments.has(d)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(s,d))}),a.push(pS(s,o,e.documentUpdates).next(d=>{u=d.Ps,c=d.Is})),!r.isEqual(Y.min())){let d=t.Ur.getLastRemoteSnapshotVersion(s).next(f=>t.Ur.setTargetsMetadata(s,s.currentSequenceNumber,r));a.push(d)}return R.waitFor(a).next(()=>o.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,u,c)).next(()=>u)}).then(s=>(t.os=i,s))}function pS(n,e,t){let r=ie(),i=ie();return t.forEach(s=>r=r.add(s)),e.getEntries(n,r).next(s=>{let o=Ct();return t.forEach((a,u)=>{let c=s.get(a);u.isFoundDocument()!==c.isFoundDocument()&&(i=i.add(a)),u.isNoDocument()&&u.version.isEqual(Y.min())?(e.removeEntry(a,u.readTime),o=o.insert(a,u)):!c.isValidDocument()||u.version.compareTo(c.version)>0||u.version.compareTo(c.version)===0&&c.hasPendingWrites?(e.addEntry(u),o=o.insert(a,u)):M("LocalStore","Ignoring outdated watch update for ",a,". Current version:",c.version," Watch version:",u.version)}),{Ps:o,Is:i}})}function DD(n,e){let t=q(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function hs(n,e){let t=q(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return t.Ur.getTargetData(r,e).next(s=>s?(i=s,R.resolve(i)):t.Ur.allocateTargetId(r).next(o=>(i=new us(e,o,"TargetPurposeListen",r.currentSequenceNumber),t.Ur.addTargetData(r,i).next(()=>i))))}).then(r=>{let i=t.os.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.os=t.os.insert(r.targetId,r),t._s.set(e,r.targetId)),r})}function ds(n,e,t){return x(this,null,function*(){let r=q(n),i=r.os.get(e),s=t?"readwrite":"readwrite-primary";try{t||(yield r.persistence.runTransaction("Release target",s,o=>r.persistence.referenceDelegate.removeTarget(o,i)))}catch(o){if(!Ir(o))throw o;M("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}r.os=r.os.remove(e),r._s.delete(i.target)})}function Hu(n,e,t){let r=q(n),i=Y.min(),s=ie();return r.persistence.runTransaction("Execute query","readwrite",o=>function(u,c,d){let f=q(u),m=f._s.get(d);return m!==void 0?R.resolve(f.os.get(m)):f.Ur.getTargetData(c,d)}(r,o,vt(e)).next(a=>{if(a)return i=a.lastLimboFreeSnapshotVersion,r.Ur.getMatchingKeysForTargetId(o,a.targetId).next(u=>{s=u})}).next(()=>r.ss.getDocumentsMatchingQuery(o,e,t?i:Y.min(),t?s:ie())).next(a=>(_S(r,NC(e),a),{documents:a,Ts:s})))}function mS(n,e){let t=q(n),r=q(t.Ur),i=t.os.get(e);return i?Promise.resolve(i.target):t.persistence.runTransaction("Get target data","readonly",s=>r.ot(s,e).next(o=>o?o.target:null))}function gS(n,e){let t=q(n),r=t.us.get(e)||Y.min();return t.persistence.runTransaction("Get new document changes","readonly",i=>t.cs.getAllFromCollectionGroup(i,e,uC(r,-1),Number.MAX_SAFE_INTEGER)).then(i=>(_S(t,e,i),i))}function _S(n,e,t){let r=n.us.get(e)||Y.min();t.forEach((i,s)=>{s.readTime.compareTo(r)>0&&(r=s.readTime)}),n.us.set(e,r)}function xD(n,e,t,r){return x(this,null,function*(){let i=q(n),s=ie(),o=Ct();for(let c of t){let d=e.Es(c.metadata.name);c.document&&(s=s.add(d));let f=e.ds(c);f.setReadTime(e.As(c.metadata.readTime)),o=o.insert(d,f)}let a=i.cs.newChangeBuffer({trackRemovals:!0}),u=yield hs(i,function(d){return vt(ws(me.fromString(`__bundle__/docs/${d}`)))}(r));return i.persistence.runTransaction("Apply bundle documents","readwrite",c=>pS(c,a,o).next(d=>(a.apply(c),d)).next(d=>i.Ur.removeMatchingKeysForTargetId(c,u.targetId).next(()=>i.Ur.addMatchingKeys(c,s,u.targetId)).next(()=>i.localDocuments.getLocalViewOfDocuments(c,d.Ps,d.Is)).next(()=>d.Ps)))})}function kD(r,i){return x(this,arguments,function*(n,e,t=ie()){let s=yield hs(n,vt(ng(e.bundledQuery))),o=q(n);return o.persistence.runTransaction("Save named query","readwrite",a=>{let u=ze(e.readTime);if(s.snapshotVersion.compareTo(u)>=0)return o.Gr.saveNamedQuery(a,e);let c=s.withResumeToken(Ke.EMPTY_BYTE_STRING,u);return o.os=o.os.insert(c.targetId,c),o.Ur.updateTargetData(a,c).next(()=>o.Ur.removeMatchingKeysForTargetId(a,s.targetId)).next(()=>o.Ur.addMatchingKeys(a,t,s.targetId)).next(()=>o.Gr.saveNamedQuery(a,e))})})}function WT(n,e){return`firestore_clients_${n}_${e}`}function QT(n,e,t){let r=`firestore_mutations_${n}_${t}`;return e.isAuthenticated()&&(r+=`_${e.uid}`),r}function Kf(n,e){return`firestore_targets_${n}_${e}`}var Yu=class n{constructor(e,t,r,i){this.user=e,this.batchId=t,this.state=r,this.error=i}static Rs(e,t,r){let i=JSON.parse(r),s,o=typeof i=="object"&&["pending","acknowledged","rejected"].indexOf(i.state)!==-1&&(i.error===void 0||typeof i.error=="object");return o&&i.error&&(o=typeof i.error.message=="string"&&typeof i.error.code=="string",o&&(s=new k(i.error.code,i.error.message))),o?new n(e,t,i.state,s):(qe("SharedClientState",`Failed to parse mutation state for ID '${t}': ${r}`),null)}Vs(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}},jo=class n{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static Rs(e,t){let r=JSON.parse(t),i,s=typeof r=="object"&&["not-current","current","rejected"].indexOf(r.state)!==-1&&(r.error===void 0||typeof r.error=="object");return s&&r.error&&(s=typeof r.error.message=="string"&&typeof r.error.code=="string",s&&(i=new k(r.error.code,r.error.message))),s?new n(e,r.state,i):(qe("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}Vs(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}},Ju=class n{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Rs(e,t){let r=JSON.parse(t),i=typeof r=="object"&&r.activeTargetIds instanceof Array,s=Zm();for(let o=0;i&&o<r.activeTargetIds.length;++o)i=fC(r.activeTargetIds[o]),s=s.add(r.activeTargetIds[o]);return i?new n(e,s):(qe("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}},om=class n{constructor(e,t){this.clientId=e,this.onlineState=t}static Rs(e){let t=JSON.parse(e);return typeof t=="object"&&["Unknown","Online","Offline"].indexOf(t.onlineState)!==-1&&typeof t.clientId=="string"?new n(t.clientId,t.onlineState):(qe("SharedClientState",`Failed to parse online state: ${e}`),null)}},sa=class{constructor(){this.activeTargetIds=Zm()}fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Vs(){let e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}},zo=class{constructor(e,t,r,i,s){this.window=e,this.ui=t,this.persistenceKey=r,this.ps=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.ys=this.ws.bind(this),this.Ss=new Ne(te),this.started=!1,this.bs=[];let o=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.Ds=WT(this.persistenceKey,this.ps),this.vs=function(u){return`firestore_sequence_number_${u}`}(this.persistenceKey),this.Ss=this.Ss.insert(this.ps,new sa),this.Cs=new RegExp(`^firestore_clients_${o}_([^_]*)$`),this.Fs=new RegExp(`^firestore_mutations_${o}_(\\d+)(?:_(.*))?$`),this.Ms=new RegExp(`^firestore_targets_${o}_(\\d+)$`),this.xs=function(u){return`firestore_online_state_${u}`}(this.persistenceKey),this.Os=function(u){return`firestore_bundle_loaded_v2_${u}`}(this.persistenceKey),this.window.addEventListener("storage",this.ys)}static D(e){return!(!e||!e.localStorage)}start(){return x(this,null,function*(){let e=yield this.syncEngine.Qi();for(let r of e){if(r===this.ps)continue;let i=this.getItem(WT(this.persistenceKey,r));if(i){let s=Ju.Rs(r,i);s&&(this.Ss=this.Ss.insert(s.clientId,s))}}this.Ns();let t=this.storage.getItem(this.xs);if(t){let r=this.Ls(t);r&&this.Bs(r)}for(let r of this.bs)this.ws(r);this.bs=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0})}writeSequenceNumber(e){this.setItem(this.vs,JSON.stringify(e))}getAllActiveQueryTargets(){return this.ks(this.Ss)}isActiveQueryTarget(e){let t=!1;return this.Ss.forEach((r,i)=>{i.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.qs(e,"pending")}updateMutationState(e,t,r){this.qs(e,t,r),this.Qs(e)}addLocalQueryTarget(e,t=!0){let r="not-current";if(this.isActiveQueryTarget(e)){let i=this.storage.getItem(Kf(this.persistenceKey,e));if(i){let s=jo.Rs(e,i);s&&(r=s.state)}}return t&&this.Ks.fs(e),this.Ns(),r}removeLocalQueryTarget(e){this.Ks.gs(e),this.Ns()}isLocalQueryTarget(e){return this.Ks.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(Kf(this.persistenceKey,e))}updateQueryState(e,t,r){this.$s(e,t,r)}handleUserChange(e,t,r){t.forEach(i=>{this.Qs(i)}),this.currentUser=e,r.forEach(i=>{this.addPendingMutation(i)})}setOnlineState(e){this.Us(e)}notifyBundleLoaded(e){this.Ws(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.ys),this.removeItem(this.Ds),this.started=!1)}getItem(e){let t=this.storage.getItem(e);return M("SharedClientState","READ",e,t),t}setItem(e,t){M("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){M("SharedClientState","REMOVE",e),this.storage.removeItem(e)}ws(e){let t=e;if(t.storageArea===this.storage){if(M("SharedClientState","EVENT",t.key,t.newValue),t.key===this.Ds)return void qe("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.ui.enqueueRetryable(()=>x(this,null,function*(){if(this.started){if(t.key!==null){if(this.Cs.test(t.key)){if(t.newValue==null){let r=this.Gs(t.key);return this.zs(r,null)}{let r=this.js(t.key,t.newValue);if(r)return this.zs(r.clientId,r)}}else if(this.Fs.test(t.key)){if(t.newValue!==null){let r=this.Hs(t.key,t.newValue);if(r)return this.Js(r)}}else if(this.Ms.test(t.key)){if(t.newValue!==null){let r=this.Ys(t.key,t.newValue);if(r)return this.Zs(r)}}else if(t.key===this.xs){if(t.newValue!==null){let r=this.Ls(t.newValue);if(r)return this.Bs(r)}}else if(t.key===this.vs){let r=function(s){let o=Nt.oe;if(s!=null)try{let a=JSON.parse(s);Q(typeof a=="number"),o=a}catch(a){qe("SharedClientState","Failed to read sequence number from WebStorage",a)}return o}(t.newValue);r!==Nt.oe&&this.sequenceNumberHandler(r)}else if(t.key===this.Os){let r=this.Xs(t.newValue);yield Promise.all(r.map(i=>this.syncEngine.eo(i)))}}}else this.bs.push(t)}))}}get Ks(){return this.Ss.get(this.ps)}Ns(){this.setItem(this.Ds,this.Ks.Vs())}qs(e,t,r){let i=new Yu(this.currentUser,e,t,r),s=QT(this.persistenceKey,this.currentUser,e);this.setItem(s,i.Vs())}Qs(e){let t=QT(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Us(e){let t={clientId:this.ps,onlineState:e};this.storage.setItem(this.xs,JSON.stringify(t))}$s(e,t,r){let i=Kf(this.persistenceKey,e),s=new jo(e,t,r);this.setItem(i,s.Vs())}Ws(e){let t=JSON.stringify(Array.from(e));this.setItem(this.Os,t)}Gs(e){let t=this.Cs.exec(e);return t?t[1]:null}js(e,t){let r=this.Gs(e);return Ju.Rs(r,t)}Hs(e,t){let r=this.Fs.exec(e),i=Number(r[1]),s=r[2]!==void 0?r[2]:null;return Yu.Rs(new $e(s),i,t)}Ys(e,t){let r=this.Ms.exec(e),i=Number(r[1]);return jo.Rs(i,t)}Ls(e){return om.Rs(e)}Xs(e){return JSON.parse(e)}Js(e){return x(this,null,function*(){if(e.user.uid===this.currentUser.uid)return this.syncEngine.no(e.batchId,e.state,e.error);M("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)})}Zs(e){return this.syncEngine.ro(e.targetId,e.state,e.error)}zs(e,t){let r=t?this.Ss.insert(e,t):this.Ss.remove(e),i=this.ks(this.Ss),s=this.ks(r),o=[],a=[];return s.forEach(u=>{i.has(u)||o.push(u)}),i.forEach(u=>{s.has(u)||a.push(u)}),this.syncEngine.io(o,a).then(()=>{this.Ss=r})}Bs(e){this.Ss.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}ks(e){let t=Zm();return e.forEach((r,i)=>{t=t.unionWith(i.activeTargetIds)}),t}},Xu=class{constructor(){this.so=new sa,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.so.fs(e),this.oo[e]||"not-current"}updateQueryState(e,t,r){this.oo[e]=t}removeLocalQueryTarget(e){this.so.gs(e)}isLocalQueryTarget(e){return this.so.activeTargetIds.has(e)}clearQueryState(e){delete this.oo[e]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(e){return this.so.activeTargetIds.has(e)}start(){return this.so=new sa,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}};var am=class{_o(e){}shutdown(){}};var Zu=class{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(e){this.ho.push(e)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){M("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(let e of this.ho)e(0)}lo(){M("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(let e of this.ho)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}};var gu=null;function Gf(){return gu===null?gu=function(){return 268435456+Math.round(2147483648*Math.random())}():gu++,"0x"+gu.toString(16)}var MD={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};var lm=class{constructor(e){this.Io=e.Io,this.To=e.To}Eo(e){this.Ao=e}Ro(e){this.Vo=e}mo(e){this.fo=e}onMessage(e){this.po=e}close(){this.To()}send(e){this.Io(e)}yo(){this.Ao()}wo(){this.Vo()}So(e){this.fo(e)}bo(e){this.po(e)}};var ct="WebChannelConnection",um=class extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;let r=t.ssl?"https":"http",i=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.Do=r+"://"+t.host,this.vo=`projects/${i}/databases/${s}`,this.Co=this.databaseId.database==="(default)"?`project_id=${i}`:`project_id=${i}&database_id=${s}`}get Fo(){return!1}Mo(t,r,i,s,o){let a=Gf(),u=this.xo(t,r.toUriEncodedString());M("RestConnection",`Sending RPC '${t}' ${a}:`,u,i);let c={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(c,s,o),this.No(t,u,c,i).then(d=>(M("RestConnection",`Received RPC '${t}' ${a}: `,d),d),d=>{throw $t("RestConnection",`RPC '${t}' ${a} failed with error: `,d,"url: ",u,"request:",i),d})}Lo(t,r,i,s,o,a){return this.Mo(t,r,i,s,o)}Oo(t,r,i){t["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+vs}(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),r&&r.headers.forEach((s,o)=>t[o]=s),i&&i.headers.forEach((s,o)=>t[o]=s)}xo(t,r){let i=MD[t];return`${this.Do}/v1/${r}:${i}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}No(e,t,r,i){let s=Gf();return new Promise((o,a)=>{let u=new Vf;u.setWithCredentials(!0),u.listenOnce(Lf.COMPLETE,()=>{try{switch(u.getLastErrorCode()){case xo.NO_ERROR:let d=u.getResponseJson();M(ct,`XHR for RPC '${e}' ${s} received:`,JSON.stringify(d)),o(d);break;case xo.TIMEOUT:M(ct,`RPC '${e}' ${s} timed out`),a(new k(D.DEADLINE_EXCEEDED,"Request time out"));break;case xo.HTTP_ERROR:let f=u.getStatus();if(M(ct,`RPC '${e}' ${s} failed with status:`,f,"response text:",u.getResponseText()),f>0){let m=u.getResponseJson();Array.isArray(m)&&(m=m[0]);let _=m?.error;if(_&&_.status&&_.message){let I=function(P){let V=P.toLowerCase().replace(/_/g,"-");return Object.values(D).indexOf(V)>=0?V:D.UNKNOWN}(_.status);a(new k(I,_.message))}else a(new k(D.UNKNOWN,"Server responded with status "+u.getStatus()))}else a(new k(D.UNAVAILABLE,"Connection failed."));break;default:z()}}finally{M(ct,`RPC '${e}' ${s} completed.`)}});let c=JSON.stringify(i);M(ct,`RPC '${e}' ${s} sending request:`,i),u.send(t,"POST",c,r,15)})}Bo(e,t,r){let i=Gf(),s=[this.Do,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=qf(),a=Uf(),u={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;c!==void 0&&(u.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(u.useFetchStreams=!0),this.Oo(u.initMessageHeaders,t,r),u.encodeInitMessageHeaders=!0;let d=s.join("");M(ct,`Creating RPC '${e}' stream ${i}: ${d}`,u);let f=o.createWebChannel(d,u),m=!1,_=!1,I=new lm({Io:P=>{_?M(ct,`Not sending because RPC '${e}' stream ${i} is closed:`,P):(m||(M(ct,`Opening RPC '${e}' stream ${i} transport.`),f.open(),m=!0),M(ct,`RPC '${e}' stream ${i} sending:`,P),f.send(P))},To:()=>f.close()}),S=(P,V,U)=>{P.listen(V,L=>{try{U(L)}catch($){setTimeout(()=>{throw $},0)}})};return S(f,ji.EventType.OPEN,()=>{_||(M(ct,`RPC '${e}' stream ${i} transport opened.`),I.yo())}),S(f,ji.EventType.CLOSE,()=>{_||(_=!0,M(ct,`RPC '${e}' stream ${i} transport closed`),I.So())}),S(f,ji.EventType.ERROR,P=>{_||(_=!0,$t(ct,`RPC '${e}' stream ${i} transport errored:`,P),I.So(new k(D.UNAVAILABLE,"The operation could not be completed")))}),S(f,ji.EventType.MESSAGE,P=>{var V;if(!_){let U=P.data[0];Q(!!U);let L=U,$=L.error||((V=L[0])===null||V===void 0?void 0:V.error);if($){M(ct,`RPC '${e}' stream ${i} received error:`,$);let re=$.status,X=function(w){let T=We[w];if(T!==void 0)return KC(T)}(re),E=$.message;X===void 0&&(X=D.INTERNAL,E="Unknown error status: "+re+" with message "+$.message),_=!0,I.So(new k(X,E)),f.close()}else M(ct,`RPC '${e}' stream ${i} received:`,U),I.bo(U)}}),S(a,Bf.STAT_EVENT,P=>{P.stat===du.PROXY?M(ct,`RPC '${e}' stream ${i} detected buffering proxy`):P.stat===du.NOPROXY&&M(ct,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{I.wo()},0),I}};function yS(){return typeof window<"u"?window:null}function Iu(){return typeof document<"u"?document:null}function ma(n){return new Cp(n,!0)}var oa=class{constructor(e,t,r=1e3,i=1.5,s=6e4){this.ui=e,this.timerId=t,this.ko=r,this.qo=i,this.Qo=s,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(e){this.cancel();let t=Math.floor(this.Ko+this.zo()),r=Math.max(0,Date.now()-this.Uo),i=Math.max(0,t-r);i>0&&M("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.Ko} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,i,()=>(this.Uo=Date.now(),e())),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){this.$o!==null&&(this.$o.skipDelay(),this.$o=null)}cancel(){this.$o!==null&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}};var ec=class{constructor(e,t,r,i,s,o,a,u){this.ui=e,this.Ho=r,this.Jo=i,this.connection=s,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=u,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new oa(e,t)}n_(){return this.state===1||this.state===5||this.r_()}r_(){return this.state===2||this.state===3}start(){this.e_=0,this.state!==4?this.auth():this.i_()}stop(){return x(this,null,function*(){this.n_()&&(yield this.close(0))})}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&this.Zo===null&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,()=>this.__()))}a_(e){this.u_(),this.stream.send(e)}__(){return x(this,null,function*(){if(this.r_())return this.close(0)})}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}close(e,t){return x(this,null,function*(){this.u_(),this.c_(),this.t_.cancel(),this.Yo++,e!==4?this.t_.reset():t&&t.code===D.RESOURCE_EXHAUSTED?(qe(t.toString()),qe("Using maximum backoff delay to prevent overloading the backend."),this.t_.Wo()):t&&t.code===D.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.l_(),this.stream.close(),this.stream=null),this.state=e,yield this.listener.mo(t)})}l_(){}auth(){this.state=1;let e=this.h_(this.Yo),t=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.Yo===t&&this.P_(r,i)},r=>{e(()=>{let i=new k(D.UNKNOWN,"Fetching auth token failed: "+r.message);return this.I_(i)})})}P_(e,t){let r=this.h_(this.Yo);this.stream=this.T_(e,t),this.stream.Eo(()=>{r(()=>this.listener.Eo())}),this.stream.Ro(()=>{r(()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,()=>(this.r_()&&(this.state=3),Promise.resolve())),this.listener.Ro()))}),this.stream.mo(i=>{r(()=>this.I_(i))}),this.stream.onMessage(i=>{r(()=>++this.e_==1?this.E_(i):this.onNext(i))})}i_(){this.state=5,this.t_.Go(()=>x(this,null,function*(){this.state=0,this.start()}))}I_(e){return M("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}h_(e){return t=>{this.ui.enqueueAndForget(()=>this.Yo===e?t():(M("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},cm=class extends ec{constructor(e,t,r,i,s,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,i,o),this.serializer=s}T_(e,t){return this.connection.Bo("Listen",e,t)}E_(e){return this.onNext(e)}onNext(e){this.t_.reset();let t=yD(this.serializer,e),r=function(s){if(!("targetChange"in s))return Y.min();let o=s.targetChange;return o.targetIds&&o.targetIds.length?Y.min():o.readTime?ze(o.readTime):Y.min()}(e);return this.listener.d_(t,r)}A_(e){let t={};t.database=Ap(this.serializer),t.addTarget=function(s,o){let a,u=o.target;if(a=Du(u)?{documents:XC(s,u)}:{query:ZC(s,u)._t},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=WC(s,o.resumeToken);let c=Sp(s,o.expectedCount);c!==null&&(a.expectedCount=c)}else if(o.snapshotVersion.compareTo(Y.min())>0){a.readTime=ls(s,o.snapshotVersion.toTimestamp());let c=Sp(s,o.expectedCount);c!==null&&(a.expectedCount=c)}return a}(this.serializer,e);let r=wD(this.serializer,e);r&&(t.labels=r),this.a_(t)}R_(e){let t={};t.database=Ap(this.serializer),t.removeTarget=e,this.a_(t)}},hm=class extends ec{constructor(e,t,r,i,s,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,i,o),this.serializer=s}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(e,t){return this.connection.Bo("Write",e,t)}E_(e){return Q(!!e.streamToken),this.lastStreamToken=e.streamToken,Q(!e.writeResults||e.writeResults.length===0),this.listener.f_()}onNext(e){Q(!!e.streamToken),this.lastStreamToken=e.streamToken,this.t_.reset();let t=vD(e.writeResults,e.commitTime),r=ze(e.commitTime);return this.listener.g_(r,t)}p_(){let e={};e.database=Ap(this.serializer),this.a_(e)}m_(e){let t={streamToken:this.lastStreamToken,writes:e.map(r=>na(this.serializer,r))};this.a_(t)}};var dm=class extends class{}{constructor(e,t,r,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=i,this.y_=!1}w_(){if(this.y_)throw new k(D.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(e,t,r,i){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,o])=>this.connection.Mo(e,bp(t,r),i,s,o)).catch(s=>{throw s.name==="FirebaseError"?(s.code===D.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new k(D.UNKNOWN,s.toString())})}Lo(e,t,r,i,s){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.Lo(e,bp(t,r),i,o,a,s)).catch(o=>{throw o.name==="FirebaseError"?(o.code===D.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new k(D.UNKNOWN,o.toString())})}terminate(){this.y_=!0,this.connection.terminate()}},fm=class{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){this.S_===0&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve())))}M_(e){this.state==="Online"?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.C_("Offline")))}set(e){this.x_(),this.S_=0,e==="Online"&&(this.D_=!1),this.C_(e)}C_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}F_(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(qe(t),this.D_=!1):M("OnlineStateTracker",t)}x_(){this.b_!==null&&(this.b_.cancel(),this.b_=null)}};var pm=class{constructor(e,t,r,i,s){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=s,this.k_._o(o=>{r.enqueueAndForget(()=>x(this,null,function*(){Er(this)&&(M("RemoteStore","Restarting streams for network reachability change."),yield function(u){return x(this,null,function*(){let c=q(u);c.L_.add(4),yield Is(c),c.q_.set("Unknown"),c.L_.delete(4),yield ga(c)})}(this))}))}),this.q_=new fm(r,i)}};function ga(n){return x(this,null,function*(){if(Er(n))for(let e of n.B_)yield e(!0)})}function Is(n){return x(this,null,function*(){for(let e of n.B_)yield e(!1)})}function Ic(n,e){let t=q(n);t.N_.has(e.targetId)||(t.N_.set(e.targetId,e),ag(t)?og(t):Ts(t).r_()&&sg(t,e))}function fs(n,e){let t=q(n),r=Ts(t);t.N_.delete(e),r.r_()&&vS(t,e),t.N_.size===0&&(r.r_()?r.o_():Er(t)&&t.q_.set("Unknown"))}function sg(n,e){if(n.Q_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(Y.min())>0){let t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Ts(n).A_(e)}function vS(n,e){n.Q_.xe(e),Ts(n).R_(e)}function og(n){n.Q_=new Tp({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>n.N_.get(e)||null,tt:()=>n.datastore.serializer.databaseId}),Ts(n).start(),n.q_.v_()}function ag(n){return Er(n)&&!Ts(n).n_()&&n.N_.size>0}function Er(n){return q(n).L_.size===0}function wS(n){n.Q_=void 0}function FD(n){return x(this,null,function*(){n.q_.set("Online")})}function OD(n){return x(this,null,function*(){n.N_.forEach((e,t)=>{sg(n,e)})})}function VD(n,e){return x(this,null,function*(){wS(n),ag(n)?(n.q_.M_(e),og(n)):n.q_.set("Unknown")})}function LD(n,e,t){return x(this,null,function*(){if(n.q_.set("Online"),e instanceof Fu&&e.state===2&&e.cause)try{yield function(i,s){return x(this,null,function*(){let o=s.cause;for(let a of s.targetIds)i.N_.has(a)&&(yield i.remoteSyncer.rejectListen(a,o),i.N_.delete(a),i.Q_.removeTarget(a))})}(n,e)}catch(r){M("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),yield tc(n,r)}else if(e instanceof ts?n.Q_.Ke(e):e instanceof Mu?n.Q_.He(e):n.Q_.We(e),!t.isEqual(Y.min()))try{let r=yield fS(n.localStore);t.compareTo(r)>=0&&(yield function(s,o){let a=s.Q_.rt(o);return a.targetChanges.forEach((u,c)=>{if(u.resumeToken.approximateByteSize()>0){let d=s.N_.get(c);d&&s.N_.set(c,d.withResumeToken(u.resumeToken,o))}}),a.targetMismatches.forEach((u,c)=>{let d=s.N_.get(u);if(!d)return;s.N_.set(u,d.withResumeToken(Ke.EMPTY_BYTE_STRING,d.snapshotVersion)),vS(s,u);let f=new us(d.target,u,c,d.sequenceNumber);sg(s,f)}),s.remoteSyncer.applyRemoteEvent(a)}(n,t))}catch(r){M("RemoteStore","Failed to raise snapshot:",r),yield tc(n,r)}})}function tc(n,e,t){return x(this,null,function*(){if(!Ir(e))throw e;n.L_.add(1),yield Is(n),n.q_.set("Offline"),t||(t=()=>fS(n.localStore)),n.asyncQueue.enqueueRetryable(()=>x(this,null,function*(){M("RemoteStore","Retrying IndexedDB access"),yield t(),n.L_.delete(1),yield ga(n)}))})}function IS(n,e){return e().catch(t=>tc(n,t,e))}function Es(n){return x(this,null,function*(){let e=q(n),t=vr(e),r=e.O_.length>0?e.O_[e.O_.length-1].batchId:-1;for(;BD(e);)try{let i=yield DD(e.localStore,r);if(i===null){e.O_.length===0&&t.o_();break}r=i.batchId,UD(e,i)}catch(i){yield tc(e,i)}ES(e)&&TS(e)})}function BD(n){return Er(n)&&n.O_.length<10}function UD(n,e){n.O_.push(e);let t=vr(n);t.r_()&&t.V_&&t.m_(e.mutations)}function ES(n){return Er(n)&&!vr(n).n_()&&n.O_.length>0}function TS(n){vr(n).start()}function qD(n){return x(this,null,function*(){vr(n).p_()})}function jD(n){return x(this,null,function*(){let e=vr(n);for(let t of n.O_)e.m_(t.mutations)})}function zD(n,e,t){return x(this,null,function*(){let r=n.O_.shift(),i=wp.from(r,e,t);yield IS(n,()=>n.remoteSyncer.applySuccessfulWrite(i)),yield Es(n)})}function KD(n,e){return x(this,null,function*(){e&&vr(n).V_&&(yield function(r,i){return x(this,null,function*(){if(function(o){return zC(o)&&o!==D.ABORTED}(i.code)){let s=r.O_.shift();vr(r).s_(),yield IS(r,()=>r.remoteSyncer.rejectFailedWrite(s.batchId,i)),yield Es(r)}})}(n,e)),ES(n)&&TS(n)})}function $T(n,e){return x(this,null,function*(){let t=q(n);t.asyncQueue.verifyOperationInProgress(),M("RemoteStore","RemoteStore received new credentials");let r=Er(t);t.L_.add(3),yield Is(t),r&&t.q_.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.L_.delete(3),yield ga(t)})}function mm(n,e){return x(this,null,function*(){let t=q(n);e?(t.L_.delete(2),yield ga(t)):e||(t.L_.add(2),yield Is(t),t.q_.set("Unknown"))})}function Ts(n){return n.K_||(n.K_=function(t,r,i){let s=q(t);return s.w_(),new cm(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(n.datastore,n.asyncQueue,{Eo:FD.bind(null,n),Ro:OD.bind(null,n),mo:VD.bind(null,n),d_:LD.bind(null,n)}),n.B_.push(e=>x(this,null,function*(){e?(n.K_.s_(),ag(n)?og(n):n.q_.set("Unknown")):(yield n.K_.stop(),wS(n))}))),n.K_}function vr(n){return n.U_||(n.U_=function(t,r,i){let s=q(t);return s.w_(),new hm(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(n.datastore,n.asyncQueue,{Eo:()=>Promise.resolve(),Ro:qD.bind(null,n),mo:KD.bind(null,n),f_:jD.bind(null,n),g_:zD.bind(null,n)}),n.B_.push(e=>x(this,null,function*(){e?(n.U_.s_(),yield Es(n)):(yield n.U_.stop(),n.O_.length>0&&(M("RemoteStore",`Stopping write stream with ${n.O_.length} pending writes`),n.O_=[]))}))),n.U_}var gm=class n{constructor(e,t,r,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=i,this.removalCallback=s,this.deferred=new Xe,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,i,s){let o=Date.now()+r,a=new n(e,t,o,i,s);return a.start(r),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new k(D.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function Cs(n,e){if(qe("AsyncQueue",`${e}: ${n}`),Ir(n))return new k(D.UNAVAILABLE,`${e}: ${n}`);throw n}var nc=class n{constructor(e){this.comparator=e?(t,r)=>e(t,r)||j.comparator(t.key,r.key):(t,r)=>j.comparator(t.key,r.key),this.keyedMap=Vo(),this.sortedSet=new Ne(this.comparator)}static emptySet(e){return new n(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=r.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){let r=new n;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}};var rc=class{constructor(){this.W_=new Ne(j.comparator)}track(e){let t=e.doc.key,r=this.W_.get(t);r?e.type!==0&&r.type===3?this.W_=this.W_.insert(t,e):e.type===3&&r.type!==1?this.W_=this.W_.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.W_=this.W_.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.W_=this.W_.remove(t):e.type===1&&r.type===2?this.W_=this.W_.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):z():this.W_=this.W_.insert(t,e)}G_(){let e=[];return this.W_.inorderTraversal((t,r)=>{e.push(r)}),e}},ps=class n{constructor(e,t,r,i,s,o,a,u,c){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=s,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=u,this.hasCachedResults=c}static fromInitialDocuments(e,t,r,i,s){let o=[];return t.forEach(a=>{o.push({type:0,doc:a})}),new n(e,t,nc.emptySet(t),o,r,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&fa(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;let t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==r[i].type||!t[i].doc.isEqual(r[i].doc))return!1;return!0}};var _m=class{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some(e=>e.J_())}},ym=class{constructor(){this.queries=HT(),this.onlineState="Unknown",this.Y_=new Set}terminate(){(function(t,r){let i=q(t),s=i.queries;i.queries=HT(),s.forEach((o,a)=>{for(let u of a.j_)u.onError(r)})})(this,new k(D.ABORTED,"Firestore shutting down"))}};function HT(){return new _n(n=>PC(n),fa)}function lg(n,e){return x(this,null,function*(){let t=q(n),r=3,i=e.query,s=t.queries.get(i);s?!s.H_()&&e.J_()&&(r=2):(s=new _m,r=e.J_()?0:1);try{switch(r){case 0:s.z_=yield t.onListen(i,!0);break;case 1:s.z_=yield t.onListen(i,!1);break;case 2:yield t.onFirstRemoteStoreListen(i)}}catch(o){let a=Cs(o,`Initialization of query '${$i(e.query)}' failed`);return void e.onError(a)}t.queries.set(i,s),s.j_.push(e),e.Z_(t.onlineState),s.z_&&e.X_(s.z_)&&cg(t)})}function ug(n,e){return x(this,null,function*(){let t=q(n),r=e.query,i=3,s=t.queries.get(r);if(s){let o=s.j_.indexOf(e);o>=0&&(s.j_.splice(o,1),s.j_.length===0?i=e.J_()?0:1:!s.H_()&&e.J_()&&(i=2))}switch(i){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}})}function GD(n,e){let t=q(n),r=!1;for(let i of e){let s=i.query,o=t.queries.get(s);if(o){for(let a of o.j_)a.X_(i)&&(r=!0);o.z_=i}}r&&cg(t)}function WD(n,e,t){let r=q(n),i=r.queries.get(e);if(i)for(let s of i.j_)s.onError(t);r.queries.delete(e)}function cg(n){n.Y_.forEach(e=>{e.next()})}var vm,YT;(YT=vm||(vm={})).ea="default",YT.Cache="cache";var aa=class{constructor(e,t,r){this.query=e,this.ta=t,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=r||{}}X_(e){if(!this.options.includeMetadataChanges){let r=[];for(let i of e.docChanges)i.type!==3&&r.push(i);e=new ps(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.na?this.ia(e)&&(this.ta.next(e),t=!0):this.sa(e,this.onlineState)&&(this.oa(e),t=!0),this.ra=e,t}onError(e){this.ta.error(e)}Z_(e){this.onlineState=e;let t=!1;return this.ra&&!this.na&&this.sa(this.ra,e)&&(this.oa(this.ra),t=!0),t}sa(e,t){if(!e.fromCache||!this.J_())return!0;let r=t!=="Offline";return(!this.options._a||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}ia(e){if(e.docChanges.length>0)return!0;let t=this.ra&&this.ra.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}oa(e){e=ps.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.na=!0,this.ta.next(e)}J_(){return this.options.source!==vm.Cache}};var wm=class{constructor(e,t){this.aa=e,this.byteLength=t}ua(){return"metadata"in this.aa}};var ic=class{constructor(e){this.serializer=e}Es(e){return fn(this.serializer,e)}ds(e){return e.metadata.exists?JC(this.serializer,e.document,!1):He.newNoDocument(this.Es(e.metadata.name),this.As(e.metadata.readTime))}As(e){return ze(e)}},Im=class{constructor(e,t,r){this.ca=e,this.localStore=t,this.serializer=r,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=CS(e)}la(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.aa.namedQuery)this.queries.push(e.aa.namedQuery);else if(e.aa.documentMetadata){this.documents.push({metadata:e.aa.documentMetadata}),e.aa.documentMetadata.exists||++t;let r=me.fromString(e.aa.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.aa.document&&(this.documents[this.documents.length-1].document=e.aa.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}ha(e){let t=new Map,r=new ic(this.serializer);for(let i of e)if(i.metadata.queries){let s=r.Es(i.metadata.name);for(let o of i.metadata.queries){let a=(t.get(o)||ie()).add(s);t.set(o,a)}}return t}complete(){return x(this,null,function*(){let e=yield xD(this.localStore,new ic(this.serializer),this.documents,this.ca.id),t=this.ha(this.documents);for(let r of this.queries)yield kD(this.localStore,r,t.get(r.name));return this.progress.taskState="Success",{progress:this.progress,Pa:this.collectionGroups,Ia:e}})}};function CS(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}var sc=class{constructor(e){this.key=e}},oc=class{constructor(e){this.key=e}},ac=class{constructor(e,t){this.query=e,this.Ta=t,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=ie(),this.mutatedKeys=ie(),this.Aa=DC(e),this.Ra=new nc(this.Aa)}get Va(){return this.Ta}ma(e,t){let r=t?t.fa:new rc,i=t?t.Ra:this.Ra,s=t?t.mutatedKeys:this.mutatedKeys,o=i,a=!1,u=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,c=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((d,f)=>{let m=i.get(d),_=pa(this.query,f)?f:null,I=!!m&&this.mutatedKeys.has(m.key),S=!!_&&(_.hasLocalMutations||this.mutatedKeys.has(_.key)&&_.hasCommittedMutations),P=!1;m&&_?m.data.isEqual(_.data)?I!==S&&(r.track({type:3,doc:_}),P=!0):this.ga(m,_)||(r.track({type:2,doc:_}),P=!0,(u&&this.Aa(_,u)>0||c&&this.Aa(_,c)<0)&&(a=!0)):!m&&_?(r.track({type:0,doc:_}),P=!0):m&&!_&&(r.track({type:1,doc:m}),P=!0,(u||c)&&(a=!0)),P&&(_?(o=o.add(_),s=S?s.add(d):s.delete(d)):(o=o.delete(d),s=s.delete(d)))}),this.query.limit!==null)for(;o.size>this.query.limit;){let d=this.query.limitType==="F"?o.last():o.first();o=o.delete(d.key),s=s.delete(d.key),r.track({type:1,doc:d})}return{Ra:o,fa:r,ns:a,mutatedKeys:s}}ga(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,i){let s=this.Ra;this.Ra=e.Ra,this.mutatedKeys=e.mutatedKeys;let o=e.fa.G_();o.sort((d,f)=>function(_,I){let S=P=>{switch(P){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return z()}};return S(_)-S(I)}(d.type,f.type)||this.Aa(d.doc,f.doc)),this.pa(r),i=i!=null&&i;let a=t&&!i?this.ya():[],u=this.da.size===0&&this.current&&!i?1:0,c=u!==this.Ea;return this.Ea=u,o.length!==0||c?{snapshot:new ps(this.query,e.Ra,s,o,e.mutatedKeys,u===0,c,!1,!!r&&r.resumeToken.approximateByteSize()>0),wa:a}:{wa:a}}Z_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new rc,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(e){return!this.Ta.has(e)&&!!this.Ra.has(e)&&!this.Ra.get(e).hasLocalMutations}pa(e){e&&(e.addedDocuments.forEach(t=>this.Ta=this.Ta.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ta=this.Ta.delete(t)),this.current=e.current)}ya(){if(!this.current)return[];let e=this.da;this.da=ie(),this.Ra.forEach(r=>{this.Sa(r.key)&&(this.da=this.da.add(r.key))});let t=[];return e.forEach(r=>{this.da.has(r)||t.push(new oc(r))}),this.da.forEach(r=>{e.has(r)||t.push(new sc(r))}),t}ba(e){this.Ta=e.Ts,this.da=ie();let t=this.ma(e.documents);return this.applyChanges(t,!0)}Da(){return ps.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,this.Ea===0,this.hasCachedResults)}},Em=class{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}},Tm=class{constructor(e){this.key=e,this.va=!1}},Cm=class{constructor(e,t,r,i,s,o){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=o,this.Ca={},this.Fa=new _n(a=>PC(a),fa),this.Ma=new Map,this.xa=new Set,this.Oa=new Ne(j.comparator),this.Na=new Map,this.La=new ia,this.Ba={},this.ka=new Map,this.qa=cs.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return this.Qa===!0}};function QD(n,e,t=!0){return x(this,null,function*(){let r=Ec(n),i,s=r.Fa.get(e);return s?(r.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.Da()):i=yield SS(r,e,t,!0),i})}function $D(n,e){return x(this,null,function*(){let t=Ec(n);yield SS(t,e,!0,!1)})}function SS(n,e,t,r){return x(this,null,function*(){let i=yield hs(n.localStore,vt(e)),s=i.targetId,o=n.sharedClientState.addLocalQueryTarget(s,t),a;return r&&(a=yield hg(n,e,s,o==="current",i.resumeToken)),n.isPrimaryClient&&t&&Ic(n.remoteStore,i),a})}function hg(n,e,t,r,i){return x(this,null,function*(){n.Ka=(f,m,_)=>function(S,P,V,U){return x(this,null,function*(){let L=P.view.ma(V);L.ns&&(L=yield Hu(S.localStore,P.query,!1).then(({documents:E})=>P.view.ma(E,L)));let $=U&&U.targetChanges.get(P.targetId),re=U&&U.targetMismatches.get(P.targetId)!=null,X=P.view.applyChanges(L,S.isPrimaryClient,$,re);return Sm(S,P.targetId,X.wa),X.snapshot})}(n,f,m,_);let s=yield Hu(n.localStore,e,!0),o=new ac(e,s.Ts),a=o.ma(s.documents),u=ea.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",i),c=o.applyChanges(a,n.isPrimaryClient,u);Sm(n,t,c.wa);let d=new Em(e,t,o);return n.Fa.set(e,d),n.Ma.has(t)?n.Ma.get(t).push(e):n.Ma.set(t,[e]),c.snapshot})}function HD(n,e,t){return x(this,null,function*(){let r=q(n),i=r.Fa.get(e),s=r.Ma.get(i.targetId);if(s.length>1)return r.Ma.set(i.targetId,s.filter(o=>!fa(o,e))),void r.Fa.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||(yield ds(r.localStore,i.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(i.targetId),t&&fs(r.remoteStore,i.targetId),ms(r,i.targetId)}).catch(wr))):(ms(r,i.targetId),yield ds(r.localStore,i.targetId,!0))})}function YD(n,e){return x(this,null,function*(){let t=q(n),r=t.Fa.get(e),i=t.Ma.get(r.targetId);t.isPrimaryClient&&i.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),fs(t.remoteStore,r.targetId))})}function JD(n,e,t){return x(this,null,function*(){let r=mg(n);try{let i=yield function(o,a){let u=q(o),c=Me.now(),d=a.reduce((_,I)=>_.add(I.key),ie()),f,m;return u.persistence.runTransaction("Locally write mutations","readwrite",_=>{let I=Ct(),S=ie();return u.cs.getEntries(_,d).next(P=>{I=P,I.forEach((V,U)=>{U.isValidDocument()||(S=S.add(V))})}).next(()=>u.localDocuments.getOverlayedDocuments(_,I)).next(P=>{f=P;let V=[];for(let U of a){let L=hD(U,f.get(U.key).overlayedDocument);L!=null&&V.push(new Yt(U.key,L,EC(L.value.mapValue),Be.exists(!0)))}return u.mutationQueue.addMutationBatch(_,c,V,a)}).next(P=>{m=P;let V=P.applyToLocalDocumentSet(f,S);return u.documentOverlayCache.saveOverlays(_,P.batchId,V)})}).then(()=>({batchId:m.batchId,changes:kC(f)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),function(o,a,u){let c=o.Ba[o.currentUser.toKey()];c||(c=new Ne(te)),c=c.insert(a,u),o.Ba[o.currentUser.toKey()]=c}(r,i.batchId,t),yield Fn(r,i.changes),yield Es(r.remoteStore)}catch(i){let s=Cs(i,"Failed to persist write");t.reject(s)}})}function bS(n,e){return x(this,null,function*(){let t=q(n);try{let r=yield ND(t.localStore,e);e.targetChanges.forEach((i,s)=>{let o=t.Na.get(s);o&&(Q(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?o.va=!0:i.modifiedDocuments.size>0?Q(o.va):i.removedDocuments.size>0&&(Q(o.va),o.va=!1))}),yield Fn(t,r,e)}catch(r){yield wr(r)}})}function JT(n,e,t){let r=q(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){let i=[];r.Fa.forEach((s,o)=>{let a=o.view.Z_(e);a.snapshot&&i.push(a.snapshot)}),function(o,a){let u=q(o);u.onlineState=a;let c=!1;u.queries.forEach((d,f)=>{for(let m of f.j_)m.Z_(a)&&(c=!0)}),c&&cg(u)}(r.eventManager,e),i.length&&r.Ca.d_(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function XD(n,e,t){return x(this,null,function*(){let r=q(n);r.sharedClientState.updateQueryState(e,"rejected",t);let i=r.Na.get(e),s=i&&i.key;if(s){let o=new Ne(j.comparator);o=o.insert(s,He.newNoDocument(s,Y.min()));let a=ie().add(s),u=new Zo(Y.min(),new Map,new Ne(te),o,a);yield bS(r,u),r.Oa=r.Oa.remove(s),r.Na.delete(e),pg(r)}else yield ds(r.localStore,e,!1).then(()=>ms(r,e,t)).catch(wr)})}function ZD(n,e){return x(this,null,function*(){let t=q(n),r=e.batch.batchId;try{let i=yield PD(t.localStore,e);fg(t,r,null),dg(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),yield Fn(t,i)}catch(i){yield wr(i)}})}function ex(n,e,t){return x(this,null,function*(){let r=q(n);try{let i=yield function(o,a){let u=q(o);return u.persistence.runTransaction("Reject batch","readwrite-primary",c=>{let d;return u.mutationQueue.lookupMutationBatch(c,a).next(f=>(Q(f!==null),d=f.keys(),u.mutationQueue.removeMutationBatch(c,f))).next(()=>u.mutationQueue.performConsistencyCheck(c)).next(()=>u.documentOverlayCache.removeOverlaysForBatchId(c,d,a)).next(()=>u.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(c,d)).next(()=>u.localDocuments.getDocuments(c,d))})}(r.localStore,e);fg(r,e,t),dg(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),yield Fn(r,i)}catch(i){yield wr(i)}})}function tx(n,e){return x(this,null,function*(){let t=q(n);Er(t.remoteStore)||M("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{let r=yield function(o){let a=q(o);return a.persistence.runTransaction("Get highest unacknowledged batch id","readonly",u=>a.mutationQueue.getHighestUnacknowledgedBatchId(u))}(t.localStore);if(r===-1)return void e.resolve();let i=t.ka.get(r)||[];i.push(e),t.ka.set(r,i)}catch(r){let i=Cs(r,"Initialization of waitForPendingWrites() operation failed");e.reject(i)}})}function dg(n,e){(n.ka.get(e)||[]).forEach(t=>{t.resolve()}),n.ka.delete(e)}function fg(n,e,t){let r=q(n),i=r.Ba[r.currentUser.toKey()];if(i){let s=i.get(e);s&&(t?s.reject(t):s.resolve(),i=i.remove(e)),r.Ba[r.currentUser.toKey()]=i}}function ms(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(let r of n.Ma.get(e))n.Fa.delete(r),t&&n.Ca.$a(r,t);n.Ma.delete(e),n.isPrimaryClient&&n.La.gr(e).forEach(r=>{n.La.containsKey(r)||AS(n,r)})}function AS(n,e){n.xa.delete(e.path.canonicalString());let t=n.Oa.get(e);t!==null&&(fs(n.remoteStore,t),n.Oa=n.Oa.remove(e),n.Na.delete(t),pg(n))}function Sm(n,e,t){for(let r of t)r instanceof sc?(n.La.addReference(r.key,e),nx(n,r)):r instanceof oc?(M("SyncEngine","Document no longer in limbo: "+r.key),n.La.removeReference(r.key,e),n.La.containsKey(r.key)||AS(n,r.key)):z()}function nx(n,e){let t=e.key,r=t.path.canonicalString();n.Oa.get(t)||n.xa.has(r)||(M("SyncEngine","New document in limbo: "+t),n.xa.add(r),pg(n))}function pg(n){for(;n.xa.size>0&&n.Oa.size<n.maxConcurrentLimboResolutions;){let e=n.xa.values().next().value;n.xa.delete(e);let t=new j(me.fromString(e)),r=n.qa.next();n.Na.set(r,new Tm(t)),n.Oa=n.Oa.insert(t,r),Ic(n.remoteStore,new us(vt(ws(t.path)),r,"TargetPurposeLimboResolution",Nt.oe))}}function Fn(n,e,t){return x(this,null,function*(){let r=q(n),i=[],s=[],o=[];r.Fa.isEmpty()||(r.Fa.forEach((a,u)=>{o.push(r.Ka(u,e,t).then(c=>{var d;if((c||t)&&r.isPrimaryClient){let f=c?!c.fromCache:(d=t?.targetChanges.get(u.targetId))===null||d===void 0?void 0:d.current;r.sharedClientState.updateQueryState(u.targetId,f?"current":"not-current")}if(c){i.push(c);let f=rm.Wi(u.targetId,c);s.push(f)}}))}),yield Promise.all(o),r.Ca.d_(i),yield function(u,c){return x(this,null,function*(){let d=q(u);try{yield d.persistence.runTransaction("notifyLocalViewChanges","readwrite",f=>R.forEach(c,m=>R.forEach(m.$i,_=>d.persistence.referenceDelegate.addReference(f,m.targetId,_)).next(()=>R.forEach(m.Ui,_=>d.persistence.referenceDelegate.removeReference(f,m.targetId,_)))))}catch(f){if(!Ir(f))throw f;M("LocalStore","Failed to update sequence numbers: "+f)}for(let f of c){let m=f.targetId;if(!f.fromCache){let _=d.os.get(m),I=_.snapshotVersion,S=_.withLastLimboFreeSnapshotVersion(I);d.os=d.os.insert(m,S)}}})}(r.localStore,s))})}function rx(n,e){return x(this,null,function*(){let t=q(n);if(!t.currentUser.isEqual(e)){M("SyncEngine","User change. New user:",e.toKey());let r=yield dS(t.localStore,e);t.currentUser=e,function(s,o){s.ka.forEach(a=>{a.forEach(u=>{u.reject(new k(D.CANCELLED,o))})}),s.ka.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),yield Fn(t,r.hs)}})}function ix(n,e){let t=q(n),r=t.Na.get(e);if(r&&r.va)return ie().add(r.key);{let i=ie(),s=t.Ma.get(e);if(!s)return i;for(let o of s){let a=t.Fa.get(o);i=i.unionWith(a.view.Va)}return i}}function sx(n,e){return x(this,null,function*(){let t=q(n),r=yield Hu(t.localStore,e.query,!0),i=e.view.ba(r);return t.isPrimaryClient&&Sm(t,e.targetId,i.wa),i})}function ox(n,e){return x(this,null,function*(){let t=q(n);return gS(t.localStore,e).then(r=>Fn(t,r))})}function ax(n,e,t,r){return x(this,null,function*(){let i=q(n),s=yield function(a,u){let c=q(a),d=q(c.mutationQueue);return c.persistence.runTransaction("Lookup mutation documents","readonly",f=>d.Mn(f,u).next(m=>m?c.localDocuments.getDocuments(f,m):R.resolve(null)))}(i.localStore,e);s!==null?(t==="pending"?yield Es(i.remoteStore):t==="acknowledged"||t==="rejected"?(fg(i,e,r||null),dg(i,e),function(a,u){q(q(a).mutationQueue).On(u)}(i.localStore,e)):z(),yield Fn(i,s)):M("SyncEngine","Cannot apply mutation batch with id: "+e)})}function lx(n,e){return x(this,null,function*(){let t=q(n);if(Ec(t),mg(t),e===!0&&t.Qa!==!0){let r=t.sharedClientState.getAllActiveQueryTargets(),i=yield XT(t,r.toArray());t.Qa=!0,yield mm(t.remoteStore,!0);for(let s of i)Ic(t.remoteStore,s)}else if(e===!1&&t.Qa!==!1){let r=[],i=Promise.resolve();t.Ma.forEach((s,o)=>{t.sharedClientState.isLocalQueryTarget(o)?r.push(o):i=i.then(()=>(ms(t,o),ds(t.localStore,o,!0))),fs(t.remoteStore,o)}),yield i,yield XT(t,r),function(o){let a=q(o);a.Na.forEach((u,c)=>{fs(a.remoteStore,c)}),a.La.pr(),a.Na=new Map,a.Oa=new Ne(j.comparator)}(t),t.Qa=!1,yield mm(t.remoteStore,!1)}})}function XT(n,e,t){return x(this,null,function*(){let r=q(n),i=[],s=[];for(let o of e){let a,u=r.Ma.get(o);if(u&&u.length!==0){a=yield hs(r.localStore,vt(u[0]));for(let c of u){let d=r.Fa.get(c),f=yield sx(r,d);f.snapshot&&s.push(f.snapshot)}}else{let c=yield mS(r.localStore,o);a=yield hs(r.localStore,c),yield hg(r,RS(c),o,!1,a.resumeToken)}i.push(a)}return r.Ca.d_(s),i})}function RS(n){return RC(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function ux(n){return function(t){return q(q(t).persistence).Qi()}(q(n).localStore)}function cx(n,e,t,r){return x(this,null,function*(){let i=q(n);if(i.Qa)return void M("SyncEngine","Ignoring unexpected query state notification.");let s=i.Ma.get(e);if(s&&s.length>0)switch(t){case"current":case"not-current":{let o=yield gS(i.localStore,NC(s[0])),a=Zo.createSynthesizedRemoteEventForCurrentChange(e,t==="current",Ke.EMPTY_BYTE_STRING);yield Fn(i,o,a);break}case"rejected":yield ds(i.localStore,e,!0),ms(i,e,r);break;default:z()}})}function hx(n,e,t){return x(this,null,function*(){let r=Ec(n);if(r.Qa){for(let i of e){if(r.Ma.has(i)&&r.sharedClientState.isActiveQueryTarget(i)){M("SyncEngine","Adding an already active target "+i);continue}let s=yield mS(r.localStore,i),o=yield hs(r.localStore,s);yield hg(r,RS(s),o.targetId,!1,o.resumeToken),Ic(r.remoteStore,o)}for(let i of t)r.Ma.has(i)&&(yield ds(r.localStore,i,!1).then(()=>{fs(r.remoteStore,i),ms(r,i)}).catch(wr))}})}function Ec(n){let e=q(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=bS.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=ix.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=XD.bind(null,e),e.Ca.d_=GD.bind(null,e.eventManager),e.Ca.$a=WD.bind(null,e.eventManager),e}function mg(n){let e=q(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=ZD.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=ex.bind(null,e),e}function dx(n,e,t){let r=q(n);(function(s,o,a){return x(this,null,function*(){try{let u=yield o.getMetadata();if(yield function(_,I){let S=q(_),P=ze(I.createTime);return S.persistence.runTransaction("hasNewerBundle","readonly",V=>S.Gr.getBundleMetadata(V,I.id)).then(V=>!!V&&V.createTime.compareTo(P)>=0)}(s.localStore,u))return yield o.close(),a._completeWith(function(_){return{taskState:"Success",documentsLoaded:_.totalDocuments,bytesLoaded:_.totalBytes,totalDocuments:_.totalDocuments,totalBytes:_.totalBytes}}(u)),Promise.resolve(new Set);a._updateProgress(CS(u));let c=new Im(u,s.localStore,o.serializer),d=yield o.Ua();for(;d;){let m=yield c.la(d);m&&a._updateProgress(m),d=yield o.Ua()}let f=yield c.complete();return yield Fn(s,f.Ia,void 0),yield function(_,I){let S=q(_);return S.persistence.runTransaction("Save bundle","readwrite",P=>S.Gr.saveBundleMetadata(P,I))}(s.localStore,u),a._completeWith(f.progress),Promise.resolve(f.Pa)}catch(u){return $t("SyncEngine",`Loading bundle failed with ${u}`),a._failWith(u),Promise.resolve(new Set)}})})(r,e,t).then(i=>{r.sharedClientState.notifyBundleLoaded(i)})}var bm=(()=>{class n{constructor(){this.kind="memory",this.synchronizeTabs=!1}initialize(t){return x(this,null,function*(){this.serializer=ma(t.databaseInfo.databaseId),this.sharedClientState=this.Wa(t),this.persistence=this.Ga(t),yield this.persistence.start(),this.localStore=this.za(t),this.gcScheduler=this.ja(t,this.localStore),this.indexBackfillerScheduler=this.Ha(t,this.localStore)})}ja(t,r){return null}Ha(t,r){return null}za(t){return hS(this.persistence,new $u,t.initialUser,this.serializer)}Ga(t){return new Wu(Qu.Zr,this.serializer)}Wa(t){return new Xu}terminate(){return x(this,null,function*(){var t,r;(t=this.gcScheduler)===null||t===void 0||t.stop(),(r=this.indexBackfillerScheduler)===null||r===void 0||r.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}}return n.provider={build:()=>new n},n})();var lc=class n extends bm{constructor(e,t,r){super(),this.Ja=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.kind="persistent",this.synchronizeTabs=!1}initialize(e){return x(this,null,function*(){yield Rh(n.prototype,this,"initialize").call(this,e),yield this.Ja.initialize(this,e),yield mg(this.Ja.syncEngine),yield Es(this.Ja.remoteStore),yield this.persistence.yi(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))})}za(e){return hS(this.persistence,new $u,e.initialUser,this.serializer)}ja(e,t){let r=this.persistence.referenceDelegate.garbageCollector;return new qp(r,e.asyncQueue,t)}Ha(e,t){let r=new ip(t,this.persistence);return new rp(e.asyncQueue,r)}Ga(e){let t=ig(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=this.cacheSizeBytes!==void 0?qt.withCacheSize(this.cacheSizeBytes):qt.DEFAULT;return new nm(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,yS(),Iu(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Wa(e){return new Xu}},Am=class n extends lc{constructor(e,t){super(e,t,!1),this.Ja=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}initialize(e){return x(this,null,function*(){yield Rh(n.prototype,this,"initialize").call(this,e);let t=this.Ja.syncEngine;this.sharedClientState instanceof zo&&(this.sharedClientState.syncEngine={no:ax.bind(null,t),ro:cx.bind(null,t),io:hx.bind(null,t),Qi:ux.bind(null,t),eo:ox.bind(null,t)},yield this.sharedClientState.start()),yield this.persistence.yi(r=>x(this,null,function*(){yield lx(this.Ja.syncEngine,r),this.gcScheduler&&(r&&!this.gcScheduler.started?this.gcScheduler.start():r||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(r&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():r||this.indexBackfillerScheduler.stop())}))})}Wa(e){let t=yS();if(!zo.D(t))throw new k(D.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");let r=ig(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new zo(t,e.asyncQueue,r,e.clientId,e.initialUser)}},gg=(()=>{class n{initialize(t,r){return x(this,null,function*(){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(r),this.remoteStore=this.createRemoteStore(r),this.eventManager=this.createEventManager(r),this.syncEngine=this.createSyncEngine(r,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=i=>JT(this.syncEngine,i,1),this.remoteStore.remoteSyncer.handleCredentialChange=rx.bind(null,this.syncEngine),yield mm(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(t){return function(){return new ym}()}createDatastore(t){let r=ma(t.databaseInfo.databaseId),i=function(o){return new um(o)}(t.databaseInfo);return function(o,a,u,c){return new dm(o,a,u,c)}(t.authCredentials,t.appCheckCredentials,i,r)}createRemoteStore(t){return function(i,s,o,a,u){return new pm(i,s,o,a,u)}(this.localStore,this.datastore,t.asyncQueue,r=>JT(this.syncEngine,r,0),function(){return Zu.D()?new Zu:new am}())}createSyncEngine(t,r){return function(s,o,a,u,c,d,f){let m=new Cm(s,o,a,u,c,d);return f&&(m.Qa=!0),m}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,r)}terminate(){return x(this,null,function*(){var t,r;yield function(s){return x(this,null,function*(){let o=q(s);M("RemoteStore","RemoteStore shutting down."),o.L_.add(5),yield Is(o),o.k_.shutdown(),o.q_.set("Unknown")})}(this.remoteStore),(t=this.datastore)===null||t===void 0||t.terminate(),(r=this.eventManager)===null||r===void 0||r.terminate()})}}return n.provider={build:()=>new n},n})();function ZT(n,e=10240){let t=0;return{read(){return x(this,null,function*(){if(t<n.byteLength){let i={value:n.slice(t,t+e),done:!1};return t+=e,i}return{done:!0}})},cancel(){return x(this,null,function*(){})},releaseLock(){},closed:Promise.resolve()}}var gs=class{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ya(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ya(this.observer.error,e):qe("Uncaught Error in snapshot listener:",e.toString()))}Za(){this.muted=!0}Ya(e,t){setTimeout(()=>{this.muted||e(t)},0)}};var Rm=class{constructor(e,t){this.Xa=e,this.serializer=t,this.metadata=new Xe,this.buffer=new Uint8Array,this.eu=function(){return new TextDecoder("utf-8")}(),this.tu().then(r=>{r&&r.ua()?this.metadata.resolve(r.aa.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(r?.aa)}`))},r=>this.metadata.reject(r))}close(){return this.Xa.cancel()}getMetadata(){return x(this,null,function*(){return this.metadata.promise})}Ua(){return x(this,null,function*(){return yield this.getMetadata(),this.tu()})}tu(){return x(this,null,function*(){let e=yield this.nu();if(e===null)return null;let t=this.eu.decode(e),r=Number(t);isNaN(r)&&this.ru(`length string (${t}) is not valid number`);let i=yield this.iu(r);return new wm(JSON.parse(i),e.length+r)})}su(){return this.buffer.findIndex(e=>e===123)}nu(){return x(this,null,function*(){for(;this.su()<0&&!(yield this.ou()););if(this.buffer.length===0)return null;let e=this.su();e<0&&this.ru("Reached the end of bundle when a length string is expected.");let t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t})}iu(e){return x(this,null,function*(){for(;this.buffer.length<e;)(yield this.ou())&&this.ru("Reached the end of bundle when more is expected.");let t=this.eu.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t})}ru(e){throw this.Xa.cancel(),new Error(`Invalid bundle format: ${e}`)}ou(){return x(this,null,function*(){let e=yield this.Xa.read();if(!e.done){let t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done})}};var Pm=class{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}lookup(e){return x(this,null,function*(){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new k(D.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;let t=yield function(i,s){return x(this,null,function*(){let o=q(i),a={documents:s.map(f=>ta(o.serializer,f))},u=yield o.Lo("BatchGetDocuments",o.serializer.databaseId,me.emptyPath(),a,s.length),c=new Map;u.forEach(f=>{let m=_D(o.serializer,f);c.set(m.key.toString(),m)});let d=[];return s.forEach(f=>{let m=c.get(f.toString());Q(!!m),d.push(m)}),d})}(this.datastore,e);return t.forEach(r=>this.recordVersion(r)),t})}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(r){this.lastTransactionError=r}this.writtenDocs.add(e.toString())}delete(e){this.write(new yr(e,this.precondition(e))),this.writtenDocs.add(e.toString())}commit(){return x(this,null,function*(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;let e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((t,r)=>{let i=j.fromPath(r);this.mutations.push(new Yo(i,this.precondition(i)))}),yield function(r,i){return x(this,null,function*(){let s=q(r),o={writes:i.map(a=>na(s.serializer,a))};yield s.Mo("Commit",s.serializer.databaseId,me.emptyPath(),o)})}(this.datastore,this.mutations),this.committed=!0})}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw z();t=Y.min()}let r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new k(D.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){let t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(Y.min())?Be.exists(!1):Be.updateTime(t):Be.none()}preconditionForUpdate(e){let t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(Y.min()))throw new k(D.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Be.updateTime(t)}return Be.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}};var Nm=class{constructor(e,t,r,i,s){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=i,this.deferred=s,this._u=r.maxAttempts,this.t_=new oa(this.asyncQueue,"transaction_retry")}au(){this._u-=1,this.uu()}uu(){this.t_.Go(()=>x(this,null,function*(){let e=new Pm(this.datastore),t=this.cu(e);t&&t.then(r=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(r)}).catch(i=>{this.lu(i)}))}).catch(r=>{this.lu(r)})}))}cu(e){try{let t=this.updateFunction(e);return!ha(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}lu(e){this._u>0&&this.hu(e)?(this._u-=1,this.asyncQueue.enqueueAndForget(()=>(this.uu(),Promise.resolve()))):this.deferred.reject(e)}hu(e){if(e.name==="FirebaseError"){let t=e.code;return t==="aborted"||t==="failed-precondition"||t==="already-exists"||!zC(t)}return!1}};var Dm=class{constructor(e,t,r,i,s){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=i,this.user=$e.UNAUTHENTICATED,this.clientId=Tu.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=s,this.authCredentials.start(r,o=>x(this,null,function*(){M("FirestoreClient","Received user=",o.uid),yield this.authCredentialListener(o),this.user=o})),this.appCheckCredentials.start(r,o=>(M("FirestoreClient","Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();let e=new Xe;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>x(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){let r=Cs(t,"Failed to shutdown persistence");e.reject(r)}})),e.promise}};function Wf(n,e){return x(this,null,function*(){n.asyncQueue.verifyOperationInProgress(),M("FirestoreClient","Initializing OfflineComponentProvider");let t=n.configuration;yield e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(i=>x(this,null,function*(){r.isEqual(i)||(yield dS(e.localStore,i),r=i)})),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e})}function eC(n,e){return x(this,null,function*(){n.asyncQueue.verifyOperationInProgress();let t=yield _g(n);M("FirestoreClient","Initializing OnlineComponentProvider"),yield e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>$T(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,i)=>$T(e.remoteStore,i)),n._onlineComponents=e})}function _g(n){return x(this,null,function*(){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){M("FirestoreClient","Using user provided OfflineComponentProvider");try{yield Wf(n,n._uninitializedComponentsProvider._offline)}catch(e){let t=e;if(!function(i){return i.name==="FirebaseError"?i.code===D.FAILED_PRECONDITION||i.code===D.UNIMPLEMENTED:!(typeof DOMException<"u"&&i instanceof DOMException)||i.code===22||i.code===20||i.code===11}(t))throw t;$t("Error using user provided cache. Falling back to memory cache: "+t),yield Wf(n,new bm)}}else M("FirestoreClient","Using default OfflineComponentProvider"),yield Wf(n,new bm);return n._offlineComponents})}function Tc(n){return x(this,null,function*(){return n._onlineComponents||(n._uninitializedComponentsProvider?(M("FirestoreClient","Using user provided OnlineComponentProvider"),yield eC(n,n._uninitializedComponentsProvider._online)):(M("FirestoreClient","Using default OnlineComponentProvider"),yield eC(n,new gg))),n._onlineComponents})}function PS(n){return _g(n).then(e=>e.persistence)}function yg(n){return _g(n).then(e=>e.localStore)}function NS(n){return Tc(n).then(e=>e.remoteStore)}function vg(n){return Tc(n).then(e=>e.syncEngine)}function fx(n){return Tc(n).then(e=>e.datastore)}function _s(n){return x(this,null,function*(){let e=yield Tc(n),t=e.eventManager;return t.onListen=QD.bind(null,e.syncEngine),t.onUnlisten=HD.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=$D.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=YD.bind(null,e.syncEngine),t})}function px(n){return n.asyncQueue.enqueue(()=>x(this,null,function*(){let e=yield PS(n),t=yield NS(n);return e.setNetworkEnabled(!0),function(i){let s=q(i);return s.L_.delete(0),ga(s)}(t)}))}function mx(n){return n.asyncQueue.enqueue(()=>x(this,null,function*(){let e=yield PS(n),t=yield NS(n);return e.setNetworkEnabled(!1),function(i){return x(this,null,function*(){let s=q(i);s.L_.add(0),yield Is(s),s.q_.set("Offline")})}(t)}))}function gx(n,e){let t=new Xe;return n.asyncQueue.enqueueAndForget(()=>x(this,null,function*(){return function(i,s,o){return x(this,null,function*(){try{let a=yield function(c,d){let f=q(c);return f.persistence.runTransaction("read document","readonly",m=>f.localDocuments.getDocument(m,d))}(i,s);a.isFoundDocument()?o.resolve(a):a.isNoDocument()?o.resolve(null):o.reject(new k(D.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(a){let u=Cs(a,`Failed to get document '${s} from cache`);o.reject(u)}})}(yield yg(n),e,t)})),t.promise}function DS(n,e,t={}){let r=new Xe;return n.asyncQueue.enqueueAndForget(()=>x(this,null,function*(){return function(s,o,a,u,c){let d=new gs({next:m=>{d.Za(),o.enqueueAndForget(()=>ug(s,f));let _=m.docs.has(a);!_&&m.fromCache?c.reject(new k(D.UNAVAILABLE,"Failed to get document because the client is offline.")):_&&m.fromCache&&u&&u.source==="server"?c.reject(new k(D.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):c.resolve(m)},error:m=>c.reject(m)}),f=new aa(ws(a.path),d,{includeMetadataChanges:!0,_a:!0});return lg(s,f)}(yield _s(n),n.asyncQueue,e,t,r)})),r.promise}function _x(n,e){let t=new Xe;return n.asyncQueue.enqueueAndForget(()=>x(this,null,function*(){return function(i,s,o){return x(this,null,function*(){try{let a=yield Hu(i,s,!0),u=new ac(s,a.Ts),c=u.ma(a.documents),d=u.applyChanges(c,!1);o.resolve(d.snapshot)}catch(a){let u=Cs(a,`Failed to execute query '${s} against cache`);o.reject(u)}})}(yield yg(n),e,t)})),t.promise}function xS(n,e,t={}){let r=new Xe;return n.asyncQueue.enqueueAndForget(()=>x(this,null,function*(){return function(s,o,a,u,c){let d=new gs({next:m=>{d.Za(),o.enqueueAndForget(()=>ug(s,f)),m.fromCache&&u.source==="server"?c.reject(new k(D.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):c.resolve(m)},error:m=>c.reject(m)}),f=new aa(a,d,{includeMetadataChanges:!0,_a:!0});return lg(s,f)}(yield _s(n),n.asyncQueue,e,t,r)})),r.promise}function yx(n,e){let t=new gs(e);return n.asyncQueue.enqueueAndForget(()=>x(this,null,function*(){return function(i,s){q(i).Y_.add(s),s.next()}(yield _s(n),t)})),()=>{t.Za(),n.asyncQueue.enqueueAndForget(()=>x(this,null,function*(){return function(i,s){q(i).Y_.delete(s)}(yield _s(n),t)}))}}function vx(n,e,t,r){let i=function(o,a){let u;return u=typeof o=="string"?GC().encode(o):o,function(d,f){return new Rm(d,f)}(function(d,f){if(d instanceof Uint8Array)return ZT(d,f);if(d instanceof ArrayBuffer)return ZT(new Uint8Array(d),f);if(d instanceof ReadableStream)return d.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(u),a)}(t,ma(e));n.asyncQueue.enqueueAndForget(()=>x(this,null,function*(){dx(yield vg(n),i,r)}))}function wx(n,e){return n.asyncQueue.enqueue(()=>x(this,null,function*(){return function(r,i){let s=q(r);return s.persistence.runTransaction("Get named query","readonly",o=>s.Gr.getNamedQuery(o,i))}(yield yg(n),e)}))}function kS(n){let e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}var tC=new Map;function wg(n,e,t){if(!t)throw new k(D.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function Ig(n,e,t,r){if(e===!0&&r===!0)throw new k(D.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function nC(n){if(!j.isDocumentKey(n))throw new k(D.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function rC(n){if(j.isDocumentKey(n))throw new k(D.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function Cc(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{let e=function(r){return r.constructor?r.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":z()}function _e(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new k(D.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let t=Cc(n);throw new k(D.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function MS(n,e){if(e<=0)throw new k(D.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}var uc=class{constructor(e){var t,r;if(e.host===void 0){if(e.ssl!==void 0)throw new k(D.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(t=e.ssl)===null||t===void 0||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new k(D.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}Ig("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=kS((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),function(s){if(s.timeoutSeconds!==void 0){if(isNaN(s.timeoutSeconds))throw new k(D.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new k(D.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new k(D.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,i){return r.timeoutSeconds===i.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}},Zr=class{constructor(e,t,r,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new uc({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new k(D.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new k(D.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new uc(e),e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new Qf;switch(r.type){case"firstParty":return new Jf(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new k(D.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}_restart(){return x(this,null,function*(){this._terminateTask==="notTerminated"?yield this._terminate():this._terminateTask="notTerminated"})}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){let r=tC.get(t);r&&(M("ComponentProvider","Removing Datastore"),tC.delete(t),r.terminate())}(this),Promise.resolve()}};function FS(n,e,t,r={}){var i;let s=(n=_e(n,Zr))._getSettings(),o=`${e}:${t}`;if(s.host!=="firestore.googleapis.com"&&s.host!==o&&$t("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},s),{host:o,ssl:!1})),r.mockUserToken){let a,u;if(typeof r.mockUserToken=="string")a=r.mockUserToken,u=$e.MOCK_USER;else{a=Ha(r.mockUserToken,(i=n._app)===null||i===void 0?void 0:i.options.projectId);let c=r.mockUserToken.sub||r.mockUserToken.user_id;if(!c)throw new k(D.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");u=new $e(c)}n._authCredentials=new $f(new Eu(a,u))}}var it=class n{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new n(this.firestore,e,this._query)}},be=class n{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new pn(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new n(this.firestore,e,this._key)}},pn=class n extends it{constructor(e,t,r){super(e,t,ws(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new be(this.firestore,null,new j(e))}withConverter(e){return new n(this.firestore,e,this._path)}};function Eg(n,e,...t){if(n=ce(n),wg("collection","path",e),n instanceof Zr){let r=me.fromString(e,...t);return rC(r),new pn(n,null,r)}{if(!(n instanceof be||n instanceof pn))throw new k(D.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(me.fromString(e,...t));return rC(r),new pn(n.firestore,null,r)}}function OS(n,e){if(n=_e(n,Zr),wg("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new k(D.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new it(n,null,function(r){return new Ht(me.emptyPath(),r)}(e))}function _a(n,e,...t){if(n=ce(n),arguments.length===1&&(e=Tu.newId()),wg("doc","path",e),n instanceof Zr){let r=me.fromString(e,...t);return nC(r),new be(n,null,new j(r))}{if(!(n instanceof be||n instanceof pn))throw new k(D.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(me.fromString(e,...t));return nC(r),new be(n.firestore,n instanceof pn?n.converter:null,new j(r))}}function Tg(n,e){return n=ce(n),e=ce(e),(n instanceof be||n instanceof pn)&&(e instanceof be||e instanceof pn)&&n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter}function Cg(n,e){return n=ce(n),e=ce(e),n instanceof it&&e instanceof it&&n.firestore===e.firestore&&fa(n._query,e._query)&&n.converter===e.converter}var cc=class{constructor(e=Promise.resolve()){this.Pu=[],this.Iu=!1,this.Tu=[],this.Eu=null,this.du=!1,this.Au=!1,this.Ru=[],this.t_=new oa(this,"async_queue_retry"),this.Vu=()=>{let r=Iu();r&&M("AsyncQueue","Visibility state changed to "+r.visibilityState),this.t_.jo()},this.mu=e;let t=Iu();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this.Vu)}get isShuttingDown(){return this.Iu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.fu(),this.gu(e)}enterRestrictedMode(e){if(!this.Iu){this.Iu=!0,this.Au=e||!1;let t=Iu();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.Vu)}}enqueue(e){if(this.fu(),this.Iu)return new Promise(()=>{});let t=new Xe;return this.gu(()=>this.Iu&&this.Au?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Pu.push(e),this.pu()))}pu(){return x(this,null,function*(){if(this.Pu.length!==0){try{yield this.Pu[0](),this.Pu.shift(),this.t_.reset()}catch(e){if(!Ir(e))throw e;M("AsyncQueue","Operation failed with retryable error: "+e)}this.Pu.length>0&&this.t_.Go(()=>this.pu())}})}gu(e){let t=this.mu.then(()=>(this.du=!0,e().catch(r=>{this.Eu=r,this.du=!1;let i=function(o){let a=o.message||"";return o.stack&&(a=o.stack.includes(o.message)?o.stack:o.message+`
`+o.stack),a}(r);throw qe("INTERNAL UNHANDLED ERROR: ",i),r}).then(r=>(this.du=!1,r))));return this.mu=t,t}enqueueAfterDelay(e,t,r){this.fu(),this.Ru.indexOf(e)>-1&&(t=0);let i=gm.createAndSchedule(this,e,t,r,s=>this.yu(s));return this.Tu.push(i),i}fu(){this.Eu&&z()}verifyOperationInProgress(){}wu(){return x(this,null,function*(){let e;do e=this.mu,yield e;while(e!==this.mu)})}Su(e){for(let t of this.Tu)if(t.timerId===e)return!0;return!1}bu(e){return this.wu().then(()=>{this.Tu.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(let t of this.Tu)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.wu()})}Du(e){this.Ru.push(e)}yu(e){let t=this.Tu.indexOf(e);this.Tu.splice(t,1)}};function xm(n){return function(t,r){if(typeof t!="object"||t===null)return!1;let i=t;for(let s of r)if(s in i&&typeof i[s]=="function")return!0;return!1}(n,["next","error","complete"])}var km=class{constructor(){this._progressObserver={},this._taskCompletionResolver=new Xe,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}};var VS=-1,Fe=class extends Zr{constructor(e,t,r,i){super(e,t,r,i),this.type="firestore",this._queue=new cc,this._persistenceKey=i?.name||"[DEFAULT]"}_terminate(){return x(this,null,function*(){if(this._firestoreClient){let e=this._firestoreClient.terminate();this._queue=new cc(e),this._firestoreClient=void 0,yield e}})}};function st(n){if(n._terminated)throw new k(D.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||LS(n),n._firestoreClient}function LS(n){var e,t,r;let i=n._freezeSettings(),s=function(a,u,c,d){return new sp(a,u,c,d.host,d.ssl,d.experimentalForceLongPolling,d.experimentalAutoDetectLongPolling,kS(d.experimentalLongPollingOptions),d.useFetchStreams)}(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,i);n._componentsProvider||!((t=i.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((r=i.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(n._componentsProvider={_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider}),n._firestoreClient=new Dm(n._authCredentials,n._appCheckCredentials,n._queue,s,n._componentsProvider&&function(a){let u=a?._online.build();return{_offline:a?._offline.build(u),_online:u}}(n._componentsProvider))}function BS(n,e){$t("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let t=n._freezeSettings();return qS(n,gg.provider,{build:r=>new lc(r,t.cacheSizeBytes,e?.forceOwnership)}),Promise.resolve()}function US(n){return x(this,null,function*(){$t("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let e=n._freezeSettings();qS(n,gg.provider,{build:t=>new Am(t,e.cacheSizeBytes)})})}function qS(n,e,t){if((n=_e(n,Fe))._firestoreClient||n._terminated)throw new k(D.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(n._componentsProvider||n._getSettings().localCache)throw new k(D.FAILED_PRECONDITION,"SDK cache is already specified.");n._componentsProvider={_online:e,_offline:t},LS(n)}function jS(n){if(n._initialized&&!n._terminated)throw new k(D.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");let e=new Xe;return n._queue.enqueueAndForgetEvenWhileRestricted(()=>x(this,null,function*(){try{yield function(r){return x(this,null,function*(){if(!hr.D())return Promise.resolve();let i=r+"main";yield hr.delete(i)})}(ig(n._databaseId,n._persistenceKey)),e.resolve()}catch(t){e.reject(t)}})),e.promise}function zS(n){return function(t){let r=new Xe;return t.asyncQueue.enqueueAndForget(()=>x(this,null,function*(){return tx(yield vg(t),r)})),r.promise}(st(n=_e(n,Fe)))}function KS(n){return px(st(n=_e(n,Fe)))}function GS(n){return mx(st(n=_e(n,Fe)))}function WS(n,e){let t=st(n=_e(n,Fe)),r=new km;return vx(t,n._databaseId,e,r),r}function QS(n,e){return wx(st(n=_e(n,Fe)),e).then(t=>t?new it(n,null,t.query):null)}var yn=class n{constructor(e){this._byteString=e}static fromBase64String(e){try{return new n(Ke.fromBase64String(e))}catch(t){throw new k(D.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new n(Ke.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}};var Jt=class{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new k(D.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new je(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}};var kn=class{constructor(e){this._methodName=e}};var ei=class{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new k(D.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new k(D.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return te(this._lat,e._lat)||te(this._long,e._long)}};var la=class{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(r,i){if(r.length!==i.length)return!1;for(let s=0;s<r.length;++s)if(r[s]!==i[s])return!1;return!0}(this._values,e._values)}};var Ix=/^__.*__$/,Mm=class{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new Yt(e,this.data,this.fieldMask,t,this.fieldTransforms):new _r(e,this.data,t,this.fieldTransforms)}},hc=class{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new Yt(e,this.data,this.fieldMask,t,this.fieldTransforms)}};function $S(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw z()}}var dc=class n{constructor(e,t,r,i,s,o){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=i,s===void 0&&this.vu(),this.fieldTransforms=s||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Cu(){return this.settings.Cu}Fu(e){return new n(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Mu(e){var t;let r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.Fu({path:r,xu:!1});return i.Ou(e),i}Nu(e){var t;let r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.Fu({path:r,xu:!1});return i.vu(),i}Lu(e){return this.Fu({path:void 0,xu:!0})}Bu(e){return fc(e,this.settings.methodName,this.settings.ku||!1,this.path,this.settings.qu)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}vu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Ou(this.path.get(e))}Ou(e){if(e.length===0)throw this.Bu("Document fields must not be empty");if($S(this.Cu)&&Ix.test(e))throw this.Bu('Document fields cannot begin and end with "__"')}},Fm=class{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||ma(e)}Qu(e,t,r,i=!1){return new dc({Cu:e,methodName:t,qu:r,path:je.emptyPath(),xu:!1,ku:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function ii(n){let e=n._freezeSettings(),t=ma(n._databaseId);return new Fm(n._databaseId,!!e.ignoreUndefinedProperties,t)}function Sc(n,e,t,r,i,s={}){let o=n.Qu(s.merge||s.mergeFields?2:0,e,t,i);Ag("Data must be an object, but it was:",o,r);let a=JS(r,o),u,c;if(s.merge)u=new Dt(o.fieldMask),c=o.fieldTransforms;else if(s.mergeFields){let d=[];for(let f of s.mergeFields){let m=Um(e,f,t);if(!o.contains(m))throw new k(D.INVALID_ARGUMENT,`Field '${m}' is specified in your field mask but missing from your input data.`);ZS(d,m)||d.push(m)}u=new Dt(d),c=o.fieldTransforms.filter(f=>u.covers(f.field))}else u=null,c=o.fieldTransforms;return new Mm(new ht(a),u,c)}var ua=class n extends kn{_toFieldTransform(e){if(e.Cu!==2)throw e.Cu===1?e.Bu(`${this._methodName}() can only appear at the top level of your update data`):e.Bu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof n}};function HS(n,e,t){return new dc({Cu:3,qu:e.settings.qu,methodName:n._methodName,xu:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}var Om=class n extends kn{_toFieldTransform(e){return new Yr(e.path,new mr)}isEqual(e){return e instanceof n}},Vm=class n extends kn{constructor(e,t){super(e),this.Ku=t}_toFieldTransform(e){let t=HS(this,e,!0),r=this.Ku.map(s=>si(s,t)),i=new Dn(r);return new Yr(e.path,i)}isEqual(e){return e instanceof n&&Vh(this.Ku,e.Ku)}},Lm=class n extends kn{constructor(e,t){super(e),this.Ku=t}_toFieldTransform(e){let t=HS(this,e,!0),r=this.Ku.map(s=>si(s,t)),i=new xn(r);return new Yr(e.path,i)}isEqual(e){return e instanceof n&&Vh(this.Ku,e.Ku)}},Bm=class n extends kn{constructor(e,t){super(e),this.$u=t}_toFieldTransform(e){let t=new gr(e.serializer,OC(e.serializer,this.$u));return new Yr(e.path,t)}isEqual(e){return e instanceof n&&this.$u===e.$u}};function Sg(n,e,t,r){let i=n.Qu(1,e,t);Ag("Data must be an object, but it was:",i,r);let s=[],o=ht.empty();ri(r,(u,c)=>{let d=Rg(e,u,t);c=ce(c);let f=i.Nu(d);if(c instanceof ua)s.push(d);else{let m=si(c,f);m!=null&&(s.push(d),o.set(d,m))}});let a=new Dt(s);return new hc(o,a,i.fieldTransforms)}function bg(n,e,t,r,i,s){let o=n.Qu(1,e,t),a=[Um(e,r,t)],u=[i];if(s.length%2!=0)throw new k(D.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let m=0;m<s.length;m+=2)a.push(Um(e,s[m])),u.push(s[m+1]);let c=[],d=ht.empty();for(let m=a.length-1;m>=0;--m)if(!ZS(c,a[m])){let _=a[m],I=u[m];I=ce(I);let S=o.Nu(_);if(I instanceof ua)c.push(_);else{let P=si(I,S);P!=null&&(c.push(_),d.set(_,P))}}let f=new Dt(c);return new hc(d,f,o.fieldTransforms)}function YS(n,e,t,r=!1){return si(t,n.Qu(r?4:3,e))}function si(n,e){if(XS(n=ce(n)))return Ag("Unsupported field value:",e,n),JS(n,e);if(n instanceof kn)return function(r,i){if(!$S(i.Cu))throw i.Bu(`${r._methodName}() can only be used with update() and set()`);if(!i.path)throw i.Bu(`${r._methodName}() is not currently supported inside arrays`);let s=r._toFieldTransform(i);s&&i.fieldTransforms.push(s)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.xu&&e.Cu!==4)throw e.Bu("Nested arrays are not supported");return function(r,i){let s=[],o=0;for(let a of r){let u=si(a,i.Lu(o));u==null&&(u={nullValue:"NULL_VALUE"}),s.push(u),o++}return{arrayValue:{values:s}}}(n,e)}return function(r,i){if((r=ce(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return OC(i.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){let s=Me.fromDate(r);return{timestampValue:ls(i.serializer,s)}}if(r instanceof Me){let s=new Me(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:ls(i.serializer,s)}}if(r instanceof ei)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof yn)return{bytesValue:WC(i.serializer,r._byteString)};if(r instanceof be){let s=i.databaseId,o=r.firestore._databaseId;if(!o.isEqual(s))throw i.Bu(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:tg(r.firestore._databaseId||i.databaseId,r._key.path)}}if(r instanceof la)return function(o,a){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:o.toArray().map(u=>{if(typeof u!="number")throw a.Bu("VectorValues must only contain numeric values.");return eg(a.serializer,u)})}}}}}}(r,i);throw i.Bu(`Unsupported field value: ${Cc(r)}`)}(n,e)}function JS(n,e){let t={};return yC(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):ri(n,(r,i)=>{let s=si(i,e.Mu(r));s!=null&&(t[r]=s)}),{mapValue:{fields:t}}}function XS(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof Me||n instanceof ei||n instanceof yn||n instanceof be||n instanceof kn||n instanceof la)}function Ag(n,e,t){if(!XS(t)||!function(i){return typeof i=="object"&&i!==null&&(Object.getPrototypeOf(i)===Object.prototype||Object.getPrototypeOf(i)===null)}(t)){let r=Cc(t);throw r==="an object"?e.Bu(n+" a custom object"):e.Bu(n+" "+r)}}function Um(n,e,t){if((e=ce(e))instanceof Jt)return e._internalPath;if(typeof e=="string")return Rg(n,e);throw fc("Field path arguments must be of type string or ",n,!1,void 0,t)}var Ex=new RegExp("[~\\*/\\[\\]]");function Rg(n,e,t){if(e.search(Ex)>=0)throw fc(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new Jt(...e.split("."))._internalPath}catch{throw fc(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function fc(n,e,t,r,i){let s=r&&!r.isEmpty(),o=i!==void 0,a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let u="";return(s||o)&&(u+=" (found",s&&(u+=` in field ${r}`),o&&(u+=` in document ${i}`),u+=")"),new k(D.INVALID_ARGUMENT,a+n+u)}function ZS(n,e){return n.some(t=>t.isEqual(e))}var ti=class{constructor(e,t,r,i,s){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new be(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){let e=new qm(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){let t=this._document.data.field(bc("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}},qm=class extends ti{data(){return super.data()}};function bc(n,e){return typeof e=="string"?Rg(n,e):e instanceof Jt?e._internalPath:e._delegate._internalPath}function e0(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new k(D.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var ca=class{},ni=class extends ca{};function On(n,e,...t){let r=[];e instanceof ca&&r.push(e),r=r.concat(t),function(s){let o=s.filter(u=>u instanceof jm).length,a=s.filter(u=>u instanceof pc).length;if(o>1||o>0&&a>0)throw new k(D.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(let i of r)n=i._apply(n);return n}var pc=class n extends ni{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=this._parse(e);return c0(e._query,t),new it(e.firestore,e.converter,yp(e._query,t))}_parse(e){let t=ii(e.firestore);return function(s,o,a,u,c,d,f){let m;if(c.isKeyField()){if(d==="array-contains"||d==="array-contains-any")throw new k(D.INVALID_ARGUMENT,`Invalid Query. You can't perform '${d}' queries on documentId().`);if(d==="in"||d==="not-in"){sC(f,d);let _=[];for(let I of f)_.push(iC(u,s,I));m={arrayValue:{values:_}}}else m=iC(u,s,f)}else d!=="in"&&d!=="not-in"&&d!=="array-contains-any"||sC(f,d),m=YS(a,o,f,d==="in"||d==="not-in");return he.create(c,d,m)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}};function t0(n,e,t){let r=e,i=bc("where",n);return pc._create(i,r,t)}var jm=class n extends ca{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new n(e,t)}_parse(e){let t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return t.length===1?t[0]:Ie.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return t.getFilters().length===0?e:(function(i,s){let o=i,a=s.getFlattenedFilters();for(let u of a)c0(o,u),o=yp(o,u)}(e._query,t),new it(e.firestore,e.converter,yp(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}};var zm=class n extends ni{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new n(e,t)}_apply(e){let t=function(i,s,o){if(i.startAt!==null)throw new k(D.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(i.endAt!==null)throw new k(D.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new $r(s,o)}(e._query,this._field,this._direction);return new it(e.firestore,e.converter,function(i,s){let o=i.explicitOrderBy.concat([s]);return new Ht(i.path,i.collectionGroup,o,i.filters.slice(),i.limit,i.limitType,i.startAt,i.endAt)}(e._query,t))}};function n0(n,e="asc"){let t=e,r=bc("orderBy",n);return zm._create(r,t)}var mc=class n extends ni{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new n(e,t,r)}_apply(e){return new it(e.firestore,e.converter,ku(e._query,this._limit,this._limitType))}};function r0(n){return MS("limit",n),mc._create("limit",n,"F")}function i0(n){return MS("limitToLast",n),mc._create("limitToLast",n,"L")}var gc=class n extends ni{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=u0(e,this.type,this._docOrFields,this._inclusive);return new it(e.firestore,e.converter,function(i,s){return new Ht(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,s,i.endAt)}(e._query,t))}};function s0(...n){return gc._create("startAt",n,!0)}function o0(...n){return gc._create("startAfter",n,!1)}var _c=class n extends ni{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=u0(e,this.type,this._docOrFields,this._inclusive);return new it(e.firestore,e.converter,function(i,s){return new Ht(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,i.startAt,s)}(e._query,t))}};function a0(...n){return _c._create("endBefore",n,!1)}function l0(...n){return _c._create("endAt",n,!0)}function u0(n,e,t,r){if(t[0]=ce(t[0]),t[0]instanceof ti)return function(s,o,a,u,c){if(!u)throw new k(D.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${a}().`);let d=[];for(let f of es(s))if(f.field.isKeyField())d.push(Qr(o,u.key));else{let m=u.data.field(f.field);if(vc(m))throw new k(D.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+f.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(m===null){let _=f.field.canonicalString();throw new k(D.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${_}' (used as the orderBy) does not exist.`)}d.push(m)}return new gn(d,c)}(n._query,n.firestore._databaseId,e,t[0]._document,r);{let i=ii(n.firestore);return function(o,a,u,c,d,f){let m=o.explicitOrderBy;if(d.length>m.length)throw new k(D.INVALID_ARGUMENT,`Too many arguments provided to ${c}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let _=[];for(let I=0;I<d.length;I++){let S=d[I];if(m[I].field.isKeyField()){if(typeof S!="string")throw new k(D.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${c}(), but got a ${typeof S}`);if(!Xm(o)&&S.indexOf("/")!==-1)throw new k(D.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${c}() must be a plain document ID, but '${S}' contains a slash.`);let P=o.path.child(me.fromString(S));if(!j.isDocumentKey(P))throw new k(D.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${c}() must result in a valid document path, but '${P}' is not because it contains an odd number of segments.`);let V=new j(P);_.push(Qr(a,V))}else{let P=YS(u,c,S);_.push(P)}}return new gn(_,f)}(n._query,n.firestore._databaseId,i,e,t,r)}}function iC(n,e,t){if(typeof(t=ce(t))=="string"){if(t==="")throw new k(D.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Xm(e)&&t.indexOf("/")!==-1)throw new k(D.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);let r=e.path.child(me.fromString(t));if(!j.isDocumentKey(r))throw new k(D.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Qr(n,new j(r))}if(t instanceof be)return Qr(n,t._key);throw new k(D.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Cc(t)}.`)}function sC(n,e){if(!Array.isArray(n)||n.length===0)throw new k(D.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function c0(n,e){let t=function(i,s){for(let o of i)for(let a of o.getFlattenedFilters())if(s.indexOf(a.op)>=0)return a.op;return null}(n.filters,function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new k(D.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new k(D.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}var ys=class{convertValue(e,t="none"){switch(Wr(e)){case 0:return null;case 1:return e.booleanValue;case 2:return xe(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(dr(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw z()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let r={};return ri(e,(i,s)=>{r[i]=this.convertValue(s,t)}),r}convertVectorValue(e){var t,r,i;let s=(i=(r=(t=e.fields)===null||t===void 0?void 0:t.value.arrayValue)===null||r===void 0?void 0:r.values)===null||i===void 0?void 0:i.map(o=>xe(o.doubleValue));return new la(s)}convertGeoPoint(e){return new ei(xe(e.latitude),xe(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":let r=Ym(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(Qo(e));default:return null}}convertTimestamp(e){let t=Nn(e);return new Me(t.seconds,t.nanos)}convertDocumentKey(e,t){let r=me.fromString(e);Q(rS(r));let i=new fr(r.get(1),r.get(3)),s=new j(r.popFirst(5));return i.isEqual(t)||qe(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}};function Ac(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}var Km=class extends ys{constructor(e){super(),this.firestore=e}convertBytes(e){return new yn(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new be(this.firestore,null,t)}};var Pn=class{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}},zt=class extends ti{constructor(e,t,r,i,s,o){super(e,t,r,i,o),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){let t=new ur(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){let r=this._document.data.field(bc("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}},ur=class extends zt{data(e={}){return super.data(e)}},Xt=class{constructor(e,t,r,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new Pn(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new ur(this._firestore,this._userDataWriter,r.key,r,new Pn(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new k(D.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(i,s){if(i._snapshot.oldDocs.isEmpty()){let o=0;return i._snapshot.docChanges.map(a=>{let u=new ur(i._firestore,i._userDataWriter,a.doc.key,a.doc,new Pn(i._snapshot.mutatedKeys.has(a.doc.key),i._snapshot.fromCache),i.query.converter);return a.doc,{type:"added",doc:u,oldIndex:-1,newIndex:o++}})}{let o=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(a=>s||a.type!==3).map(a=>{let u=new ur(i._firestore,i._userDataWriter,a.doc.key,a.doc,new Pn(i._snapshot.mutatedKeys.has(a.doc.key),i._snapshot.fromCache),i.query.converter),c=-1,d=-1;return a.type!==0&&(c=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),a.type!==1&&(o=o.add(a.doc),d=o.indexOf(a.doc.key)),{type:Tx(a.type),doc:u,oldIndex:c,newIndex:d}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}};function Tx(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return z()}}function Pg(n,e){return n instanceof zt&&e instanceof zt?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(n._document===null?e._document===null:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof Xt&&e instanceof Xt&&n._firestore===e._firestore&&Cg(n.query,e.query)&&n.metadata.isEqual(e.metadata)&&n._snapshot.isEqual(e._snapshot)}function h0(n){n=_e(n,be);let e=_e(n.firestore,Fe);return DS(st(e),n._key).then(t=>kg(e,n,t))}var Mn=class extends ys{constructor(e){super(),this.firestore=e}convertBytes(e){return new yn(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new be(this.firestore,null,t)}};function d0(n){n=_e(n,be);let e=_e(n.firestore,Fe),t=st(e),r=new Mn(e);return gx(t,n._key).then(i=>new zt(e,r,n._key,i,new Pn(i!==null&&i.hasLocalMutations,!0),n.converter))}function f0(n){n=_e(n,be);let e=_e(n.firestore,Fe);return DS(st(e),n._key,{source:"server"}).then(t=>kg(e,n,t))}function p0(n){n=_e(n,it);let e=_e(n.firestore,Fe),t=st(e),r=new Mn(e);return e0(n._query),xS(t,n._query).then(i=>new Xt(e,r,n,i))}function m0(n){n=_e(n,it);let e=_e(n.firestore,Fe),t=st(e),r=new Mn(e);return _x(t,n._query).then(i=>new Xt(e,r,n,i))}function g0(n){n=_e(n,it);let e=_e(n.firestore,Fe),t=st(e),r=new Mn(e);return xS(t,n._query,{source:"server"}).then(i=>new Xt(e,r,n,i))}function Ng(n,e,t){n=_e(n,be);let r=_e(n.firestore,Fe),i=Ac(n.converter,e,t);return Ss(r,[Sc(ii(r),"setDoc",n._key,i,n.converter!==null,t).toMutation(n._key,Be.none())])}function Dg(n,e,t,...r){n=_e(n,be);let i=_e(n.firestore,Fe),s=ii(i),o;return o=typeof(e=ce(e))=="string"||e instanceof Jt?bg(s,"updateDoc",n._key,e,t,r):Sg(s,"updateDoc",n._key,e),Ss(i,[o.toMutation(n._key,Be.exists(!0))])}function _0(n){return Ss(_e(n.firestore,Fe),[new yr(n._key,Be.none())])}function y0(n,e){let t=_e(n.firestore,Fe),r=_a(n),i=Ac(n.converter,e);return Ss(t,[Sc(ii(n.firestore),"addDoc",r._key,i,n.converter!==null,{}).toMutation(r._key,Be.exists(!1))]).then(()=>r)}function xg(n,...e){var t,r,i;n=ce(n);let s={includeMetadataChanges:!1,source:"default"},o=0;typeof e[o]!="object"||xm(e[o])||(s=e[o],o++);let a={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(xm(e[o])){let f=e[o];e[o]=(t=f.next)===null||t===void 0?void 0:t.bind(f),e[o+1]=(r=f.error)===null||r===void 0?void 0:r.bind(f),e[o+2]=(i=f.complete)===null||i===void 0?void 0:i.bind(f)}let u,c,d;if(n instanceof be)c=_e(n.firestore,Fe),d=ws(n._key.path),u={next:f=>{e[o]&&e[o](kg(c,n,f))},error:e[o+1],complete:e[o+2]};else{let f=_e(n,it);c=_e(f.firestore,Fe),d=f._query;let m=new Mn(c);u={next:_=>{e[o]&&e[o](new Xt(c,m,f,_))},error:e[o+1],complete:e[o+2]},e0(n._query)}return function(m,_,I,S){let P=new gs(S),V=new aa(_,P,I);return m.asyncQueue.enqueueAndForget(()=>x(this,null,function*(){return lg(yield _s(m),V)})),()=>{P.Za(),m.asyncQueue.enqueueAndForget(()=>x(this,null,function*(){return ug(yield _s(m),V)}))}}(st(c),d,a,u)}function v0(n,e){return yx(st(n=_e(n,Fe)),xm(e)?e:{next:e})}function Ss(n,e){return function(r,i){let s=new Xe;return r.asyncQueue.enqueueAndForget(()=>x(this,null,function*(){return JD(yield vg(r),i,s)})),s.promise}(st(n),e)}function kg(n,e,t){let r=t.docs.get(e._key),i=new Mn(n);return new zt(n,i,e._key,r,new Pn(t.hasPendingWrites,t.fromCache),e.converter)}var Cx={maxAttempts:5};var yc=class{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=ii(e)}set(e,t,r){this._verifyNotCommitted();let i=ar(e,this._firestore),s=Ac(i.converter,t,r),o=Sc(this._dataReader,"WriteBatch.set",i._key,s,i.converter!==null,r);return this._mutations.push(o.toMutation(i._key,Be.none())),this}update(e,t,r,...i){this._verifyNotCommitted();let s=ar(e,this._firestore),o;return o=typeof(t=ce(t))=="string"||t instanceof Jt?bg(this._dataReader,"WriteBatch.update",s._key,t,r,i):Sg(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(o.toMutation(s._key,Be.exists(!0))),this}delete(e){this._verifyNotCommitted();let t=ar(e,this._firestore);return this._mutations=this._mutations.concat(new yr(t._key,Be.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new k(D.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}};function ar(n,e){if((n=ce(n)).firestore!==e)throw new k(D.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}var Gm=class extends class{constructor(t,r){this._firestore=t,this._transaction=r,this._dataReader=ii(t)}get(t){let r=ar(t,this._firestore),i=new Km(this._firestore);return this._transaction.lookup([r._key]).then(s=>{if(!s||s.length!==1)return z();let o=s[0];if(o.isFoundDocument())return new ti(this._firestore,i,o.key,o,r.converter);if(o.isNoDocument())return new ti(this._firestore,i,r._key,null,r.converter);throw z()})}set(t,r,i){let s=ar(t,this._firestore),o=Ac(s.converter,r,i),a=Sc(this._dataReader,"Transaction.set",s._key,o,s.converter!==null,i);return this._transaction.set(s._key,a),this}update(t,r,i,...s){let o=ar(t,this._firestore),a;return a=typeof(r=ce(r))=="string"||r instanceof Jt?bg(this._dataReader,"Transaction.update",o._key,r,i,s):Sg(this._dataReader,"Transaction.update",o._key,r),this._transaction.update(o._key,a),this}delete(t){let r=ar(t,this._firestore);return this._transaction.delete(r._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){let t=ar(e,this._firestore),r=new Mn(this._firestore);return super.get(e).then(i=>new zt(this._firestore,r,t._key,i._document,new Pn(!1,!1),t.converter))}};function w0(n,e,t){n=_e(n,Fe);let r=Object.assign(Object.assign({},Cx),t);return function(s){if(s.maxAttempts<1)throw new k(D.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(s,o,a){let u=new Xe;return s.asyncQueue.enqueueAndForget(()=>x(this,null,function*(){let c=yield fx(s);new Nm(s.asyncQueue,c,a,o,u).au()})),u.promise}(st(n),i=>e(new Gm(n,i)),r)}function I0(){return new ua("deleteField")}function E0(){return new Om("serverTimestamp")}function T0(...n){return new Vm("arrayUnion",n)}function C0(...n){return new Lm("arrayRemove",n)}function S0(n){return new Bm("increment",n)}(function(e,t=!0){(function(i){vs=i})(el),Za(new rn("firestore",(r,{instanceIdentifier:i,options:s})=>{let o=r.getProvider("app").getImmediate(),a=new Fe(new Hf(r.getProvider("auth-internal")),new Zf(r.getProvider("app-check-internal")),function(c,d){if(!Object.prototype.hasOwnProperty.apply(c.options,["projectId"]))throw new k(D.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new fr(c.options.projectId,d)}(o,i),o);return s=Object.assign({useFetchStreams:t},s),a._setSettings(s),a},"PUBLIC").setMultipleInstances(!0)),Ci(rT,"4.7.3",e),Ci(rT,"4.7.3","esm2017")})();var Sx="@firebase/firestore-compat",bx="0.3.38";function Bg(n,e){if(e===void 0)return{merge:!1};if(e.mergeFields!==void 0&&e.merge!==void 0)throw new k("invalid-argument",`Invalid options passed to function ${n}(): You cannot specify both "merge" and "mergeFields".`);return e}function b0(){if(typeof Uint8Array>"u")throw new k("unimplemented","Uint8Arrays are not available in this environment.")}function A0(){if(!vC())throw new k("unimplemented","Blobs are unavailable in Firestore in this environment.")}var Rc=class n{constructor(e){this._delegate=e}static fromBase64String(e){return A0(),new n(yn.fromBase64String(e))}static fromUint8Array(e){return b0(),new n(yn.fromUint8Array(e))}toBase64(){return A0(),this._delegate.toBase64()}toUint8Array(){return b0(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}};function Mg(n){return Ax(n,["next","error","complete"])}function Ax(n,e){if(typeof n!="object"||n===null)return!1;let t=n;for(let r of e)if(r in t&&typeof t[r]=="function")return!0;return!1}var Fg=class{enableIndexedDbPersistence(e,t){return BS(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return US(e._delegate)}clearIndexedDbPersistence(e){return jS(e._delegate)}},Pc=class{constructor(e,t,r){this._delegate=t,this._persistenceProvider=r,this.INTERNAL={delete:()=>this.terminate()},e instanceof fr||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){let t=this._delegate._getSettings();!e.merge&&t.host!==e.host&&$t("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&(e=Object.assign(Object.assign({},t),e),delete e.merge),this._delegate._setSettings(e)}useEmulator(e,t,r={}){FS(this._delegate,e,t,r)}enableNetwork(){return KS(this._delegate)}disableNetwork(){return GS(this._delegate)}enablePersistence(e){let t=!1,r=!1;return e&&(t=!!e.synchronizeTabs,r=!!e.experimentalForceOwningTab,Ig("synchronizeTabs",t,"experimentalForceOwningTab",r)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,r)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return zS(this._delegate)}onSnapshotsInSync(e){return v0(this._delegate,e)}get app(){if(!this._appCompat)throw new k("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new Rs(this,Eg(this._delegate,e))}catch(t){throw wt(t,"collection()","Firestore.collection()")}}doc(e){try{return new vn(this,_a(this._delegate,e))}catch(t){throw wt(t,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new ui(this,OS(this._delegate,e))}catch(t){throw wt(t,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return w0(this._delegate,t=>e(new Nc(this,t)))}batch(){return st(this._delegate),new Dc(new yc(this._delegate,e=>Ss(this._delegate,e)))}loadBundle(e){return WS(this._delegate,e)}namedQuery(e){return QS(this._delegate,e).then(t=>t?new ui(this,t):null)}},bs=class extends ys{constructor(e){super(),this.firestore=e}convertBytes(e){return new Rc(new yn(e))}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return vn.forKey(t,this.firestore,null)}};function Rx(n){oC(n)}var Nc=class{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new bs(e)}get(e){let t=oi(e);return this._delegate.get(t).then(r=>new ai(this._firestore,new zt(this._firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,t.converter)))}set(e,t,r){let i=oi(e);return r?(Bg("Transaction.set",r),this._delegate.set(i,t,r)):this._delegate.set(i,t),this}update(e,t,r,...i){let s=oi(e);return arguments.length===2?this._delegate.update(s,t):this._delegate.update(s,t,r,...i),this}delete(e){let t=oi(e);return this._delegate.delete(t),this}},Dc=class{constructor(e){this._delegate=e}set(e,t,r){let i=oi(e);return r?(Bg("WriteBatch.set",r),this._delegate.set(i,t,r)):this._delegate.set(i,t),this}update(e,t,r,...i){let s=oi(e);return arguments.length===2?this._delegate.update(s,t):this._delegate.update(s,t,r,...i),this}delete(e){let t=oi(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}},As=class n{constructor(e,t,r){this._firestore=e,this._userDataWriter=t,this._delegate=r}fromFirestore(e,t){let r=new ur(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new li(this._firestore,r),t??{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){let r=n.INSTANCES,i=r.get(e);i||(i=new WeakMap,r.set(e,i));let s=i.get(t);return s||(s=new n(e,new bs(e),t),i.set(t,s)),s}};As.INSTANCES=new WeakMap;var vn=class n{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new bs(e)}static forPath(e,t,r){if(e.length%2!==0)throw new k("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${e.canonicalString()} has ${e.length}`);return new n(t,new be(t._delegate,r,new j(e)))}static forKey(e,t,r){return new n(t,new be(t._delegate,r,e))}get id(){return this._delegate.id}get parent(){return new Rs(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new Rs(this.firestore,Eg(this._delegate,e))}catch(t){throw wt(t,"collection()","DocumentReference.collection()")}}isEqual(e){return e=ce(e),e instanceof be?Tg(this._delegate,e):!1}set(e,t){t=Bg("DocumentReference.set",t);try{return t?Ng(this._delegate,e,t):Ng(this._delegate,e)}catch(r){throw wt(r,"setDoc()","DocumentReference.set()")}}update(e,t,...r){try{return arguments.length===1?Dg(this._delegate,e):Dg(this._delegate,e,t,...r)}catch(i){throw wt(i,"updateDoc()","DocumentReference.update()")}}delete(){return _0(this._delegate)}onSnapshot(...e){let t=R0(e),r=P0(e,i=>new ai(this.firestore,new zt(this.firestore._delegate,this._userDataWriter,i._key,i._document,i.metadata,this._delegate.converter)));return xg(this._delegate,t,r)}get(e){let t;return e?.source==="cache"?t=d0(this._delegate):e?.source==="server"?t=f0(this._delegate):t=h0(this._delegate),t.then(r=>new ai(this.firestore,new zt(this.firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,this._delegate.converter)))}withConverter(e){return new n(this.firestore,e?this._delegate.withConverter(As.getInstance(this.firestore,e)):this._delegate.withConverter(null))}};function wt(n,e,t){return n.message=n.message.replace(e,t),n}function R0(n){for(let e of n)if(typeof e=="object"&&!Mg(e))return e;return{}}function P0(n,e){var t,r;let i;return Mg(n[0])?i=n[0]:Mg(n[1])?i=n[1]:typeof n[0]=="function"?i={next:n[0],error:n[1],complete:n[2]}:i={next:n[1],error:n[2],complete:n[3]},{next:s=>{i.next&&i.next(e(s))},error:(t=i.error)===null||t===void 0?void 0:t.bind(i),complete:(r=i.complete)===null||r===void 0?void 0:r.bind(i)}}var ai=class{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new vn(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return Pg(this._delegate,e._delegate)}},li=class extends ai{data(e){let t=this._delegate.data(e);return this._delegate._converter||aC(t!==void 0,"Document in a QueryDocumentSnapshot should exist"),t}},ui=class n{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new bs(e)}where(e,t,r){try{return new n(this.firestore,On(this._delegate,t0(e,t,r)))}catch(i){throw wt(i,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,t){try{return new n(this.firestore,On(this._delegate,n0(e,t)))}catch(r){throw wt(r,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new n(this.firestore,On(this._delegate,r0(e)))}catch(t){throw wt(t,"limit()","Query.limit()")}}limitToLast(e){try{return new n(this.firestore,On(this._delegate,i0(e)))}catch(t){throw wt(t,"limitToLast()","Query.limitToLast()")}}startAt(...e){try{return new n(this.firestore,On(this._delegate,s0(...e)))}catch(t){throw wt(t,"startAt()","Query.startAt()")}}startAfter(...e){try{return new n(this.firestore,On(this._delegate,o0(...e)))}catch(t){throw wt(t,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new n(this.firestore,On(this._delegate,a0(...e)))}catch(t){throw wt(t,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new n(this.firestore,On(this._delegate,l0(...e)))}catch(t){throw wt(t,"endAt()","Query.endAt()")}}isEqual(e){return Cg(this._delegate,e._delegate)}get(e){let t;return e?.source==="cache"?t=m0(this._delegate):e?.source==="server"?t=g0(this._delegate):t=p0(this._delegate),t.then(r=>new ya(this.firestore,new Xt(this.firestore._delegate,this._userDataWriter,this._delegate,r._snapshot)))}onSnapshot(...e){let t=R0(e),r=P0(e,i=>new ya(this.firestore,new Xt(this.firestore._delegate,this._userDataWriter,this._delegate,i._snapshot)));return xg(this._delegate,t,r)}withConverter(e){return new n(this.firestore,e?this._delegate.withConverter(As.getInstance(this.firestore,e)):this._delegate.withConverter(null))}},Og=class{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new li(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}},ya=class{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new ui(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new li(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(t=>new Og(this._firestore,t))}forEach(e,t){this._delegate.forEach(r=>{e.call(t,new li(this._firestore,r))})}isEqual(e){return Pg(this._delegate,e._delegate)}},Rs=class n extends ui{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){let e=this._delegate.parent;return e?new vn(this.firestore,e):null}doc(e){try{return e===void 0?new vn(this.firestore,_a(this._delegate)):new vn(this.firestore,_a(this._delegate,e))}catch(t){throw wt(t,"doc()","CollectionReference.doc()")}}add(e){return y0(this._delegate,e).then(t=>new vn(this.firestore,t))}isEqual(e){return Tg(this._delegate,e._delegate)}withConverter(e){return new n(this.firestore,e?this._delegate.withConverter(As.getInstance(this.firestore,e)):this._delegate.withConverter(null))}};function oi(n){return _e(n,be)}var Vg=class n{constructor(...e){this._delegate=new Jt(...e)}static documentId(){return new n(je.keyField().canonicalString())}isEqual(e){return e=ce(e),e instanceof Jt?this._delegate._internalPath.isEqual(e._internalPath):!1}};var Lg=class n{constructor(e){this._delegate=e}static serverTimestamp(){let e=E0();return e._methodName="FieldValue.serverTimestamp",new n(e)}static delete(){let e=I0();return e._methodName="FieldValue.delete",new n(e)}static arrayUnion(...e){let t=T0(...e);return t._methodName="FieldValue.arrayUnion",new n(t)}static arrayRemove(...e){let t=C0(...e);return t._methodName="FieldValue.arrayRemove",new n(t)}static increment(e){let t=S0(e);return t._methodName="FieldValue.increment",new n(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}};var Px={Firestore:Pc,GeoPoint:ei,Timestamp:Me,Blob:Rc,Transaction:Nc,WriteBatch:Dc,DocumentReference:vn,DocumentSnapshot:ai,Query:ui,QueryDocumentSnapshot:li,QuerySnapshot:ya,CollectionReference:Rs,FieldPath:Vg,FieldValue:Lg,setLogLevel:Rx,CACHE_SIZE_UNLIMITED:VS};function Nx(n,e){n.INTERNAL.registerComponent(new rn("firestore-compat",t=>{let r=t.getProvider("app-compat").getImmediate(),i=t.getProvider("firestore").getImmediate();return e(r,i)},"PUBLIC").setServiceProps(Object.assign({},Px)))}function Dx(n){Nx(n,(e,t)=>new Pc(e,t,new Fg)),n.registerVersion(Sx,bx)}Dx(Qn);function xx(n,e=qa){return new Ua(t=>{let r;return e!=null?e.schedule(()=>{r=n.onSnapshot({includeMetadataChanges:!0},t)}):r=n.onSnapshot({includeMetadataChanges:!0},t),()=>{r?.()}})}function N0(n,e){return xx(n,e)}function kx(n,e){return N0(n,e).pipe(Ka(void 0),za(),et(t=>{let[r,i]=t;return i.exists?r?.exists?{payload:i,type:"modified"}:{payload:i,type:"added"}:{payload:i,type:"removed"}}))}function jg(n,e){return N0(n,e).pipe(et(t=>({payload:t,type:"query"})))}var xc=class{ref;afs;constructor(e,t){this.ref=e,this.afs=t}set(e,t){return this.ref.set(e,t)}update(e){return this.ref.update(e)}delete(){return this.ref.delete()}collection(e,t){let r=this.ref.collection(e),{ref:i,query:s}=F0(r,t);return new Mc(i,s,this.afs)}snapshotChanges(){return kx(this.ref,this.afs.schedulers.outsideAngular).pipe(Je)}valueChanges(e={}){return this.snapshotChanges().pipe(et(({payload:t})=>e.idField?Gs(en({},t.data()),{[e.idField]:t.id}):t.data()))}get(e){return Ws(this.ref.get(e)).pipe(Je)}};function kc(n,e){return jg(n,e).pipe(Ka(void 0),za(),et(t=>{let[r,i]=t,s=i.payload.docChanges(),o=s.map(a=>({type:a.type,payload:a}));return r&&JSON.stringify(r.payload.metadata)!==JSON.stringify(i.payload.metadata)&&i.payload.docs.forEach((a,u)=>{let c=s.find(f=>f.doc.ref.isEqual(a.ref)),d=r?.payload.docs.find(f=>f.ref.isEqual(a.ref));c&&JSON.stringify(c.doc.metadata)===JSON.stringify(a.metadata)||!c&&d&&JSON.stringify(d.metadata)===JSON.stringify(a.metadata)||o.push({type:"modified",payload:{oldIndex:u,newIndex:u,type:"modified",doc:a}})}),o}))}function D0(n,e,t){return kc(n,t).pipe(Rr((r,i)=>Mx(r,i.map(s=>s.payload),e),[]),ja(),et(r=>r.map(i=>({type:i.type,payload:i}))))}function Mx(n,e,t){return e.forEach(r=>{t.indexOf(r.type)>-1&&(n=Fx(n,r))}),n}function Ug(n,e,t,...r){let i=n.slice();return i.splice(e,t,...r),i}function Fx(n,e){switch(e.type){case"added":if(!(n[e.newIndex]&&n[e.newIndex].doc.ref.isEqual(e.doc.ref)))return Ug(n,e.newIndex,0,e);break;case"modified":if(n[e.oldIndex]==null||n[e.oldIndex].doc.ref.isEqual(e.doc.ref))if(e.oldIndex!==e.newIndex){let t=n.slice();return t.splice(e.oldIndex,1),t.splice(e.newIndex,0,e),t}else return Ug(n,e.newIndex,1,e);break;case"removed":if(n[e.oldIndex]&&n[e.oldIndex].doc.ref.isEqual(e.doc.ref))return Ug(n,e.oldIndex,1);break}return n}function x0(n){return(!n||n.length===0)&&(n=["added","removed","modified"]),n}var Mc=class{ref;query;afs;constructor(e,t,r){this.ref=e,this.query=t,this.afs=r}stateChanges(e){let t=kc(this.query,this.afs.schedulers.outsideAngular);return e&&e.length>0&&(t=t.pipe(et(r=>r.filter(i=>e.indexOf(i.type)>-1)))),t.pipe(Ka(void 0),za(),Dh(([r,i])=>i.length>0||!r),et(([,r])=>r),Je)}auditTrail(e){return this.stateChanges(e).pipe(Rr((t,r)=>[...t,...r],[]))}snapshotChanges(e){let t=x0(e);return D0(this.query,t,this.afs.schedulers.outsideAngular).pipe(Je)}valueChanges(e={}){return jg(this.query,this.afs.schedulers.outsideAngular).pipe(et(t=>t.payload.docs.map(r=>e.idField?Gs(en({},r.data()),{[e.idField]:r.id}):r.data())),Je)}get(e){return Ws(this.query.get(e)).pipe(Je)}add(e){return this.ref.add(e)}doc(e){return new xc(this.ref.doc(e),this.afs)}},qg=class{query;afs;constructor(e,t){this.query=e,this.afs=t}stateChanges(e){return!e||e.length===0?kc(this.query,this.afs.schedulers.outsideAngular).pipe(Je):kc(this.query,this.afs.schedulers.outsideAngular).pipe(et(t=>t.filter(r=>e.indexOf(r.type)>-1)),Dh(t=>t.length>0),Je)}auditTrail(e){return this.stateChanges(e).pipe(Rr((t,r)=>[...t,...r],[]))}snapshotChanges(e){let t=x0(e);return D0(this.query,t,this.afs.schedulers.outsideAngular).pipe(Je)}valueChanges(e={}){return jg(this.query,this.afs.schedulers.outsideAngular).pipe(et(r=>r.payload.docs.map(i=>e.idField?en({[e.idField]:i.id},i.data()):i.data())),Je)}get(e){return Ws(this.query.get(e)).pipe(Je)}},k0=new Gn("angularfire2.enableFirestorePersistence"),M0=new Gn("angularfire2.firestore.persistenceSettings"),Ox=new Gn("angularfire2.firestore.settings"),Vx=new Gn("angularfire2.firestore.use-emulator");function F0(n,e=t=>t){return{query:e(n),ref:n}}var Lx=(()=>{class n{schedulers;firestore;persistenceEnabled$;constructor(t,r,i,s,o,a,u,c,d,f,m,_,I,S,P,V,U){this.schedulers=u;let L=ol(t,a,r),$=d;f&&pl(L,a,m,I,S,P,_,V),[this.firestore,this.persistenceEnabled$]=al(`${L.name}.firestore`,"AngularFirestore",L.name,()=>{let re=a.runOutsideAngular(()=>L.firestore());if(s&&re.settings(s),$&&re.useEmulator(...$),i&&!My(o)){let X=()=>{try{return Ws(re.enablePersistence(c||void 0).then(()=>!0,()=>!1))}catch(E){return typeof console<"u"&&console.warn(E),Qs(!1)}};return[re,a.runOutsideAngular(X)]}else return[re,Qs(!1)]},[s,$,i])}collection(t,r){let i;typeof t=="string"?i=this.firestore.collection(t):i=t;let{ref:s,query:o}=F0(i,r),a=this.schedulers.ngZone.run(()=>s);return new Mc(a,o,this)}collectionGroup(t,r){let i=r||(o=>o),s=this.firestore.collectionGroup(t);return new qg(i(s),this)}doc(t){let r;typeof t=="string"?r=this.firestore.doc(t):r=t;let i=this.schedulers.ngZone.run(()=>r);return new xc(i,this)}createId(){return this.firestore.collection("_").doc().id}static \u0275fac=function(r){return new(r||n)(ae(il),ae(sl,8),ae(k0,8),ae(Ox,8),ae(Ga),ae(wi),ae(rl),ae(M0,8),ae(Vx,8),ae(ml,8),ae(ll,8),ae(ul,8),ae(cl,8),ae(hl,8),ae(dl,8),ae(fl,8),ae(nl,8))};static \u0275prov=Kn({token:n,factory:n.\u0275fac,providedIn:"any"})}return n})(),O0=(()=>{class n{constructor(){Qn.registerVersion("angularfire",tl.full,"fst-compat")}static enablePersistence(t){return{ngModule:n,providers:[{provide:k0,useValue:!0},{provide:M0,useValue:t}]}}static \u0275fac=function(r){return new(r||n)};static \u0275mod=G({type:n});static \u0275inj=K({providers:[Lx]})}return n})();function V0(n){return new ge(3e3,!1)}function Bx(){return new ge(3100,!1)}function Ux(){return new ge(3101,!1)}function qx(n){return new ge(3001,!1)}function jx(n){return new ge(3003,!1)}function zx(n){return new ge(3004,!1)}function Kx(n,e){return new ge(3005,!1)}function Gx(){return new ge(3006,!1)}function Wx(){return new ge(3007,!1)}function Qx(n,e){return new ge(3008,!1)}function $x(n){return new ge(3002,!1)}function Hx(n,e,t,r,i){return new ge(3010,!1)}function Yx(){return new ge(3011,!1)}function Jx(){return new ge(3012,!1)}function Xx(){return new ge(3200,!1)}function Zx(){return new ge(3202,!1)}function ek(){return new ge(3013,!1)}function tk(n){return new ge(3014,!1)}function nk(n){return new ge(3015,!1)}function rk(n){return new ge(3016,!1)}function ik(n,e){return new ge(3404,!1)}function sk(n){return new ge(3502,!1)}function ok(n){return new ge(3503,!1)}function ak(){return new ge(3300,!1)}function lk(n){return new ge(3504,!1)}function uk(n){return new ge(3301,!1)}function ck(n,e){return new ge(3302,!1)}function hk(n){return new ge(3303,!1)}function dk(n,e){return new ge(3400,!1)}function fk(n){return new ge(3401,!1)}function pk(n){return new ge(3402,!1)}function mk(n,e){return new ge(3505,!1)}function Tr(n){switch(n.length){case 0:return new Ii;case 1:return n[0];default:return new Mh(n)}}function J0(n,e,t=new Map,r=new Map){let i=[],s=[],o=-1,a=null;if(e.forEach(u=>{let c=u.get("offset"),d=c==o,f=d&&a||new Map;u.forEach((m,_)=>{let I=_,S=m;if(_!=="offset")switch(I=n.normalizePropertyName(I,i),S){case $a:S=t.get(_);break;case tn:S=r.get(_);break;default:S=n.normalizeStyleValue(_,I,S,i);break}f.set(I,S)}),d||s.push(f),a=f,o=c}),i.length)throw sk(i);return s}function h_(n,e,t,r){switch(e){case"start":n.onStart(()=>r(t&&zg(t,"start",n)));break;case"done":n.onDone(()=>r(t&&zg(t,"done",n)));break;case"destroy":n.onDestroy(()=>r(t&&zg(t,"destroy",n)));break}}function zg(n,e,t){let r=t.totalTime,i=!!t.disabled,s=d_(n.element,n.triggerName,n.fromState,n.toState,e||n.phaseName,r??n.totalTime,i),o=n._data;return o!=null&&(s._data=o),s}function d_(n,e,t,r,i="",s=0,o){return{element:n,triggerName:e,fromState:t,toState:r,phaseName:i,totalTime:s,disabled:!!o}}function kt(n,e,t){let r=n.get(e);return r||n.set(e,r=t),r}function L0(n){let e=n.indexOf(":"),t=n.substring(1,e),r=n.slice(e+1);return[t,r]}var gk=typeof document>"u"?null:document.documentElement;function f_(n){let e=n.parentNode||n.host||null;return e===gk?null:e}function _k(n){return n.substring(1,6)=="ebkit"}var ci=null,B0=!1;function yk(n){ci||(ci=vk()||{},B0=ci.style?"WebkitAppearance"in ci.style:!1);let e=!0;return ci.style&&!_k(n)&&(e=n in ci.style,!e&&B0&&(e="Webkit"+n.charAt(0).toUpperCase()+n.slice(1)in ci.style)),e}function vk(){return typeof document<"u"?document.body:null}function X0(n,e){for(;e;){if(e===n)return!0;e=f_(e)}return!1}function Z0(n,e,t){if(t)return Array.from(n.querySelectorAll(e));let r=n.querySelector(e);return r?[r]:[]}var p_=(()=>{class n{validateStyleProperty(t){return yk(t)}matchesElement(t,r){return!1}containsElement(t,r){return X0(t,r)}getParentElement(t){return f_(t)}query(t,r,i){return Z0(t,r,i)}computeStyle(t,r,i){return i||""}animate(t,r,i,s,o,a=[],u){return new Ii(i,s)}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275prov=Kn({token:n,factory:n.\u0275fac})}}return n})(),fi=class{static{this.NOOP=new p_}},pi=class{};var wk=1e3,eb="{{",Ik="}}",tb="ng-enter",Hg="ng-leave",Fc="ng-trigger",Uc=".ng-trigger",U0="ng-animating",Yg=".ng-animating";function Vn(n){if(typeof n=="number")return n;let e=n.match(/^(-?[\.\d]+)(m?s)/);return!e||e.length<2?0:Jg(parseFloat(e[1]),e[2])}function Jg(n,e){switch(e){case"s":return n*wk;default:return n}}function qc(n,e,t){return n.hasOwnProperty("duration")?n:Ek(n,e,t)}function Ek(n,e,t){let r=/^(-?[\.\d]+)(m?s)(?:\s+(-?[\.\d]+)(m?s))?(?:\s+([-a-z]+(?:\(.+?\))?))?$/i,i,s=0,o="";if(typeof n=="string"){let a=n.match(r);if(a===null)return e.push(V0(n)),{duration:0,delay:0,easing:""};i=Jg(parseFloat(a[1]),a[2]);let u=a[3];u!=null&&(s=Jg(parseFloat(u),a[4]));let c=a[5];c&&(o=c)}else i=n;if(!t){let a=!1,u=e.length;i<0&&(e.push(Bx()),a=!0),s<0&&(e.push(Ux()),a=!0),a&&e.splice(u,0,V0(n))}return{duration:i,delay:s,easing:o}}function Tk(n){return n.length?n[0]instanceof Map?n:n.map(e=>new Map(Object.entries(e))):[]}function wn(n,e,t){e.forEach((r,i)=>{let s=m_(i);t&&!t.has(i)&&t.set(i,n.style[s]),n.style[s]=r})}function di(n,e){e.forEach((t,r)=>{let i=m_(r);n.style[i]=""})}function va(n){return Array.isArray(n)?n.length==1?n[0]:zy(n):n}function Ck(n,e,t){let r=e.params||{},i=nb(n);i.length&&i.forEach(s=>{r.hasOwnProperty(s)||t.push(qx(s))})}var Xg=new RegExp(`${eb}\\s*(.+?)\\s*${Ik}`,"g");function nb(n){let e=[];if(typeof n=="string"){let t;for(;t=Xg.exec(n);)e.push(t[1]);Xg.lastIndex=0}return e}function Ia(n,e,t){let r=`${n}`,i=r.replace(Xg,(s,o)=>{let a=e[o];return a==null&&(t.push(jx(o)),a=""),a.toString()});return i==r?n:i}var Sk=/-+([a-z0-9])/g;function m_(n){return n.replace(Sk,(...e)=>e[1].toUpperCase())}function bk(n,e){return n===0||e===0}function Ak(n,e,t){if(t.size&&e.length){let r=e[0],i=[];if(t.forEach((s,o)=>{r.has(o)||i.push(o),r.set(o,s)}),i.length)for(let s=1;s<e.length;s++){let o=e[s];i.forEach(a=>o.set(a,g_(n,a)))}}return e}function xt(n,e,t){switch(e.type){case de.Trigger:return n.visitTrigger(e,t);case de.State:return n.visitState(e,t);case de.Transition:return n.visitTransition(e,t);case de.Sequence:return n.visitSequence(e,t);case de.Group:return n.visitGroup(e,t);case de.Animate:return n.visitAnimate(e,t);case de.Keyframes:return n.visitKeyframes(e,t);case de.Style:return n.visitStyle(e,t);case de.Reference:return n.visitReference(e,t);case de.AnimateChild:return n.visitAnimateChild(e,t);case de.AnimateRef:return n.visitAnimateRef(e,t);case de.Query:return n.visitQuery(e,t);case de.Stagger:return n.visitStagger(e,t);default:throw zx(e.type)}}function g_(n,e){return window.getComputedStyle(n)[e]}var Rk=new Set(["width","height","minWidth","minHeight","maxWidth","maxHeight","left","top","bottom","right","fontSize","outlineWidth","outlineOffset","paddingTop","paddingLeft","paddingBottom","paddingRight","marginTop","marginLeft","marginBottom","marginRight","borderRadius","borderWidth","borderTopWidth","borderLeftWidth","borderRightWidth","borderBottomWidth","textIndent","perspective"]),jc=class extends pi{normalizePropertyName(e,t){return m_(e)}normalizeStyleValue(e,t,r,i){let s="",o=r.toString().trim();if(Rk.has(t)&&r!==0&&r!=="0")if(typeof r=="number")s="px";else{let a=r.match(/^[+-]?[\d\.]+([a-z]*)$/);a&&a[1].length==0&&i.push(Kx(e,r))}return o+s}};var zc="*";function Pk(n,e){let t=[];return typeof n=="string"?n.split(/\s*,\s*/).forEach(r=>Nk(r,t,e)):t.push(n),t}function Nk(n,e,t){if(n[0]==":"){let u=Dk(n,t);if(typeof u=="function"){e.push(u);return}n=u}let r=n.match(/^(\*|[-\w]+)\s*(<?[=-]>)\s*(\*|[-\w]+)$/);if(r==null||r.length<4)return t.push(nk(n)),e;let i=r[1],s=r[2],o=r[3];e.push(q0(i,o));let a=i==zc&&o==zc;s[0]=="<"&&!a&&e.push(q0(o,i))}function Dk(n,e){switch(n){case":enter":return"void => *";case":leave":return"* => void";case":increment":return(t,r)=>parseFloat(r)>parseFloat(t);case":decrement":return(t,r)=>parseFloat(r)<parseFloat(t);default:return e.push(rk(n)),"* => *"}}var Oc=new Set(["true","1"]),Vc=new Set(["false","0"]);function q0(n,e){let t=Oc.has(n)||Vc.has(n),r=Oc.has(e)||Vc.has(e);return(i,s)=>{let o=n==zc||n==i,a=e==zc||e==s;return!o&&t&&typeof i=="boolean"&&(o=i?Oc.has(n):Vc.has(n)),!a&&r&&typeof s=="boolean"&&(a=s?Oc.has(e):Vc.has(e)),o&&a}}var rb=":self",xk=new RegExp(`s*${rb}s*,?`,"g");function ib(n,e,t,r){return new Zg(n).build(e,t,r)}var j0="",Zg=class{constructor(e){this._driver=e}build(e,t,r){let i=new e_(t);return this._resetContextStyleTimingState(i),xt(this,va(e),i)}_resetContextStyleTimingState(e){e.currentQuerySelector=j0,e.collectedStyles=new Map,e.collectedStyles.set(j0,new Map),e.currentTime=0}visitTrigger(e,t){let r=t.queryCount=0,i=t.depCount=0,s=[],o=[];return e.name.charAt(0)=="@"&&t.errors.push(Gx()),e.definitions.forEach(a=>{if(this._resetContextStyleTimingState(t),a.type==de.State){let u=a,c=u.name;c.toString().split(/\s*,\s*/).forEach(d=>{u.name=d,s.push(this.visitState(u,t))}),u.name=c}else if(a.type==de.Transition){let u=this.visitTransition(a,t);r+=u.queryCount,i+=u.depCount,o.push(u)}else t.errors.push(Wx())}),{type:de.Trigger,name:e.name,states:s,transitions:o,queryCount:r,depCount:i,options:null}}visitState(e,t){let r=this.visitStyle(e.styles,t),i=e.options&&e.options.params||null;if(r.containsDynamicStyles){let s=new Set,o=i||{};r.styles.forEach(a=>{a instanceof Map&&a.forEach(u=>{nb(u).forEach(c=>{o.hasOwnProperty(c)||s.add(c)})})}),s.size&&t.errors.push(Qx(e.name,[...s.values()]))}return{type:de.State,name:e.name,style:r,options:i?{params:i}:null}}visitTransition(e,t){t.queryCount=0,t.depCount=0;let r=xt(this,va(e.animation),t),i=Pk(e.expr,t.errors);return{type:de.Transition,matchers:i,animation:r,queryCount:t.queryCount,depCount:t.depCount,options:hi(e.options)}}visitSequence(e,t){return{type:de.Sequence,steps:e.steps.map(r=>xt(this,r,t)),options:hi(e.options)}}visitGroup(e,t){let r=t.currentTime,i=0,s=e.steps.map(o=>{t.currentTime=r;let a=xt(this,o,t);return i=Math.max(i,t.currentTime),a});return t.currentTime=i,{type:de.Group,steps:s,options:hi(e.options)}}visitAnimate(e,t){let r=Ok(e.timings,t.errors);t.currentAnimateTimings=r;let i,s=e.styles?e.styles:kh({});if(s.type==de.Keyframes)i=this.visitKeyframes(s,t);else{let o=e.styles,a=!1;if(!o){a=!0;let c={};r.easing&&(c.easing=r.easing),o=kh(c)}t.currentTime+=r.duration+r.delay;let u=this.visitStyle(o,t);u.isEmptyStep=a,i=u}return t.currentAnimateTimings=null,{type:de.Animate,timings:r,style:i,options:null}}visitStyle(e,t){let r=this._makeStyleAst(e,t);return this._validateStyleAst(r,t),r}_makeStyleAst(e,t){let r=[],i=Array.isArray(e.styles)?e.styles:[e.styles];for(let a of i)typeof a=="string"?a===tn?r.push(a):t.errors.push($x(a)):r.push(new Map(Object.entries(a)));let s=!1,o=null;return r.forEach(a=>{if(a instanceof Map&&(a.has("easing")&&(o=a.get("easing"),a.delete("easing")),!s)){for(let u of a.values())if(u.toString().indexOf(eb)>=0){s=!0;break}}}),{type:de.Style,styles:r,easing:o,offset:e.offset,containsDynamicStyles:s,options:null}}_validateStyleAst(e,t){let r=t.currentAnimateTimings,i=t.currentTime,s=t.currentTime;r&&s>0&&(s-=r.duration+r.delay),e.styles.forEach(o=>{typeof o!="string"&&o.forEach((a,u)=>{let c=t.collectedStyles.get(t.currentQuerySelector),d=c.get(u),f=!0;d&&(s!=i&&s>=d.startTime&&i<=d.endTime&&(t.errors.push(Hx(u,d.startTime,d.endTime,s,i)),f=!1),s=d.startTime),f&&c.set(u,{startTime:s,endTime:i}),t.options&&Ck(a,t.options,t.errors)})})}visitKeyframes(e,t){let r={type:de.Keyframes,styles:[],options:null};if(!t.currentAnimateTimings)return t.errors.push(Yx()),r;let i=1,s=0,o=[],a=!1,u=!1,c=0,d=e.steps.map(V=>{let U=this._makeStyleAst(V,t),L=U.offset!=null?U.offset:Fk(U.styles),$=0;return L!=null&&(s++,$=U.offset=L),u=u||$<0||$>1,a=a||$<c,c=$,o.push($),U});u&&t.errors.push(Jx()),a&&t.errors.push(Xx());let f=e.steps.length,m=0;s>0&&s<f?t.errors.push(Zx()):s==0&&(m=i/(f-1));let _=f-1,I=t.currentTime,S=t.currentAnimateTimings,P=S.duration;return d.forEach((V,U)=>{let L=m>0?U==_?1:m*U:o[U],$=L*P;t.currentTime=I+S.delay+$,S.duration=$,this._validateStyleAst(V,t),V.offset=L,r.styles.push(V)}),r}visitReference(e,t){return{type:de.Reference,animation:xt(this,va(e.animation),t),options:hi(e.options)}}visitAnimateChild(e,t){return t.depCount++,{type:de.AnimateChild,options:hi(e.options)}}visitAnimateRef(e,t){return{type:de.AnimateRef,animation:this.visitReference(e.animation,t),options:hi(e.options)}}visitQuery(e,t){let r=t.currentQuerySelector,i=e.options||{};t.queryCount++,t.currentQuery=e;let[s,o]=kk(e.selector);t.currentQuerySelector=r.length?r+" "+s:s,kt(t.collectedStyles,t.currentQuerySelector,new Map);let a=xt(this,va(e.animation),t);return t.currentQuery=null,t.currentQuerySelector=r,{type:de.Query,selector:s,limit:i.limit||0,optional:!!i.optional,includeSelf:o,animation:a,originalSelector:e.selector,options:hi(e.options)}}visitStagger(e,t){t.currentQuery||t.errors.push(ek());let r=e.timings==="full"?{duration:0,delay:0,easing:"full"}:qc(e.timings,t.errors,!0);return{type:de.Stagger,animation:xt(this,va(e.animation),t),timings:r,options:null}}};function kk(n){let e=!!n.split(/\s*,\s*/).find(t=>t==rb);return e&&(n=n.replace(xk,"")),n=n.replace(/@\*/g,Uc).replace(/@\w+/g,t=>Uc+"-"+t.slice(1)).replace(/:animating/g,Yg),[n,e]}function Mk(n){return n?en({},n):null}var e_=class{constructor(e){this.errors=e,this.queryCount=0,this.depCount=0,this.currentTransition=null,this.currentQuery=null,this.currentQuerySelector=null,this.currentAnimateTimings=null,this.currentTime=0,this.collectedStyles=new Map,this.options=null,this.unsupportedCSSPropertiesFound=new Set}};function Fk(n){if(typeof n=="string")return null;let e=null;if(Array.isArray(n))n.forEach(t=>{if(t instanceof Map&&t.has("offset")){let r=t;e=parseFloat(r.get("offset")),r.delete("offset")}});else if(n instanceof Map&&n.has("offset")){let t=n;e=parseFloat(t.get("offset")),t.delete("offset")}return e}function Ok(n,e){if(n.hasOwnProperty("duration"))return n;if(typeof n=="number"){let s=qc(n,e).duration;return Kg(s,0,"")}let t=n;if(t.split(/\s+/).some(s=>s.charAt(0)=="{"&&s.charAt(1)=="{")){let s=Kg(0,0,"");return s.dynamic=!0,s.strValue=t,s}let i=qc(t,e);return Kg(i.duration,i.delay,i.easing)}function hi(n){return n?(n=en({},n),n.params&&(n.params=Mk(n.params))):n={},n}function Kg(n,e,t){return{duration:n,delay:e,easing:t}}function __(n,e,t,r,i,s,o=null,a=!1){return{type:1,element:n,keyframes:e,preStyleProps:t,postStyleProps:r,duration:i,delay:s,totalTime:i+s,easing:o,subTimeline:a}}var Ea=class{constructor(){this._map=new Map}get(e){return this._map.get(e)||[]}append(e,t){let r=this._map.get(e);r||this._map.set(e,r=[]),r.push(...t)}has(e){return this._map.has(e)}clear(){this._map.clear()}},Vk=1,Lk=":enter",Bk=new RegExp(Lk,"g"),Uk=":leave",qk=new RegExp(Uk,"g");function sb(n,e,t,r,i,s=new Map,o=new Map,a,u,c=[]){return new t_().buildKeyframes(n,e,t,r,i,s,o,a,u,c)}var t_=class{buildKeyframes(e,t,r,i,s,o,a,u,c,d=[]){c=c||new Ea;let f=new n_(e,t,c,i,s,d,[]);f.options=u;let m=u.delay?Vn(u.delay):0;f.currentTimeline.delayNextStep(m),f.currentTimeline.setStyles([o],null,f.errors,u),xt(this,r,f);let _=f.timelines.filter(I=>I.containsAnimation());if(_.length&&a.size){let I;for(let S=_.length-1;S>=0;S--){let P=_[S];if(P.element===t){I=P;break}}I&&!I.allowOnlyTimelineStyles()&&I.setStyles([a],null,f.errors,u)}return _.length?_.map(I=>I.buildKeyframes()):[__(t,[],[],[],0,m,"",!1)]}visitTrigger(e,t){}visitState(e,t){}visitTransition(e,t){}visitAnimateChild(e,t){let r=t.subInstructions.get(t.element);if(r){let i=t.createSubContext(e.options),s=t.currentTimeline.currentTime,o=this._visitSubInstructions(r,i,i.options);s!=o&&t.transformIntoNewTimeline(o)}t.previousNode=e}visitAnimateRef(e,t){let r=t.createSubContext(e.options);r.transformIntoNewTimeline(),this._applyAnimationRefDelays([e.options,e.animation.options],t,r),this.visitReference(e.animation,r),t.transformIntoNewTimeline(r.currentTimeline.currentTime),t.previousNode=e}_applyAnimationRefDelays(e,t,r){for(let i of e){let s=i?.delay;if(s){let o=typeof s=="number"?s:Vn(Ia(s,i?.params??{},t.errors));r.delayNextStep(o)}}}_visitSubInstructions(e,t,r){let s=t.currentTimeline.currentTime,o=r.duration!=null?Vn(r.duration):null,a=r.delay!=null?Vn(r.delay):null;return o!==0&&e.forEach(u=>{let c=t.appendInstructionToTimeline(u,o,a);s=Math.max(s,c.duration+c.delay)}),s}visitReference(e,t){t.updateOptions(e.options,!0),xt(this,e.animation,t),t.previousNode=e}visitSequence(e,t){let r=t.subContextCount,i=t,s=e.options;if(s&&(s.params||s.delay)&&(i=t.createSubContext(s),i.transformIntoNewTimeline(),s.delay!=null)){i.previousNode.type==de.Style&&(i.currentTimeline.snapshotCurrentStyles(),i.previousNode=Kc);let o=Vn(s.delay);i.delayNextStep(o)}e.steps.length&&(e.steps.forEach(o=>xt(this,o,i)),i.currentTimeline.applyStylesToKeyframe(),i.subContextCount>r&&i.transformIntoNewTimeline()),t.previousNode=e}visitGroup(e,t){let r=[],i=t.currentTimeline.currentTime,s=e.options&&e.options.delay?Vn(e.options.delay):0;e.steps.forEach(o=>{let a=t.createSubContext(e.options);s&&a.delayNextStep(s),xt(this,o,a),i=Math.max(i,a.currentTimeline.currentTime),r.push(a.currentTimeline)}),r.forEach(o=>t.currentTimeline.mergeTimelineCollectedStyles(o)),t.transformIntoNewTimeline(i),t.previousNode=e}_visitTiming(e,t){if(e.dynamic){let r=e.strValue,i=t.params?Ia(r,t.params,t.errors):r;return qc(i,t.errors)}else return{duration:e.duration,delay:e.delay,easing:e.easing}}visitAnimate(e,t){let r=t.currentAnimateTimings=this._visitTiming(e.timings,t),i=t.currentTimeline;r.delay&&(t.incrementTime(r.delay),i.snapshotCurrentStyles());let s=e.style;s.type==de.Keyframes?this.visitKeyframes(s,t):(t.incrementTime(r.duration),this.visitStyle(s,t),i.applyStylesToKeyframe()),t.currentAnimateTimings=null,t.previousNode=e}visitStyle(e,t){let r=t.currentTimeline,i=t.currentAnimateTimings;!i&&r.hasCurrentStyleProperties()&&r.forwardFrame();let s=i&&i.easing||e.easing;e.isEmptyStep?r.applyEmptyStep(s):r.setStyles(e.styles,s,t.errors,t.options),t.previousNode=e}visitKeyframes(e,t){let r=t.currentAnimateTimings,i=t.currentTimeline.duration,s=r.duration,a=t.createSubContext().currentTimeline;a.easing=r.easing,e.styles.forEach(u=>{let c=u.offset||0;a.forwardTime(c*s),a.setStyles(u.styles,u.easing,t.errors,t.options),a.applyStylesToKeyframe()}),t.currentTimeline.mergeTimelineCollectedStyles(a),t.transformIntoNewTimeline(i+s),t.previousNode=e}visitQuery(e,t){let r=t.currentTimeline.currentTime,i=e.options||{},s=i.delay?Vn(i.delay):0;s&&(t.previousNode.type===de.Style||r==0&&t.currentTimeline.hasCurrentStyleProperties())&&(t.currentTimeline.snapshotCurrentStyles(),t.previousNode=Kc);let o=r,a=t.invokeQuery(e.selector,e.originalSelector,e.limit,e.includeSelf,!!i.optional,t.errors);t.currentQueryTotal=a.length;let u=null;a.forEach((c,d)=>{t.currentQueryIndex=d;let f=t.createSubContext(e.options,c);s&&f.delayNextStep(s),c===t.element&&(u=f.currentTimeline),xt(this,e.animation,f),f.currentTimeline.applyStylesToKeyframe();let m=f.currentTimeline.currentTime;o=Math.max(o,m)}),t.currentQueryIndex=0,t.currentQueryTotal=0,t.transformIntoNewTimeline(o),u&&(t.currentTimeline.mergeTimelineCollectedStyles(u),t.currentTimeline.snapshotCurrentStyles()),t.previousNode=e}visitStagger(e,t){let r=t.parentContext,i=t.currentTimeline,s=e.timings,o=Math.abs(s.duration),a=o*(t.currentQueryTotal-1),u=o*t.currentQueryIndex;switch(s.duration<0?"reverse":s.easing){case"reverse":u=a-u;break;case"full":u=r.currentStaggerTime;break}let d=t.currentTimeline;u&&d.delayNextStep(u);let f=d.currentTime;xt(this,e.animation,t),t.previousNode=e,r.currentStaggerTime=i.currentTime-f+(i.startTime-r.currentTimeline.startTime)}},Kc={},n_=class n{constructor(e,t,r,i,s,o,a,u){this._driver=e,this.element=t,this.subInstructions=r,this._enterClassName=i,this._leaveClassName=s,this.errors=o,this.timelines=a,this.parentContext=null,this.currentAnimateTimings=null,this.previousNode=Kc,this.subContextCount=0,this.options={},this.currentQueryIndex=0,this.currentQueryTotal=0,this.currentStaggerTime=0,this.currentTimeline=u||new Gc(this._driver,t,0),a.push(this.currentTimeline)}get params(){return this.options.params}updateOptions(e,t){if(!e)return;let r=e,i=this.options;r.duration!=null&&(i.duration=Vn(r.duration)),r.delay!=null&&(i.delay=Vn(r.delay));let s=r.params;if(s){let o=i.params;o||(o=this.options.params={}),Object.keys(s).forEach(a=>{(!t||!o.hasOwnProperty(a))&&(o[a]=Ia(s[a],o,this.errors))})}}_copyOptions(){let e={};if(this.options){let t=this.options.params;if(t){let r=e.params={};Object.keys(t).forEach(i=>{r[i]=t[i]})}}return e}createSubContext(e=null,t,r){let i=t||this.element,s=new n(this._driver,i,this.subInstructions,this._enterClassName,this._leaveClassName,this.errors,this.timelines,this.currentTimeline.fork(i,r||0));return s.previousNode=this.previousNode,s.currentAnimateTimings=this.currentAnimateTimings,s.options=this._copyOptions(),s.updateOptions(e),s.currentQueryIndex=this.currentQueryIndex,s.currentQueryTotal=this.currentQueryTotal,s.parentContext=this,this.subContextCount++,s}transformIntoNewTimeline(e){return this.previousNode=Kc,this.currentTimeline=this.currentTimeline.fork(this.element,e),this.timelines.push(this.currentTimeline),this.currentTimeline}appendInstructionToTimeline(e,t,r){let i={duration:t??e.duration,delay:this.currentTimeline.currentTime+(r??0)+e.delay,easing:""},s=new r_(this._driver,e.element,e.keyframes,e.preStyleProps,e.postStyleProps,i,e.stretchStartingKeyframe);return this.timelines.push(s),i}incrementTime(e){this.currentTimeline.forwardTime(this.currentTimeline.duration+e)}delayNextStep(e){e>0&&this.currentTimeline.delayNextStep(e)}invokeQuery(e,t,r,i,s,o){let a=[];if(i&&a.push(this.element),e.length>0){e=e.replace(Bk,"."+this._enterClassName),e=e.replace(qk,"."+this._leaveClassName);let u=r!=1,c=this._driver.query(this.element,e,u);r!==0&&(c=r<0?c.slice(c.length+r,c.length):c.slice(0,r)),a.push(...c)}return!s&&a.length==0&&o.push(tk(t)),a}},Gc=class n{constructor(e,t,r,i){this._driver=e,this.element=t,this.startTime=r,this._elementTimelineStylesLookup=i,this.duration=0,this.easing=null,this._previousKeyframe=new Map,this._currentKeyframe=new Map,this._keyframes=new Map,this._styleSummary=new Map,this._localTimelineStyles=new Map,this._pendingStyles=new Map,this._backFill=new Map,this._currentEmptyStepKeyframe=null,this._elementTimelineStylesLookup||(this._elementTimelineStylesLookup=new Map),this._globalTimelineStyles=this._elementTimelineStylesLookup.get(t),this._globalTimelineStyles||(this._globalTimelineStyles=this._localTimelineStyles,this._elementTimelineStylesLookup.set(t,this._localTimelineStyles)),this._loadKeyframe()}containsAnimation(){switch(this._keyframes.size){case 0:return!1;case 1:return this.hasCurrentStyleProperties();default:return!0}}hasCurrentStyleProperties(){return this._currentKeyframe.size>0}get currentTime(){return this.startTime+this.duration}delayNextStep(e){let t=this._keyframes.size===1&&this._pendingStyles.size;this.duration||t?(this.forwardTime(this.currentTime+e),t&&this.snapshotCurrentStyles()):this.startTime+=e}fork(e,t){return this.applyStylesToKeyframe(),new n(this._driver,e,t||this.currentTime,this._elementTimelineStylesLookup)}_loadKeyframe(){this._currentKeyframe&&(this._previousKeyframe=this._currentKeyframe),this._currentKeyframe=this._keyframes.get(this.duration),this._currentKeyframe||(this._currentKeyframe=new Map,this._keyframes.set(this.duration,this._currentKeyframe))}forwardFrame(){this.duration+=Vk,this._loadKeyframe()}forwardTime(e){this.applyStylesToKeyframe(),this.duration=e,this._loadKeyframe()}_updateStyle(e,t){this._localTimelineStyles.set(e,t),this._globalTimelineStyles.set(e,t),this._styleSummary.set(e,{time:this.currentTime,value:t})}allowOnlyTimelineStyles(){return this._currentEmptyStepKeyframe!==this._currentKeyframe}applyEmptyStep(e){e&&this._previousKeyframe.set("easing",e);for(let[t,r]of this._globalTimelineStyles)this._backFill.set(t,r||tn),this._currentKeyframe.set(t,tn);this._currentEmptyStepKeyframe=this._currentKeyframe}setStyles(e,t,r,i){t&&this._previousKeyframe.set("easing",t);let s=i&&i.params||{},o=jk(e,this._globalTimelineStyles);for(let[a,u]of o){let c=Ia(u,s,r);this._pendingStyles.set(a,c),this._localTimelineStyles.has(a)||this._backFill.set(a,this._globalTimelineStyles.get(a)??tn),this._updateStyle(a,c)}}applyStylesToKeyframe(){this._pendingStyles.size!=0&&(this._pendingStyles.forEach((e,t)=>{this._currentKeyframe.set(t,e)}),this._pendingStyles.clear(),this._localTimelineStyles.forEach((e,t)=>{this._currentKeyframe.has(t)||this._currentKeyframe.set(t,e)}))}snapshotCurrentStyles(){for(let[e,t]of this._localTimelineStyles)this._pendingStyles.set(e,t),this._updateStyle(e,t)}getFinalKeyframe(){return this._keyframes.get(this.duration)}get properties(){let e=[];for(let t in this._currentKeyframe)e.push(t);return e}mergeTimelineCollectedStyles(e){e._styleSummary.forEach((t,r)=>{let i=this._styleSummary.get(r);(!i||t.time>i.time)&&this._updateStyle(r,t.value)})}buildKeyframes(){this.applyStylesToKeyframe();let e=new Set,t=new Set,r=this._keyframes.size===1&&this.duration===0,i=[];this._keyframes.forEach((a,u)=>{let c=new Map([...this._backFill,...a]);c.forEach((d,f)=>{d===$a?e.add(f):d===tn&&t.add(f)}),r||c.set("offset",u/this.duration),i.push(c)});let s=[...e.values()],o=[...t.values()];if(r){let a=i[0],u=new Map(a);a.set("offset",0),u.set("offset",1),i=[a,u]}return __(this.element,i,s,o,this.duration,this.startTime,this.easing,!1)}},r_=class extends Gc{constructor(e,t,r,i,s,o,a=!1){super(e,t,o.delay),this.keyframes=r,this.preStyleProps=i,this.postStyleProps=s,this._stretchStartingKeyframe=a,this.timings={duration:o.duration,delay:o.delay,easing:o.easing}}containsAnimation(){return this.keyframes.length>1}buildKeyframes(){let e=this.keyframes,{delay:t,duration:r,easing:i}=this.timings;if(this._stretchStartingKeyframe&&t){let s=[],o=r+t,a=t/o,u=new Map(e[0]);u.set("offset",0),s.push(u);let c=new Map(e[0]);c.set("offset",z0(a)),s.push(c);let d=e.length-1;for(let f=1;f<=d;f++){let m=new Map(e[f]),_=m.get("offset"),I=t+_*r;m.set("offset",z0(I/o)),s.push(m)}r=o,t=0,i="",e=s}return __(this.element,e,this.preStyleProps,this.postStyleProps,r,t,i,!0)}};function z0(n,e=3){let t=Math.pow(10,e-1);return Math.round(n*t)/t}function jk(n,e){let t=new Map,r;return n.forEach(i=>{if(i==="*"){r??=e.keys();for(let s of r)t.set(s,tn)}else for(let[s,o]of i)t.set(s,o)}),t}function K0(n,e,t,r,i,s,o,a,u,c,d,f,m){return{type:0,element:n,triggerName:e,isRemovalTransition:i,fromState:t,fromStyles:s,toState:r,toStyles:o,timelines:a,queriedElements:u,preStyleProps:c,postStyleProps:d,totalTime:f,errors:m}}var Gg={},Wc=class{constructor(e,t,r){this._triggerName=e,this.ast=t,this._stateStyles=r}match(e,t,r,i){return zk(this.ast.matchers,e,t,r,i)}buildStyles(e,t,r){let i=this._stateStyles.get("*");return e!==void 0&&(i=this._stateStyles.get(e?.toString())||i),i?i.buildStyles(t,r):new Map}build(e,t,r,i,s,o,a,u,c,d){let f=[],m=this.ast.options&&this.ast.options.params||Gg,_=a&&a.params||Gg,I=this.buildStyles(r,_,f),S=u&&u.params||Gg,P=this.buildStyles(i,S,f),V=new Set,U=new Map,L=new Map,$=i==="void",re={params:ob(S,m),delay:this.ast.options?.delay},X=d?[]:sb(e,t,this.ast.animation,s,o,I,P,re,c,f),E=0;return X.forEach(y=>{E=Math.max(y.duration+y.delay,E)}),f.length?K0(t,this._triggerName,r,i,$,I,P,[],[],U,L,E,f):(X.forEach(y=>{let w=y.element,T=kt(U,w,new Set);y.preStyleProps.forEach(A=>T.add(A));let C=kt(L,w,new Set);y.postStyleProps.forEach(A=>C.add(A)),w!==t&&V.add(w)}),K0(t,this._triggerName,r,i,$,I,P,X,[...V.values()],U,L,E))}};function zk(n,e,t,r,i){return n.some(s=>s(e,t,r,i))}function ob(n,e){let t=en({},e);return Object.entries(n).forEach(([r,i])=>{i!=null&&(t[r]=i)}),t}var i_=class{constructor(e,t,r){this.styles=e,this.defaultParams=t,this.normalizer=r}buildStyles(e,t){let r=new Map,i=ob(e,this.defaultParams);return this.styles.styles.forEach(s=>{typeof s!="string"&&s.forEach((o,a)=>{o&&(o=Ia(o,i,t));let u=this.normalizer.normalizePropertyName(a,t);o=this.normalizer.normalizeStyleValue(a,u,o,t),r.set(a,o)})}),r}};function Kk(n,e,t){return new s_(n,e,t)}var s_=class{constructor(e,t,r){this.name=e,this.ast=t,this._normalizer=r,this.transitionFactories=[],this.states=new Map,t.states.forEach(i=>{let s=i.options&&i.options.params||{};this.states.set(i.name,new i_(i.style,s,r))}),G0(this.states,"true","1"),G0(this.states,"false","0"),t.transitions.forEach(i=>{this.transitionFactories.push(new Wc(e,i,this.states))}),this.fallbackTransition=Gk(e,this.states,this._normalizer)}get containsQueries(){return this.ast.queryCount>0}matchTransition(e,t,r,i){return this.transitionFactories.find(o=>o.match(e,t,r,i))||null}matchStyles(e,t,r){return this.fallbackTransition.buildStyles(e,t,r)}};function Gk(n,e,t){let r=[(o,a)=>!0],i={type:de.Sequence,steps:[],options:null},s={type:de.Transition,animation:i,matchers:r,options:null,queryCount:0,depCount:0};return new Wc(n,s,e)}function G0(n,e,t){n.has(e)?n.has(t)||n.set(t,n.get(e)):n.has(t)&&n.set(e,n.get(t))}var Wk=new Ea,o_=class{constructor(e,t,r){this.bodyNode=e,this._driver=t,this._normalizer=r,this._animations=new Map,this._playersById=new Map,this.players=[]}register(e,t){let r=[],i=[],s=ib(this._driver,t,r,i);if(r.length)throw ok(r);i.length&&void 0,this._animations.set(e,s)}_buildPlayer(e,t,r){let i=e.element,s=J0(this._normalizer,e.keyframes,t,r);return this._driver.animate(i,s,e.duration,e.delay,e.easing,[],!0)}create(e,t,r={}){let i=[],s=this._animations.get(e),o,a=new Map;if(s?(o=sb(this._driver,t,s,tb,Hg,new Map,new Map,r,Wk,i),o.forEach(d=>{let f=kt(a,d.element,new Map);d.postStyleProps.forEach(m=>f.set(m,null))})):(i.push(ak()),o=[]),i.length)throw lk(i);a.forEach((d,f)=>{d.forEach((m,_)=>{d.set(_,this._driver.computeStyle(f,_,tn))})});let u=o.map(d=>{let f=a.get(d.element);return this._buildPlayer(d,new Map,f)}),c=Tr(u);return this._playersById.set(e,c),c.onDestroy(()=>this.destroy(e)),this.players.push(c),c}destroy(e){let t=this._getPlayer(e);t.destroy(),this._playersById.delete(e);let r=this.players.indexOf(t);r>=0&&this.players.splice(r,1)}_getPlayer(e){let t=this._playersById.get(e);if(!t)throw uk(e);return t}listen(e,t,r,i){let s=d_(t,"","","");return h_(this._getPlayer(e),r,s,i),()=>{}}command(e,t,r,i){if(r=="register"){this.register(e,i[0]);return}if(r=="create"){let o=i[0]||{};this.create(e,t,o);return}let s=this._getPlayer(e);switch(r){case"play":s.play();break;case"pause":s.pause();break;case"reset":s.reset();break;case"restart":s.restart();break;case"finish":s.finish();break;case"init":s.init();break;case"setPosition":s.setPosition(parseFloat(i[0]));break;case"destroy":this.destroy(e);break}}},W0="ng-animate-queued",Qk=".ng-animate-queued",Wg="ng-animate-disabled",$k=".ng-animate-disabled",Hk="ng-star-inserted",Yk=".ng-star-inserted",Jk=[],ab={namespaceId:"",setForRemoval:!1,setForMove:!1,hasAnimation:!1,removedBeforeQueried:!1},Xk={namespaceId:"",setForMove:!1,setForRemoval:!1,hasAnimation:!1,removedBeforeQueried:!0},Zt="__ng_removed",Ta=class{get params(){return this.options.params}constructor(e,t=""){this.namespaceId=t;let r=e&&e.hasOwnProperty("value"),i=r?e.value:e;if(this.value=eM(i),r){let s=e,{value:o}=s,a=wy(s,["value"]);this.options=a}else this.options={};this.options.params||(this.options.params={})}absorbOptions(e){let t=e.params;if(t){let r=this.options.params;Object.keys(t).forEach(i=>{r[i]==null&&(r[i]=t[i])})}}},wa="void",Qg=new Ta(wa),a_=class{constructor(e,t,r){this.id=e,this.hostElement=t,this._engine=r,this.players=[],this._triggers=new Map,this._queue=[],this._elementListeners=new Map,this._hostClassName="ng-tns-"+e,Kt(t,this._hostClassName)}listen(e,t,r,i){if(!this._triggers.has(t))throw ck(r,t);if(r==null||r.length==0)throw hk(t);if(!tM(r))throw dk(r,t);let s=kt(this._elementListeners,e,[]),o={name:t,phase:r,callback:i};s.push(o);let a=kt(this._engine.statesByElement,e,new Map);return a.has(t)||(Kt(e,Fc),Kt(e,Fc+"-"+t),a.set(t,Qg)),()=>{this._engine.afterFlush(()=>{let u=s.indexOf(o);u>=0&&s.splice(u,1),this._triggers.has(t)||a.delete(t)})}}register(e,t){return this._triggers.has(e)?!1:(this._triggers.set(e,t),!0)}_getTrigger(e){let t=this._triggers.get(e);if(!t)throw fk(e);return t}trigger(e,t,r,i=!0){let s=this._getTrigger(t),o=new Ca(this.id,t,e),a=this._engine.statesByElement.get(e);a||(Kt(e,Fc),Kt(e,Fc+"-"+t),this._engine.statesByElement.set(e,a=new Map));let u=a.get(t),c=new Ta(r,this.id);if(!(r&&r.hasOwnProperty("value"))&&u&&c.absorbOptions(u.options),a.set(t,c),u||(u=Qg),!(c.value===wa)&&u.value===c.value){if(!iM(u.params,c.params)){let S=[],P=s.matchStyles(u.value,u.params,S),V=s.matchStyles(c.value,c.params,S);S.length?this._engine.reportError(S):this._engine.afterFlush(()=>{di(e,P),wn(e,V)})}return}let m=kt(this._engine.playersByElement,e,[]);m.forEach(S=>{S.namespaceId==this.id&&S.triggerName==t&&S.queued&&S.destroy()});let _=s.matchTransition(u.value,c.value,e,c.params),I=!1;if(!_){if(!i)return;_=s.fallbackTransition,I=!0}return this._engine.totalQueuedPlayers++,this._queue.push({element:e,triggerName:t,transition:_,fromState:u,toState:c,player:o,isFallbackTransition:I}),I||(Kt(e,W0),o.onStart(()=>{Ps(e,W0)})),o.onDone(()=>{let S=this.players.indexOf(o);S>=0&&this.players.splice(S,1);let P=this._engine.playersByElement.get(e);if(P){let V=P.indexOf(o);V>=0&&P.splice(V,1)}}),this.players.push(o),m.push(o),o}deregister(e){this._triggers.delete(e),this._engine.statesByElement.forEach(t=>t.delete(e)),this._elementListeners.forEach((t,r)=>{this._elementListeners.set(r,t.filter(i=>i.name!=e))})}clearElementCache(e){this._engine.statesByElement.delete(e),this._elementListeners.delete(e);let t=this._engine.playersByElement.get(e);t&&(t.forEach(r=>r.destroy()),this._engine.playersByElement.delete(e))}_signalRemovalForInnerTriggers(e,t){let r=this._engine.driver.query(e,Uc,!0);r.forEach(i=>{if(i[Zt])return;let s=this._engine.fetchNamespacesByElement(i);s.size?s.forEach(o=>o.triggerLeaveAnimation(i,t,!1,!0)):this.clearElementCache(i)}),this._engine.afterFlushAnimationsDone(()=>r.forEach(i=>this.clearElementCache(i)))}triggerLeaveAnimation(e,t,r,i){let s=this._engine.statesByElement.get(e),o=new Map;if(s){let a=[];if(s.forEach((u,c)=>{if(o.set(c,u.value),this._triggers.has(c)){let d=this.trigger(e,c,wa,i);d&&a.push(d)}}),a.length)return this._engine.markElementAsRemoved(this.id,e,!0,t,o),r&&Tr(a).onDone(()=>this._engine.processLeaveNode(e)),!0}return!1}prepareLeaveAnimationListeners(e){let t=this._elementListeners.get(e),r=this._engine.statesByElement.get(e);if(t&&r){let i=new Set;t.forEach(s=>{let o=s.name;if(i.has(o))return;i.add(o);let u=this._triggers.get(o).fallbackTransition,c=r.get(o)||Qg,d=new Ta(wa),f=new Ca(this.id,o,e);this._engine.totalQueuedPlayers++,this._queue.push({element:e,triggerName:o,transition:u,fromState:c,toState:d,player:f,isFallbackTransition:!0})})}}removeNode(e,t){let r=this._engine;if(e.childElementCount&&this._signalRemovalForInnerTriggers(e,t),this.triggerLeaveAnimation(e,t,!0))return;let i=!1;if(r.totalAnimations){let s=r.players.length?r.playersByQueriedElement.get(e):[];if(s&&s.length)i=!0;else{let o=e;for(;o=o.parentNode;)if(r.statesByElement.get(o)){i=!0;break}}}if(this.prepareLeaveAnimationListeners(e),i)r.markElementAsRemoved(this.id,e,!1,t);else{let s=e[Zt];(!s||s===ab)&&(r.afterFlush(()=>this.clearElementCache(e)),r.destroyInnerAnimations(e),r._onRemovalComplete(e,t))}}insertNode(e,t){Kt(e,this._hostClassName)}drainQueuedTransitions(e){let t=[];return this._queue.forEach(r=>{let i=r.player;if(i.destroyed)return;let s=r.element,o=this._elementListeners.get(s);o&&o.forEach(a=>{if(a.name==r.triggerName){let u=d_(s,r.triggerName,r.fromState.value,r.toState.value);u._data=e,h_(r.player,a.phase,u,a.callback)}}),i.markedForDestroy?this._engine.afterFlush(()=>{i.destroy()}):t.push(r)}),this._queue=[],t.sort((r,i)=>{let s=r.transition.ast.depCount,o=i.transition.ast.depCount;return s==0||o==0?s-o:this._engine.driver.containsElement(r.element,i.element)?1:-1})}destroy(e){this.players.forEach(t=>t.destroy()),this._signalRemovalForInnerTriggers(this.hostElement,e)}},l_=class{_onRemovalComplete(e,t){this.onRemovalComplete(e,t)}constructor(e,t,r,i){this.bodyNode=e,this.driver=t,this._normalizer=r,this.scheduler=i,this.players=[],this.newHostElements=new Map,this.playersByElement=new Map,this.playersByQueriedElement=new Map,this.statesByElement=new Map,this.disabledNodes=new Set,this.totalAnimations=0,this.totalQueuedPlayers=0,this._namespaceLookup={},this._namespaceList=[],this._flushFns=[],this._whenQuietFns=[],this.namespacesByHostElement=new Map,this.collectedEnterElements=[],this.collectedLeaveElements=[],this.onRemovalComplete=(s,o)=>{}}get queuedPlayers(){let e=[];return this._namespaceList.forEach(t=>{t.players.forEach(r=>{r.queued&&e.push(r)})}),e}createNamespace(e,t){let r=new a_(e,t,this);return this.bodyNode&&this.driver.containsElement(this.bodyNode,t)?this._balanceNamespaceList(r,t):(this.newHostElements.set(t,r),this.collectEnterElement(t)),this._namespaceLookup[e]=r}_balanceNamespaceList(e,t){let r=this._namespaceList,i=this.namespacesByHostElement;if(r.length-1>=0){let o=!1,a=this.driver.getParentElement(t);for(;a;){let u=i.get(a);if(u){let c=r.indexOf(u);r.splice(c+1,0,e),o=!0;break}a=this.driver.getParentElement(a)}o||r.unshift(e)}else r.push(e);return i.set(t,e),e}register(e,t){let r=this._namespaceLookup[e];return r||(r=this.createNamespace(e,t)),r}registerTrigger(e,t,r){let i=this._namespaceLookup[e];i&&i.register(t,r)&&this.totalAnimations++}destroy(e,t){e&&(this.afterFlush(()=>{}),this.afterFlushAnimationsDone(()=>{let r=this._fetchNamespace(e);this.namespacesByHostElement.delete(r.hostElement);let i=this._namespaceList.indexOf(r);i>=0&&this._namespaceList.splice(i,1),r.destroy(t),delete this._namespaceLookup[e]}))}_fetchNamespace(e){return this._namespaceLookup[e]}fetchNamespacesByElement(e){let t=new Set,r=this.statesByElement.get(e);if(r){for(let i of r.values())if(i.namespaceId){let s=this._fetchNamespace(i.namespaceId);s&&t.add(s)}}return t}trigger(e,t,r,i){if(Lc(t)){let s=this._fetchNamespace(e);if(s)return s.trigger(t,r,i),!0}return!1}insertNode(e,t,r,i){if(!Lc(t))return;let s=t[Zt];if(s&&s.setForRemoval){s.setForRemoval=!1,s.setForMove=!0;let o=this.collectedLeaveElements.indexOf(t);o>=0&&this.collectedLeaveElements.splice(o,1)}if(e){let o=this._fetchNamespace(e);o&&o.insertNode(t,r)}i&&this.collectEnterElement(t)}collectEnterElement(e){this.collectedEnterElements.push(e)}markElementAsDisabled(e,t){t?this.disabledNodes.has(e)||(this.disabledNodes.add(e),Kt(e,Wg)):this.disabledNodes.has(e)&&(this.disabledNodes.delete(e),Ps(e,Wg))}removeNode(e,t,r){if(Lc(t)){this.scheduler?.notify();let i=e?this._fetchNamespace(e):null;i?i.removeNode(t,r):this.markElementAsRemoved(e,t,!1,r);let s=this.namespacesByHostElement.get(t);s&&s.id!==e&&s.removeNode(t,r)}else this._onRemovalComplete(t,r)}markElementAsRemoved(e,t,r,i,s){this.collectedLeaveElements.push(t),t[Zt]={namespaceId:e,setForRemoval:i,hasAnimation:r,removedBeforeQueried:!1,previousTriggersValues:s}}listen(e,t,r,i,s){return Lc(t)?this._fetchNamespace(e).listen(t,r,i,s):()=>{}}_buildInstruction(e,t,r,i,s){return e.transition.build(this.driver,e.element,e.fromState.value,e.toState.value,r,i,e.fromState.options,e.toState.options,t,s)}destroyInnerAnimations(e){let t=this.driver.query(e,Uc,!0);t.forEach(r=>this.destroyActiveAnimationsForElement(r)),this.playersByQueriedElement.size!=0&&(t=this.driver.query(e,Yg,!0),t.forEach(r=>this.finishActiveQueriedAnimationOnElement(r)))}destroyActiveAnimationsForElement(e){let t=this.playersByElement.get(e);t&&t.forEach(r=>{r.queued?r.markedForDestroy=!0:r.destroy()})}finishActiveQueriedAnimationOnElement(e){let t=this.playersByQueriedElement.get(e);t&&t.forEach(r=>r.finish())}whenRenderingDone(){return new Promise(e=>{if(this.players.length)return Tr(this.players).onDone(()=>e());e()})}processLeaveNode(e){let t=e[Zt];if(t&&t.setForRemoval){if(e[Zt]=ab,t.namespaceId){this.destroyInnerAnimations(e);let r=this._fetchNamespace(t.namespaceId);r&&r.clearElementCache(e)}this._onRemovalComplete(e,t.setForRemoval)}e.classList?.contains(Wg)&&this.markElementAsDisabled(e,!1),this.driver.query(e,$k,!0).forEach(r=>{this.markElementAsDisabled(r,!1)})}flush(e=-1){let t=[];if(this.newHostElements.size&&(this.newHostElements.forEach((r,i)=>this._balanceNamespaceList(r,i)),this.newHostElements.clear()),this.totalAnimations&&this.collectedEnterElements.length)for(let r=0;r<this.collectedEnterElements.length;r++){let i=this.collectedEnterElements[r];Kt(i,Hk)}if(this._namespaceList.length&&(this.totalQueuedPlayers||this.collectedLeaveElements.length)){let r=[];try{t=this._flushAnimations(r,e)}finally{for(let i=0;i<r.length;i++)r[i]()}}else for(let r=0;r<this.collectedLeaveElements.length;r++){let i=this.collectedLeaveElements[r];this.processLeaveNode(i)}if(this.totalQueuedPlayers=0,this.collectedEnterElements.length=0,this.collectedLeaveElements.length=0,this._flushFns.forEach(r=>r()),this._flushFns=[],this._whenQuietFns.length){let r=this._whenQuietFns;this._whenQuietFns=[],t.length?Tr(t).onDone(()=>{r.forEach(i=>i())}):r.forEach(i=>i())}}reportError(e){throw pk(e)}_flushAnimations(e,t){let r=new Ea,i=[],s=new Map,o=[],a=new Map,u=new Map,c=new Map,d=new Set;this.disabledNodes.forEach(W=>{d.add(W);let H=this.driver.query(W,Qk,!0);for(let J=0;J<H.length;J++)d.add(H[J])});let f=this.bodyNode,m=Array.from(this.statesByElement.keys()),_=H0(m,this.collectedEnterElements),I=new Map,S=0;_.forEach((W,H)=>{let J=tb+S++;I.set(H,J),W.forEach(ue=>Kt(ue,J))});let P=[],V=new Set,U=new Set;for(let W=0;W<this.collectedLeaveElements.length;W++){let H=this.collectedLeaveElements[W],J=H[Zt];J&&J.setForRemoval&&(P.push(H),V.add(H),J.hasAnimation?this.driver.query(H,Yk,!0).forEach(ue=>V.add(ue)):U.add(H))}let L=new Map,$=H0(m,Array.from(V));$.forEach((W,H)=>{let J=Hg+S++;L.set(H,J),W.forEach(ue=>Kt(ue,J))}),e.push(()=>{_.forEach((W,H)=>{let J=I.get(H);W.forEach(ue=>Ps(ue,J))}),$.forEach((W,H)=>{let J=L.get(H);W.forEach(ue=>Ps(ue,J))}),P.forEach(W=>{this.processLeaveNode(W)})});let re=[],X=[];for(let W=this._namespaceList.length-1;W>=0;W--)this._namespaceList[W].drainQueuedTransitions(t).forEach(J=>{let ue=J.player,Ue=J.element;if(re.push(ue),this.collectedEnterElements.length){let Ve=Ue[Zt];if(Ve&&Ve.setForMove){if(Ve.previousTriggersValues&&Ve.previousTriggersValues.has(J.triggerName)){let In=Ve.previousTriggersValues.get(J.triggerName),It=this.statesByElement.get(J.element);if(It&&It.has(J.triggerName)){let En=It.get(J.triggerName);En.value=In,It.set(J.triggerName,En)}}ue.destroy();return}}let Ft=!f||!this.driver.containsElement(f,Ue),Oe=L.get(Ue),Ae=I.get(Ue),Re=this._buildInstruction(J,r,Ae,Oe,Ft);if(Re.errors&&Re.errors.length){X.push(Re);return}if(Ft){ue.onStart(()=>di(Ue,Re.fromStyles)),ue.onDestroy(()=>wn(Ue,Re.toStyles)),i.push(ue);return}if(J.isFallbackTransition){ue.onStart(()=>di(Ue,Re.fromStyles)),ue.onDestroy(()=>wn(Ue,Re.toStyles)),i.push(ue);return}let Bn=[];Re.timelines.forEach(Ve=>{Ve.stretchStartingKeyframe=!0,this.disabledNodes.has(Ve.element)||Bn.push(Ve)}),Re.timelines=Bn,r.append(Ue,Re.timelines);let rh={instruction:Re,player:ue,element:Ue};o.push(rh),Re.queriedElements.forEach(Ve=>kt(a,Ve,[]).push(ue)),Re.preStyleProps.forEach((Ve,In)=>{if(Ve.size){let It=u.get(In);It||u.set(In,It=new Set),Ve.forEach((En,Un)=>It.add(Un))}}),Re.postStyleProps.forEach((Ve,In)=>{let It=c.get(In);It||c.set(In,It=new Set),Ve.forEach((En,Un)=>It.add(Un))})});if(X.length){let W=[];X.forEach(H=>{W.push(mk(H.triggerName,H.errors))}),re.forEach(H=>H.destroy()),this.reportError(W)}let E=new Map,y=new Map;o.forEach(W=>{let H=W.element;r.has(H)&&(y.set(H,H),this._beforeAnimationBuild(W.player.namespaceId,W.instruction,E))}),i.forEach(W=>{let H=W.element;this._getPreviousPlayers(H,!1,W.namespaceId,W.triggerName,null).forEach(ue=>{kt(E,H,[]).push(ue),ue.destroy()})});let w=P.filter(W=>Y0(W,u,c)),T=new Map;$0(T,this.driver,U,c,tn).forEach(W=>{Y0(W,u,c)&&w.push(W)});let A=new Map;_.forEach((W,H)=>{$0(A,this.driver,new Set(W),u,$a)}),w.forEach(W=>{let H=T.get(W),J=A.get(W);T.set(W,new Map([...H?.entries()??[],...J?.entries()??[]]))});let v=[],Mt=[],Ln={};o.forEach(W=>{let{element:H,player:J,instruction:ue}=W;if(r.has(H)){if(d.has(H)){J.onDestroy(()=>wn(H,ue.toStyles)),J.disabled=!0,J.overrideTotalTime(ue.totalTime),i.push(J);return}let Ue=Ln;if(y.size>1){let Oe=H,Ae=[];for(;Oe=Oe.parentNode;){let Re=y.get(Oe);if(Re){Ue=Re;break}Ae.push(Oe)}Ae.forEach(Re=>y.set(Re,Ue))}let Ft=this._buildAnimation(J.namespaceId,ue,E,s,A,T);if(J.setRealPlayer(Ft),Ue===Ln)v.push(J);else{let Oe=this.playersByElement.get(Ue);Oe&&Oe.length&&(J.parentPlayer=Tr(Oe)),i.push(J)}}else di(H,ue.fromStyles),J.onDestroy(()=>wn(H,ue.toStyles)),Mt.push(J),d.has(H)&&i.push(J)}),Mt.forEach(W=>{let H=s.get(W.element);if(H&&H.length){let J=Tr(H);W.setRealPlayer(J)}}),i.forEach(W=>{W.parentPlayer?W.syncPlayerEvents(W.parentPlayer):W.destroy()});for(let W=0;W<P.length;W++){let H=P[W],J=H[Zt];if(Ps(H,Hg),J&&J.hasAnimation)continue;let ue=[];if(a.size){let Ft=a.get(H);Ft&&Ft.length&&ue.push(...Ft);let Oe=this.driver.query(H,Yg,!0);for(let Ae=0;Ae<Oe.length;Ae++){let Re=a.get(Oe[Ae]);Re&&Re.length&&ue.push(...Re)}}let Ue=ue.filter(Ft=>!Ft.destroyed);Ue.length?nM(this,H,Ue):this.processLeaveNode(H)}return P.length=0,v.forEach(W=>{this.players.push(W),W.onDone(()=>{W.destroy();let H=this.players.indexOf(W);this.players.splice(H,1)}),W.play()}),v}afterFlush(e){this._flushFns.push(e)}afterFlushAnimationsDone(e){this._whenQuietFns.push(e)}_getPreviousPlayers(e,t,r,i,s){let o=[];if(t){let a=this.playersByQueriedElement.get(e);a&&(o=a)}else{let a=this.playersByElement.get(e);if(a){let u=!s||s==wa;a.forEach(c=>{c.queued||!u&&c.triggerName!=i||o.push(c)})}}return(r||i)&&(o=o.filter(a=>!(r&&r!=a.namespaceId||i&&i!=a.triggerName))),o}_beforeAnimationBuild(e,t,r){let i=t.triggerName,s=t.element,o=t.isRemovalTransition?void 0:e,a=t.isRemovalTransition?void 0:i;for(let u of t.timelines){let c=u.element,d=c!==s,f=kt(r,c,[]);this._getPreviousPlayers(c,d,o,a,t.toState).forEach(_=>{let I=_.getRealPlayer();I.beforeDestroy&&I.beforeDestroy(),_.destroy(),f.push(_)})}di(s,t.fromStyles)}_buildAnimation(e,t,r,i,s,o){let a=t.triggerName,u=t.element,c=[],d=new Set,f=new Set,m=t.timelines.map(I=>{let S=I.element;d.add(S);let P=S[Zt];if(P&&P.removedBeforeQueried)return new Ii(I.duration,I.delay);let V=S!==u,U=rM((r.get(S)||Jk).map(E=>E.getRealPlayer())).filter(E=>{let y=E;return y.element?y.element===S:!1}),L=s.get(S),$=o.get(S),re=J0(this._normalizer,I.keyframes,L,$),X=this._buildPlayer(I,re,U);if(I.subTimeline&&i&&f.add(S),V){let E=new Ca(e,a,S);E.setRealPlayer(X),c.push(E)}return X});c.forEach(I=>{kt(this.playersByQueriedElement,I.element,[]).push(I),I.onDone(()=>Zk(this.playersByQueriedElement,I.element,I))}),d.forEach(I=>Kt(I,U0));let _=Tr(m);return _.onDestroy(()=>{d.forEach(I=>Ps(I,U0)),wn(u,t.toStyles)}),f.forEach(I=>{kt(i,I,[]).push(_)}),_}_buildPlayer(e,t,r){return t.length>0?this.driver.animate(e.element,t,e.duration,e.delay,e.easing,r):new Ii(e.duration,e.delay)}},Ca=class{constructor(e,t,r){this.namespaceId=e,this.triggerName=t,this.element=r,this._player=new Ii,this._containsRealPlayer=!1,this._queuedCallbacks=new Map,this.destroyed=!1,this.parentPlayer=null,this.markedForDestroy=!1,this.disabled=!1,this.queued=!0,this.totalTime=0}setRealPlayer(e){this._containsRealPlayer||(this._player=e,this._queuedCallbacks.forEach((t,r)=>{t.forEach(i=>h_(e,r,void 0,i))}),this._queuedCallbacks.clear(),this._containsRealPlayer=!0,this.overrideTotalTime(e.totalTime),this.queued=!1)}getRealPlayer(){return this._player}overrideTotalTime(e){this.totalTime=e}syncPlayerEvents(e){let t=this._player;t.triggerCallback&&e.onStart(()=>t.triggerCallback("start")),e.onDone(()=>this.finish()),e.onDestroy(()=>this.destroy())}_queueEvent(e,t){kt(this._queuedCallbacks,e,[]).push(t)}onDone(e){this.queued&&this._queueEvent("done",e),this._player.onDone(e)}onStart(e){this.queued&&this._queueEvent("start",e),this._player.onStart(e)}onDestroy(e){this.queued&&this._queueEvent("destroy",e),this._player.onDestroy(e)}init(){this._player.init()}hasStarted(){return this.queued?!1:this._player.hasStarted()}play(){!this.queued&&this._player.play()}pause(){!this.queued&&this._player.pause()}restart(){!this.queued&&this._player.restart()}finish(){this._player.finish()}destroy(){this.destroyed=!0,this._player.destroy()}reset(){!this.queued&&this._player.reset()}setPosition(e){this.queued||this._player.setPosition(e)}getPosition(){return this.queued?0:this._player.getPosition()}triggerCallback(e){let t=this._player;t.triggerCallback&&t.triggerCallback(e)}};function Zk(n,e,t){let r=n.get(e);if(r){if(r.length){let i=r.indexOf(t);r.splice(i,1)}r.length==0&&n.delete(e)}return r}function eM(n){return n??null}function Lc(n){return n&&n.nodeType===1}function tM(n){return n=="start"||n=="done"}function Q0(n,e){let t=n.style.display;return n.style.display=e??"none",t}function $0(n,e,t,r,i){let s=[];t.forEach(u=>s.push(Q0(u)));let o=[];r.forEach((u,c)=>{let d=new Map;u.forEach(f=>{let m=e.computeStyle(c,f,i);d.set(f,m),(!m||m.length==0)&&(c[Zt]=Xk,o.push(c))}),n.set(c,d)});let a=0;return t.forEach(u=>Q0(u,s[a++])),o}function H0(n,e){let t=new Map;if(n.forEach(a=>t.set(a,[])),e.length==0)return t;let r=1,i=new Set(e),s=new Map;function o(a){if(!a)return r;let u=s.get(a);if(u)return u;let c=a.parentNode;return t.has(c)?u=c:i.has(c)?u=r:u=o(c),s.set(a,u),u}return e.forEach(a=>{let u=o(a);u!==r&&t.get(u).push(a)}),t}function Kt(n,e){n.classList?.add(e)}function Ps(n,e){n.classList?.remove(e)}function nM(n,e,t){Tr(t).onDone(()=>n.processLeaveNode(e))}function rM(n){let e=[];return lb(n,e),e}function lb(n,e){for(let t=0;t<n.length;t++){let r=n[t];r instanceof Mh?lb(r.players,e):e.push(r)}}function iM(n,e){let t=Object.keys(n),r=Object.keys(e);if(t.length!=r.length)return!1;for(let i=0;i<t.length;i++){let s=t[i];if(!e.hasOwnProperty(s)||n[s]!==e[s])return!1}return!0}function Y0(n,e,t){let r=t.get(n);if(!r)return!1;let i=e.get(n);return i?r.forEach(s=>i.add(s)):e.set(n,r),t.delete(n),!0}var Ns=class{constructor(e,t,r,i){this._driver=t,this._normalizer=r,this._triggerCache={},this.onRemovalComplete=(s,o)=>{},this._transitionEngine=new l_(e.body,t,r,i),this._timelineEngine=new o_(e.body,t,r),this._transitionEngine.onRemovalComplete=(s,o)=>this.onRemovalComplete(s,o)}registerTrigger(e,t,r,i,s){let o=e+"-"+i,a=this._triggerCache[o];if(!a){let u=[],c=[],d=ib(this._driver,s,u,c);if(u.length)throw ik(i,u);c.length&&void 0,a=Kk(i,d,this._normalizer),this._triggerCache[o]=a}this._transitionEngine.registerTrigger(t,i,a)}register(e,t){this._transitionEngine.register(e,t)}destroy(e,t){this._transitionEngine.destroy(e,t)}onInsert(e,t,r,i){this._transitionEngine.insertNode(e,t,r,i)}onRemove(e,t,r){this._transitionEngine.removeNode(e,t,r)}disableAnimations(e,t){this._transitionEngine.markElementAsDisabled(e,t)}process(e,t,r,i){if(r.charAt(0)=="@"){let[s,o]=L0(r),a=i;this._timelineEngine.command(s,t,o,a)}else this._transitionEngine.trigger(e,t,r,i)}listen(e,t,r,i,s){if(r.charAt(0)=="@"){let[o,a]=L0(r);return this._timelineEngine.listen(o,t,a,s)}return this._transitionEngine.listen(e,t,r,i,s)}flush(e=-1){this._transitionEngine.flush(e)}get players(){return[...this._transitionEngine.players,...this._timelineEngine.players]}whenRenderingDone(){return this._transitionEngine.whenRenderingDone()}afterFlushAnimationsDone(e){this._transitionEngine.afterFlushAnimationsDone(e)}};function sM(n,e){let t=null,r=null;return Array.isArray(e)&&e.length?(t=$g(e[0]),e.length>1&&(r=$g(e[e.length-1]))):e instanceof Map&&(t=$g(e)),t||r?new u_(n,t,r):null}var u_=class n{static{this.initialStylesByElement=new WeakMap}constructor(e,t,r){this._element=e,this._startStyles=t,this._endStyles=r,this._state=0;let i=n.initialStylesByElement.get(e);i||n.initialStylesByElement.set(e,i=new Map),this._initialStyles=i}start(){this._state<1&&(this._startStyles&&wn(this._element,this._startStyles,this._initialStyles),this._state=1)}finish(){this.start(),this._state<2&&(wn(this._element,this._initialStyles),this._endStyles&&(wn(this._element,this._endStyles),this._endStyles=null),this._state=1)}destroy(){this.finish(),this._state<3&&(n.initialStylesByElement.delete(this._element),this._startStyles&&(di(this._element,this._startStyles),this._endStyles=null),this._endStyles&&(di(this._element,this._endStyles),this._endStyles=null),wn(this._element,this._initialStyles),this._state=3)}};function $g(n){let e=null;return n.forEach((t,r)=>{oM(r)&&(e=e||new Map,e.set(r,t))}),e}function oM(n){return n==="display"||n==="position"}var Qc=class{constructor(e,t,r,i){this.element=e,this.keyframes=t,this.options=r,this._specialStyles=i,this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._initialized=!1,this._finished=!1,this._started=!1,this._destroyed=!1,this._originalOnDoneFns=[],this._originalOnStartFns=[],this.time=0,this.parentPlayer=null,this.currentSnapshot=new Map,this._duration=r.duration,this._delay=r.delay||0,this.time=this._duration+this._delay}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(e=>e()),this._onDoneFns=[])}init(){this._buildPlayer(),this._preparePlayerBeforeStart()}_buildPlayer(){if(this._initialized)return;this._initialized=!0;let e=this.keyframes;this.domPlayer=this._triggerWebAnimation(this.element,e,this.options),this._finalKeyframe=e.length?e[e.length-1]:new Map;let t=()=>this._onFinish();this.domPlayer.addEventListener("finish",t),this.onDestroy(()=>{this.domPlayer.removeEventListener("finish",t)})}_preparePlayerBeforeStart(){this._delay?this._resetDomPlayerState():this.domPlayer.pause()}_convertKeyframesToObject(e){let t=[];return e.forEach(r=>{t.push(Object.fromEntries(r))}),t}_triggerWebAnimation(e,t,r){return e.animate(this._convertKeyframesToObject(t),r)}onStart(e){this._originalOnStartFns.push(e),this._onStartFns.push(e)}onDone(e){this._originalOnDoneFns.push(e),this._onDoneFns.push(e)}onDestroy(e){this._onDestroyFns.push(e)}play(){this._buildPlayer(),this.hasStarted()||(this._onStartFns.forEach(e=>e()),this._onStartFns=[],this._started=!0,this._specialStyles&&this._specialStyles.start()),this.domPlayer.play()}pause(){this.init(),this.domPlayer.pause()}finish(){this.init(),this._specialStyles&&this._specialStyles.finish(),this._onFinish(),this.domPlayer.finish()}reset(){this._resetDomPlayerState(),this._destroyed=!1,this._finished=!1,this._started=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}_resetDomPlayerState(){this.domPlayer&&this.domPlayer.cancel()}restart(){this.reset(),this.play()}hasStarted(){return this._started}destroy(){this._destroyed||(this._destroyed=!0,this._resetDomPlayerState(),this._onFinish(),this._specialStyles&&this._specialStyles.destroy(),this._onDestroyFns.forEach(e=>e()),this._onDestroyFns=[])}setPosition(e){this.domPlayer===void 0&&this.init(),this.domPlayer.currentTime=e*this.time}getPosition(){return+(this.domPlayer.currentTime??0)/this.time}get totalTime(){return this._delay+this._duration}beforeDestroy(){let e=new Map;this.hasStarted()&&this._finalKeyframe.forEach((r,i)=>{i!=="offset"&&e.set(i,this._finished?r:g_(this.element,i))}),this.currentSnapshot=e}triggerCallback(e){let t=e==="start"?this._onStartFns:this._onDoneFns;t.forEach(r=>r()),t.length=0}},$c=class{validateStyleProperty(e){return!0}validateAnimatableStyleProperty(e){return!0}matchesElement(e,t){return!1}containsElement(e,t){return X0(e,t)}getParentElement(e){return f_(e)}query(e,t,r){return Z0(e,t,r)}computeStyle(e,t,r){return g_(e,t)}animate(e,t,r,i,s,o=[]){let a=i==0?"both":"forwards",u={duration:r,delay:i,fill:a};s&&(u.easing=s);let c=new Map,d=o.filter(_=>_ instanceof Qc);bk(r,i)&&d.forEach(_=>{_.currentSnapshot.forEach((I,S)=>c.set(S,I))});let f=Tk(t).map(_=>new Map(_));f=Ak(e,f,c);let m=sM(e,f);return new Qc(e,f,u,m)}};var Bc="@",ub="@.disabled",Hc=class{constructor(e,t,r,i){this.namespaceId=e,this.delegate=t,this.engine=r,this._onDestroy=i,this.\u0275type=0}get data(){return this.delegate.data}destroyNode(e){this.delegate.destroyNode?.(e)}destroy(){this.engine.destroy(this.namespaceId,this.delegate),this.engine.afterFlushAnimationsDone(()=>{queueMicrotask(()=>{this.delegate.destroy()})}),this._onDestroy?.()}createElement(e,t){return this.delegate.createElement(e,t)}createComment(e){return this.delegate.createComment(e)}createText(e){return this.delegate.createText(e)}appendChild(e,t){this.delegate.appendChild(e,t),this.engine.onInsert(this.namespaceId,t,e,!1)}insertBefore(e,t,r,i=!0){this.delegate.insertBefore(e,t,r),this.engine.onInsert(this.namespaceId,t,e,i)}removeChild(e,t,r){this.engine.onRemove(this.namespaceId,t,this.delegate)}selectRootElement(e,t){return this.delegate.selectRootElement(e,t)}parentNode(e){return this.delegate.parentNode(e)}nextSibling(e){return this.delegate.nextSibling(e)}setAttribute(e,t,r,i){this.delegate.setAttribute(e,t,r,i)}removeAttribute(e,t,r){this.delegate.removeAttribute(e,t,r)}addClass(e,t){this.delegate.addClass(e,t)}removeClass(e,t){this.delegate.removeClass(e,t)}setStyle(e,t,r,i){this.delegate.setStyle(e,t,r,i)}removeStyle(e,t,r){this.delegate.removeStyle(e,t,r)}setProperty(e,t,r){t.charAt(0)==Bc&&t==ub?this.disableAnimations(e,!!r):this.delegate.setProperty(e,t,r)}setValue(e,t){this.delegate.setValue(e,t)}listen(e,t,r){return this.delegate.listen(e,t,r)}disableAnimations(e,t){this.engine.disableAnimations(e,t)}},c_=class extends Hc{constructor(e,t,r,i,s){super(t,r,i,s),this.factory=e,this.namespaceId=t}setProperty(e,t,r){t.charAt(0)==Bc?t.charAt(1)=="."&&t==ub?(r=r===void 0?!0:!!r,this.disableAnimations(e,r)):this.engine.process(this.namespaceId,e,t.slice(1),r):this.delegate.setProperty(e,t,r)}listen(e,t,r){if(t.charAt(0)==Bc){let i=aM(e),s=t.slice(1),o="";return s.charAt(0)!=Bc&&([s,o]=lM(s)),this.engine.listen(this.namespaceId,i,s,o,a=>{let u=a._data||-1;this.factory.scheduleListenerCallback(u,r,a)})}return this.delegate.listen(e,t,r)}};function aM(n){switch(n){case"body":return document.body;case"document":return document;case"window":return window;default:return n}}function lM(n){let e=n.indexOf("."),t=n.substring(0,e),r=n.slice(e+1);return[t,r]}var Yc=class{constructor(e,t,r){this.delegate=e,this.engine=t,this._zone=r,this._currentId=0,this._microtaskId=1,this._animationCallbacksBuffer=[],this._rendererCache=new Map,this._cdRecurDepth=0,t.onRemovalComplete=(i,s)=>{let o=s?.parentNode(i);o&&s.removeChild(o,i)}}createRenderer(e,t){let r="",i=this.delegate.createRenderer(e,t);if(!e||!t?.data?.animation){let c=this._rendererCache,d=c.get(i);if(!d){let f=()=>c.delete(i);d=new Hc(r,i,this.engine,f),c.set(i,d)}return d}let s=t.id,o=t.id+"-"+this._currentId;this._currentId++,this.engine.register(o,e);let a=c=>{Array.isArray(c)?c.forEach(a):this.engine.registerTrigger(s,o,e,c.name,c)};return t.data.animation.forEach(a),new c_(this,o,i,this.engine)}begin(){this._cdRecurDepth++,this.delegate.begin&&this.delegate.begin()}_scheduleCountTask(){queueMicrotask(()=>{this._microtaskId++})}scheduleListenerCallback(e,t,r){if(e>=0&&e<this._microtaskId){this._zone.run(()=>t(r));return}let i=this._animationCallbacksBuffer;i.length==0&&queueMicrotask(()=>{this._zone.run(()=>{i.forEach(s=>{let[o,a]=s;o(a)}),this._animationCallbacksBuffer=[]})}),i.push([t,r])}end(){this._cdRecurDepth--,this._cdRecurDepth==0&&this._zone.runOutsideAngular(()=>{this._scheduleCountTask(),this.engine.flush(this._microtaskId)}),this.delegate.end&&this.delegate.end()}whenRenderingDone(){return this.engine.whenRenderingDone()}};var cM=(()=>{class n extends Ns{constructor(t,r,i){super(t,r,i,Sy(Py,{optional:!0}))}ngOnDestroy(){this.flush()}static{this.\u0275fac=function(r){return new(r||n)(ae(ky),ae(fi),ae(pi))}}static{this.\u0275prov=Kn({token:n,factory:n.\u0275fac})}}return n})();function hM(){return new jc}function dM(n,e,t){return new Yc(n,e,t)}var hb=[{provide:pi,useFactory:hM},{provide:Ns,useClass:cM},{provide:Ny,useFactory:dM,deps:[Fy,Ns,wi]}],cb=[{provide:fi,useFactory:()=>new $c},{provide:xh,useValue:"BrowserAnimations"},...hb],fM=[{provide:fi,useClass:p_},{provide:xh,useValue:"NoopAnimations"},...hb],db=(()=>{class n{static withConfig(t){return{ngModule:n,providers:t.disableAnimations?fM:cb}}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275mod=G({type:n})}static{this.\u0275inj=K({providers:cb,imports:[Vy]})}}return n})();function Jc(n,e){let t=ee(n);if(isNaN(e))return Tt(n,NaN);if(!e)return t;let r=t.getDate(),i=Tt(n,t.getTime());i.setMonth(t.getMonth()+e+1,0);let s=i.getDate();return r>=s?i:(t.setFullYear(i.getFullYear(),i.getMonth(),r),t)}var pM={};function Xc(){return pM}function Zc(n,e){let t=Xc(),r=e?.weekStartsOn??e?.locale?.options?.weekStartsOn??t.weekStartsOn??t.locale?.options?.weekStartsOn??0,i=ee(n),s=i.getDay(),o=(s<r?7:0)+s-r;return i.setDate(i.getDate()-o),i.setHours(0,0,0,0),i}function mi(n){return Zc(n,{weekStartsOn:1})}function fb(n){let e=ee(n),t=e.getFullYear(),r=Tt(n,0);r.setFullYear(t+1,0,4),r.setHours(0,0,0,0);let i=mi(r),s=Tt(n,0);s.setFullYear(t,0,4),s.setHours(0,0,0,0);let o=mi(s);return e.getTime()>=i.getTime()?t+1:e.getTime()>=o.getTime()?t:t-1}function y_(n){let e=ee(n),t=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()));return t.setUTCFullYear(e.getFullYear()),+n-+t}function pb(n,e){let t=Js(n),r=Js(e),i=+t-y_(t),s=+r-y_(r);return Math.round((i-s)/pv)}function mb(n){let e=fb(n),t=Tt(n,0);return t.setFullYear(e,0,4),t.setHours(0,0,0,0),mi(t)}function gb(n,e){return _l(n,e*yl)}function _b(n,e){return _l(n,e*1e3)}function eh(n,e){let t=e*7;return gl(n,t)}function yb(n){let e;return n.forEach(function(t){let r=ee(t);(e===void 0||e<r||isNaN(Number(r)))&&(e=r)}),e||new Date(NaN)}function wb(n,e){let t=ee(n),r=ee(e),i=vb(t,r),s=Math.abs(pb(t,r));t.setDate(t.getDate()-i*s);let o=+(vb(t,r)===-i),a=i*(s-o);return a===0?0:a}function vb(n,e){let t=n.getFullYear()-e.getFullYear()||n.getMonth()-e.getMonth()||n.getDate()-e.getDate()||n.getHours()-e.getHours()||n.getMinutes()-e.getMinutes()||n.getSeconds()-e.getSeconds()||n.getMilliseconds()-e.getMilliseconds();return t<0?-1:t>0?1:t}function th(n){return e=>{let r=(n?Math[n]:Math.trunc)(e);return r===0?0:r}}function nh(n,e){return+ee(n)-+ee(e)}function Ib(n,e,t){let r=nh(n,e)/yl;return th(t?.roundingMethod)(r)}function Eb(n,e,t){let r=nh(n,e)/1e3;return th(t?.roundingMethod)(r)}function Tb(n){let e=ee(n);return e.setSeconds(0,0),e}function Cb(n){let e=ee(n);return e.setDate(1),e.setHours(0,0,0,0),e}function Sb(n,e){let t=Xc(),r=e?.weekStartsOn??e?.locale?.options?.weekStartsOn??t.weekStartsOn??t.locale?.options?.weekStartsOn??0,i=ee(n),s=i.getDay(),o=(s<r?-7:0)+6-(s-r);return i.setDate(i.getDate()+o),i.setHours(23,59,59,999),i}function bb(n){let e=ee(n),t=+mi(e)-+mb(e);return Math.round(t/fv)+1}function Ab(n){return ee(n).getDate()}function Rb(n){return ee(n).getDay()}function Pb(n){let e=ee(n),t=e.getFullYear(),r=e.getMonth(),i=Tt(n,0);return i.setFullYear(t,r+1,0),i.setHours(0,0,0,0),i.getDate()}function Nb(n){return ee(n).getHours()}function Db(n){return ee(n).getMinutes()}function xb(n){return ee(n).getMonth()}function kb(n){return ee(n).getFullYear()}function v_(n){let e=ee(n);return e.setMilliseconds(0),e}function Mb(n,e){let t=v_(n),r=v_(e);return+t==+r}function Fb(n,e){let t=ee(n),r=t.getFullYear(),i=t.getDate(),s=Tt(n,0);s.setFullYear(r,e,15),s.setHours(0,0,0,0);let o=Pb(s);return t.setMonth(e,Math.min(i,o)),t}function Ob(n,e){let t=ee(n);return t.setDate(e),t}function Vb(n,e){let t=ee(n);return t.setHours(e),t}function Lb(n,e){let t=ee(n);return t.setMinutes(e),t}function Bb(n,e){let t=ee(n);return isNaN(+t)?Tt(n,NaN):(t.setFullYear(e),t)}function Ub(n,e){return Jc(n,-e)}function qb(n,e){return eh(n,-e)}function mM(n){return new Date(n).getTimezoneOffset()}function jb(){return{addDays:gl,addHours:mv,addMinutes:gb,addSeconds:_b,differenceInDays:wb,differenceInMinutes:Ib,differenceInSeconds:Eb,endOfDay:_v,endOfMonth:yv,endOfWeek:Sb,getDay:Rb,getMonth:xb,isSameDay:gv,isSameMonth:vv,isSameSecond:Mb,max:yb,setHours:Vb,setMinutes:Lb,startOfDay:Js,startOfMinute:Tb,startOfMonth:Cb,startOfWeek:Zc,getHours:Nb,getMinutes:Db,getTimezoneOffset:mM}}function zb(){return Ph(Ph({},jb()),{addWeeks:eh,addMonths:Jc,subDays:wv,subWeeks:qb,subMonths:Ub,getISOWeek:bb,setDate:Ob,setMonth:Fb,setYear:Bb,getDate:Ab,getYear:kb})}var Kb={production:!0,firebase:{apiKey:"********************************",authDomain:"********************************",projectId:"********************************",storageBucket:"********************************",messagingSenderId:"********************************",appId:"********************************",measurementId:"********************************"}};var Gb={providers:[Ly(Dw),lv(av()),Wa,qy,rv,O0,eT,Uh,Uy,uv,Iv,By,Ay(Qa,sv.forRoot(),iv.forRoot(),cv.forRoot(),dv.forRoot({provide:hv,useFactory:zb}),Uh.initializeApp(Kb.firebase),db)]};var Wb=(()=>{class n{constructor(t){this.appState=t,this.appState.updateState()}static{this.\u0275fac=function(r){return new(r||n)(Ry(Qa))}}static{this.\u0275cmp=by({type:n,selectors:[["app-root"]],standalone:!0,features:[xy],decls:1,vars:0,template:function(r,i){r&1&&Dy(0,"router-outlet")},dependencies:[Wa]})}}return n})();Oy(Wb,Gb).catch(n=>console.error(n));
